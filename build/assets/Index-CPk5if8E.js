import{u as B,r as v,j as E,o as F,c as m,a as l,b as r,h as L,w as n,d as t,e as N,t as i,g as u,k as T,F as M,i as O}from"./app-BiSPCPuo.js";import{f as w,a as V,e as I,b as P,_ as Y}from"./AuthenticatedLayout-57Q77M7z.js";import{_ as K}from"./AdvancedTable-5fi55ECo.js";import{_ as h}from"./Card-B0sMFwFC.js";import{a as g}from"./api-BtR7IrG5.js";import{r as S}from"./ArrowDownTrayIcon-DICVMDSG.js";import{r as q}from"./EyeIcon-BomQU5Ge.js";import{r as G}from"./TrashIcon-DlbRnS0G.js";import"./ArrowUpIcon-IEJdmouC.js";const H={class:"space-y-6 pb-8"},J={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},Q={class:"flex items-center justify-between"},W={class:"mt-2 text-3xl font-semibold text-gray-900"},X={class:"rounded-lg bg-blue-50 p-3"},Z={class:"flex items-center justify-between"},ee={class:"mt-2 text-3xl font-semibold text-gray-900"},te={class:"rounded-lg bg-purple-50 p-3"},se={class:"flex items-center justify-between"},ae={class:"mt-2 text-3xl font-semibold text-gray-900"},le={class:"rounded-lg bg-green-50 p-3"},oe={class:"flex items-center justify-between"},re={class:"mt-2 text-3xl font-semibold text-gray-900"},ne={class:"rounded-lg bg-orange-50 p-3"},ie={class:"flex items-center gap-3"},ce=["src","alt"],de={key:1,class:"flex h-12 w-12 items-center justify-center rounded-lg bg-gray-100"},ue={class:"font-medium text-gray-900"},me={key:0,class:"text-xs text-gray-500"},ge={class:"flex items-center gap-2"},he={class:"text-gray-900"},_e={class:"flex items-center gap-2"},fe={class:"text-gray-900"},pe={class:"text-gray-900"},ye={class:"text-right text-gray-900"},xe={class:"flex items-center justify-end gap-2"},be=["onClick"],ve=["onClick"],we=["onClick"],ke={key:1,class:"space-y-4"},Ee={__name:"Index",setup($e){B();const _=v(!1),c=v([]),j=v(null),f=[{key:"thumbnail",label:"Screenshot",sortable:!1},{key:"teacher",label:"Teacher",sortable:!0},{key:"student",label:"Student",sortable:!0},{key:"class",label:"Class",sortable:!0},{key:"file_size",label:"Size",sortable:!0,align:"right"},{key:"created_at",label:"Uploaded",sortable:!0,format:"date"}],p=async()=>{_.value=!0;try{const{data:s}=await g.get("/screenshots");c.value=Array.isArray(s.screenshots||s)?(s.screenshots||s).map(e=>({...e,teacher:e.teacher?`${e.teacher.first_name||""} ${e.teacher.last_name||""}`.trim()||e.teacher.email:"N/A",student:e.student?`${e.student.first_name||""} ${e.student.last_name||""}`.trim()||e.student.email:"N/A",class:e.class_schedule?`Class #${e.class_schedule.id}`:"N/A",file_size:e.file_size?`${(e.file_size/1024).toFixed(2)} KB`:"N/A"})):[]}catch(s){console.error("Error fetching screenshots:",s),c.value=[]}finally{_.value=!1}},y=async()=>{try{const{data:s}=await g.get("/dashboard/stats");j.value=s?.stats||{}}catch(s){console.error("Error fetching stats:",s)}},D=s=>{O.visit(`/super-admin/screenshots/${s.id}`)},U=async s=>{try{const e=await g.get(`/screenshots/${s.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=a,o.setAttribute("download",s.file_name||`screenshot-${s.id}.png`),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("Error downloading screenshot:",e),alert("Failed to download screenshot")}},C=async s=>{if(confirm("Are you sure you want to delete this screenshot?"))try{await g.delete(`/screenshots/${s.id}`),await p(),await y()}catch(e){console.error("Error deleting screenshot:",e),alert("Failed to delete screenshot")}},R=async()=>{if(confirm(`Are you sure you want to delete ${selectedRows.value.length} screenshot(s)?`))try{await Promise.all(selectedRows.value.map(s=>g.delete(`/screenshots/${s.id}`))),selectedRows.value=[],await p(),await y()}catch(s){console.error("Error bulk deleting screenshots:",s),alert("Failed to delete some screenshots")}},z=s=>{const e=f.map(b=>b.label).join(","),a=s.map(b=>f.map($=>$.key==="thumbnail"?'""':`"${b[$.key]||""}"`).join(",")).join(`
`),o=`${e}
${a}`,d=new Blob([o],{type:"text/csv"}),k=window.URL.createObjectURL(d),x=document.createElement("a");x.href=k,x.download=`screenshots-${new Date().toISOString().split("T")[0]}.csv`,x.click(),window.URL.revokeObjectURL(k)},A=E(()=>(c.value.reduce((s,e)=>s+(e.file_size?parseFloat(e.file_size):0),0)/1024/1024).toFixed(2));return F(()=>{p(),y()}),(s,e)=>(u(),m(M,null,[l(r(L),{title:"Screenshots Library"}),l(Y,null,{default:n(()=>[t("div",H,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Screenshots Library"),t("p",{class:"mt-1 text-sm text-gray-500"}," Manage all class screenshots ")],-1)),t("div",J,[l(h,{class:"p-6"},{default:n(()=>[t("div",Q,[t("div",null,[e[0]||(e[0]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Screenshots",-1)),t("p",W,i(c.value.length),1)]),t("div",X,[l(r(w),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),l(h,{class:"p-6"},{default:n(()=>[t("div",Z,[t("div",null,[e[1]||(e[1]=t("p",{class:"text-sm font-medium text-gray-600"},"Storage Used",-1)),t("p",ee,i(A.value)+" MB ",1),e[2]||(e[2]=t("p",{class:"mt-1 text-xs text-gray-500"},"Total size",-1))]),t("div",te,[l(r(S),{class:"h-8 w-8 text-purple-600"})])])]),_:1}),l(h,{class:"p-6"},{default:n(()=>[t("div",se,[t("div",null,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-gray-600"},"This Month",-1)),t("p",ae,i(c.value.filter(a=>{const o=new Date(a.created_at),d=new Date;return o.getMonth()===d.getMonth()&&o.getFullYear()===d.getFullYear()}).length),1),e[4]||(e[4]=t("p",{class:"mt-1 text-xs text-gray-500"},"Uploads",-1))]),t("div",le,[l(r(V),{class:"h-8 w-8 text-green-600"})])])]),_:1}),l(h,{class:"p-6"},{default:n(()=>[t("div",oe,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600"},"Today",-1)),t("p",re,i(c.value.filter(a=>{const o=new Date(a.created_at),d=new Date;return o.toDateString()===d.toDateString()}).length),1),e[6]||(e[6]=t("p",{class:"mt-1 text-xs text-gray-500"},"Uploads",-1))]),t("div",ne,[l(r(w),{class:"h-8 w-8 text-orange-600"})])])]),_:1})]),_.value?(u(),m("div",ke,[...e[7]||(e[7]=[t("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(u(),N(K,{key:0,title:"All Screenshots",columns:f,data:c.value,searchable:!0,paginated:!0,selectable:!0,exportable:!0,filters:[],"items-per-page":25,"row-key":"id",onExport:z,onBulkDelete:R},{"cell-thumbnail":n(({row:a})=>[t("div",ie,[a.file_url?(u(),m("img",{key:0,src:a.file_url,alt:a.file_name||"Screenshot",class:"h-12 w-12 rounded-lg object-cover"},null,8,ce)):(u(),m("div",de,[l(r(w),{class:"h-6 w-6 text-gray-400"})])),t("div",null,[t("div",ue,i(a.file_name||"Screenshot"),1),a.class?(u(),m("div",me,i(a.class),1)):T("",!0)])])]),"cell-teacher":n(({row:a})=>[t("div",ge,[l(r(P),{class:"h-4 w-4 text-gray-400"}),t("span",he,i(a.teacher),1)])]),"cell-student":n(({row:a})=>[t("div",_e,[l(r(I),{class:"h-4 w-4 text-gray-400"}),t("span",fe,i(a.student),1)])]),"cell-class":n(({row:a})=>[t("div",pe,i(a.class||"—"),1)]),"cell-file_size":n(({row:a})=>[t("div",ye,i(a.file_size||"—"),1)]),"row-actions":n(({row:a})=>[t("div",xe,[t("button",{onClick:o=>D(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View"},[l(r(q),{class:"h-5 w-5"})],8,be),t("button",{onClick:o=>U(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-green-600 transition-colors",title:"Download"},[l(r(S),{class:"h-5 w-5"})],8,ve),t("button",{onClick:o=>C(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-red-600 transition-colors",title:"Delete"},[l(r(G),{class:"h-5 w-5"})],8,we)])]),_:1},8,["data"]))])]),_:1})],64))}};export{Ee as default};
