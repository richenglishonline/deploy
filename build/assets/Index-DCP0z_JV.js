import{u as T,r as x,j as w,o as V,c as k,a as l,b as i,h as B,w as o,d as e,e as C,t as r,g as _,f as y,F as N,i as R}from"./app-CGuEmW06.js";import{k as O,d as I,j as H,b as M,_ as q}from"./AuthenticatedLayout-CJGuDV3D.js";import{_ as z}from"./AdvancedTable-C74tgwHJ.js";import{_ as u}from"./Card-O4ACqxyG.js";import{_ as b}from"./Badge-xK72gQ5Q.js";import{a as $}from"./api-B9gIEsIZ.js";import{r as G}from"./CheckCircleIcon-QmryU6wr.js";import{r as J}from"./EyeIcon-BaQtjq6r.js";import"./ArrowDownTrayIcon-CC8afiRz.js";import"./ArrowUpIcon-DLRLa_dE.js";import"./TrashIcon-7rQaTgdF.js";const K={class:"space-y-6 pb-8"},Q={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},W={class:"flex items-center justify-between"},X={class:"mt-2 text-3xl font-semibold text-gray-900"},Y={class:"rounded-lg bg-blue-50 p-3"},Z={class:"flex items-center justify-between"},tt={class:"mt-2 text-3xl font-semibold text-gray-900"},et={class:"rounded-lg bg-yellow-50 p-3"},st={class:"flex items-center justify-between"},at={class:"mt-2 text-3xl font-semibold text-gray-900"},lt={class:"rounded-lg bg-orange-50 p-3"},ot={class:"flex items-center justify-between"},rt={class:"mt-2 text-3xl font-semibold text-gray-900"},nt={class:"rounded-lg bg-green-50 p-3"},it={class:"flex items-center gap-3"},ct={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-500 to-pink-600"},dt={class:"text-sm font-semibold text-white"},ut={class:"font-medium text-gray-900"},mt={class:"text-right font-semibold text-gray-900"},pt={class:"text-gray-900"},gt=["onClick"],ft={key:1,class:"space-y-4"},Dt={__name:"Index",setup(xt){T();const m=x(!1),n=x([]),S=x(null),p=[{key:"teacher",label:"Teacher",sortable:!0},{key:"amount",label:"Amount",sortable:!0,format:"currency",align:"right"},{key:"period",label:"Period",sortable:!0},{key:"hours",label:"Hours",sortable:!0,align:"center"},{key:"classes",label:"Classes",sortable:!0,align:"center"},{key:"status",label:"Status",sortable:!0,align:"center"},{key:"processed_at",label:"Processed",sortable:!0,format:"date"}],P=[{key:"status",label:"Status",type:"select",options:[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"processed",label:"Processed"},{value:"failed",label:"Failed"}]}],j=async()=>{m.value=!0;try{const{data:s}=await $.get("/admin/payouts");n.value=Array.isArray(s.payouts||s)?(s.payouts||s).map(t=>({...t,teacher:t.teacher?`${t.teacher.first_name||""} ${t.teacher.last_name||""}`.trim()||t.teacher.email:"N/A",period:t.period||`${new Date(t.start_date).toLocaleDateString()} - ${new Date(t.end_date).toLocaleDateString()}`,hours:t.total_hours||0,classes:t.classes_count||0,status:t.status||"pending"})):[]}catch(s){console.error("Error fetching payouts:",s),n.value=[]}finally{m.value=!1}},D=async()=>{try{const{data:s}=await $.get("/dashboard/stats");S.value=s?.stats||{}}catch(s){console.error("Error fetching stats:",s)}},F=s=>{R.visit(`/admin/payouts/${s.id}`)},A=w(()=>n.value.filter(s=>s.status==="pending").reduce((s,t)=>s+(parseFloat(t.amount)||0),0)),L=w(()=>n.value.filter(s=>s.status==="processed").reduce((s,t)=>s+(parseFloat(t.amount)||0),0)),U=s=>{const t=p.map(f=>f.label).join(","),a=s.map(f=>p.map(v=>{let c=f[v.key]||"";return v.format==="currency"&&(c=typeof c=="number"?c:parseFloat(c)||0),`"${String(c).replace(/"/g,'""')}"`}).join(",")).join(`
`),d=`${t}
${a}`,E=new Blob([d],{type:"text/csv"}),h=window.URL.createObjectURL(E),g=document.createElement("a");g.href=h,g.download=`payouts-${new Date().toISOString().split("T")[0]}.csv`,g.click(),window.URL.revokeObjectURL(h)};return V(()=>{j(),D()}),(s,t)=>(_(),k(N,null,[l(i(B),{title:"Payouts"}),l(q,null,{default:o(()=>[e("div",K,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Payouts"),e("p",{class:"mt-1 text-sm text-gray-500"}," View and track teacher payouts ")],-1)),e("div",Q,[l(u,{class:"p-6"},{default:o(()=>[e("div",W,[e("div",null,[t[0]||(t[0]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Payouts",-1)),e("p",X,r(n.value.length),1)]),e("div",Y,[l(i(O),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),l(u,{class:"p-6"},{default:o(()=>[e("div",Z,[e("div",null,[t[1]||(t[1]=e("p",{class:"text-sm font-medium text-gray-600"},"Pending",-1)),e("p",tt,r(n.value.filter(a=>a.status==="pending").length),1),t[2]||(t[2]=e("p",{class:"mt-1 text-xs text-yellow-600"},"Awaiting processing",-1))]),e("div",et,[l(i(I),{class:"h-8 w-8 text-yellow-600"})])])]),_:1}),l(u,{class:"p-6"},{default:o(()=>[e("div",st,[e("div",null,[t[3]||(t[3]=e("p",{class:"text-sm font-medium text-gray-600"},"Pending Amount",-1)),e("p",at," $"+r(A.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),t[4]||(t[4]=e("p",{class:"mt-1 text-xs text-gray-500"},"To be processed",-1))]),e("div",lt,[l(i(H),{class:"h-8 w-8 text-orange-600"})])])]),_:1}),l(u,{class:"p-6"},{default:o(()=>[e("div",ot,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Processed",-1)),e("p",rt," $"+r(L.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),t[6]||(t[6]=e("p",{class:"mt-1 text-xs text-green-600"},"All time",-1))]),e("div",nt,[l(i(G),{class:"h-8 w-8 text-green-600"})])])]),_:1})]),m.value?(_(),k("div",ft,[...t[7]||(t[7]=[e("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(_(),C(z,{key:0,title:"All Payouts",columns:p,data:n.value,searchable:!0,paginated:!0,exportable:!0,filters:P,"items-per-page":25,"row-key":"id",onExport:U},{"cell-teacher":o(({row:a})=>[e("div",it,[e("div",ct,[e("span",dt,r(a.teacher.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2)),1)]),e("span",ut,r(a.teacher),1)])]),"cell-amount":o(({row:a})=>[e("div",mt," $"+r(parseFloat(a.amount||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),"cell-period":o(({row:a})=>[e("div",pt,r(a.period||"â€”"),1)]),"cell-hours":o(({row:a})=>[l(b,{variant:"secondary"},{default:o(()=>[y(r(a.hours||0)+"h",1)]),_:2},1024)]),"cell-classes":o(({row:a})=>[l(b,{variant:"secondary"},{default:o(()=>[l(i(M),{class:"h-3 w-3 mr-1 inline"}),y(" "+r(a.classes||0),1)]),_:2},1024)]),"cell-status":o(({row:a})=>[l(b,{variant:a.status==="processed"?"success":a.status==="pending"?"warning":"danger"},{default:o(()=>[y(r(a.status||"pending"),1)]),_:2},1032,["variant"])]),"row-actions":o(({row:a})=>[e("button",{onClick:d=>F(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[l(i(J),{class:"h-5 w-5"})],8,gt)]),_:1},8,["data"]))])]),_:1})],64))}};export{Dt as default};
