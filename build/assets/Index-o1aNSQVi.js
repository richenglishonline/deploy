import{c as l,d as t,g as r,u as F,r as v,j as D,o as q,a as c,b as u,h as H,w as _,e as $,p as B,v as V,k as h,F as C,q as L,y as k,t as n,f as z,s as J}from"./app-BiSPCPuo.js";import{n as O,_ as P}from"./AuthenticatedLayout-57Q77M7z.js";import{_ as S}from"./Card-B0sMFwFC.js";import{_ as Q}from"./Button-cwC7HEN4.js";import{_ as Z}from"./Badge-DAiRCop6.js";import{a as j}from"./api-BtR7IrG5.js";function T(I,y){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})])}function G(I,y){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}const K={class:"space-y-6 pb-8"},R={class:"grid grid-cols-1 gap-6 lg:grid-cols-4"},W={class:"border-b border-gray-200 p-4"},X={class:"relative"},Y={class:"max-h-[600px] overflow-y-auto"},ee=["onClick"],te={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},se={class:"text-sm font-semibold text-white"},ae={class:"flex-1 min-w-0 text-left"},re={class:"font-medium text-gray-900 truncate"},oe={class:"text-xs text-gray-500 truncate"},ne={key:0,class:"p-8 text-center"},le={class:"border-b border-gray-200 bg-gray-50 px-6 py-4"},ie={class:"flex items-center gap-3"},ce={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600"},de={class:"text-sm font-semibold text-white"},ue={class:"font-semibold text-gray-900"},me={class:"text-xs text-gray-500"},ge={id:"messages-container",class:"flex-1 overflow-y-auto p-6 space-y-4",style:{"max-height":"500px"}},pe={key:0,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-green-500 to-teal-600 flex-shrink-0"},fe={class:"text-xs font-semibold text-white"},xe={class:"text-sm"},ve={key:1,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex-shrink-0"},_e={class:"text-xs font-semibold text-white"},ye={key:0,class:"text-center py-12"},he={class:"border-t border-gray-200 bg-gray-50 px-6 py-4"},be={class:"text-center"},Te={__name:"Index",setup(I){const y=F(),p=v(!1),f=v([]),i=v([]),o=v(null),m=v(""),b=v(""),x=D(()=>y.props.auth?.user?.id),M=D(()=>{if(!b.value)return f.value;const a=b.value.toLowerCase();return f.value.filter(s=>(`${s.first_name||""} ${s.last_name||""}`.trim()||s.email||"").toLowerCase().includes(a)||s.email?.toLowerCase().includes(a))}),A=async()=>{p.value=!0;try{const{data:a}=await j.get("/message/users");f.value=Array.isArray(a)?a:[]}catch(a){console.error("Error loading users:",a),f.value=[]}finally{p.value=!1}},U=async a=>{o.value=a,p.value=!0;try{const{data:s}=await j.get(`/message/${a.id}`);i.value=Array.isArray(s.messages||s)?s.messages||s:[],setTimeout(()=>{const e=document.getElementById("messages-container");e&&(e.scrollTop=e.scrollHeight)},100)}catch(s){console.error("Error loading conversation:",s),i.value=[]}finally{p.value=!1}},E=async()=>{if(!m.value.trim()||!o.value)return;const a=m.value.trim();m.value="";const s={id:Date.now(),message:a,sender_id:x.value,receiver_id:o.value.id,created_at:new Date().toISOString(),is_temp:!0};i.value.push(s),setTimeout(()=>{const e=document.getElementById("messages-container");e&&(e.scrollTop=e.scrollHeight)},100);try{const{data:e}=await j.post("/message",{receiver_id:o.value.id,message:a}),d=i.value.findIndex(g=>g.is_temp);d>=0?i.value[d]=e:i.value.push(e)}catch(e){console.error("Error sending message:",e);const d=i.value.findIndex(g=>g.is_temp);d>=0&&i.value.splice(d,1),m.value=a,alert("Failed to send message")}},N=a=>{if(!a)return"";const s=new Date(a),e=new Date,d=e-s,g=Math.floor(d/6e4);return g<1?"Just now":g<60?`${g}m ago`:s.toDateString()===e.toDateString()?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString()},w=a=>(`${a.first_name||""} ${a.last_name||""}`.trim()||a.email||"").split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return q(async()=>{await A(),f.value.length>0&&await U(f.value[0])}),(a,s)=>(r(),l(C,null,[c(u(H),{title:"Messages"}),c(P,null,{default:_(()=>[t("div",K,[s[8]||(s[8]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Messages"),t("p",{class:"mt-1 text-sm text-gray-500"}," Communicate with teachers, students, and admins ")],-1)),t("div",R,[c(S,{class:"p-0 lg:col-span-1"},{default:_(()=>[t("div",W,[t("div",X,[c(u(O),{class:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),B(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>b.value=e),type:"text",placeholder:"Search conversations...",class:"block w-full rounded-lg border-0 bg-gray-50 py-2 pl-10 pr-4 text-sm text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:bg-white focus:ring-2 focus:ring-inset focus:ring-blue-500"},null,512),[[V,b.value]])])]),t("div",Y,[(r(!0),l(C,null,L(M.value,e=>(r(),l("button",{key:e.id,onClick:d=>U(e),class:k(["w-full flex items-center gap-3 p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors",o.value?.id===e.id?"bg-blue-50 border-blue-200":""])},[t("div",te,[t("span",se,n(w(e)),1)]),t("div",ae,[t("p",re,n(`${e.first_name||""} ${e.last_name||""}`.trim()||e.email||"User"),1),t("p",oe,n(e.email||""),1)]),e.unread_count>0?(r(),$(Z,{key:0,variant:"primary",class:"text-xs"},{default:_(()=>[z(n(e.unread_count),1)]),_:2},1024)):h("",!0)],10,ee))),128)),M.value.length===0?(r(),l("div",ne,[c(u(T),{class:"mx-auto h-12 w-12 text-gray-300"}),s[2]||(s[2]=t("p",{class:"mt-4 text-sm font-medium text-gray-900"},"No conversations",-1)),s[3]||(s[3]=t("p",{class:"mt-1 text-xs text-gray-500"},"Start a conversation by selecting a user",-1))])):h("",!0)])]),_:1}),o.value?(r(),$(S,{key:0,class:"lg:col-span-3 flex flex-col p-0"},{default:_(()=>[t("div",le,[t("div",ie,[t("div",ce,[t("span",de,n(w(o.value)),1)]),t("div",null,[t("h3",ue,n(`${o.value.first_name||""} ${o.value.last_name||""}`.trim()||o.value.email||"User"),1),t("p",me,n(o.value.email||""),1)])])]),t("div",ge,[(r(!0),l(C,null,L(i.value,e=>(r(),l("div",{key:e.id,class:k(["flex gap-3",e.sender_id===x.value?"justify-end":"justify-start"])},[e.sender_id!==x.value?(r(),l("div",pe,[t("span",fe,n(w(e.sender||o.value)),1)])):h("",!0),t("div",{class:k(["max-w-[70%] rounded-2xl px-4 py-2",e.sender_id===x.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"])},[t("p",xe,n(e.message),1),t("p",{class:k(["mt-1 text-xs",e.sender_id===x.value?"text-blue-100":"text-gray-500"])},n(N(e.created_at)),3)],2),e.sender_id===x.value?(r(),l("div",ve,[t("span",_e,n(w({email:u(y).props.auth?.user?.email,name:u(y).props.auth?.user?.name})),1)])):h("",!0)],2))),128)),i.value.length===0&&!p.value?(r(),l("div",ye,[c(u(T),{class:"mx-auto h-12 w-12 text-gray-300"}),s[4]||(s[4]=t("p",{class:"mt-4 text-sm font-medium text-gray-900"},"No messages yet",-1)),s[5]||(s[5]=t("p",{class:"mt-1 text-xs text-gray-500"},"Start the conversation!",-1))])):h("",!0)]),t("div",he,[t("form",{onSubmit:J(E,["prevent"]),class:"flex items-center gap-3"},[B(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>m.value=e),type:"text",placeholder:"Type a message...",class:"flex-1 rounded-lg border-0 bg-white py-2.5 px-4 text-sm text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-500"},null,512),[[V,m.value]]),c(Q,{type:"submit",variant:"primary",disabled:!m.value.trim()||p.value},{default:_(()=>[c(u(G),{class:"h-5 w-5"})]),_:1},8,["disabled"])],32)])]),_:1})):(r(),$(S,{key:1,class:"lg:col-span-3 flex items-center justify-center p-12"},{default:_(()=>[t("div",be,[c(u(T),{class:"mx-auto h-16 w-16 text-gray-300"}),s[6]||(s[6]=t("p",{class:"mt-4 text-lg font-medium text-gray-900"},"Select a conversation",-1)),s[7]||(s[7]=t("p",{class:"mt-1 text-sm text-gray-500"}," Choose a user from the list to start messaging ",-1))])]),_:1}))])])]),_:1})],64))}};export{Te as default};
