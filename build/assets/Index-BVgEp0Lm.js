import{u as V,r as c,o as L,c as $,a as l,b as r,h as P,w as o,d as e,e as I,f as A,t as n,g as v,n as z,F as q,i as j}from"./app-CGuEmW06.js";import{r as y,a as C,b as G,_ as H}from"./AuthenticatedLayout-CJGuDV3D.js";import{_ as J}from"./AdvancedTable-C74tgwHJ.js";import{_ as K}from"./Button-BBsil_pH.js";import{_ as Q}from"./Badge-xK72gQ5Q.js";import{_ as m}from"./Card-O4ACqxyG.js";import{a as d}from"./api-B9gIEsIZ.js";import{r as W}from"./PlusIcon-CiP_j3xr.js";import{r as X}from"./EyeIcon-BaQtjq6r.js";import{r as Y}from"./TrashIcon-7rQaTgdF.js";import"./ArrowDownTrayIcon-CC8afiRz.js";import"./ArrowUpIcon-DLRLa_dE.js";const Z={class:"space-y-6 pb-8"},ee={class:"flex items-center justify-between"},te={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},se={class:"flex items-center justify-between"},ae={class:"mt-2 text-3xl font-semibold text-gray-900"},le={class:"rounded-lg bg-blue-50 p-3"},oe={class:"flex items-center justify-between"},re={class:"mt-2 text-3xl font-semibold text-gray-900"},ne={class:"rounded-lg bg-green-50 p-3"},ie={class:"flex items-center justify-between"},de={class:"mt-2 text-3xl font-semibold text-gray-900"},ce={class:"rounded-lg bg-emerald-50 p-3"},ue={class:"flex items-center justify-between"},me={class:"mt-2 text-3xl font-semibold text-gray-900"},ge={class:"rounded-lg bg-red-50 p-3"},pe={class:"flex items-center gap-3"},_e={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-green-500 to-teal-600"},fe={class:"text-sm font-semibold text-white"},he={class:"font-medium text-gray-900"},be={class:"flex items-center gap-2"},ve={class:"text-gray-900"},ye={class:"flex items-center gap-2"},xe={class:"text-gray-900"},ke={class:"flex items-center gap-2"},we={class:"font-medium text-gray-900"},$e={class:"h-2 w-16 rounded-full bg-gray-200"},Ae={class:"flex items-center justify-end gap-2"},je=["onClick"],Ce=["onClick"],Se={key:1,class:"space-y-4"},Ie={__name:"Index",setup(Re){V();const g=c(!1),i=c([]),S=c(null),x=c([]),k=c([]),R=c([]),p=[{key:"student",label:"Student",sortable:!0},{key:"teacher",label:"Teacher",sortable:!0},{key:"book",label:"Book",sortable:!0},{key:"assigned_date",label:"Assigned",sortable:!0,format:"date"},{key:"due_date",label:"Due Date",sortable:!0,format:"date"},{key:"progress",label:"Progress",sortable:!0,align:"center",format:"percentage"},{key:"status",label:"Status",sortable:!0,align:"center"}],D=[{key:"teacher_id",label:"Teacher",type:"select",options:[{value:"",label:"All Teachers"},...x.value.map(s=>({value:s.id,label:`${s.first_name||""} ${s.last_name||""}`.trim()||s.email}))]},{key:"student_id",label:"Student",type:"select",options:[{value:"",label:"All Students"},...k.value.map(s=>({value:s.id,label:`${s.first_name||""} ${s.last_name||""}`.trim()||s.email}))]},{key:"status",label:"Status",type:"select",options:[{value:"",label:"All Statuses"},{value:"active",label:"Active"},{value:"completed",label:"Completed"},{value:"overdue",label:"Overdue"}]}],_=async()=>{g.value=!0;try{const{data:s}=await d.get("/book-assign");i.value=Array.isArray(s.assignments||s)?(s.assignments||s).map(t=>({...t,student:t.student?`${t.student.first_name||""} ${t.student.last_name||""}`.trim()||t.student.email:"N/A",teacher:t.teacher?`${t.teacher.first_name||""} ${t.teacher.last_name||""}`.trim()||t.teacher.email:"N/A",book:t.book?.title||"N/A",assigned_date:t.created_at||t.assigned_date,due_date:t.due_date,progress:t.progress||0,status:t.status||"active"})):[]}catch(s){console.error("Error fetching assignments:",s),i.value=[]}finally{g.value=!1}},E=async()=>{try{const[s,t,a]=await Promise.all([d.get("/teacher").catch(()=>({data:{teachers:[]}})),d.get("/students").catch(()=>({data:[]})),d.get("/books").catch(()=>({data:{books:[]}}))]);x.value=s.data?.teachers||s.data||[],k.value=Array.isArray(t.data)?t.data:t.data?.students||[],R.value=a.data?.books||a.data||[]}catch(s){console.error("Error fetching options:",s)}},f=async()=>{try{const{data:s}=await d.get("/dashboard/stats");S.value=s?.stats||{}}catch(s){console.error("Error fetching stats:",s)}},O=()=>{j.visit("/super-admin/assignments/create")},B=s=>{j.visit(`/super-admin/assignments/${s.id}`)},N=async s=>{if(confirm("Are you sure you want to delete this assignment?"))try{await d.delete(`/book-assign/${s.id}`),await _(),await f()}catch(t){console.error("Error deleting assignment:",t),alert("Failed to delete assignment")}},T=async()=>{if(confirm(`Are you sure you want to delete ${selectedRows.value.length} assignment(s)?`))try{await Promise.all(selectedRows.value.map(s=>d.delete(`/book-assign/${s.id}`))),selectedRows.value=[],await _(),await f()}catch(s){console.error("Error bulk deleting assignments:",s),alert("Failed to delete some assignments")}},F=s=>{const t=p.map(b=>b.label).join(","),a=s.map(b=>p.map(U=>`"${b[U.key]||""}"`).join(",")).join(`
`),u=`${t}
${a}`,M=new Blob([u],{type:"text/csv"}),w=window.URL.createObjectURL(M),h=document.createElement("a");h.href=w,h.download=`assignments-${new Date().toISOString().split("T")[0]}.csv`,h.click(),window.URL.revokeObjectURL(w)};return L(()=>{E(),_(),f()}),(s,t)=>(v(),$(q,null,[l(r(P),{title:"Assignments Management"}),l(H,null,{default:o(()=>[e("div",Z,[e("div",ee,[t[1]||(t[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Assignments Management"),e("p",{class:"mt-1 text-sm text-gray-500"}," Manage book assignments to students ")],-1)),l(K,{onClick:O,variant:"primary"},{default:o(()=>[l(r(W),{class:"h-5 w-5 mr-2"}),t[0]||(t[0]=A(" Create Assignment ",-1))]),_:1})]),e("div",te,[l(m,{class:"p-6"},{default:o(()=>[e("div",se,[e("div",null,[t[2]||(t[2]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Assignments",-1)),e("p",ae,n(i.value.length),1)]),e("div",le,[l(r(y),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),l(m,{class:"p-6"},{default:o(()=>[e("div",oe,[e("div",null,[t[3]||(t[3]=e("p",{class:"text-sm font-medium text-gray-600"},"Active",-1)),e("p",re,n(i.value.filter(a=>a.status==="active").length),1),t[4]||(t[4]=e("p",{class:"mt-1 text-xs text-gray-500"},"In progress",-1))]),e("div",ne,[l(r(C),{class:"h-8 w-8 text-green-600"})])])]),_:1}),l(m,{class:"p-6"},{default:o(()=>[e("div",ie,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Completed",-1)),e("p",de,n(i.value.filter(a=>a.status==="completed").length),1),t[6]||(t[6]=e("p",{class:"mt-1 text-xs text-gray-500"},"Finished",-1))]),e("div",ce,[l(r(y),{class:"h-8 w-8 text-emerald-600"})])])]),_:1}),l(m,{class:"p-6"},{default:o(()=>[e("div",ue,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Overdue",-1)),e("p",me,n(i.value.filter(a=>a.status==="overdue").length),1),t[8]||(t[8]=e("p",{class:"mt-1 text-xs text-red-600"},"Needs attention",-1))]),e("div",ge,[l(r(C),{class:"h-8 w-8 text-red-600"})])])]),_:1})]),g.value?(v(),$("div",Se,[...t[9]||(t[9]=[e("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(v(),I(J,{key:0,title:"All Assignments",columns:p,data:i.value,searchable:!0,paginated:!0,selectable:!0,exportable:!0,filters:D,"items-per-page":25,"row-key":"id",onExport:F,onBulkDelete:T},{"cell-student":o(({row:a})=>[e("div",pe,[e("div",_e,[e("span",fe,n(a.student.split(" ").map(u=>u[0]).join("").toUpperCase().slice(0,2)),1)]),e("span",he,n(a.student),1)])]),"cell-teacher":o(({row:a})=>[e("div",be,[l(r(G),{class:"h-4 w-4 text-gray-400"}),e("span",ve,n(a.teacher),1)])]),"cell-book":o(({row:a})=>[e("div",ye,[l(r(y),{class:"h-4 w-4 text-gray-400"}),e("span",xe,n(a.book),1)])]),"cell-progress":o(({row:a})=>[e("div",ke,[e("span",we,n(a.progress||0)+"%",1),e("div",$e,[e("div",{class:"h-2 rounded-full bg-green-500",style:z({width:`${Math.min(a.progress||0,100)}%`})},null,4)])])]),"cell-status":o(({row:a})=>[l(Q,{variant:a.status==="completed"?"success":a.status==="overdue"?"danger":"primary"},{default:o(()=>[A(n(a.status||"active"),1)]),_:2},1032,["variant"])]),"row-actions":o(({row:a})=>[e("div",Ae,[e("button",{onClick:u=>B(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[l(r(X),{class:"h-5 w-5"})],8,je),e("button",{onClick:u=>N(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-red-600 transition-colors",title:"Delete"},[l(r(Y),{class:"h-5 w-5"})],8,Ce)])]),_:1},8,["data"]))])]),_:1})],64))}};export{Ie as default};
