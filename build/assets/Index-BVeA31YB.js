import{u as L,r as b,j as S,o as T,c as v,a as l,b as n,h as N,w as r,d as t,e as M,t as i,g,f as V,k as O,F as P,i as I}from"./app-Cmmq__Tw.js";import{g as Y,a as G,d as q,e as H,b as J,_ as K}from"./AuthenticatedLayout-B2GbnFPi.js";import{_ as Q}from"./AdvancedTable-CIaIA73U.js";import{_ as m}from"./Card-CcoMGp7w.js";import{_ as W}from"./Badge-BZFBi4LI.js";import{a as c}from"./api-BS-ONIJM.js";import{r as k}from"./ArrowDownTrayIcon-CzbVfJHZ.js";import{r as $}from"./PlayIcon-B-NjgEGo.js";import{r as X}from"./EyeIcon-DroDtrWB.js";import{r as Z}from"./TrashIcon-DD0p8Ace.js";import"./ArrowUpIcon-DRFX-h9Y.js";const ee={class:"space-y-6 pb-8"},te={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},se={class:"flex items-center justify-between"},ae={class:"mt-2 text-3xl font-semibold text-gray-900"},le={class:"rounded-lg bg-blue-50 p-3"},oe={class:"flex items-center justify-between"},re={class:"mt-2 text-3xl font-semibold text-gray-900"},ne={class:"rounded-lg bg-purple-50 p-3"},ie={class:"flex items-center justify-between"},de={class:"mt-2 text-3xl font-semibold text-gray-900"},ce={class:"rounded-lg bg-green-50 p-3"},ue={class:"flex items-center justify-between"},ge={class:"mt-2 text-3xl font-semibold text-gray-900"},me={class:"rounded-lg bg-orange-50 p-3"},pe={class:"flex items-center gap-3"},_e={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-red-500 to-pink-600"},ye={class:"font-medium text-gray-900"},he={key:0,class:"text-xs text-gray-500"},fe={class:"flex items-center gap-2"},xe={class:"text-gray-900"},be={class:"flex items-center gap-2"},ve={class:"text-gray-900"},we={class:"text-gray-900"},ke={class:"text-right text-gray-900"},$e={class:"flex items-center justify-end gap-2"},Re=["onClick"],je=["onClick"],Ce=["onClick"],Ae=["onClick"],De={key:1,class:"space-y-4"},Pe={__name:"Index",setup(Ue){L();const p=b(!1),d=b([]),R=b(null),_=[{key:"title",label:"Recording",sortable:!0},{key:"teacher",label:"Teacher",sortable:!0},{key:"student",label:"Student",sortable:!0},{key:"class",label:"Class",sortable:!0},{key:"duration",label:"Duration",sortable:!0,align:"center"},{key:"file_size",label:"Size",sortable:!0,align:"right"},{key:"created_at",label:"Uploaded",sortable:!0,format:"date"}],j=[{key:"teacher_id",label:"Teacher",type:"select",options:[{value:"",label:"All Teachers"}]},{key:"student_id",label:"Student",type:"select",options:[{value:"",label:"All Students"}]}],y=async()=>{p.value=!0;try{const{data:s}=await c.get("/recordings");d.value=Array.isArray(s.recordings||s)?(s.recordings||s).map(e=>({...e,title:e.title||e.file_name||"Untitled Recording",teacher:e.teacher?`${e.teacher.first_name||""} ${e.teacher.last_name||""}`.trim()||e.teacher.email:"N/A",student:e.student?`${e.student.first_name||""} ${e.student.last_name||""}`.trim()||e.student.email:"N/A",class:e.class_schedule?`Class #${e.class_schedule.id}`:"N/A",duration:e.duration?`${e.duration} min`:"N/A",file_size:e.file_size?`${(e.file_size/1024/1024).toFixed(2)} MB`:"N/A"})):[]}catch(s){console.error("Error fetching recordings:",s),d.value=[]}finally{p.value=!1}},h=async()=>{try{const{data:s}=await c.get("/dashboard/stats");R.value=s?.stats||{}}catch(s){console.error("Error fetching stats:",s)}},C=s=>{I.visit(`/super-admin/recordings/${s.id}`)},A=async s=>{try{const e=await c.get(`/recordings/${s.id}/play`);window.open(e.data.url,"_blank")}catch(e){console.error("Error playing recording:",e),alert("Failed to play recording")}},D=async s=>{try{const e=await c.get(`/recordings/${s.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=a,o.setAttribute("download",s.file_name||`${s.title}.mp4`),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("Error downloading recording:",e),alert("Failed to download recording")}},U=async s=>{if(confirm(`Are you sure you want to delete "${s.title}"?`))try{await c.delete(`/recordings/${s.id}`),await y(),await h()}catch(e){console.error("Error deleting recording:",e),alert("Failed to delete recording")}},E=async()=>{if(confirm(`Are you sure you want to delete ${selectedRows.value.length} recording(s)?`))try{await Promise.all(selectedRows.value.map(s=>c.delete(`/recordings/${s.id}`))),selectedRows.value=[],await y(),await h()}catch(s){console.error("Error bulk deleting recordings:",s),alert("Failed to delete some recordings")}},F=s=>{const e=_.map(x=>x.label).join(","),a=s.map(x=>_.map(B=>`"${x[B.key]||""}"`).join(",")).join(`
`),o=`${e}
${a}`,u=new Blob([o],{type:"text/csv"}),w=window.URL.createObjectURL(u),f=document.createElement("a");f.href=w,f.download=`recordings-${new Date().toISOString().split("T")[0]}.csv`,f.click(),window.URL.revokeObjectURL(w)},z=S(()=>(d.value.reduce((s,e)=>s+(e.file_size?parseFloat(e.file_size):0),0)/1024).toFixed(2));return T(()=>{y(),h()}),(s,e)=>(g(),v(P,null,[l(n(N),{title:"Recordings Library"}),l(K,null,{default:r(()=>[t("div",ee,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Recordings Library"),t("p",{class:"mt-1 text-sm text-gray-500"}," Manage all class recordings ")],-1)),t("div",te,[l(m,{class:"p-6"},{default:r(()=>[t("div",se,[t("div",null,[e[0]||(e[0]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Recordings",-1)),t("p",ae,i(d.value.length),1)]),t("div",le,[l(n(Y),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),l(m,{class:"p-6"},{default:r(()=>[t("div",oe,[t("div",null,[e[1]||(e[1]=t("p",{class:"text-sm font-medium text-gray-600"},"Storage Used",-1)),t("p",re,i(z.value)+" GB ",1),e[2]||(e[2]=t("p",{class:"mt-1 text-xs text-gray-500"},"Total size",-1))]),t("div",ne,[l(n(k),{class:"h-8 w-8 text-purple-600"})])])]),_:1}),l(m,{class:"p-6"},{default:r(()=>[t("div",ie,[t("div",null,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-gray-600"},"This Month",-1)),t("p",de,i(d.value.filter(a=>{const o=new Date(a.created_at),u=new Date;return o.getMonth()===u.getMonth()&&o.getFullYear()===u.getFullYear()}).length),1),e[4]||(e[4]=t("p",{class:"mt-1 text-xs text-gray-500"},"Uploads",-1))]),t("div",ce,[l(n(G),{class:"h-8 w-8 text-green-600"})])])]),_:1}),l(m,{class:"p-6"},{default:r(()=>[t("div",ue,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Duration",-1)),t("p",ge,i(d.value.reduce((a,o)=>a+(parseInt(o.duration)||0),0))+" min ",1),e[6]||(e[6]=t("p",{class:"mt-1 text-xs text-gray-500"},"Combined",-1))]),t("div",me,[l(n(q),{class:"h-8 w-8 text-orange-600"})])])]),_:1})]),p.value?(g(),v("div",De,[...e[7]||(e[7]=[t("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(g(),M(Q,{key:0,title:"All Recordings",columns:_,data:d.value,searchable:!0,paginated:!0,selectable:!0,exportable:!0,filters:j,"items-per-page":25,"row-key":"id",onExport:F,onBulkDelete:E},{"cell-title":r(({row:a})=>[t("div",pe,[t("div",_e,[l(n($),{class:"h-5 w-5 text-white"})]),t("div",null,[t("div",ye,i(a.title),1),a.class?(g(),v("div",he,i(a.class),1)):O("",!0)])])]),"cell-teacher":r(({row:a})=>[t("div",fe,[l(n(J),{class:"h-4 w-4 text-gray-400"}),t("span",xe,i(a.teacher),1)])]),"cell-student":r(({row:a})=>[t("div",be,[l(n(H),{class:"h-4 w-4 text-gray-400"}),t("span",ve,i(a.student),1)])]),"cell-class":r(({row:a})=>[t("div",we,i(a.class||"—"),1)]),"cell-duration":r(({row:a})=>[l(W,{variant:"secondary"},{default:r(()=>[V(i(a.duration||"—"),1)]),_:2},1024)]),"cell-file_size":r(({row:a})=>[t("div",ke,i(a.file_size||"—"),1)]),"row-actions":r(({row:a})=>[t("div",$e,[t("button",{onClick:o=>A(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"Play"},[l(n($),{class:"h-5 w-5"})],8,Re),t("button",{onClick:o=>D(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-green-600 transition-colors",title:"Download"},[l(n(k),{class:"h-5 w-5"})],8,je),t("button",{onClick:o=>C(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[l(n(X),{class:"h-5 w-5"})],8,Ce),t("button",{onClick:o=>U(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-red-600 transition-colors",title:"Delete"},[l(n(Z),{class:"h-5 w-5"})],8,Ae)])]),_:1},8,["data"]))])]),_:1})],64))}};export{Pe as default};
