import{l as C,r as g,m as h,o as A,c as o,b as m,u as M,h as B,w as P,d as a,f as l,F as u,g as p,s as S,p as T,G as N,t as c}from"./app-m0EauCUY.js";import{g as $,d as D,c as H,h as F,_ as z}from"./AuthenticatedLayout-OkZKskr4.js";import{_ as E}from"./DashboardHeader-DeUr5HOb.js";import{a as L}from"./api-p6Oc_tdf.js";const V={class:"space-y-6"},W={key:0,class:"space-y-6"},G={class:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"},U={class:"p-5"},j={class:"flex items-center"},q={class:"flex-shrink-0"},I={class:"ml-5 w-0 flex-1"},J={class:"text-sm font-medium text-gray-500 truncate"},K={class:"text-lg font-medium text-gray-900"},O={key:2,class:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3"},Q={class:"text-sm font-medium text-gray-500"},R={class:"mt-2 text-3xl font-semibold text-gray-900"},se={__name:"Dashboard",setup(X){const f=C(),n=g(!1),r=g(null),v=g(!1),i=h(()=>f.props.auth?.user?.role??"teacher"),b=h(()=>{if(!r.value||i.value!=="teacher")return[];const s=(r.value.stats??{}).dashboard??{},t=s.students??0,w=Array.isArray(s.activeClass)?s.activeClass.filter(d=>d!==null).length:s.activeClass&&s.activeClass!==null?1:0,x=Array.isArray(s.todayAttendance)?s.todayAttendance.filter(d=>d!==null).length:s.todayAttendance&&s.todayAttendance!==null?1:0,k=Array.isArray(s.pendingMakeups)?s.pendingMakeups.filter(d=>d!==null).length:s.pendingMakeups&&s.pendingMakeups!==null?1:0;return[{name:"Total Students",value:t,icon:$,color:"bg-blue-500"},{name:"Active Classes",value:w,icon:D,color:"bg-green-500"},{name:"Today's Attendance",value:x,icon:H,color:"bg-yellow-500"},{name:"Pending Makeups",value:k,icon:F,color:"bg-red-500"}]}),y=h(()=>{if(!r.value||i.value==="teacher")return[];const e=r.value.stats??{};return{"super-admin":[{label:"Admins",value:e.totalAdmins},{label:"Teachers",value:e.totalTeachers},{label:"Students",value:e.totalStudents},{label:"Books",value:e.totalBooks},{label:"Classes",value:e.totalClasses},{label:"Payouts",value:e.totalPayouts},{label:"Notifications",value:e.totalNotifications},{label:"Book Assignments",value:e.totalBookAssignments}],admin:[{label:"Assigned Teachers",value:e.assignedTeachers},{label:"Students",value:e.totalStudents},{label:"Books",value:e.totalBooks},{label:"Classes Created",value:e.totalClasses},{label:"Notifications",value:e.totalNotifications},{label:"Payouts",value:e.totalPayouts},{label:"Hours This Month",value:e.totalHoursMonth},{label:"Hours This Week",value:e.totalHoursWeek},{label:"Estimated Month Payout",value:`â‚±${Number(e.totalPaymentMonth??0).toFixed(2)}`}]}[i.value]??[]}),_=async()=>{if(!(n.value||v.value)){n.value=!0;try{const{data:e}=await L.get("/dashboard/stats");r.value=e,v.value=!0}catch(e){console.error("Dashboard stats error:",e),e.response?.status===401&&console.warn("Unauthorized - user may need to re-login")}finally{n.value=!1}}};return A(()=>{!v.value&&!n.value&&_()}),(e,s)=>(l(),o(u,null,[m(M(B),{title:"Dashboard"}),m(z,null,{default:P(()=>[a("div",V,[m(E),n.value?(l(),o("div",W,[...s[0]||(s[0]=[a("div",{class:"w-full h-96 mb-12 mt-5 bg-gray-200 animate-pulse rounded"},null,-1),a("div",{class:"w-full h-96 bg-gray-200 animate-pulse rounded"},null,-1)])])):i.value==="teacher"?(l(),o(u,{key:1},[a("div",G,[(l(!0),o(u,null,p(b.value,t=>(l(),o("div",{key:t.name,class:"bg-white overflow-hidden shadow rounded-lg"},[a("div",U,[a("div",j,[a("div",q,[a("div",{class:S([t.color,"p-3 rounded-md"])},[(l(),T(N(t.icon),{class:"h-6 w-6 text-white"}))],2)]),a("div",I,[a("dl",null,[a("dt",J,c(t.name),1),a("dd",K,c(t.value),1)])])])])]))),128))]),s[1]||(s[1]=a("div",{class:"flex flex-col-reverse lg:flex-row gap-6"},[a("div",{class:"w-full lg:w-2/3"},[a("div",{class:"bg-white rounded-lg shadow-lg p-4 max-h-[70vh] overflow-auto"})]),a("div",{class:"w-full lg:w-1/3"},[a("div",{class:"bg-white rounded-lg shadow-lg p-4 max-h-[70vh] overflow-visible"},[a("div",{class:"text-center text-gray-500 py-8"}," Calendar will be displayed here ")])])],-1))],64)):(l(),o("div",O,[(l(!0),o(u,null,p(y.value,t=>(l(),o("div",{key:t.label,class:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm"},[a("dt",Q,c(t.label),1),a("dd",R,c(t.value??0),1)]))),128))]))])]),_:1})],64))}};export{se as default};
