import{u as L,r as x,j as v,o as U,l as V,c as y,a as n,b as d,h as H,w as l,d as e,e as O,f as u,t as r,g as h,F as P,i as w}from"./app-r5F7AQbe.js";import{c as I,a as k,d as M,e as q,_ as z}from"./AuthenticatedLayout-CNSH0xWk.js";import{_ as G}from"./AdvancedTable-DeA0jASj.js";import{_ as m}from"./Card-2P4Rmxrj.js";import{_ as $}from"./Badge-l3XqjddH.js";import{a as j}from"./api-COcabK3_.js";import{r as J}from"./CheckCircleIcon-CNGI8Jtx.js";import{r as K}from"./EyeIcon-DeULzbgW.js";import"./ArrowDownTrayIcon-DZwgirt0.js";import"./ArrowUpIcon-BRIgdKK5.js";import"./TrashIcon-Q9E64JkZ.js";const Q={class:"space-y-6 pb-8"},W={class:"flex items-center justify-between"},X={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},Y={class:"flex items-center justify-between"},Z={class:"mt-2 text-3xl font-semibold text-gray-900"},tt={class:"rounded-lg bg-blue-50 p-3"},et={class:"flex items-center justify-between"},st={class:"mt-2 text-3xl font-semibold text-gray-900"},at={class:"rounded-lg bg-green-50 p-3"},nt={class:"flex items-center justify-between"},lt={class:"mt-2 text-3xl font-semibold text-gray-900"},rt={class:"rounded-lg bg-purple-50 p-3"},ot={class:"flex items-center justify-between"},it={class:"mt-2 text-3xl font-semibold text-gray-900"},dt={class:"rounded-lg bg-emerald-50 p-3"},ct={class:"flex items-center gap-3"},ut={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-indigo-500 to-purple-600"},mt={class:"text-sm font-semibold text-white"},pt={class:"font-medium text-gray-900"},gt={class:"flex items-center gap-3"},ft={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-green-500 to-teal-600"},_t={class:"text-sm font-semibold text-white"},xt={class:"font-medium text-gray-900"},ht={class:"text-gray-900"},bt={class:"flex items-center gap-2 text-gray-900"},vt={class:"text-right font-medium text-gray-900"},yt=["onClick"],wt={key:1,class:"space-y-4"},Et={__name:"Index",setup(kt){L();const p=x(!1),o=x([]),A=x(null),g=[{key:"teacher",label:"Teacher",sortable:!0},{key:"student",label:"Student",sortable:!0},{key:"class",label:"Class",sortable:!0},{key:"date",label:"Date",sortable:!0,format:"date"},{key:"duration",label:"Duration",sortable:!0,align:"center"},{key:"status",label:"Status",sortable:!0,align:"center"},{key:"hours",label:"Hours",sortable:!0,align:"right",format:"number"}],D=[{key:"status",label:"Status",type:"select",options:[{value:"",label:"All Statuses"},{value:"present",label:"Present"},{value:"absent",label:"Absent"},{value:"late",label:"Late"}]}],S=async()=>{p.value=!0;try{const{data:a}=await j.get("/admin/attendance");o.value=Array.isArray(a.attendances||a)?(a.attendances||a).map(t=>({...t,teacher:t.teacher?`${t.teacher.first_name||""} ${t.teacher.last_name||""}`.trim()||t.teacher.email:"N/A",student:t.student?`${t.student.first_name||""} ${t.student.last_name||""}`.trim()||t.student.email:"N/A",class:t.class_schedule?`Class #${t.class_schedule.id}`:"N/A",date:t.date||t.class_schedule?.start_time,duration:t.duration?`${t.duration} min`:"N/A",hours:t.hours||(t.duration?(t.duration/60).toFixed(2):0),status:t.status||"present"})):[]}catch(a){console.error("Error fetching attendance:",a),o.value=[]}finally{p.value=!1}},R=async()=>{try{const{data:a}=await j.get("/dashboard/stats");A.value=a?.stats||{}}catch(a){console.error("Error fetching stats:",a)}},T=a=>{w.visit(`/admin/attendance/${a.id}`)},C=()=>{w.visit("/admin/attendance/reports")},F=v(()=>{const a=o.value.length;return a===0?0:(o.value.filter(c=>c.status==="present").length/a*100).toFixed(1)}),B=v(()=>o.value.reduce((a,t)=>a+(parseFloat(t.hours)||0),0).toFixed(2)),N=a=>{const t=g.map(_=>_.label).join(","),c=a.map(_=>g.map(E=>`"${_[E.key]||""}"`).join(",")).join(`
`),s=`${t}
${c}`,i=new Blob([s],{type:"text/csv"}),b=window.URL.createObjectURL(i),f=document.createElement("a");f.href=b,f.download=`attendance-${new Date().toISOString().split("T")[0]}.csv`,f.click(),window.URL.revokeObjectURL(b)};return U(()=>{S(),R()}),(a,t)=>{const c=V("Button");return h(),y(P,null,[n(d(H),{title:"Attendance Tracking"}),n(z,null,{default:l(()=>[e("div",Q,[e("div",W,[t[1]||(t[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Attendance Tracking"),e("p",{class:"mt-1 text-sm text-gray-500"}," Track and manage attendance for assigned teachers ")],-1)),n(c,{onClick:C,variant:"primary"},{default:l(()=>[n(d(I),{class:"h-5 w-5 mr-2"}),t[0]||(t[0]=u(" View Reports ",-1))]),_:1})]),e("div",X,[n(m,{class:"p-6"},{default:l(()=>[e("div",Y,[e("div",null,[t[2]||(t[2]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Records",-1)),e("p",Z,r(o.value.length),1)]),e("div",tt,[n(d(k),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),n(m,{class:"p-6"},{default:l(()=>[e("div",et,[e("div",null,[t[3]||(t[3]=e("p",{class:"text-sm font-medium text-gray-600"},"Attendance Rate",-1)),e("p",st,r(F.value)+"% ",1),t[4]||(t[4]=e("p",{class:"mt-1 text-xs text-green-600"},"Overall",-1))]),e("div",at,[n(d(J),{class:"h-8 w-8 text-green-600"})])])]),_:1}),n(m,{class:"p-6"},{default:l(()=>[e("div",nt,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Hours",-1)),e("p",lt,r(B.value)+"h ",1),t[6]||(t[6]=e("p",{class:"mt-1 text-xs text-gray-500"},"Hours taught",-1))]),e("div",rt,[n(d(M),{class:"h-8 w-8 text-purple-600"})])])]),_:1}),n(m,{class:"p-6"},{default:l(()=>[e("div",ot,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Present Today",-1)),e("p",it,r(o.value.filter(s=>{const i=new Date().toDateString();return s.date&&new Date(s.date).toDateString()===i&&s.status==="present"}).length),1),t[8]||(t[8]=e("p",{class:"mt-1 text-xs text-gray-500"},"Today",-1))]),e("div",dt,[n(d(q),{class:"h-8 w-8 text-emerald-600"})])])]),_:1})]),p.value?(h(),y("div",wt,[...t[9]||(t[9]=[e("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(h(),O(G,{key:0,title:"All Attendance Records",columns:g,data:o.value,searchable:!0,paginated:!0,exportable:!0,filters:D,"items-per-page":25,"row-key":"id",onExport:N},{"cell-teacher":l(({row:s})=>[e("div",ct,[e("div",ut,[e("span",mt,r(s.teacher.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2)),1)]),e("span",pt,r(s.teacher),1)])]),"cell-student":l(({row:s})=>[e("div",gt,[e("div",ft,[e("span",_t,r(s.student.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2)),1)]),e("span",xt,r(s.student),1)])]),"cell-class":l(({row:s})=>[e("div",ht,r(s.class||"—"),1)]),"cell-date":l(({row:s})=>[e("div",bt,[n(d(k),{class:"h-4 w-4 text-gray-400"}),u(" "+r(s.date?new Date(s.date).toLocaleDateString():"—"),1)])]),"cell-duration":l(({row:s})=>[n($,{variant:"secondary"},{default:l(()=>[u(r(s.duration||"—"),1)]),_:2},1024)]),"cell-status":l(({row:s})=>[n($,{variant:s.status==="present"?"success":s.status==="absent"?"danger":"warning"},{default:l(()=>[u(r(s.status||"present"),1)]),_:2},1032,["variant"])]),"cell-hours":l(({row:s})=>[e("div",vt,r(parseFloat(s.hours||0).toFixed(2))+"h ",1)]),"row-actions":l(({row:s})=>[e("button",{onClick:i=>T(s),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[n(d(K),{class:"h-5 w-5"})],8,yt)]),_:1},8,["data"]))])]),_:1})],64)}}};export{Et as default};
