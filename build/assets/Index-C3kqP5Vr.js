import{l as C,r as n,m as M,o as S,c as a,b as y,u as U,h as B,w as _,d as e,f as o,F as m,g as p,s as h,t as r,j as D,k as L,q as N}from"./app-C5n5MEBy.js";import{_ as T}from"./AuthenticatedLayout-CuJFiyfd.js";import{a as v}from"./api-DyaYUT2x.js";const V={class:"py-10"},$={class:"mx-auto max-w-6xl px-4 sm:px-6 lg:px-8"},z={class:"grid gap-6 lg:grid-cols-4"},F={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},I={class:"max-h-[32rem] divide-y divide-gray-100 overflow-y-auto"},j=["onClick"],q={class:"font-medium"},E={class:"text-xs text-gray-500"},P={class:"lg:col-span-3"},A={class:"flex h-[32rem] flex-col rounded-lg border border-gray-200 bg-white shadow-sm"},G={class:"border-b border-gray-100 px-6 py-4"},H={key:0,class:"flex items-center gap-2"},J={class:"text-base font-semibold text-gray-900"},K={class:"text-xs text-gray-500 capitalize"},O={key:1,class:"text-sm text-gray-500"},Q={class:"flex-1 overflow-y-auto px-6 py-4"},R={key:0,class:"py-10 text-center text-sm text-gray-500"},W={key:1,class:"py-10 text-center text-sm text-gray-500"},X={key:2,class:"space-y-4"},Y={class:"mt-2 text-xs opacity-70"},Z={class:"border-t border-gray-100 px-6 py-4"},ee=["disabled"],se=["disabled"],de={__name:"Index",setup(te){const b=C(),g=n(!1),c=n([]),u=n([]),i=n(null),d=n(""),f=M(()=>b.props.auth?.user?.id),w=async()=>{const{data:l}=await v.get("/message/users");c.value=l},x=async l=>{i.value=l,g.value=!0;try{const{data:t}=await v.get(`/message/${l.id}`);u.value=t}catch(t){console.error(t)}finally{g.value=!1}},k=async()=>{if(!(!d.value.trim()||!i.value))try{const{data:l}=await v.post("/message",{receiver_id:i.value.id,message:d.value});u.value.push(l),d.value=""}catch(l){console.error(l)}};return S(async()=>{await w(),c.value.length&&await x(c.value[0])}),(l,t)=>(o(),a(m,null,[y(U(B),{title:"Messages"}),y(T,null,{header:_(()=>[...t[1]||(t[1]=[e("div",null,[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Messages "),e("p",{class:"text-sm text-gray-500"}," Communicate securely with admins, teachers, and super administrators. ")],-1)])]),default:_(()=>[e("div",V,[e("div",$,[e("div",z,[e("aside",F,[t[2]||(t[2]=e("div",{class:"border-b border-gray-100 px-4 py-3 text-sm font-semibold text-gray-700"}," Contacts ",-1)),e("ul",I,[(o(!0),a(m,null,p(c.value,s=>(o(),a("li",{key:s.id,class:h(["cursor-pointer px-4 py-3 text-sm hover:bg-indigo-50",i.value?.id===s.id?"bg-indigo-50 text-indigo-600":"text-gray-700"]),onClick:ae=>x(s)},[e("div",q,r(s.name),1),e("div",E,r(s.role),1)],10,j))),128))])]),e("section",P,[e("div",A,[e("div",G,[i.value?(o(),a("div",H,[e("div",null,[e("div",J,r(i.value.name),1),e("div",K,r(i.value.role),1)])])):(o(),a("div",O," Select a user to start chatting. "))]),e("div",Q,[g.value?(o(),a("div",R," Loading conversation... ")):u.value.length===0?(o(),a("div",W," No messages yet. Say hello! ")):(o(),a("div",X,[(o(!0),a(m,null,p(u.value,s=>(o(),a("div",{key:s.id,class:h(["max-w-sm rounded-lg px-4 py-3 text-sm",s.sender_id===f.value?"ml-auto bg-indigo-600 text-white":"mr-auto bg-gray-100 text-gray-800"])},[e("p",null,r(s.message),1),e("div",Y,r(new Date(s.created_at).toLocaleString()),1)],2))),128))]))]),e("div",Z,[e("form",{class:"flex items-center gap-3",onSubmit:D(k,["prevent"])},[L(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),type:"text",placeholder:"Type your message...",class:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",disabled:!i.value},null,8,ee),[[N,d.value]]),e("button",{type:"submit",class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:!i.value||!d.value.trim()}," Send ",8,se)],32)])])])])])])]),_:1})],64))}};export{de as default};
