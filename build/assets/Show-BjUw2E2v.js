import{u as I,j as c,r as f,o as L,c as n,a as o,b as g,h as P,w as i,d as e,k as v,g as a,F as y,t as d,f as m,e as V,q as E,i as _}from"./app-CGuEmW06.js";import{r as j,_ as q}from"./AuthenticatedLayout-CJGuDV3D.js";import{a as N}from"./api-B9gIEsIZ.js";import{_ as b}from"./Button-BBsil_pH.js";import{_ as O,a as M,b as z,c as G,d as H}from"./DialogFooter-D_yQBisI.js";import{P as J}from"./PdfViewer-DMd90zdb.js";import{r as K}from"./ArrowLeftIcon-Cd0Nh-mh.js";import{r as Q}from"./TrashIcon-7rQaTgdF.js";import"./utils-D-FEVSg0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"flex items-center justify-between"},W={class:"flex items-center gap-4"},X={class:"text-xl font-semibold leading-tight text-gray-800"},Y={key:0,class:"flex items-center gap-3"},Z=["href"],ee={class:"py-10"},te={class:"mx-auto max-w-7xl space-y-6 px-4 sm:px-6 lg:px-8"},se={key:0,class:"text-center py-12"},oe={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},ae={class:"px-6 py-4"},le={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3"},re={class:"mt-1 text-sm text-gray-900"},ne={class:"mt-1 text-sm text-gray-900"},ie={class:"mt-1 text-sm text-gray-900"},de={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},ue={class:"border-b border-gray-200 px-6 py-4"},ce={class:"text-lg font-semibold text-gray-900 flex items-center gap-2"},me={key:0,class:"ml-auto text-xs font-normal text-gray-500"},ge={class:"px-6 py-4"},ve={key:1,class:"text-center py-12 text-gray-500"},pe={key:0,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},xe={class:"border-b border-gray-200 px-6 py-4"},fe={class:"text-lg font-semibold text-gray-900"},ye={class:"px-6 py-4"},_e={class:"overflow-x-auto"},be={class:"min-w-full divide-y divide-gray-200"},he={class:"divide-y divide-gray-200 bg-white"},ke=["onClick"],we={class:"px-4 py-3 text-sm text-gray-900"},$e={class:"px-4 py-3 text-sm text-gray-900"},De={class:"px-4 py-3 text-sm text-gray-900"},Pe={__name:"Show",props:{bookId:{type:[String,Number],required:!0}},setup(T){const h=T,U=I(),k=c(()=>U.props.auth?.user?.role??"teacher"),w=c(()=>k.value==="super-admin"),$=c(()=>["admin","super-admin"].includes(k.value)),D=c(()=>w.value),B=c(()=>w.value),u=f(!1),s=f(null),p=f(!1),x=c(()=>s.value?`/api/v1/books/${s.value.id}/stream`:null),C=c(()=>s.value?s.value.path?`/storage/${s.value.path}`:x.value:null),A=async()=>{u.value=!0;try{const{data:l}=await N.get(`/books/${h.bookId}`);s.value=l}catch(l){console.error("Error fetching book:",l)}finally{u.value=!1}},F=async()=>{try{u.value=!0,await N.delete(`/books/${h.bookId}`),_.visit(route("books.index"))}catch(l){console.error("Error deleting book:",l),p.value=!1}finally{u.value=!1}},S=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"—";return L(()=>{A()}),(l,t)=>(a(),n(y,null,[o(g(P),{title:s.value?`${s.value.title} - Book Details`:"Book Details"},null,8,["title"]),o(q,null,{header:i(()=>[e("div",R,[e("div",W,[e("button",{onClick:t[0]||(t[0]=r=>g(_).visit(l.route("books.index"))),class:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600"},[o(g(K),{class:"h-5 w-5"})]),e("div",null,[e("h2",X,d(s.value?.title??"Loading..."),1),t[4]||(t[4]=e("p",{class:"text-sm text-gray-500"},"Book Viewer",-1))])]),D.value||$.value?(a(),n("div",Y,[D.value&&C.value?(a(),n("a",{key:0,href:C.value,target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 rounded-md border border-gray-300 px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"}," Download ",8,Z)):v("",!0),$.value?(a(),V(b,{key:1,onClick:t[1]||(t[1]=r=>p.value=!0),variant:"destructive",disabled:u.value},{default:i(()=>[o(g(Q),{class:"h-4 w-4 mr-2"}),t[5]||(t[5]=m(" Delete ",-1))]),_:1},8,["disabled"])):v("",!0)])):v("",!0)])]),default:i(()=>[e("div",ee,[e("div",te,[u.value&&!s.value?(a(),n("div",se,[...t[6]||(t[6]=[e("div",{class:"text-gray-500"},"Loading book information...",-1)])])):s.value?(a(),n(y,{key:1},[e("div",oe,[t[10]||(t[10]=e("div",{class:"border-b border-gray-200 px-6 py-4"},[e("h3",{class:"text-lg font-semibold text-gray-900"}," Book Information ")],-1)),e("div",ae,[e("dl",le,[e("div",null,[t[7]||(t[7]=e("dt",{class:"text-sm font-medium text-gray-500"}," Title ",-1)),e("dd",re,d(s.value.title??"—"),1)]),e("div",null,[t[8]||(t[8]=e("dt",{class:"text-sm font-medium text-gray-500"}," Original Filename ",-1)),e("dd",ne,d(s.value.original_filename??"—"),1)]),e("div",null,[t[9]||(t[9]=e("dt",{class:"text-sm font-medium text-gray-500"}," Uploaded ",-1)),e("dd",ie,d(S(s.value.created_at)),1)])])])]),e("div",de,[e("div",ue,[e("h3",ce,[o(g(j),{class:"h-5 w-5"}),t[11]||(t[11]=m(" Book Content ",-1)),B.value?v("",!0):(a(),n("span",me," (Copy, highlight, and download are restricted) "))])]),e("div",ge,[x.value?(a(),V(J,{key:0,src:x.value,"allow-text-selection":B.value},null,8,["src","allow-text-selection"])):(a(),n("div",ve," PDF not available "))])]),s.value.book_assignments&&s.value.book_assignments.length>0?(a(),n("div",pe,[e("div",xe,[e("h3",fe," Assignments ("+d(s.value.book_assignments.length)+") ",1)]),e("div",ye,[e("div",_e,[e("table",be,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Student "),e("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Teacher "),e("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Assigned Date ")])],-1)),e("tbody",he,[(a(!0),n(y,null,E(s.value.book_assignments,r=>(a(),n("tr",{key:r.id,class:"hover:bg-gray-50 cursor-pointer",onClick:Be=>g(_).visit(l.route("assignments.show",r.id))},[e("td",we,d(r.student?.name??"—"),1),e("td",$e,d(r.teacher?.name??"—"),1),e("td",De,d(S(r.created_at)),1)],8,ke))),128))])])])])])):v("",!0)],64)):v("",!0)])]),o(O,{open:p.value,"onUpdate:open":t[3]||(t[3]=r=>p.value=r)},{default:i(()=>[e("div",null,[o(M,null,{default:i(()=>[o(z,null,{default:i(()=>[...t[13]||(t[13]=[m("Delete Book",-1)])]),_:1}),o(G,null,{default:i(()=>[t[14]||(t[14]=m(" Are you sure you want to delete ",-1)),e("strong",null,d(s.value?.title),1),t[15]||(t[15]=m("? This action cannot be undone. ",-1))]),_:1})]),_:1}),o(H,null,{default:i(()=>[o(b,{variant:"outline",onClick:t[2]||(t[2]=r=>p.value=!1)},{default:i(()=>[...t[16]||(t[16]=[m("Cancel",-1)])]),_:1}),o(b,{variant:"destructive",onClick:F,disabled:u.value},{default:i(()=>[...t[17]||(t[17]=[m(" Delete ",-1)])]),_:1},8,["disabled"])]),_:1})])]),_:1},8,["open"])]),_:1})],64))}};export{Pe as default};
