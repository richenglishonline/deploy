import{u as D,r as g,j as F,o as N,c as _,a as o,b as n,h as S,w as l,d as t,e as B,f as h,t as i,g as u,k as E,F as V,i as x}from"./app-Cmmq__Tw.js";import{g as M,d as T,e as L,_ as P}from"./AuthenticatedLayout-B2GbnFPi.js";import{_ as I}from"./AdvancedTable-CIaIA73U.js";import{_ as p}from"./Card-CcoMGp7w.js";import{_ as O}from"./Badge-BZFBi4LI.js";import{_ as q}from"./Button-D72KtQR-.js";import{a as c}from"./api-BS-ONIJM.js";import{r as G}from"./PlusIcon-3lCZdoOe.js";import{r as b}from"./ArrowDownTrayIcon-CzbVfJHZ.js";import{r as v}from"./PlayIcon-B-NjgEGo.js";import{r as H}from"./EyeIcon-DroDtrWB.js";import{r as J}from"./TrashIcon-DD0p8Ace.js";import"./ArrowUpIcon-DRFX-h9Y.js";const K={class:"space-y-6 pb-8"},Q={class:"flex items-center justify-between"},W={class:"grid grid-cols-1 gap-6 sm:grid-cols-3"},X={class:"flex items-center justify-between"},Y={class:"mt-2 text-3xl font-semibold text-gray-900"},Z={class:"rounded-lg bg-blue-50 p-3"},ee={class:"flex items-center justify-between"},te={class:"mt-2 text-3xl font-semibold text-gray-900"},se={class:"rounded-lg bg-purple-50 p-3"},ae={class:"flex items-center justify-between"},oe={class:"mt-2 text-3xl font-semibold text-gray-900"},le={class:"rounded-lg bg-orange-50 p-3"},re={class:"flex items-center gap-3"},ne={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-red-500 to-pink-600"},ie={class:"font-medium text-gray-900"},de={key:0,class:"text-xs text-gray-500"},ce={class:"flex items-center gap-2"},ue={class:"text-gray-900"},me={class:"text-gray-900"},ge={class:"text-right text-gray-900"},_e={class:"flex items-center justify-end gap-2"},pe=["onClick"],fe=["onClick"],ye=["onClick"],he=["onClick"],xe={key:1,class:"space-y-4"},Se={__name:"Index",setup(be){D();const m=g(!1),d=g([]),w=g(null),k=[{key:"title",label:"Recording",sortable:!0},{key:"student",label:"Student",sortable:!0},{key:"class",label:"Class",sortable:!0},{key:"duration",label:"Duration",sortable:!0,align:"center"},{key:"file_size",label:"Size",sortable:!0,align:"right"},{key:"created_at",label:"Uploaded",sortable:!0,format:"date"}],$=[{key:"student_id",label:"Student",type:"select",options:[{value:"",label:"All Students"}]}],f=async()=>{m.value=!0;try{const{data:s}=await c.get("/teacher/recordings");d.value=Array.isArray(s.recordings||s)?(s.recordings||s).map(e=>({...e,title:e.title||e.file_name||"Untitled Recording",student:e.student?`${e.student.first_name||""} ${e.student.last_name||""}`.trim()||e.student.email:"N/A",class:e.class_schedule?`Class #${e.class_schedule.id}`:"N/A",duration:e.duration?`${e.duration} min`:"N/A",file_size:e.file_size?`${(e.file_size/1024/1024).toFixed(2)} MB`:"N/A"})):[]}catch(s){console.error("Error fetching recordings:",s),d.value=[]}finally{m.value=!1}},y=async()=>{try{const{data:s}=await c.get("/dashboard/stats");w.value=s?.dashboard||{}}catch(s){console.error("Error fetching stats:",s)}},C=()=>{x.visit("/teacher/recordings/upload")},R=s=>{x.visit(`/teacher/recordings/${s.id}`)},z=async s=>{try{const e=await c.get(`/recordings/${s.id}/play`);window.open(e.data.url,"_blank")}catch(e){console.error("Error playing recording:",e),alert("Failed to play recording")}},A=async s=>{try{const e=await c.get(`/recordings/${s.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=a,r.setAttribute("download",s.file_name||`${s.title}.mp4`),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("Error downloading recording:",e),alert("Failed to download recording")}},U=async s=>{if(confirm(`Are you sure you want to delete "${s.title}"?`))try{await c.delete(`/recordings/${s.id}`),await f(),await y()}catch(e){console.error("Error deleting recording:",e),alert("Failed to delete recording")}},j=F(()=>(d.value.reduce((s,e)=>s+(e.file_size?parseFloat(e.file_size):0),0)/1024).toFixed(2));return N(()=>{f(),y()}),(s,e)=>(u(),_(V,null,[o(n(S),{title:"My Recordings"}),o(P,null,{default:l(()=>[t("div",K,[t("div",Q,[e[1]||(e[1]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"My Recordings"),t("p",{class:"mt-1 text-sm text-gray-500"}," Upload and manage your class recordings ")],-1)),o(q,{onClick:C,variant:"primary"},{default:l(()=>[o(n(G),{class:"h-5 w-5 mr-2"}),e[0]||(e[0]=h(" Upload Recording ",-1))]),_:1})]),t("div",W,[o(p,{class:"p-6"},{default:l(()=>[t("div",X,[t("div",null,[e[2]||(e[2]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Recordings",-1)),t("p",Y,i(d.value.length),1)]),t("div",Z,[o(n(M),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),o(p,{class:"p-6"},{default:l(()=>[t("div",ee,[t("div",null,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-gray-600"},"Storage Used",-1)),t("p",te,i(j.value)+" MB ",1),e[4]||(e[4]=t("p",{class:"mt-1 text-xs text-gray-500"},"Total size",-1))]),t("div",se,[o(n(b),{class:"h-8 w-8 text-purple-600"})])])]),_:1}),o(p,{class:"p-6"},{default:l(()=>[t("div",ae,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Duration",-1)),t("p",oe,i(d.value.reduce((a,r)=>a+(parseInt(r.duration)||0),0))+" min ",1),e[6]||(e[6]=t("p",{class:"mt-1 text-xs text-gray-500"},"Combined",-1))]),t("div",le,[o(n(T),{class:"h-8 w-8 text-orange-600"})])])]),_:1})]),m.value?(u(),_("div",xe,[...e[7]||(e[7]=[t("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(u(),B(I,{key:0,title:"All Recordings",columns:k,data:d.value,searchable:!0,paginated:!0,filters:$,"items-per-page":25,"row-key":"id"},{"cell-title":l(({row:a})=>[t("div",re,[t("div",ne,[o(n(v),{class:"h-5 w-5 text-white"})]),t("div",null,[t("div",ie,i(a.title),1),a.class?(u(),_("div",de,i(a.class),1)):E("",!0)])])]),"cell-student":l(({row:a})=>[t("div",ce,[o(n(L),{class:"h-4 w-4 text-gray-400"}),t("span",ue,i(a.student),1)])]),"cell-class":l(({row:a})=>[t("div",me,i(a.class||"—"),1)]),"cell-duration":l(({row:a})=>[o(O,{variant:"secondary"},{default:l(()=>[h(i(a.duration||"—"),1)]),_:2},1024)]),"cell-file_size":l(({row:a})=>[t("div",ge,i(a.file_size||"—"),1)]),"row-actions":l(({row:a})=>[t("div",_e,[t("button",{onClick:r=>z(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"Play"},[o(n(v),{class:"h-5 w-5"})],8,pe),t("button",{onClick:r=>A(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-green-600 transition-colors",title:"Download"},[o(n(b),{class:"h-5 w-5"})],8,fe),t("button",{onClick:r=>R(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[o(n(H),{class:"h-5 w-5"})],8,ye),t("button",{onClick:r=>U(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-red-600 transition-colors",title:"Delete"},[o(n(J),{class:"h-5 w-5"})],8,he)])]),_:1},8,["data"]))])]),_:1})],64))}};export{Se as default};
