import{u as E,r as x,j as b,o as L,c as v,a as n,b as i,h as U,w as l,d as e,e as B,t as r,g as f,f as _,F as V,i as H}from"./app-BiSPCPuo.js";import{a as y,d as O,e as P,_ as I}from"./AuthenticatedLayout-57Q77M7z.js";import{_ as M}from"./AdvancedTable-5fi55ECo.js";import{_ as c}from"./Card-B0sMFwFC.js";import{_ as w}from"./Badge-DAiRCop6.js";import{a as k}from"./api-BtR7IrG5.js";import{r as q}from"./CheckCircleIcon-C_xlp5Nk.js";import{r as z}from"./EyeIcon-BomQU5Ge.js";import"./ArrowDownTrayIcon-DICVMDSG.js";import"./ArrowUpIcon-IEJdmouC.js";import"./TrashIcon-DlbRnS0G.js";const G={class:"space-y-6 pb-8"},J={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},K={class:"flex items-center justify-between"},Q={class:"mt-2 text-3xl font-semibold text-gray-900"},W={class:"rounded-lg bg-blue-50 p-3"},X={class:"flex items-center justify-between"},Y={class:"mt-2 text-3xl font-semibold text-gray-900"},Z={class:"rounded-lg bg-green-50 p-3"},tt={class:"flex items-center justify-between"},et={class:"mt-2 text-3xl font-semibold text-gray-900"},st={class:"rounded-lg bg-purple-50 p-3"},at={class:"flex items-center justify-between"},lt={class:"mt-2 text-3xl font-semibold text-gray-900"},nt={class:"rounded-lg bg-emerald-50 p-3"},rt={class:"flex items-center gap-3"},ot={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-indigo-500 to-purple-600"},it={class:"text-sm font-semibold text-white"},dt={class:"font-medium text-gray-900"},ct={class:"flex items-center gap-3"},ut={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-green-500 to-teal-600"},mt={class:"text-sm font-semibold text-white"},pt={class:"font-medium text-gray-900"},gt={class:"text-gray-900"},xt={class:"flex items-center gap-2 text-gray-900"},ft={class:"text-right font-medium text-gray-900"},_t=["onClick"],ht={key:1,class:"space-y-4"},Ct={__name:"Index",setup(bt){E();const u=x(!1),o=x([]),$=x(null),m=[{key:"teacher",label:"Teacher",sortable:!0},{key:"student",label:"Student",sortable:!0},{key:"class",label:"Class",sortable:!0},{key:"date",label:"Date",sortable:!0,format:"date"},{key:"duration",label:"Duration",sortable:!0,align:"center"},{key:"status",label:"Status",sortable:!0,align:"center"},{key:"hours",label:"Hours",sortable:!0,align:"right",format:"number"}],A=[{key:"status",label:"Status",type:"select",options:[{value:"",label:"All Statuses"},{value:"present",label:"Present"},{value:"absent",label:"Absent"},{value:"late",label:"Late"}]}],j=async()=>{u.value=!0;try{const{data:a}=await k.get("/attendance");o.value=Array.isArray(a.attendances||a)?(a.attendances||a).map(t=>({...t,teacher:t.teacher?`${t.teacher.first_name||""} ${t.teacher.last_name||""}`.trim()||t.teacher.email:"N/A",student:t.student?`${t.student.first_name||""} ${t.student.last_name||""}`.trim()||t.student.email:"N/A",class:t.class_schedule?`Class #${t.class_schedule.id}`:"N/A",date:t.date||t.class_schedule?.start_time,duration:t.duration?`${t.duration} min`:"N/A",hours:t.hours||(t.duration?(t.duration/60).toFixed(2):0),status:t.status||"present"})):[]}catch(a){console.error("Error fetching attendance:",a),o.value=[]}finally{u.value=!1}},S=async()=>{try{const{data:a}=await k.get("/dashboard/stats");$.value=a?.stats||{}}catch(a){console.error("Error fetching stats:",a)}},F=a=>{H.visit(`/super-admin/attendance/${a.id}`)},R=b(()=>o.value.reduce((a,t)=>a+(parseFloat(t.hours)||0),0).toFixed(2)),T=b(()=>{const a=o.value.length;return a===0?0:(o.value.filter(s=>s.status==="present").length/a*100).toFixed(1)}),C=a=>{const t=m.map(g=>g.label).join(","),s=a.map(g=>m.map(N=>`"${g[N.key]||""}"`).join(",")).join(`
`),d=`${t}
${s}`,D=new Blob([d],{type:"text/csv"}),h=window.URL.createObjectURL(D),p=document.createElement("a");p.href=h,p.download=`attendance-${new Date().toISOString().split("T")[0]}.csv`,p.click(),window.URL.revokeObjectURL(h)};return L(()=>{j(),S()}),(a,t)=>(f(),v(V,null,[n(i(U),{title:"Attendance Tracking"}),n(I,null,{default:l(()=>[e("div",G,[t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Attendance Tracking"),e("p",{class:"mt-1 text-sm text-gray-500"}," System-wide attendance tracking and reporting ")],-1)),e("div",J,[n(c,{class:"p-6"},{default:l(()=>[e("div",K,[e("div",null,[t[0]||(t[0]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Records",-1)),e("p",Q,r(o.value.length),1),t[1]||(t[1]=e("p",{class:"mt-1 text-xs text-gray-500"},"All time",-1))]),e("div",W,[n(i(y),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),n(c,{class:"p-6"},{default:l(()=>[e("div",X,[e("div",null,[t[2]||(t[2]=e("p",{class:"text-sm font-medium text-gray-600"},"Attendance Rate",-1)),e("p",Y,r(T.value)+"% ",1),t[3]||(t[3]=e("p",{class:"mt-1 text-xs text-green-600"},"Overall",-1))]),e("div",Z,[n(i(q),{class:"h-8 w-8 text-green-600"})])])]),_:1}),n(c,{class:"p-6"},{default:l(()=>[e("div",tt,[e("div",null,[t[4]||(t[4]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Hours",-1)),e("p",et,r(R.value),1),t[5]||(t[5]=e("p",{class:"mt-1 text-xs text-gray-500"},"Hours taught",-1))]),e("div",st,[n(i(O),{class:"h-8 w-8 text-purple-600"})])])]),_:1}),n(c,{class:"p-6"},{default:l(()=>[e("div",at,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm font-medium text-gray-600"},"Present",-1)),e("p",lt,r(o.value.filter(s=>s.status==="present").length),1),t[7]||(t[7]=e("p",{class:"mt-1 text-xs text-gray-500"},"This month",-1))]),e("div",nt,[n(i(P),{class:"h-8 w-8 text-emerald-600"})])])]),_:1})]),u.value?(f(),v("div",ht,[...t[8]||(t[8]=[e("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(f(),B(M,{key:0,title:"All Attendance Records",columns:m,data:o.value,searchable:!0,paginated:!0,exportable:!0,filters:A,"items-per-page":25,"row-key":"id",onExport:C},{"cell-teacher":l(({row:s})=>[e("div",rt,[e("div",ot,[e("span",it,r(s.teacher.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2)),1)]),e("span",dt,r(s.teacher),1)])]),"cell-student":l(({row:s})=>[e("div",ct,[e("div",ut,[e("span",mt,r(s.student.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2)),1)]),e("span",pt,r(s.student),1)])]),"cell-class":l(({row:s})=>[e("div",gt,r(s.class||"—"),1)]),"cell-date":l(({row:s})=>[e("div",xt,[n(i(y),{class:"h-4 w-4 text-gray-400"}),_(" "+r(s.date?new Date(s.date).toLocaleDateString():"—"),1)])]),"cell-duration":l(({row:s})=>[n(w,{variant:"secondary"},{default:l(()=>[_(r(s.duration||"—"),1)]),_:2},1024)]),"cell-status":l(({row:s})=>[n(w,{variant:s.status==="present"?"success":s.status==="absent"?"danger":"warning"},{default:l(()=>[_(r(s.status||"present"),1)]),_:2},1032,["variant"])]),"cell-hours":l(({row:s})=>[e("div",ft,r(parseFloat(s.hours||0).toFixed(2))+"h ",1)]),"row-actions":l(({row:s})=>[e("button",{onClick:d=>F(s),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[n(i(z),{class:"h-5 w-5"})],8,_t)]),_:1},8,["data"]))])]),_:1})],64))}};export{Ct as default};
