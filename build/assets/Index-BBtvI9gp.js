import{u as U,r as h,j as F,o as A,c as u,a as l,b as r,h as B,w as n,d as t,e as D,f as M,t as i,g as c,k as N,F as E,i as x}from"./app-Cmmq__Tw.js";import{f as v,a as V,e as T,_ as L}from"./AuthenticatedLayout-B2GbnFPi.js";import{_ as R}from"./AdvancedTable-CIaIA73U.js";import{_ as g}from"./Card-CcoMGp7w.js";import{_ as O}from"./Button-D72KtQR-.js";import{a as m}from"./api-BS-ONIJM.js";import{r as Y}from"./PlusIcon-3lCZdoOe.js";import{r as b}from"./ArrowDownTrayIcon-CzbVfJHZ.js";import{r as I}from"./EyeIcon-DroDtrWB.js";import{r as K}from"./TrashIcon-DD0p8Ace.js";import"./ArrowUpIcon-DRFX-h9Y.js";const P={class:"space-y-6 pb-8"},q={class:"flex items-center justify-between"},G={class:"grid grid-cols-1 gap-6 sm:grid-cols-3"},H={class:"flex items-center justify-between"},J={class:"mt-2 text-3xl font-semibold text-gray-900"},Q={class:"rounded-lg bg-blue-50 p-3"},W={class:"flex items-center justify-between"},X={class:"mt-2 text-3xl font-semibold text-gray-900"},Z={class:"rounded-lg bg-purple-50 p-3"},ee={class:"flex items-center justify-between"},te={class:"mt-2 text-3xl font-semibold text-gray-900"},se={class:"rounded-lg bg-green-50 p-3"},ae={class:"flex items-center gap-3"},le=["src","alt"],oe={key:1,class:"flex h-12 w-12 items-center justify-center rounded-lg bg-gray-100"},re={class:"font-medium text-gray-900"},ne={key:0,class:"text-xs text-gray-500"},ie={class:"flex items-center gap-2"},de={class:"text-gray-900"},ce={class:"text-gray-900"},ue={class:"text-right text-gray-900"},me={class:"flex items-center justify-end gap-2"},_e=["onClick"],he=["onClick"],ge=["onClick"],fe={key:1,class:"space-y-4"},Ue={__name:"Index",setup(pe){U();const _=h(!1),d=h([]),w=h(null),k=[{key:"thumbnail",label:"Screenshot",sortable:!1},{key:"student",label:"Student",sortable:!0},{key:"class",label:"Class",sortable:!0},{key:"file_size",label:"Size",sortable:!0,align:"right"},{key:"created_at",label:"Uploaded",sortable:!0,format:"date"}],f=async()=>{_.value=!0;try{const{data:s}=await m.get("/teacher/screenshots");d.value=Array.isArray(s.screenshots||s)?(s.screenshots||s).map(e=>({...e,student:e.student?`${e.student.first_name||""} ${e.student.last_name||""}`.trim()||e.student.email:"N/A",class:e.class_schedule?`Class #${e.class_schedule.id}`:"N/A",file_size:e.file_size?`${(e.file_size/1024).toFixed(2)} KB`:"N/A"})):[]}catch(s){console.error("Error fetching screenshots:",s),d.value=[]}finally{_.value=!1}},p=async()=>{try{const{data:s}=await m.get("/dashboard/stats");w.value=s?.dashboard||{}}catch(s){console.error("Error fetching stats:",s)}},$=()=>{x.visit("/teacher/screenshots/upload")},S=s=>{x.visit(`/teacher/screenshots/${s.id}`)},C=async s=>{try{const e=await m.get(`/screenshots/${s.id}/download`,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=a,o.setAttribute("download",s.file_name||`screenshot-${s.id}.png`),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("Error downloading screenshot:",e),alert("Failed to download screenshot")}},j=async s=>{if(confirm("Are you sure you want to delete this screenshot?"))try{await m.delete(`/screenshots/${s.id}`),await f(),await p()}catch(e){console.error("Error deleting screenshot:",e),alert("Failed to delete screenshot")}},z=F(()=>(d.value.reduce((s,e)=>s+(e.file_size?parseFloat(e.file_size):0),0)/1024/1024).toFixed(2));return A(()=>{f(),p()}),(s,e)=>(c(),u(E,null,[l(r(B),{title:"My Screenshots"}),l(L,null,{default:n(()=>[t("div",P,[t("div",q,[e[1]||(e[1]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"My Screenshots"),t("p",{class:"mt-1 text-sm text-gray-500"}," Upload and manage your class screenshots ")],-1)),l(O,{onClick:$,variant:"primary"},{default:n(()=>[l(r(Y),{class:"h-5 w-5 mr-2"}),e[0]||(e[0]=M(" Upload Screenshot ",-1))]),_:1})]),t("div",G,[l(g,{class:"p-6"},{default:n(()=>[t("div",H,[t("div",null,[e[2]||(e[2]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Screenshots",-1)),t("p",J,i(d.value.length),1)]),t("div",Q,[l(r(v),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),l(g,{class:"p-6"},{default:n(()=>[t("div",W,[t("div",null,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-gray-600"},"Storage Used",-1)),t("p",X,i(z.value)+" MB ",1),e[4]||(e[4]=t("p",{class:"mt-1 text-xs text-gray-500"},"Total size",-1))]),t("div",Z,[l(r(b),{class:"h-8 w-8 text-purple-600"})])])]),_:1}),l(g,{class:"p-6"},{default:n(()=>[t("div",ee,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600"},"This Month",-1)),t("p",te,i(d.value.filter(a=>{const o=new Date(a.created_at),y=new Date;return o.getMonth()===y.getMonth()&&o.getFullYear()===y.getFullYear()}).length),1),e[6]||(e[6]=t("p",{class:"mt-1 text-xs text-gray-500"},"Uploads",-1))]),t("div",se,[l(r(V),{class:"h-8 w-8 text-green-600"})])])]),_:1})]),_.value?(c(),u("div",fe,[...e[7]||(e[7]=[t("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(c(),D(R,{key:0,title:"All Screenshots",columns:k,data:d.value,searchable:!0,paginated:!0,"items-per-page":25,"row-key":"id"},{"cell-thumbnail":n(({row:a})=>[t("div",ae,[a.file_url?(c(),u("img",{key:0,src:a.file_url,alt:a.file_name||"Screenshot",class:"h-12 w-12 rounded-lg object-cover"},null,8,le)):(c(),u("div",oe,[l(r(v),{class:"h-6 w-6 text-gray-400"})])),t("div",null,[t("div",re,i(a.file_name||"Screenshot"),1),a.class?(c(),u("div",ne,i(a.class),1)):N("",!0)])])]),"cell-student":n(({row:a})=>[t("div",ie,[l(r(T),{class:"h-4 w-4 text-gray-400"}),t("span",de,i(a.student),1)])]),"cell-class":n(({row:a})=>[t("div",ce,i(a.class||"—"),1)]),"cell-file_size":n(({row:a})=>[t("div",ue,i(a.file_size||"—"),1)]),"row-actions":n(({row:a})=>[t("div",me,[t("button",{onClick:o=>S(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View"},[l(r(I),{class:"h-5 w-5"})],8,_e),t("button",{onClick:o=>C(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-green-600 transition-colors",title:"Download"},[l(r(b),{class:"h-5 w-5"})],8,he),t("button",{onClick:o=>j(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-red-600 transition-colors",title:"Delete"},[l(r(K),{class:"h-5 w-5"})],8,ge)])]),_:1},8,["data"]))])]),_:1})],64))}};export{Ue as default};
