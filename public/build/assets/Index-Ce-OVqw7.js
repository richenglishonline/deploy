import{l as W,m as D,r as m,a as j,o as H,c as n,b as l,u as v,h as K,w as i,d as t,e as C,k as E,f as d,F as y,g as U,t as u,v as N,i as B,j as Q,n as p}from"./app-CIgItLJv.js";import{_ as X}from"./AuthenticatedLayout-DJwHHg2a.js";import{a as $}from"./api-VVF87TnZ.js";import{_ as h}from"./Button-B0tF0lTV.js";import{_ as Y,a as Z,b as I,c as ee}from"./DialogFooter-Arc2yNoV.js";import{_ as te}from"./DialogDescription-DrehivX2.js";import{_ as S,a as se}from"./Label-Ca64gdOv.js";import{r as M}from"./PhotoIcon-BN5Mh8j4.js";import{r as ae}from"./PlusIcon-CtWxGgWm.js";const le={class:"flex items-center justify-between"},oe={class:"flex items-center gap-3"},ie=["disabled"],ne={class:"py-10"},de={class:"mx-auto max-w-7xl space-y-6 px-4 sm:px-6 lg:px-8"},re={class:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm"},ue={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},ce=["value"],pe={class:"flex items-end gap-3 sm:col-span-2 lg:col-span-3"},fe=["disabled"],me=["disabled"],ge={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},ve=["onClick"],_e={class:"aspect-video bg-gray-100 flex items-center justify-center overflow-hidden"},be=["src","alt"],xe={key:1,class:"flex flex-col items-center justify-center text-gray-400"},ye={class:"p-3"},he={class:"text-xs font-medium text-gray-900 truncate"},we={class:"text-xs text-gray-500 mt-1"},ke={key:0,class:"text-xs text-gray-500 mt-1"},Ce={class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity"},Ue={key:0,class:"text-center py-12"},$e={key:1,class:"flex flex-col items-center justify-between gap-4 border-t border-gray-200 px-6 py-4 text-sm text-gray-600 sm:flex-row"},Se={class:"flex items-center gap-2"},Pe=["disabled"],Fe=["disabled"],Ve={class:"max-w-md"},De={class:"grid gap-4 py-4"},je=["value"],Je={__name:"Index",setup(Ee){const P=W(),A=D(()=>P.props.auth?.user?.role??"teacher"),G=D(()=>P.props.auth?.user?.id),c=m(!1),x=m([]),r=m(null),w=m([]),_=m(!1),b=m(!1),k=m(null),o=j({class_id:"",attendance_id:"",file:null}),f=j({class_id:"",attendance_id:"",page:1,limit:20}),O=async()=>{try{const{data:s}=await $.get("/class",{params:{teacher_id:A.value==="teacher"?G.value:void 0,limit:100}});w.value=s.classes||[]}catch(s){console.error("Error loading filters:",s)}},g=async()=>{c.value=!0;try{const{data:s}=await $.get("/screen-shot",{params:f});x.value=s.screenshots,r.value=s.pagination}catch(s){console.error("Error fetching screenshots:",s)}finally{c.value=!1}},F=s=>{r.value&&(s<1||s>r.value.totalPages||(f.page=s,g()))},T=()=>{f.class_id="",f.attendance_id="",f.page=1,g()},q=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”",V=s=>s.drive?.link?s.drive.link:s.path?`/storage/${s.path}`:null,z=s=>{const[e]=s.target.files??[];o.file=e??null},J=()=>{o.class_id="",o.attendance_id="",o.file=null,k.value&&(k.value.value="")},L=async()=>{if(!o.class_id||!o.file){alert("Please select a class and file");return}b.value=!0;try{const s=new FormData;s.append("class_id",o.class_id),o.attendance_id&&s.append("attendance_id",o.attendance_id),s.append("file",o.file),await $.post("/screen-shot",s,{headers:{"Content-Type":"multipart/form-data"}}),_.value=!1,J(),await g()}catch(s){console.error("Error uploading screenshot:",s),alert(s.response?.data?.message||"Failed to upload screenshot")}finally{b.value=!1}};return H(async()=>{await O(),await g()}),(s,e)=>(d(),n(y,null,[l(v(K),{title:"Screenshots"}),l(X,null,{header:i(()=>[t("div",le,[e[9]||(e[9]=t("div",null,[t("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Screenshots "),t("p",{class:"text-sm text-gray-500"}," View and manage class screenshots. ")],-1)),t("div",oe,[l(h,{onClick:e[0]||(e[0]=a=>_.value=!0),disabled:c.value},{default:i(()=>[l(v(ae),{class:"h-4 w-4 mr-2"}),e[8]||(e[8]=p(" Upload Screenshot ",-1))]),_:1},8,["disabled"]),t("button",{onClick:g,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:c.value}," Refresh ",8,ie)])])]),default:i(()=>[t("div",ne,[t("div",de,[t("div",re,[t("form",ue,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"}," Class ",-1)),E(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>f.class_id=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[e[10]||(e[10]=t("option",{value:""},"All Classes",-1)),(d(!0),n(y,null,U(w.value,a=>(d(),n("option",{key:a.id,value:a.id},u(a.student?.name??"Unknown")+" - "+u(a.start_date),9,ce))),128))],512),[[N,f.class_id]])]),t("div",pe,[t("button",{type:"button",onClick:g,class:"flex-1 rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:c.value}," Apply Filters ",8,fe),t("button",{type:"button",onClick:T,class:"flex-1 rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50",disabled:c.value}," Reset ",8,me)])])]),t("div",ge,[(d(!0),n(y,null,U(x.value,a=>(d(),n("div",{key:a.id,class:"group relative overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:R=>v(B).visit(s.route("screenshots.show",a.id))},[t("div",_e,[V(a)?(d(),n("img",{key:0,src:V(a),alt:a.filename,class:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"},null,8,be)):(d(),n("div",xe,[l(v(M),{class:"h-12 w-12"}),e[12]||(e[12]=t("span",{class:"text-xs mt-2"},"No preview",-1))]))]),t("div",ye,[t("div",he,u(a.filename??"Untitled Screenshot"),1),t("div",we,u(q(a.created_at)),1),a.classSchedule?(d(),n("div",ke,u(a.classSchedule.student?.name??"Unknown"),1)):C("",!0)]),t("div",Ce,[l(h,{onClick:Q(R=>v(B).visit(s.route("screenshots.show",a.id)),["stop"]),variant:"outline",size:"sm",class:"bg-white/90 backdrop-blur-sm"},{default:i(()=>[...e[13]||(e[13]=[p(" View ",-1)])]),_:1},8,["onClick"])])],8,ve))),128))]),!c.value&&x.value.length===0?(d(),n("div",Ue,[l(v(M),{class:"mx-auto h-12 w-12 text-gray-400"}),e[14]||(e[14]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No screenshots",-1)),e[15]||(e[15]=t("p",{class:"mt-1 text-sm text-gray-500"},"Get started by uploading a screenshot.",-1))])):C("",!0),r.value&&x.value.length>0?(d(),n("div",$e,[t("div",null," Page "+u(r.value.page)+" of "+u(r.value.totalPages??1),1),t("div",Se,[t("button",{onClick:e[2]||(e[2]=a=>F(r.value.page-1)),class:"rounded-md border border-gray-300 px-3 py-1 hover:bg-gray-50",disabled:c.value||r.value.page===1}," Previous ",8,Pe),t("button",{onClick:e[3]||(e[3]=a=>F(r.value.page+1)),class:"rounded-md border border-gray-300 px-3 py-1 hover:bg-gray-50",disabled:c.value||r.value.page===r.value.totalPages}," Next ",8,Fe)])])):C("",!0)])]),l(Y,{open:_.value,"onUpdate:open":e[7]||(e[7]=a=>_.value=a)},{default:i(()=>[t("div",Ve,[l(Z,null,{default:i(()=>[l(I,null,{default:i(()=>[...e[16]||(e[16]=[p("Upload Screenshot",-1)])]),_:1}),l(te,null,{default:i(()=>[...e[17]||(e[17]=[p(" Upload a screenshot image file. ",-1)])]),_:1})]),_:1}),t("div",De,[t("div",null,[l(S,{for:"upload-class"},{default:i(()=>[...e[18]||(e[18]=[p("Class *",-1)])]),_:1}),E(t("select",{id:"upload-class","onUpdate:modelValue":e[4]||(e[4]=a=>o.class_id=a),class:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",required:""},[e[19]||(e[19]=t("option",{value:""},"Select a class",-1)),(d(!0),n(y,null,U(w.value,a=>(d(),n("option",{key:a.id,value:a.id},u(a.student?.name??"Unknown")+" - "+u(a.start_date)+" "+u(a.start_time),9,je))),128))],512),[[N,o.class_id]])]),t("div",null,[l(S,{for:"upload-attendance"},{default:i(()=>[...e[20]||(e[20]=[p("Attendance (Optional)",-1)])]),_:1}),l(se,{id:"upload-attendance",modelValue:o.attendance_id,"onUpdate:modelValue":e[5]||(e[5]=a=>o.attendance_id=a),type:"text",placeholder:"Attendance ID"},null,8,["modelValue"])]),t("div",null,[l(S,{for:"upload-file"},{default:i(()=>[...e[21]||(e[21]=[p("Image File *",-1)])]),_:1}),t("input",{ref_key:"fileInput",ref:k,id:"upload-file",type:"file",accept:"image/*",onChange:z,class:"mt-1 block w-full text-sm text-gray-700",required:""},null,544),e[22]||(e[22]=t("p",{class:"mt-1 text-xs text-gray-500"}," Maximum size 5MB. Supported formats: PNG, JPEG, JPG, WEBP. ",-1))])]),l(ee,null,{default:i(()=>[l(h,{variant:"outline",onClick:e[6]||(e[6]=a=>_.value=!1),disabled:b.value},{default:i(()=>[...e[23]||(e[23]=[p(" Cancel ",-1)])]),_:1},8,["disabled"]),l(h,{onClick:L,disabled:b.value||!o.class_id||!o.file},{default:i(()=>[p(u(b.value?"Uploading...":"Upload"),1)]),_:1},8,["disabled"])]),_:1})])]),_:1},8,["open"])]),_:1})],64))}};export{Je as default};
