import{u as V,r as g,o as N,l as U,c as _,a as o,b as n,h as E,w as l,d as e,e as M,f as p,t as r,g as c,k as D,F as I,i as x}from"./app-CGuEmW06.js";import{r as v,h as R,e as y,_ as T}from"./AuthenticatedLayout-CJGuDV3D.js";import{_ as F}from"./AdvancedTable-C74tgwHJ.js";import{_ as f}from"./Card-O4ACqxyG.js";import{_ as h}from"./Badge-xK72gQ5Q.js";import{a as b}from"./api-B9gIEsIZ.js";import{r as S}from"./ArrowDownTrayIcon-CC8afiRz.js";import{r as O}from"./EyeIcon-BaQtjq6r.js";import"./ArrowUpIcon-DLRLa_dE.js";import"./TrashIcon-7rQaTgdF.js";const P={class:"space-y-6 pb-8"},q={class:"flex items-center justify-between"},z={class:"grid grid-cols-1 gap-6 sm:grid-cols-3"},G={class:"flex items-center justify-between"},H={class:"mt-2 text-3xl font-semibold text-gray-900"},J={class:"rounded-lg bg-blue-50 p-3"},K={class:"flex items-center justify-between"},Q={class:"mt-2 text-3xl font-semibold text-gray-900"},W={class:"rounded-lg bg-green-50 p-3"},X={class:"flex items-center justify-between"},Y={class:"mt-2 text-3xl font-semibold text-gray-900"},Z={class:"rounded-lg bg-purple-50 p-3"},ee={class:"flex items-center gap-3"},te={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-orange-500 to-red-600"},se={class:"font-medium text-gray-900"},ae={key:0,class:"text-xs text-gray-500"},oe={class:"text-gray-900"},le={class:"flex items-center justify-end gap-2"},ne=["onClick"],re=["onClick"],ie={key:1,class:"space-y-4"},ye={__name:"Index",setup(de){V();const u=g(!1),i=g([]),k=g(null),w=[{key:"title",label:"Book",sortable:!0},{key:"author",label:"Author",sortable:!0},{key:"level",label:"Level",sortable:!0,align:"center"},{key:"assigned_count",label:"Assigned",sortable:!0,align:"center"},{key:"created_at",label:"Uploaded",sortable:!0,format:"date"}],B=[{key:"level",label:"Level",type:"select",options:[{value:"",label:"All Levels"},{value:"beginner",label:"Beginner"},{value:"intermediate",label:"Intermediate"},{value:"advanced",label:"Advanced"}]}],$=async()=>{u.value=!0;try{const{data:a}=await b.get("/admin/books");i.value=Array.isArray(a.books||a)?(a.books||a).map(s=>({...s,assigned_count:s.assignments?.length||0})):[]}catch(a){console.error("Error fetching books:",a),i.value=[]}finally{u.value=!1}},A=async()=>{try{const{data:a}=await b.get("/dashboard/stats");k.value=a?.stats||{}}catch(a){console.error("Error fetching stats:",a)}},C=a=>{x.visit(`/admin/books/${a.id}`)},j=()=>{x.visit("/admin/books/manage")},L=async a=>{try{const s=await b.get(`/books/${a.id}/download`,{responseType:"blob"}),d=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=d,t.setAttribute("download",a.file_name||`${a.title}.pdf`),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(d)}catch(s){console.error("Error downloading book:",s),alert("Failed to download book")}};return N(()=>{$(),A()}),(a,s)=>{const d=U("Button");return c(),_(I,null,[o(n(E),{title:"Books Management"}),o(T,null,{default:l(()=>[e("div",P,[e("div",q,[s[1]||(s[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Books Management"),e("p",{class:"mt-1 text-sm text-gray-500"}," View and manage curriculum books ")],-1)),o(d,{onClick:j,variant:"primary"},{default:l(()=>[o(n(v),{class:"h-5 w-5 mr-2"}),s[0]||(s[0]=p(" Manage Books ",-1))]),_:1})]),e("div",z,[o(f,{class:"p-6"},{default:l(()=>[e("div",G,[e("div",null,[s[2]||(s[2]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Books",-1)),e("p",H,r(i.value.length),1)]),e("div",J,[o(n(v),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),o(f,{class:"p-6"},{default:l(()=>[e("div",K,[e("div",null,[s[3]||(s[3]=e("p",{class:"text-sm font-medium text-gray-600"},"Assigned Books",-1)),e("p",Q,r(i.value.filter(t=>t.assigned_count>0).length),1),s[4]||(s[4]=e("p",{class:"mt-1 text-xs text-gray-500"},"In use",-1))]),e("div",W,[o(n(R),{class:"h-8 w-8 text-green-600"})])])]),_:1}),o(f,{class:"p-6"},{default:l(()=>[e("div",X,[e("div",null,[s[5]||(s[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Assignments",-1)),e("p",Y,r(i.value.reduce((t,m)=>t+(m.assigned_count||0),0)),1),s[6]||(s[6]=e("p",{class:"mt-1 text-xs text-gray-500"},"Active",-1))]),e("div",Z,[o(n(y),{class:"h-8 w-8 text-purple-600"})])])]),_:1})]),u.value?(c(),_("div",ie,[...s[7]||(s[7]=[e("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(c(),M(F,{key:0,title:"All Books",columns:w,data:i.value,searchable:!0,paginated:!0,exportable:!0,filters:B,"items-per-page":25,"row-key":"id"},{"cell-title":l(({row:t})=>[e("div",ee,[e("div",te,[o(n(v),{class:"h-5 w-5 text-white"})]),e("div",null,[e("div",se,r(t.title||"Untitled"),1),t.isbn?(c(),_("div",ae,"ISBN: "+r(t.isbn),1)):D("",!0)])])]),"cell-author":l(({row:t})=>[e("div",oe,r(t.author||"â€”"),1)]),"cell-level":l(({row:t})=>[o(h,{variant:t.level==="beginner"?"primary":t.level==="intermediate"?"warning":"success"},{default:l(()=>[p(r(t.level||"N/A"),1)]),_:2},1032,["variant"])]),"cell-assigned_count":l(({row:t})=>[o(h,{variant:"secondary"},{default:l(()=>[o(n(y),{class:"h-3 w-3 mr-1 inline"}),p(" "+r(t.assigned_count||0),1)]),_:2},1024)]),"row-actions":l(({row:t})=>[e("div",le,[e("button",{onClick:m=>L(t),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-green-600 transition-colors",title:"Download"},[o(n(S),{class:"h-5 w-5"})],8,ne),e("button",{onClick:m=>C(t),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[o(n(O),{class:"h-5 w-5"})],8,re)])]),_:1},8,["data"]))])]),_:1})],64)}}};export{ye as default};
