import{G as require$$5,r as ref,o as onMounted,H as watch,I as onBeforeUnmount,c as createElementBlock,t as toDisplayString,e as openBlock,m as usePage,p as computed,a as createVNode,u as unref,h as head_default,w as withCtx,b as createBaseVNode,d as createCommentVNode,F as Fragment,f as createTextVNode,q as createBlock,j as renderList,g as router}from"./app-Ct4hsfzr.js";import{a as render,_ as _sfc_main$8}from"./AuthenticatedLayout-D745UfWq.js";import{a as api}from"./api-g2UYsWvT.js";import{_ as _sfc_main$7}from"./Button-oQerMwbE.js";import{_ as _sfc_main$2,a as _sfc_main$3,b as _sfc_main$4,c as _sfc_main$6}from"./DialogFooter-Ch21CAvU.js";import{_ as _sfc_main$5}from"./DialogDescription-C5MfAsnU.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as render$1}from"./ArrowLeftIcon-DdjLQmXZ.js";import{r as render$2}from"./TrashIcon-CjWCZUE2.js";function commonjsRequire(U){throw new Error('Could not dynamically require "'+U+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}},hasRequiredPdf;function requirePdf(){return hasRequiredPdf||(hasRequiredPdf=1,(function(module,exports$1){(function(r,F){module.exports=r.pdfjsLib=F()})(globalThis,()=>(()=>{var __webpack_modules__=[,((U,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.VerbosityLevel=r.Util=r.UnknownErrorException=r.UnexpectedResponseException=r.TextRenderingMode=r.RenderingIntentFlag=r.PromiseCapability=r.PermissionFlag=r.PasswordResponses=r.PasswordException=r.PageActionEventType=r.OPS=r.MissingPDFException=r.MAX_IMAGE_SIZE_TO_CACHE=r.LINE_FACTOR=r.LINE_DESCENT_FACTOR=r.InvalidPDFException=r.ImageKind=r.IDENTITY_MATRIX=r.FormatError=r.FeatureTest=r.FONT_IDENTITY_MATRIX=r.DocumentActionEventType=r.CMapCompressionType=r.BaseException=r.BASELINE_FACTOR=r.AnnotationType=r.AnnotationReplyType=r.AnnotationPrefix=r.AnnotationMode=r.AnnotationFlag=r.AnnotationFieldFlag=r.AnnotationEditorType=r.AnnotationEditorPrefix=r.AnnotationEditorParamsType=r.AnnotationBorderStyleType=r.AnnotationActionEventType=r.AbortException=void 0,r.assert=h,r.bytesToString=O,r.createValidAbsoluteUrl=b,r.getModificationDate=mt,r.getUuid=Nt,r.getVerbosityLevel=nt,r.info=J,r.isArrayBuffer=ut,r.isArrayEqual=At,r.isNodeJS=void 0,r.normalizeUnicode=Dt,r.objectFromMap=q,r.objectSize=it,r.setVerbosityLevel=et,r.shadow=P,r.string32=X,r.stringToBytes=j,r.stringToPDFString=lt,r.stringToUTF8String=ct,r.unreachable=_,r.utf8StringToString=ht,r.warn=M;const F=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");r.isNodeJS=F;const o=[1,0,0,1,0,0];r.IDENTITY_MATRIX=o;const m=[.001,0,0,.001,0,0];r.FONT_IDENTITY_MATRIX=m;const D=1e7;r.MAX_IMAGE_SIZE_TO_CACHE=D;const C=1.35;r.LINE_FACTOR=C;const N=.35;r.LINE_DESCENT_FACTOR=N;const L=N/C;r.BASELINE_FACTOR=L;const i={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};r.RenderingIntentFlag=i;const t={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};r.AnnotationMode=t;const s="pdfjs_internal_editor_";r.AnnotationEditorPrefix=s;const u={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};r.AnnotationEditorType=u;const l={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};r.AnnotationEditorParamsType=l;const e={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};r.PermissionFlag=e;const c={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};r.TextRenderingMode=c;const f={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};r.ImageKind=f;const n={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};r.AnnotationType=n;const y={GROUP:"Group",REPLY:"R"};r.AnnotationReplyType=y;const T={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};r.AnnotationFlag=T;const w={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};r.AnnotationFieldFlag=w;const p={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};r.AnnotationBorderStyleType=p;const v={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};r.AnnotationActionEventType=v;const B={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};r.DocumentActionEventType=B;const H={O:"PageOpen",C:"PageClose"};r.PageActionEventType=H;const I={ERRORS:0,WARNINGS:1,INFOS:5};r.VerbosityLevel=I;const V={NONE:0,BINARY:1};r.CMapCompressionType=V;const z={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};r.OPS=z;const st={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};r.PasswordResponses=st;let Q=I.WARNINGS;function et(tt){Number.isInteger(tt)&&(Q=tt)}function nt(){return Q}function J(tt){Q>=I.INFOS&&console.log(`Info: ${tt}`)}function M(tt){Q>=I.WARNINGS&&console.log(`Warning: ${tt}`)}function _(tt){throw new Error(tt)}function h(tt,G){tt||_(G)}function d(tt){switch(tt?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function b(tt,G=null,W=null){if(!tt)return null;try{if(W&&typeof tt=="string"&&(W.addDefaultProtocol&&tt.startsWith("www.")&&tt.match(/\./g)?.length>=2&&(tt=`http://${tt}`),W.tryConvertEncoding))try{tt=ct(tt)}catch{}const at=G?new URL(tt,G):new URL(tt);if(d(at))return at}catch{}return null}function P(tt,G,W,at=!1){return Object.defineProperty(tt,G,{value:W,enumerable:!at,configurable:!0,writable:!1}),W}const k=(function(){function G(W,at){this.constructor===G&&_("Cannot initialize BaseException."),this.message=W,this.name=at}return G.prototype=new Error,G.constructor=G,G})();r.BaseException=k;class R extends k{constructor(G,W){super(G,"PasswordException"),this.code=W}}r.PasswordException=R;class S extends k{constructor(G,W){super(G,"UnknownErrorException"),this.details=W}}r.UnknownErrorException=S;class a extends k{constructor(G){super(G,"InvalidPDFException")}}r.InvalidPDFException=a;class g extends k{constructor(G){super(G,"MissingPDFException")}}r.MissingPDFException=g;class A extends k{constructor(G,W){super(G,"UnexpectedResponseException"),this.status=W}}r.UnexpectedResponseException=A;class E extends k{constructor(G){super(G,"FormatError")}}r.FormatError=E;class x extends k{constructor(G){super(G,"AbortException")}}r.AbortException=x;function O(tt){(typeof tt!="object"||tt?.length===void 0)&&_("Invalid argument for bytesToString");const G=tt.length,W=8192;if(G<W)return String.fromCharCode.apply(null,tt);const at=[];for(let dt=0;dt<G;dt+=W){const pt=Math.min(dt+W,G),gt=tt.subarray(dt,pt);at.push(String.fromCharCode.apply(null,gt))}return at.join("")}function j(tt){typeof tt!="string"&&_("Invalid argument for stringToBytes");const G=tt.length,W=new Uint8Array(G);for(let at=0;at<G;++at)W[at]=tt.charCodeAt(at)&255;return W}function X(tt){return String.fromCharCode(tt>>24&255,tt>>16&255,tt>>8&255,tt&255)}function it(tt){return Object.keys(tt).length}function q(tt){const G=Object.create(null);for(const[W,at]of tt)G[W]=at;return G}function Y(){const tt=new Uint8Array(4);return tt[0]=1,new Uint32Array(tt.buffer,0,1)[0]===1}function K(){try{return new Function(""),!0}catch{return!1}}class ${static get isLittleEndian(){return P(this,"isLittleEndian",Y())}static get isEvalSupported(){return P(this,"isEvalSupported",K())}static get isOffscreenCanvasSupported(){return P(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?P(this,"platform",{isWin:!1,isMac:!1}):P(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return P(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}r.FeatureTest=$;const Z=[...Array(256).keys()].map(tt=>tt.toString(16).padStart(2,"0"));class rt{static makeHexColor(G,W,at){return`#${Z[G]}${Z[W]}${Z[at]}`}static scaleMinMax(G,W){let at;G[0]?(G[0]<0&&(at=W[0],W[0]=W[1],W[1]=at),W[0]*=G[0],W[1]*=G[0],G[3]<0&&(at=W[2],W[2]=W[3],W[3]=at),W[2]*=G[3],W[3]*=G[3]):(at=W[0],W[0]=W[2],W[2]=at,at=W[1],W[1]=W[3],W[3]=at,G[1]<0&&(at=W[2],W[2]=W[3],W[3]=at),W[2]*=G[1],W[3]*=G[1],G[2]<0&&(at=W[0],W[0]=W[1],W[1]=at),W[0]*=G[2],W[1]*=G[2]),W[0]+=G[4],W[1]+=G[4],W[2]+=G[5],W[3]+=G[5]}static transform(G,W){return[G[0]*W[0]+G[2]*W[1],G[1]*W[0]+G[3]*W[1],G[0]*W[2]+G[2]*W[3],G[1]*W[2]+G[3]*W[3],G[0]*W[4]+G[2]*W[5]+G[4],G[1]*W[4]+G[3]*W[5]+G[5]]}static applyTransform(G,W){const at=G[0]*W[0]+G[1]*W[2]+W[4],dt=G[0]*W[1]+G[1]*W[3]+W[5];return[at,dt]}static applyInverseTransform(G,W){const at=W[0]*W[3]-W[1]*W[2],dt=(G[0]*W[3]-G[1]*W[2]+W[2]*W[5]-W[4]*W[3])/at,pt=(-G[0]*W[1]+G[1]*W[0]+W[4]*W[1]-W[5]*W[0])/at;return[dt,pt]}static getAxialAlignedBoundingBox(G,W){const at=this.applyTransform(G,W),dt=this.applyTransform(G.slice(2,4),W),pt=this.applyTransform([G[0],G[3]],W),gt=this.applyTransform([G[2],G[1]],W);return[Math.min(at[0],dt[0],pt[0],gt[0]),Math.min(at[1],dt[1],pt[1],gt[1]),Math.max(at[0],dt[0],pt[0],gt[0]),Math.max(at[1],dt[1],pt[1],gt[1])]}static inverseTransform(G){const W=G[0]*G[3]-G[1]*G[2];return[G[3]/W,-G[1]/W,-G[2]/W,G[0]/W,(G[2]*G[5]-G[4]*G[3])/W,(G[4]*G[1]-G[5]*G[0])/W]}static singularValueDecompose2dScale(G){const W=[G[0],G[2],G[1],G[3]],at=G[0]*W[0]+G[1]*W[2],dt=G[0]*W[1]+G[1]*W[3],pt=G[2]*W[0]+G[3]*W[2],gt=G[2]*W[1]+G[3]*W[3],Ct=(at+gt)/2,xt=Math.sqrt((at+gt)**2-4*(at*gt-pt*dt))/2,Et=Ct+xt||1,bt=Ct-xt||1;return[Math.sqrt(Et),Math.sqrt(bt)]}static normalizeRect(G){const W=G.slice(0);return G[0]>G[2]&&(W[0]=G[2],W[2]=G[0]),G[1]>G[3]&&(W[1]=G[3],W[3]=G[1]),W}static intersect(G,W){const at=Math.max(Math.min(G[0],G[2]),Math.min(W[0],W[2])),dt=Math.min(Math.max(G[0],G[2]),Math.max(W[0],W[2]));if(at>dt)return null;const pt=Math.max(Math.min(G[1],G[3]),Math.min(W[1],W[3])),gt=Math.min(Math.max(G[1],G[3]),Math.max(W[1],W[3]));return pt>gt?null:[at,pt,dt,gt]}static bezierBoundingBox(G,W,at,dt,pt,gt,Ct,xt){const Et=[],bt=[[],[]];let Tt,St,Ft,ft,Mt,Rt,It,Lt;for(let Ot=0;Ot<2;++Ot){if(Ot===0?(St=6*G-12*at+6*pt,Tt=-3*G+9*at-9*pt+3*Ct,Ft=3*at-3*G):(St=6*W-12*dt+6*gt,Tt=-3*W+9*dt-9*gt+3*xt,Ft=3*dt-3*W),Math.abs(Tt)<1e-12){if(Math.abs(St)<1e-12)continue;ft=-Ft/St,0<ft&&ft<1&&Et.push(ft);continue}It=St*St-4*Ft*Tt,Lt=Math.sqrt(It),!(It<0)&&(Mt=(-St+Lt)/(2*Tt),0<Mt&&Mt<1&&Et.push(Mt),Rt=(-St-Lt)/(2*Tt),0<Rt&&Rt<1&&Et.push(Rt))}let Pt=Et.length,yt;const kt=Pt;for(;Pt--;)ft=Et[Pt],yt=1-ft,bt[0][Pt]=yt*yt*yt*G+3*yt*yt*ft*at+3*yt*ft*ft*pt+ft*ft*ft*Ct,bt[1][Pt]=yt*yt*yt*W+3*yt*yt*ft*dt+3*yt*ft*ft*gt+ft*ft*ft*xt;return bt[0][kt]=G,bt[1][kt]=W,bt[0][kt+1]=Ct,bt[1][kt+1]=xt,bt[0].length=bt[1].length=kt+2,[Math.min(...bt[0]),Math.min(...bt[1]),Math.max(...bt[0]),Math.max(...bt[1])]}}r.Util=rt;const ot=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function lt(tt){if(tt[0]>="ï"){let W;if(tt[0]==="þ"&&tt[1]==="ÿ"?W="utf-16be":tt[0]==="ÿ"&&tt[1]==="þ"?W="utf-16le":tt[0]==="ï"&&tt[1]==="»"&&tt[2]==="¿"&&(W="utf-8"),W)try{const at=new TextDecoder(W,{fatal:!0}),dt=j(tt);return at.decode(dt)}catch(at){M(`stringToPDFString: "${at}".`)}}const G=[];for(let W=0,at=tt.length;W<at;W++){const dt=ot[tt.charCodeAt(W)];G.push(dt?String.fromCharCode(dt):tt.charAt(W))}return G.join("")}function ct(tt){return decodeURIComponent(escape(tt))}function ht(tt){return unescape(encodeURIComponent(tt))}function ut(tt){return typeof tt=="object"&&tt?.byteLength!==void 0}function At(tt,G){if(tt.length!==G.length)return!1;for(let W=0,at=tt.length;W<at;W++)if(tt[W]!==G[W])return!1;return!0}function mt(tt=new Date){return[tt.getUTCFullYear().toString(),(tt.getUTCMonth()+1).toString().padStart(2,"0"),tt.getUTCDate().toString().padStart(2,"0"),tt.getUTCHours().toString().padStart(2,"0"),tt.getUTCMinutes().toString().padStart(2,"0"),tt.getUTCSeconds().toString().padStart(2,"0")].join("")}class wt{#t=!1;constructor(){this.promise=new Promise((G,W)=>{this.resolve=at=>{this.#t=!0,G(at)},this.reject=at=>{this.#t=!0,W(at)}})}get settled(){return this.#t}}r.PromiseCapability=wt;let _t=null,vt=null;function Dt(tt){return _t||(_t=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,vt=new Map([["ﬅ","ſt"]])),tt.replaceAll(_t,(G,W,at)=>W?W.normalize("NFKC"):vt.get(at))}function Nt(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const tt=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(tt);else for(let G=0;G<32;G++)tt[G]=Math.floor(Math.random()*255);return O(tt)}const Bt="pdfjs_internal_id_";r.AnnotationPrefix=Bt}),((__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(U){if(typeof U=="string"||U instanceof URL?U={url:U}:(0,_util.isArrayBuffer)(U)&&(U={data:U}),typeof U!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!U.url&&!U.data&&!U.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const r=new PDFDocumentLoadingTask,{docId:F}=r,o=U.url?getUrlProp(U.url):null,m=U.data?getDataProp(U.data):null,D=U.httpHeaders||null,C=U.withCredentials===!0,N=U.password??null,L=U.range instanceof PDFDataRangeTransport?U.range:null,i=Number.isInteger(U.rangeChunkSize)&&U.rangeChunkSize>0?U.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let t=U.worker instanceof PDFWorker?U.worker:null;const s=U.verbosity,u=typeof U.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(U.docBaseUrl)?U.docBaseUrl:null,l=typeof U.cMapUrl=="string"?U.cMapUrl:null,e=U.cMapPacked!==!1,c=U.CMapReaderFactory||DefaultCMapReaderFactory,f=typeof U.standardFontDataUrl=="string"?U.standardFontDataUrl:null,n=U.StandardFontDataFactory||DefaultStandardFontDataFactory,y=U.stopAtErrors!==!0,T=Number.isInteger(U.maxImageSize)&&U.maxImageSize>-1?U.maxImageSize:-1,w=U.isEvalSupported!==!1,p=typeof U.isOffscreenCanvasSupported=="boolean"?U.isOffscreenCanvasSupported:!_util.isNodeJS,v=Number.isInteger(U.canvasMaxAreaInBytes)?U.canvasMaxAreaInBytes:-1,B=typeof U.disableFontFace=="boolean"?U.disableFontFace:_util.isNodeJS,H=U.fontExtraProperties===!0,I=U.enableXfa===!0,V=U.ownerDocument||globalThis.document,z=U.disableRange===!0,st=U.disableStream===!0,Q=U.disableAutoFetch===!0,et=U.pdfBug===!0,nt=L?L.length:U.length??NaN,J=typeof U.useSystemFonts=="boolean"?U.useSystemFonts:!_util.isNodeJS&&!B,M=typeof U.useWorkerFetch=="boolean"?U.useWorkerFetch:c===_display_utils.DOMCMapReaderFactory&&n===_display_utils.DOMStandardFontDataFactory&&l&&f&&(0,_display_utils.isValidFetchUrl)(l,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(f,document.baseURI),_=U.canvasFactory||new DefaultCanvasFactory({ownerDocument:V}),h=U.filterFactory||new DefaultFilterFactory({docId:F,ownerDocument:V}),d=null;(0,_util.setVerbosityLevel)(s);const b={canvasFactory:_,filterFactory:h};if(M||(b.cMapReaderFactory=new c({baseUrl:l,isCompressed:e}),b.standardFontDataFactory=new n({baseUrl:f})),!t){const R={verbosity:s,port:_worker_options.GlobalWorkerOptions.workerPort};t=R.port?PDFWorker.fromPort(R):new PDFWorker(R),r._worker=t}const P={docId:F,apiVersion:"3.11.174",data:m,password:N,disableAutoFetch:Q,rangeChunkSize:i,length:nt,docBaseUrl:u,enableXfa:I,evaluatorOptions:{maxImageSize:T,disableFontFace:B,ignoreErrors:y,isEvalSupported:w,isOffscreenCanvasSupported:p,canvasMaxAreaInBytes:v,fontExtraProperties:H,useSystemFonts:J,cMapUrl:M?l:null,standardFontDataUrl:M?f:null}},k={ignoreErrors:y,isEvalSupported:w,disableFontFace:B,fontExtraProperties:H,enableXfa:I,ownerDocument:V,disableAutoFetch:Q,pdfBug:et,styleElement:d};return t.promise.then(function(){if(r.destroyed)throw new Error("Loading aborted");const R=_fetchDocument(t,P),S=new Promise(function(a){let g;L?g=new _transport_stream.PDFDataTransportStream({length:nt,initialData:L.initialData,progressiveDone:L.progressiveDone,contentDispositionFilename:L.contentDispositionFilename,disableRange:z,disableStream:st},L):m||(g=(E=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(E):(0,_display_utils.isValidFetchUrl)(E.url)?new _displayFetch_stream.PDFFetchStream(E):new _displayNetwork.PDFNetworkStream(E))({url:o,length:nt,httpHeaders:D,withCredentials:C,rangeChunkSize:i,disableRange:z,disableStream:st})),a(g)});return Promise.all([R,S]).then(function([a,g]){if(r.destroyed)throw new Error("Loading aborted");const A=new _message_handler.MessageHandler(F,a,t.port),E=new WorkerTransport(A,r,g,k,b);r._transport=E,A.send("Ready",null)})}).catch(r._capability.reject),r}async function _fetchDocument(U,r){if(U.destroyed)throw new Error("Worker was destroyed");const F=await U.messageHandler.sendWithPromise("GetDocRequest",r,r.data?[r.data.buffer]:null);if(U.destroyed)throw new Error("Worker was destroyed");return F}function getUrlProp(U){if(U instanceof URL)return U.href;try{return new URL(U,window.location).href}catch{if(_util.isNodeJS&&typeof U=="string")return U}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(U){if(_util.isNodeJS&&typeof Buffer<"u"&&U instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(U instanceof Uint8Array&&U.byteLength===U.buffer.byteLength)return U;if(typeof U=="string")return(0,_util.stringToBytes)(U);if(typeof U=="object"&&!isNaN(U?.length)||(0,_util.isArrayBuffer)(U))return new Uint8Array(U);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#t=0;constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(r){throw this._worker?.port&&delete this._worker._pendingDestroy,r}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(r,F,o=!1,m=null){this.length=r,this.initialData=F,this.progressiveDone=o,this.contentDispositionFilename=m,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(r){this._rangeListeners.push(r)}addProgressListener(r){this._progressListeners.push(r)}addProgressiveReadListener(r){this._progressiveReadListeners.push(r)}addProgressiveDoneListener(r){this._progressiveDoneListeners.push(r)}onDataRange(r,F){for(const o of this._rangeListeners)o(r,F)}onDataProgress(r,F){this._readyCapability.promise.then(()=>{for(const o of this._progressListeners)o(r,F)})}onDataProgressiveRead(r){this._readyCapability.promise.then(()=>{for(const F of this._progressiveReadListeners)F(r)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const r of this._progressiveDoneListeners)r()})}transportReady(){this._readyCapability.resolve()}requestDataRange(r,F){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(r,F){this._pdfInfo=r,this._transport=F,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(o=>{if(!o)return o;const m=[];for(const D in o)m.push(...o[D]);return m}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(r){return this._transport.getPage(r)}getPageIndex(r){return this._transport.getPageIndex(r)}getDestinations(){return this._transport.getDestinations()}getDestination(r){return this._transport.getDestination(r)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(r=!1){return this._transport.startCleanup(r||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{#t=null;#e=!1;constructor(r,F,o,m=!1){this._pageIndex=r,this._pageInfo=F,this._transport=o,this._stats=m?new _display_utils.StatTimer:null,this._pdfBug=m,this.commonObjs=o.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:r,rotation:F=this.rotate,offsetX:o=0,offsetY:m=0,dontFlip:D=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:r,rotation:F,offsetX:o,offsetY:m,dontFlip:D})}getAnnotations({intent:r="display"}={}){const F=this._transport.getRenderingIntent(r);return this._transport.getAnnotations(this._pageIndex,F.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:r,viewport:F,intent:o="display",annotationMode:m=_util.AnnotationMode.ENABLE,transform:D=null,background:C=null,optionalContentConfigPromise:N=null,annotationCanvasMap:L=null,pageColors:i=null,printAnnotationStorage:t=null}){this._stats?.time("Overall");const s=this._transport.getRenderingIntent(o,m,t);this.#e=!1,this.#i(),N||(N=this._transport.getOptionalContentConfig());let u=this._intentStates.get(s.cacheKey);u||(u=Object.create(null),this._intentStates.set(s.cacheKey,u)),u.streamReaderCancelTimeout&&(clearTimeout(u.streamReaderCancelTimeout),u.streamReaderCancelTimeout=null);const l=!!(s.renderingIntent&_util.RenderingIntentFlag.PRINT);u.displayReadyCapability||(u.displayReadyCapability=new _util.PromiseCapability,u.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s));const e=n=>{u.renderTasks.delete(c),(this._maybeCleanupAfterRender||l)&&(this.#e=!0),this.#s(!l),n?(c.capability.reject(n),this._abortOperatorList({intentState:u,reason:n instanceof Error?n:new Error(n)})):c.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},c=new InternalRenderTask({callback:e,params:{canvasContext:r,viewport:F,transform:D,background:C},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:L,operatorList:u.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!l,pdfBug:this._pdfBug,pageColors:i});(u.renderTasks||=new Set).add(c);const f=c.task;return Promise.all([u.displayReadyCapability.promise,N]).then(([n,y])=>{if(this.destroyed){e();return}this._stats?.time("Rendering"),c.initializeGraphics({transparency:n,optionalContentConfig:y}),c.operatorListChanged()}).catch(e),f}getOperatorList({intent:r="display",annotationMode:F=_util.AnnotationMode.ENABLE,printAnnotationStorage:o=null}={}){function m(){C.operatorList.lastChunk&&(C.opListReadCapability.resolve(C.operatorList),C.renderTasks.delete(N))}const D=this._transport.getRenderingIntent(r,F,o,!0);let C=this._intentStates.get(D.cacheKey);C||(C=Object.create(null),this._intentStates.set(D.cacheKey,C));let N;return C.opListReadCapability||(N=Object.create(null),N.operatorListChanged=m,C.opListReadCapability=new _util.PromiseCapability,(C.renderTasks||=new Set).add(N),C.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(D)),C.opListReadCapability.promise}streamTextContent({includeMarkedContent:r=!1,disableNormalization:F=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:r===!0,disableNormalization:F===!0},{highWaterMark:100,size(m){return m.items.length}})}getTextContent(r={}){if(this._transport._htmlForXfa)return this.getXfa().then(o=>_xfa_text.XfaText.textContent(o));const F=this.streamTextContent(r);return new Promise(function(o,m){function D(){C.read().then(function({value:L,done:i}){if(i){o(N);return}Object.assign(N.styles,L.styles),N.items.push(...L.items),D()},m)}const C=F.getReader(),N={items:[],styles:Object.create(null)};D()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const r=[];for(const F of this._intentStates.values())if(this._abortOperatorList({intentState:F,reason:new Error("Page was destroyed."),force:!0}),!F.opListReadCapability)for(const o of F.renderTasks)r.push(o.completed),o.cancel();return this.objs.clear(),this.#e=!1,this.#i(),Promise.all(r)}cleanup(r=!1){this.#e=!0;const F=this.#s(!1);return r&&F&&(this._stats&&=new _display_utils.StatTimer),F}#s(r=!1){if(this.#i(),!this.#e||this.destroyed)return!1;if(r)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},DELAYED_CLEANUP_TIMEOUT),!1;for(const{renderTasks:F,operatorList:o}of this._intentStates.values())if(F.size>0||!o.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#i(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(r,F){const o=this._intentStates.get(F);o&&(this._stats?.timeEnd("Page Request"),o.displayReadyCapability?.resolve(r))}_renderPageChunk(r,F){for(let o=0,m=r.length;o<m;o++)F.operatorList.fnArray.push(r.fnArray[o]),F.operatorList.argsArray.push(r.argsArray[o]);F.operatorList.lastChunk=r.lastChunk,F.operatorList.separateAnnots=r.separateAnnots;for(const o of F.renderTasks)o.operatorListChanged();r.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:r,cacheKey:F,annotationStorageSerializable:o}){const{map:m,transfers:D}=o,N=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:r,cacheKey:F,annotationStorage:m},D).getReader(),L=this._intentStates.get(F);L.streamReader=N;const i=()=>{N.read().then(({value:t,done:s})=>{if(s){L.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(t,L),i())},t=>{if(L.streamReader=null,!this._transport.destroyed){if(L.operatorList){L.operatorList.lastChunk=!0;for(const s of L.renderTasks)s.operatorListChanged();this.#s(!0)}if(L.displayReadyCapability)L.displayReadyCapability.reject(t);else if(L.opListReadCapability)L.opListReadCapability.reject(t);else throw t}})};i()}_abortOperatorList({intentState:r,reason:F,force:o=!1}){if(r.streamReader){if(r.streamReaderCancelTimeout&&(clearTimeout(r.streamReaderCancelTimeout),r.streamReaderCancelTimeout=null),!o){if(r.renderTasks.size>0)return;if(F instanceof _display_utils.RenderingCancelledException){let m=RENDERING_CANCELLED_TIMEOUT;F.extraDelay>0&&F.extraDelay<1e3&&(m+=F.extraDelay),r.streamReaderCancelTimeout=setTimeout(()=>{r.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:r,reason:F,force:!0})},m);return}}if(r.streamReader.cancel(new _util.AbortException(F.message)).catch(()=>{}),r.streamReader=null,!this._transport.destroyed){for(const[m,D]of this._intentStates)if(D===r){this._intentStates.delete(m);break}this.cleanup()}}}get stats(){return this._stats}}exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{#t=new Set;#e=Promise.resolve();postMessage(r,F){const o={data:structuredClone(r,F?{transfer:F}:null)};this.#e.then(()=>{for(const m of this.#t)m.call(this,o)})}addEventListener(r,F){this.#t.add(F)}removeEventListener(r,F){this.#t.delete(F)}terminate(){this.#t.clear()}}exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const U=document?.currentScript?.src;U&&(PDFWorkerUtil.fallbackWorkerSrc=U.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(U,r){let F;try{if(F=new URL(U),!F.origin||F.origin==="null")return!1}catch{return!1}const o=new URL(r,F);return F.origin===o.origin},PDFWorkerUtil.createCDNWrapper=function(U){const r=`importScripts("${U}");`;return URL.createObjectURL(new Blob([r]))}}class PDFWorker{static#workerPorts;constructor({name:U=null,port:r=null,verbosity:F=(0,_util.getVerbosityLevel)()}={}){if(this.name=U,this.destroyed=!1,this.verbosity=F,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,r){if(PDFWorker.#workerPorts?.has(r))throw new Error("Cannot use more than one PDFWorker per port.");(PDFWorker.#workerPorts||=new WeakMap).set(r,this),this._initializeFromPort(r);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(U){this._port=U,this._messageHandler=new _message_handler.MessageHandler("main","worker",U),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:U}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,U)||(U=PDFWorkerUtil.createCDNWrapper(new URL(U,window.location).href));const r=new Worker(U),F=new _message_handler.MessageHandler("main","worker",r),o=()=>{r.removeEventListener("error",m),F.destroy(),r.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},m=()=>{this._webWorker||o()};r.addEventListener("error",m),F.on("test",C=>{if(r.removeEventListener("error",m),this.destroyed){o();return}C?(this._messageHandler=F,this._port=r,this._webWorker=r,this._readyCapability.resolve(),F.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),F.destroy(),r.terminate())}),F.on("ready",C=>{if(r.removeEventListener("error",m),this.destroyed){o();return}try{D()}catch{this._setupFakeWorker()}});const D=()=>{const C=new Uint8Array;F.send("test",C,[C.buffer])};D();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(U=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const r=new LoopbackPort;this._port=r;const F=`fake${PDFWorkerUtil.fakeWorkerId++}`,o=new _message_handler.MessageHandler(F+"_worker",F,r);U.setup(o,r);const m=new _message_handler.MessageHandler(F,F+"_worker",r);this._messageHandler=m,this._readyCapability.resolve(),m.send("configure",{verbosity:this.verbosity})}).catch(U=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${U.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(U){if(!U?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const r=this.#workerPorts?.get(U.port);if(r){if(r._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return r}return new PDFWorker(U)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports$1.PDFWorker=PDFWorker;class WorkerTransport{#t=new Map;#e=new Map;#s=new Map;#i=null;constructor(r,F,o,m,D){this.messageHandler=r,this.loadingTask=F,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:m.ownerDocument,styleElement:m.styleElement}),this._params=m,this.canvasFactory=D.canvasFactory,this.filterFactory=D.filterFactory,this.cMapReaderFactory=D.cMapReaderFactory,this.standardFontDataFactory=D.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=o,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}#o(r,F=null){const o=this.#t.get(r);if(o)return o;const m=this.messageHandler.sendWithPromise(r,F);return this.#t.set(r,m),m}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(r,F=_util.AnnotationMode.ENABLE,o=null,m=!1){let D=_util.RenderingIntentFlag.DISPLAY,C=_annotation_storage.SerializableEmpty;switch(r){case"any":D=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":D=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${r}`)}switch(F){case _util.AnnotationMode.DISABLE:D+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:D+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:D+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,C=(D&_util.RenderingIntentFlag.PRINT&&o instanceof _annotation_storage.PrintAnnotationStorage?o:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${F}`)}return m&&(D+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:D,cacheKey:`${D}_${C.hash}`,annotationStorageSerializable:C}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this.#i?.reject(new Error("Worker was destroyed during onPassword callback"));const r=[];for(const o of this.#e.values())r.push(o._destroy());this.#e.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const F=this.messageHandler.sendWithPromise("Terminate",null);return r.push(F),Promise.all(r).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:r,loadingTask:F}=this;r.on("GetReader",(o,m)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=D=>{this._lastProgress={loaded:D.loaded,total:D.total}},m.onPull=()=>{this._fullReader.read().then(function({value:D,done:C}){if(C){m.close();return}(0,_util.assert)(D instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),m.enqueue(new Uint8Array(D),1,[D])}).catch(D=>{m.error(D)})},m.onCancel=D=>{this._fullReader.cancel(D),m.ready.catch(C=>{if(!this.destroyed)throw C})}}),r.on("ReaderHeadersReady",o=>{const m=new _util.PromiseCapability,D=this._fullReader;return D.headersReady.then(()=>{(!D.isStreamingSupported||!D.isRangeSupported)&&(this._lastProgress&&F.onProgress?.(this._lastProgress),D.onProgress=C=>{F.onProgress?.({loaded:C.loaded,total:C.total})}),m.resolve({isStreamingSupported:D.isStreamingSupported,isRangeSupported:D.isRangeSupported,contentLength:D.contentLength})},m.reject),m.promise}),r.on("GetRangeReader",(o,m)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const D=this._networkStream.getRangeReader(o.begin,o.end);if(!D){m.close();return}m.onPull=()=>{D.read().then(function({value:C,done:N}){if(N){m.close();return}(0,_util.assert)(C instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),m.enqueue(new Uint8Array(C),1,[C])}).catch(C=>{m.error(C)})},m.onCancel=C=>{D.cancel(C),m.ready.catch(N=>{if(!this.destroyed)throw N})}}),r.on("GetDoc",({pdfInfo:o})=>{this._numPages=o.numPages,this._htmlForXfa=o.htmlForXfa,delete o.htmlForXfa,F._capability.resolve(new PDFDocumentProxy(o,this))}),r.on("DocException",function(o){let m;switch(o.name){case"PasswordException":m=new _util.PasswordException(o.message,o.code);break;case"InvalidPDFException":m=new _util.InvalidPDFException(o.message);break;case"MissingPDFException":m=new _util.MissingPDFException(o.message);break;case"UnexpectedResponseException":m=new _util.UnexpectedResponseException(o.message,o.status);break;case"UnknownErrorException":m=new _util.UnknownErrorException(o.message,o.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}F._capability.reject(m)}),r.on("PasswordRequest",o=>{if(this.#i=new _util.PromiseCapability,F.onPassword){const m=D=>{D instanceof Error?this.#i.reject(D):this.#i.resolve({password:D})};try{F.onPassword(m,o.code)}catch(D){this.#i.reject(D)}}else this.#i.reject(new _util.PasswordException(o.message,o.code));return this.#i.promise}),r.on("DataLoaded",o=>{F.onProgress?.({loaded:o.length,total:o.length}),this.downloadInfoCapability.resolve(o)}),r.on("StartRenderPage",o=>{if(this.destroyed)return;this.#e.get(o.pageIndex)._startRenderPage(o.transparency,o.cacheKey)}),r.on("commonobj",([o,m,D])=>{if(!this.destroyed&&!this.commonObjs.has(o))switch(m){case"Font":const C=this._params;if("error"in D){const i=D.error;(0,_util.warn)(`Error during font loading: ${i}`),this.commonObjs.resolve(o,i);break}const N=C.pdfBug&&globalThis.FontInspector?.enabled?(i,t)=>globalThis.FontInspector.fontAdded(i,t):null,L=new _font_loader.FontFaceObject(D,{isEvalSupported:C.isEvalSupported,disableFontFace:C.disableFontFace,ignoreErrors:C.ignoreErrors,inspectFont:N});this.fontLoader.bind(L).catch(i=>r.sendWithPromise("FontFallback",{id:o})).finally(()=>{!C.fontExtraProperties&&L.data&&(L.data=null),this.commonObjs.resolve(o,L)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(o,D);break;default:throw new Error(`Got unknown common object type ${m}`)}}),r.on("obj",([o,m,D,C])=>{if(this.destroyed)return;const N=this.#e.get(m);if(!N.objs.has(o))switch(D){case"Image":if(N.objs.resolve(o,C),C){let L;if(C.bitmap){const{width:i,height:t}=C;L=i*t*4}else L=C.data?.length||0;L>_util.MAX_IMAGE_SIZE_TO_CACHE&&(N._maybeCleanupAfterRender=!0)}break;case"Pattern":N.objs.resolve(o,C);break;default:throw new Error(`Got unknown object type ${D}`)}}),r.on("DocProgress",o=>{this.destroyed||F.onProgress?.({loaded:o.loaded,total:o.total})}),r.on("FetchBuiltInCMap",o=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(o):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),r.on("FetchStandardFontData",o=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(o):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:r,transfers:F}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:r,filename:this._fullReader?.filename??null},F).finally(()=>{this.annotationStorage.resetModified()})}getPage(r){if(!Number.isInteger(r)||r<=0||r>this._numPages)return Promise.reject(new Error("Invalid page request."));const F=r-1,o=this.#s.get(F);if(o)return o;const m=this.messageHandler.sendWithPromise("GetPage",{pageIndex:F}).then(D=>{if(this.destroyed)throw new Error("Transport destroyed");const C=new PDFPageProxy(F,D,this,this._params.pdfBug);return this.#e.set(F,C),C});return this.#s.set(F,m),m}getPageIndex(r){return typeof r!="object"||r===null||!Number.isInteger(r.num)||r.num<0||!Number.isInteger(r.gen)||r.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:r.num,gen:r.gen})}getAnnotations(r,F){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:r,intent:F})}getFieldObjects(){return this.#o("GetFieldObjects")}hasJSActions(){return this.#o("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(r){return typeof r!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:r})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#o("GetDocJSActions")}getPageJSActions(r){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:r})}getStructTree(r){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:r})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(r=>new _optional_content_config.OptionalContentConfig(r))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const r="GetMetadata",F=this.#t.get(r);if(F)return F;const o=this.messageHandler.sendWithPromise(r,null).then(m=>({info:m[0],metadata:m[1]?new _metadata.Metadata(m[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(r,o),o}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(r=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const F of this.#e.values())if(!F.cleanup())throw new Error(`startCleanup: Page ${F.pageNumber} is currently rendering.`);this.commonObjs.clear(),r||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:r,enableXfa:F}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:r,enableXfa:F})}}class PDFObjects{#t=Object.create(null);#e(r){return this.#t[r]||={capability:new _util.PromiseCapability,data:null}}get(r,F=null){if(F){const m=this.#e(r);return m.capability.promise.then(()=>F(m.data)),null}const o=this.#t[r];if(!o?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${r}.`);return o.data}has(r){return this.#t[r]?.capability.settled||!1}resolve(r,F=null){const o=this.#e(r);o.data=F,o.capability.resolve()}clear(){for(const r in this.#t){const{data:F}=this.#t[r];F?.bitmap?.close()}this.#t=Object.create(null)}}class RenderTask{#t=null;constructor(r){this.#t=r,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(r=0){this.#t.cancel(null,r)}get separateAnnots(){const{separateAnnots:r}=this.#t.operatorList;if(!r)return!1;const{annotationCanvasMap:F}=this.#t;return r.form||r.canvas&&F?.size>0}}exports$1.RenderTask=RenderTask;class InternalRenderTask{static#t=new WeakSet;constructor({callback:r,params:F,objs:o,commonObjs:m,annotationCanvasMap:D,operatorList:C,pageIndex:N,canvasFactory:L,filterFactory:i,useRequestAnimationFrame:t=!1,pdfBug:s=!1,pageColors:u=null}){this.callback=r,this.params=F,this.objs=o,this.commonObjs=m,this.annotationCanvasMap=D,this.operatorListIdx=null,this.operatorList=C,this._pageIndex=N,this.canvasFactory=L,this.filterFactory=i,this._pdfBug=s,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=t===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=F.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:r=!1,optionalContentConfig:F}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:o,viewport:m,transform:D,background:C}=this.params;this.gfx=new _canvas.CanvasGraphics(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:F},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:D,viewport:m,transparency:r,background:C}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(r=null,F=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback(r||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,F))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback())))}}const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SerializableEmpty=r.PrintAnnotationStorage=r.AnnotationStorage=void 0;var o=F(1),m=F(4),D=F(8);const C=Object.freeze({map:null,hash:"",transfers:void 0});r.SerializableEmpty=C;class N{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,s){const u=this.#e.get(t);return u===void 0?s:Object.assign(s,u)}getRawValue(t){return this.#e.get(t)}remove(t){if(this.#e.delete(t),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const s of this.#e.values())if(s instanceof m.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(t,s){const u=this.#e.get(t);let l=!1;if(u!==void 0)for(const[e,c]of Object.entries(s))u[e]!==c&&(l=!0,u[e]=c);else l=!0,this.#e.set(t,s);l&&this.#s(),s instanceof m.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(s.constructor._type)}has(t){return this.#e.has(t)}getAll(){return this.#e.size>0?(0,o.objectFromMap)(this.#e):null}setAll(t){for(const[s,u]of Object.entries(t))this.setValue(s,u)}get size(){return this.#e.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new L(this)}get serializable(){if(this.#e.size===0)return C;const t=new Map,s=new D.MurmurHash3_64,u=[],l=Object.create(null);let e=!1;for(const[c,f]of this.#e){const n=f instanceof m.AnnotationEditor?f.serialize(!1,l):f;n&&(t.set(c,n),s.update(`${c}:${JSON.stringify(n)}`),e||=!!n.bitmap)}if(e)for(const c of t.values())c.bitmap&&u.push(c.bitmap);return t.size>0?{map:t,hash:s.hexdigest(),transfers:u}:C}}r.AnnotationStorage=N;class L extends N{#t;constructor(t){super();const{map:s,hash:u,transfers:l}=t.serializable,e=structuredClone(s,l?{transfer:l}:null);this.#t={map:e,hash:u,transfers:l}}get print(){(0,o.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}r.PrintAnnotationStorage=L}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditor=void 0;var o=F(5),m=F(1),D=F(6);class C{#t="";#e=!1;#s=null;#i=null;#o=null;#a=!1;#r=null;#l=this.focusin.bind(this);#c=this.focusout.bind(this);#n=!1;#f=!1;#d=!1;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#u=!1;#p=C._zIndex++;static _borderLineWidth=-1;static _colorManager=new o.ColorManager;static _zIndex=1;static SMALL_EDITOR_SIZE=0;constructor(i){this.constructor===C&&(0,m.unreachable)("Cannot initialize AnnotationEditor."),this.parent=i.parent,this.id=i.id,this.width=this.height=null,this.pageIndex=i.parent.pageIndex,this.name=i.name,this.div=null,this._uiManager=i.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=i.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:u,pageX:l,pageY:e}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,u],this.pageTranslation=[l,e];const[c,f]=this.parentDimensions;this.x=i.x/c,this.y=i.y/f,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,m.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(i){const t=new N({id:i.parent.getNextId(),parent:i.parent,uiManager:i._uiManager});t.annotationElementId=i.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(i,t=null){if(C._l10nPromise||=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(u=>[u,i.get(u)])),t?.strings)for(const u of t.strings)C._l10nPromise.set(u,i.get(u));if(C._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);C._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(i,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(i){return!1}static paste(i,t){(0,m.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#u}set _isDraggable(i){this.#u=i,this.div?.classList.toggle("draggable",i)}center(){const[i,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(i*2),this.y+=this.width*i/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(i*2),this.y-=this.width*i/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(i){this._uiManager.addCommands(i)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#p}setParent(i){i!==null&&(this.pageIndex=i.pageIndex,this.pageDimensions=i.pageDimensions),this.parent=i}focusin(i){this._focusEventsAllowed&&(this.#n?this.#n=!1:this.parent.setSelected(this))}focusout(i){!this._focusEventsAllowed||!this.isAttachedToDOM||i.relatedTarget?.closest(`#${this.id}`)||(i.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(i,t,s,u){const[l,e]=this.parentDimensions;[s,u]=this.screenToPageTranslation(s,u),this.x=(i+s)/l,this.y=(t+u)/e,this.fixAndSetPosition()}#_([i,t],s,u){[s,u]=this.screenToPageTranslation(s,u),this.x+=s/i,this.y+=u/t,this.fixAndSetPosition()}translate(i,t){this.#_(this.parentDimensions,i,t)}translateInPage(i,t){this.#_(this.pageDimensions,i,t),this.div.scrollIntoView({block:"nearest"})}drag(i,t){const[s,u]=this.parentDimensions;if(this.x+=i/s,this.y+=t/u,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:n,y}=this.div.getBoundingClientRect();this.parent.findNewParent(this,n,y)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:l,y:e}=this;const[c,f]=this.#m();l+=c,e+=f,this.div.style.left=`${(100*l).toFixed(2)}%`,this.div.style.top=`${(100*e).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#m(){const[i,t]=this.parentDimensions,{_borderLineWidth:s}=C,u=s/i,l=s/t;switch(this.rotation){case 90:return[-u,l];case 180:return[u,l];case 270:return[u,-l];default:return[-u,-l]}}fixAndSetPosition(){const[i,t]=this.pageDimensions;let{x:s,y:u,width:l,height:e}=this;switch(l*=i,e*=t,s*=i,u*=t,this.rotation){case 0:s=Math.max(0,Math.min(i-l,s)),u=Math.max(0,Math.min(t-e,u));break;case 90:s=Math.max(0,Math.min(i-e,s)),u=Math.min(t,Math.max(l,u));break;case 180:s=Math.min(i,Math.max(l,s)),u=Math.min(t,Math.max(e,u));break;case 270:s=Math.min(i,Math.max(e,s)),u=Math.max(0,Math.min(t-l,u));break}this.x=s/=i,this.y=u/=t;const[c,f]=this.#m();s+=c,u+=f;const{style:n}=this.div;n.left=`${(100*s).toFixed(2)}%`,n.top=`${(100*u).toFixed(2)}%`,this.moveInDOM()}static#g(i,t,s){switch(s){case 90:return[t,-i];case 180:return[-i,-t];case 270:return[-t,i];default:return[i,t]}}screenToPageTranslation(i,t){return C.#g(i,t,this.parentRotation)}pageTranslationToScreen(i,t){return C.#g(i,t,360-this.parentRotation)}#h(i){switch(i){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:i,pageDimensions:[t,s]}=this,u=t*i,l=s*i;return m.FeatureTest.isCSSRoundSupported?[Math.round(u),Math.round(l)]:[u,l]}setDims(i,t){const[s,u]=this.parentDimensions;this.div.style.width=`${(100*i/s).toFixed(2)}%`,this.#a||(this.div.style.height=`${(100*t/u).toFixed(2)}%`),this.#s?.classList.toggle("small",i<C.SMALL_EDITOR_SIZE||t<C.SMALL_EDITOR_SIZE)}fixDims(){const{style:i}=this.div,{height:t,width:s}=i,u=s.endsWith("%"),l=!this.#a&&t.endsWith("%");if(u&&l)return;const[e,c]=this.parentDimensions;u||(i.width=`${(100*parseFloat(s)/e).toFixed(2)}%`),!this.#a&&!l&&(i.height=`${(100*parseFloat(t)/c).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#b(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const i=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||i.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const t of i){const s=document.createElement("div");this.#r.append(s),s.classList.add("resizer",t),s.addEventListener("pointerdown",this.#E.bind(this,t)),s.addEventListener("contextmenu",D.noContextMenu)}this.div.prepend(this.#r)}#E(i,t){t.preventDefault();const{isMac:s}=m.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&s)return;const u=this.#S.bind(this,i),l=this._isDraggable;this._isDraggable=!1;const e={passive:!0,capture:!0};window.addEventListener("pointermove",u,e);const c=this.x,f=this.y,n=this.width,y=this.height,T=this.parent.div.style.cursor,w=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const p=()=>{this._isDraggable=l,window.removeEventListener("pointerup",p),window.removeEventListener("blur",p),window.removeEventListener("pointermove",u,e),this.parent.div.style.cursor=T,this.div.style.cursor=w;const v=this.x,B=this.y,H=this.width,I=this.height;v===c&&B===f&&H===n&&I===y||this.addCommands({cmd:()=>{this.width=H,this.height=I,this.x=v,this.y=B;const[V,z]=this.parentDimensions;this.setDims(V*H,z*I),this.fixAndSetPosition()},undo:()=>{this.width=n,this.height=y,this.x=c,this.y=f;const[V,z]=this.parentDimensions;this.setDims(V*n,z*y),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",p),window.addEventListener("blur",p)}#S(i,t){const[s,u]=this.parentDimensions,l=this.x,e=this.y,c=this.width,f=this.height,n=C.MIN_SIZE/s,y=C.MIN_SIZE/u,T=S=>Math.round(S*1e4)/1e4,w=this.#h(this.rotation),p=(S,a)=>[w[0]*S+w[2]*a,w[1]*S+w[3]*a],v=this.#h(360-this.rotation),B=(S,a)=>[v[0]*S+v[2]*a,v[1]*S+v[3]*a];let H,I,V=!1,z=!1;switch(i){case"topLeft":V=!0,H=(S,a)=>[0,0],I=(S,a)=>[S,a];break;case"topMiddle":H=(S,a)=>[S/2,0],I=(S,a)=>[S/2,a];break;case"topRight":V=!0,H=(S,a)=>[S,0],I=(S,a)=>[0,a];break;case"middleRight":z=!0,H=(S,a)=>[S,a/2],I=(S,a)=>[0,a/2];break;case"bottomRight":V=!0,H=(S,a)=>[S,a],I=(S,a)=>[0,0];break;case"bottomMiddle":H=(S,a)=>[S/2,a],I=(S,a)=>[S/2,0];break;case"bottomLeft":V=!0,H=(S,a)=>[0,a],I=(S,a)=>[S,0];break;case"middleLeft":z=!0,H=(S,a)=>[0,a/2],I=(S,a)=>[S,a/2];break}const st=H(c,f),Q=I(c,f);let et=p(...Q);const nt=T(l+et[0]),J=T(e+et[1]);let M=1,_=1,[h,d]=this.screenToPageTranslation(t.movementX,t.movementY);if([h,d]=B(h/s,d/u),V){const S=Math.hypot(c,f);M=_=Math.max(Math.min(Math.hypot(Q[0]-st[0]-h,Q[1]-st[1]-d)/S,1/c,1/f),n/c,y/f)}else z?M=Math.max(n,Math.min(1,Math.abs(Q[0]-st[0]-h)))/c:_=Math.max(y,Math.min(1,Math.abs(Q[1]-st[1]-d)))/f;const b=T(c*M),P=T(f*_);et=p(...I(b,P));const k=nt-et[0],R=J-et[1];this.width=b,this.height=P,this.x=k,this.y=R,this.setDims(s*b,u*P),this.fixAndSetPosition()}async addAltTextButton(){if(this.#s)return;const i=this.#s=document.createElement("button");i.className="altText";const t=await C._l10nPromise.get("editor_alt_text_button_label");i.textContent=t,i.setAttribute("aria-label",t),i.tabIndex="0",i.addEventListener("contextmenu",D.noContextMenu),i.addEventListener("pointerdown",s=>s.stopPropagation()),i.addEventListener("click",s=>{s.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),i.addEventListener("keydown",s=>{s.target===i&&s.key==="Enter"&&(s.preventDefault(),this._uiManager.editAltText(this))}),this.#x(),this.div.append(i),C.SMALL_EDITOR_SIZE||(C.SMALL_EDITOR_SIZE=Math.min(128,Math.round(i.getBoundingClientRect().width*1.4)))}async#x(){const i=this.#s;if(!i)return;if(!this.#t&&!this.#e){i.classList.remove("done"),this.#i?.remove();return}C._l10nPromise.get("editor_alt_text_edit_button_label").then(s=>{i.setAttribute("aria-label",s)});let t=this.#i;if(!t){this.#i=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");const s=t.id=`alt-text-tooltip-${this.id}`;i.setAttribute("aria-describedby",s);const u=100;i.addEventListener("mouseenter",()=>{this.#o=setTimeout(()=>{this.#o=null,this.#i.classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},u)}),i.addEventListener("mouseleave",()=>{clearTimeout(this.#o),this.#o=null,this.#i?.classList.remove("show")})}i.classList.add("done"),t.innerText=this.#e?await C._l10nPromise.get("editor_alt_text_decorative_tooltip"):this.#t,t.parentNode||i.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:this.#t,decorative:this.#e}}set altTextData({altText:i,decorative:t}){this.#t===i&&this.#e===t||(this.#t=i,this.#e=t,this.#x())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#l),this.div.addEventListener("focusout",this.#c);const[i,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/i).toFixed(2)}%`,this.div.style.maxHeight=`${(100*i/t).toFixed(2)}%`);const[s,u]=this.getInitialTranslation();return this.translate(s,u),(0,o.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(i){const{isMac:t}=m.FeatureTest.platform;if(i.button!==0||i.ctrlKey&&t){i.preventDefault();return}this.#n=!0,this.#P(i)}#P(i){if(!this._isDraggable)return;const t=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let s,u;t&&(s={passive:!0,capture:!0},u=e=>{const[c,f]=this.screenToPageTranslation(e.movementX,e.movementY);this._uiManager.dragSelectedEditors(c,f)},window.addEventListener("pointermove",u,s));const l=()=>{if(window.removeEventListener("pointerup",l),window.removeEventListener("blur",l),t&&window.removeEventListener("pointermove",u,s),this.#n=!1,!this._uiManager.endDragSession()){const{isMac:e}=m.FeatureTest.platform;i.ctrlKey&&!e||i.shiftKey||i.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",l),window.addEventListener("blur",l)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(i,t,s){i.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition()}getRect(i,t){const s=this.parentScale,[u,l]=this.pageDimensions,[e,c]=this.pageTranslation,f=i/s,n=t/s,y=this.x*u,T=this.y*l,w=this.width*u,p=this.height*l;switch(this.rotation){case 0:return[y+f+e,l-T-n-p+c,y+f+w+e,l-T-n+c];case 90:return[y+n+e,l-T+f+c,y+n+p+e,l-T+f+w+c];case 180:return[y-f-w+e,l-T+n+c,y-f+e,l-T+n+p+c];case 270:return[y-n-p+e,l-T-f-w+c,y-n+e,l-T-f+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(i,t){const[s,u,l,e]=i,c=l-s,f=e-u;switch(this.rotation){case 0:return[s,t-e,c,f];case 90:return[s,t-u,f,c];case 180:return[l,t-u,c,f];case 270:return[l,t-e,f,c];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#d=!0}disableEditMode(){this.#d=!1}isInEditMode(){return this.#d}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#l),this.div?.addEventListener("focusout",this.#c)}serialize(i=!1,t=null){(0,m.unreachable)("An editor must be serializable")}static deserialize(i,t,s){const u=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});u.rotation=i.rotation;const[l,e]=u.pageDimensions,[c,f,n,y]=u.getRectInCurrentCoords(i.rect,e);return u.x=c/l,u.y=f/e,u.width=n/l,u.height=y/e,u}remove(){this.div.removeEventListener("focusin",this.#l),this.div.removeEventListener("focusout",this.#c),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#s?.remove(),this.#s=null,this.#i=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#b(),this.#r.classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(i,t){}disableEditing(){this.#s&&(this.#s.hidden=!0)}enableEditing(){this.#s&&(this.#s.hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return this.#f}set isEditing(i){this.#f=i,this.parent&&(i?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(i,t){this.#a=!0;const s=i/t,{style:u}=this.div;u.aspectRatio=s,u.height="auto"}static get MIN_SIZE(){return 16}}r.AnnotationEditor=C;class N extends C{constructor(i){super(i),this.annotationElementId=i.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.KeyboardManager=r.CommandManager=r.ColorManager=r.AnnotationEditorUIManager=void 0,r.bindEvents=D,r.opacityToHex=C;var o=F(1),m=F(6);function D(l,e,c){for(const f of c)e.addEventListener(f,l[f].bind(l))}function C(l){return Math.round(Math.min(255,Math.max(1,255*l))).toString(16).padStart(2,"0")}class N{#t=0;getId(){return`${o.AnnotationEditorPrefix}${this.#t++}`}}class L{#t=(0,o.getUuid)();#e=0;#s=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',f=new OffscreenCanvas(1,3).getContext("2d"),n=new Image;n.src=e;const y=n.decode().then(()=>(f.drawImage(n,0,0,1,1,0,0,1,3),new Uint32Array(f.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,o.shadow)(this,"_isSVGFittingCanvas",y)}async#i(e,c){this.#s||=new Map;let f=this.#s.get(e);if(f===null)return null;if(f?.bitmap)return f.refCounter+=1,f;try{f||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let n;if(typeof c=="string"){f.url=c;const y=await fetch(c);if(!y.ok)throw new Error(y.statusText);n=await y.blob()}else n=f.file=c;if(n.type==="image/svg+xml"){const y=L._isSVGFittingCanvas,T=new FileReader,w=new Image,p=new Promise((v,B)=>{w.onload=()=>{f.bitmap=w,f.isSvg=!0,v()},T.onload=async()=>{const H=f.svgUrl=T.result;w.src=await y?`${H}#svgView(preserveAspectRatio(none))`:H},w.onerror=T.onerror=B});T.readAsDataURL(n),await p}else f.bitmap=await createImageBitmap(n);f.refCounter=1}catch(n){console.error(n),f=null}return this.#s.set(e,f),f&&this.#s.set(f.id,f),f}async getFromFile(e){const{lastModified:c,name:f,size:n,type:y}=e;return this.#i(`${c}_${f}_${n}_${y}`,e)}async getFromUrl(e){return this.#i(e,e)}async getFromId(e){this.#s||=new Map;const c=this.#s.get(e);return c?c.bitmap?(c.refCounter+=1,c):c.file?this.getFromFile(c.file):this.getFromUrl(c.url):null}getSvgUrl(e){const c=this.#s.get(e);return c?.isSvg?c.svgUrl:null}deleteId(e){this.#s||=new Map;const c=this.#s.get(e);c&&(c.refCounter-=1,c.refCounter===0&&(c.bitmap=null))}isValidId(e){return e.startsWith(`image_${this.#t}_`)}}class i{#t=[];#e=!1;#s;#i=-1;constructor(e=128){this.#s=e}add({cmd:e,undo:c,mustExec:f,type:n=NaN,overwriteIfSameType:y=!1,keepUndo:T=!1}){if(f&&e(),this.#e)return;const w={cmd:e,undo:c,type:n};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(w);return}if(y&&this.#t[this.#i].type===n){T&&(w.undo=this.#t[this.#i].undo),this.#t[this.#i]=w;return}const p=this.#i+1;p===this.#s?this.#t.splice(0,1):(this.#i=p,p<this.#t.length&&this.#t.splice(p)),this.#t.push(w)}undo(){this.#i!==-1&&(this.#e=!0,this.#t[this.#i].undo(),this.#e=!1,this.#i-=1)}redo(){this.#i<this.#t.length-1&&(this.#i+=1,this.#e=!0,this.#t[this.#i].cmd(),this.#e=!1)}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}destroy(){this.#t=null}}r.CommandManager=i;class t{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:c}=o.FeatureTest.platform;for(const[f,n,y={}]of e)for(const T of f){const w=T.startsWith("mac+");c&&w?(this.callbacks.set(T.slice(4),{callback:n,options:y}),this.allKeys.add(T.split("+").at(-1))):!c&&!w&&(this.callbacks.set(T,{callback:n,options:y}),this.allKeys.add(T.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const c=this.buffer.join("+");return this.buffer.length=0,c}exec(e,c){if(!this.allKeys.has(c.key))return;const f=this.callbacks.get(this.#t(c));if(!f)return;const{callback:n,options:{bubbles:y=!1,args:T=[],checker:w=null}}=f;w&&!w(e,c)||(n.bind(e,...T)(),y||(c.stopPropagation(),c.preventDefault()))}}r.KeyboardManager=t;class s{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,m.getColorValues)(e),(0,o.shadow)(this,"_colors",e)}convert(e){const c=(0,m.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return c;for(const[f,n]of this._colors)if(n.every((y,T)=>y===c[T]))return s._colorsMapping.get(f);return c}getHexCode(e){const c=this._colors.get(e);return c?o.Util.makeHexColor(...c):e}}r.ColorManager=s;class u{#t=null;#e=new Map;#s=new Map;#i=null;#o=null;#a=new i;#r=0;#l=new Set;#c=null;#n=null;#f=new Set;#d=null;#u=new N;#p=!1;#_=!1;#m=null;#g=o.AnnotationEditorType.NONE;#h=new Set;#b=null;#E=this.blur.bind(this);#S=this.focus.bind(this);#x=this.copy.bind(this);#P=this.cut.bind(this);#I=this.paste.bind(this);#L=this.keydown.bind(this);#O=this.onEditingAction.bind(this);#A=this.onPageChanging.bind(this);#D=this.onScaleChanging.bind(this);#k=this.onRotationChanging.bind(this);#F={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#y=[0,0];#T=null;#w=null;#N=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=u.prototype,c=y=>{const{activeElement:T}=document;return T&&y.#w.contains(T)&&y.hasSomethingToControl()},f=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return(0,o.shadow)(this,"_keyboardManager",new t([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-f,0],checker:c}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:c}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[f,0],checker:c}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:c}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-f],checker:c}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:c}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,f],checker:c}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:c}]]))}constructor(e,c,f,n,y,T){this.#w=e,this.#N=c,this.#i=f,this._eventBus=n,this._eventBus._on("editingaction",this.#O),this._eventBus._on("pagechanging",this.#A),this._eventBus._on("scalechanging",this.#D),this._eventBus._on("rotationchanging",this.#k),this.#o=y.annotationStorage,this.#d=y.filterFactory,this.#b=T,this.viewParameters={realScale:m.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#M(),this.#U(),this._eventBus._off("editingaction",this.#O),this._eventBus._off("pagechanging",this.#A),this._eventBus._off("scalechanging",this.#D),this._eventBus._off("rotationchanging",this.#k);for(const e of this.#s.values())e.destroy();this.#s.clear(),this.#e.clear(),this.#f.clear(),this.#t=null,this.#h.clear(),this.#a.destroy(),this.#i.destroy()}get hcmFilter(){return(0,o.shadow)(this,"hcmFilter",this.#b?this.#d.addHCMFilter(this.#b.foreground,this.#b.background):"none")}get direction(){return(0,o.shadow)(this,"direction",getComputedStyle(this.#w).direction)}editAltText(e){this.#i?.editAltText(this,e)}onPageChanging({pageNumber:e}){this.#r=e-1}focusMainContainer(){this.#w.focus()}findParent(e,c){for(const f of this.#s.values()){const{x:n,y,width:T,height:w}=f.div.getBoundingClientRect();if(e>=n&&e<=n+T&&c>=y&&c<=y+w)return f}return null}disableUserSelect(e=!1){this.#N.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#f.add(e)}removeShouldRescale(e){this.#f.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*m.PixelsPerInch.PDF_TO_CSS_UNITS;for(const c of this.#f)c.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&this.#o&&!this.#o.has(e.id)&&this.#o.setValue(e.id,e)}#B(){window.addEventListener("focus",this.#S),window.addEventListener("blur",this.#E)}#U(){window.removeEventListener("focus",this.#S),window.removeEventListener("blur",this.#E)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const c of this.#h)if(c.div.contains(e)){this.#m=[c,e],c._focusEventsAllowed=!1;break}}focus(){if(!this.#m)return;const[e,c]=this.#m;this.#m=null,c.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),c.focus()}#j(){window.addEventListener("keydown",this.#L,{capture:!0})}#M(){window.removeEventListener("keydown",this.#L,{capture:!0})}#R(){document.addEventListener("copy",this.#x),document.addEventListener("cut",this.#P),document.addEventListener("paste",this.#I)}#C(){document.removeEventListener("copy",this.#x),document.removeEventListener("cut",this.#P),document.removeEventListener("paste",this.#I)}addEditListeners(){this.#j(),this.#R()}removeEditListeners(){this.#M(),this.#C()}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const c=[];for(const f of this.#h){const n=f.serialize(!0);n&&c.push(n)}c.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(c))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:c}=e;for(const y of c.items)for(const T of this.#n)if(T.isHandlingMimeForPasting(y.type)){T.paste(y,this.currentLayer);return}let f=c.getData("application/pdfjs");if(!f)return;try{f=JSON.parse(f)}catch(y){(0,o.warn)(`paste: "${y.message}".`);return}if(!Array.isArray(f))return;this.unselectAll();const n=this.currentLayer;try{const y=[];for(const p of f){const v=n.deserialize(p);if(!v)return;y.push(v)}const T=()=>{for(const p of y)this.#V(p);this.#G(y)},w=()=>{for(const p of y)p.remove()};this.addCommands({cmd:T,undo:w,mustExec:!0})}catch(y){(0,o.warn)(`paste: "${y.message}".`)}}keydown(e){this.getActive()?.shouldGetKeyboardEvents()||u._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}#v(e){Object.entries(e).some(([f,n])=>this.#F[f]!==n)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#F,e)})}#H(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#B(),this.#j(),this.#R(),this.#v({isEditing:this.#g!==o.AnnotationEditorType.NONE,isEmpty:this.#W(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#U(),this.#M(),this.#C(),this.#v({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#n){this.#n=e;for(const c of this.#n)this.#H(c.defaultPropertiesToUpdate)}}getId(){return this.#u.getId()}get currentLayer(){return this.#s.get(this.#r)}getLayer(e){return this.#s.get(e)}get currentPageIndex(){return this.#r}addLayer(e){this.#s.set(e.pageIndex,e),this.#p?e.enable():e.disable()}removeLayer(e){this.#s.delete(e.pageIndex)}updateMode(e,c=null){if(this.#g!==e){if(this.#g=e,e===o.AnnotationEditorType.NONE){this.setEditingState(!1),this.#X();return}this.setEditingState(!0),this.#z(),this.unselectAll();for(const f of this.#s.values())f.updateMode(e);if(c){for(const f of this.#e.values())if(f.annotationElementId===c){this.setSelected(f),f.enterInEditMode();break}}}}updateToolbar(e){e!==this.#g&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,c){if(this.#n){if(e===o.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const f of this.#h)f.updateParams(e,c);for(const f of this.#n)f.updateDefaultParams(e,c)}}enableWaiting(e=!1){if(this.#_!==e){this.#_=e;for(const c of this.#s.values())e?c.disableClick():c.enableClick(),c.div.classList.toggle("waiting",e)}}#z(){if(!this.#p){this.#p=!0;for(const e of this.#s.values())e.enable()}}#X(){if(this.unselectAll(),this.#p){this.#p=!1;for(const e of this.#s.values())e.disable()}}getEditors(e){const c=[];for(const f of this.#e.values())f.pageIndex===e&&c.push(f);return c}getEditor(e){return this.#e.get(e)}addEditor(e){this.#e.set(e.id,e)}removeEditor(e){this.#e.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#l.has(e.annotationElementId))&&this.#o?.remove(e.id)}addDeletedAnnotationElement(e){this.#l.add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return this.#l.has(e)}removeDeletedAnnotationElement(e){this.#l.delete(e.annotationElementId),e.deleted=!1}#V(e){const c=this.#s.get(e.pageIndex);c?c.addOrRebuild(e):this.addEditor(e)}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#H(e.propertiesToUpdate))}toggleSelected(e){if(this.#h.has(e)){this.#h.delete(e),e.unselect(),this.#v({hasSelectedEditor:this.hasSelection});return}this.#h.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}setSelected(e){for(const c of this.#h)c!==e&&c.unselect();this.#h.clear(),this.#h.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}isSelected(e){return this.#h.has(e)}unselect(e){e.unselect(),this.#h.delete(e),this.#v({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#h.size!==0}undo(){this.#a.undo(),this.#v({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#W()})}redo(){this.#a.redo(),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#W()})}addCommands(e){this.#a.add(e),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#W()})}#W(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const e of this.#e.values())return e.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...this.#h],c=()=>{for(const n of e)n.remove()},f=()=>{for(const n of e)this.#V(n)};this.addCommands({cmd:c,undo:f,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#G(e){this.#h.clear();for(const c of e)c.isEmpty()||(this.#h.add(c),c.select());this.#v({hasSelectedEditor:!0})}selectAll(){for(const e of this.#h)e.commit();this.#G(this.#e.values())}unselectAll(){if(this.#t){this.#t.commitOrRemove();return}if(this.hasSelection){for(const e of this.#h)e.unselect();this.#h.clear(),this.#v({hasSelectedEditor:!1})}}translateSelectedEditors(e,c,f=!1){if(f||this.commitOrRemove(),!this.hasSelection)return;this.#y[0]+=e,this.#y[1]+=c;const[n,y]=this.#y,T=[...this.#h],w=1e3;this.#T&&clearTimeout(this.#T),this.#T=setTimeout(()=>{this.#T=null,this.#y[0]=this.#y[1]=0,this.addCommands({cmd:()=>{for(const p of T)this.#e.has(p.id)&&p.translateInPage(n,y)},undo:()=>{for(const p of T)this.#e.has(p.id)&&p.translateInPage(-n,-y)},mustExec:!1})},w);for(const p of T)p.translateInPage(e,c)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#c=new Map;for(const e of this.#h)this.#c.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#c)return!1;this.disableUserSelect(!1);const e=this.#c;this.#c=null;let c=!1;for(const[{x:n,y,pageIndex:T},w]of e)w.newX=n,w.newY=y,w.newPageIndex=T,c||=n!==w.savedX||y!==w.savedY||T!==w.savedPageIndex;if(!c)return!1;const f=(n,y,T,w)=>{if(this.#e.has(n.id)){const p=this.#s.get(w);p?n._setParentAndPosition(p,y,T):(n.pageIndex=w,n.x=y,n.y=T)}};return this.addCommands({cmd:()=>{for(const[n,{newX:y,newY:T,newPageIndex:w}]of e)f(n,y,T,w)},undo:()=>{for(const[n,{savedX:y,savedY:T,savedPageIndex:w}]of e)f(n,y,T,w)},mustExec:!0}),!0}dragSelectedEditors(e,c){if(this.#c)for(const f of this.#c.keys())f.drag(e,c)}rebuild(e){if(e.parent===null){const c=this.getLayer(e.pageIndex);c?(c.changeParent(e),c.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#g}get imageManager(){return(0,o.shadow)(this,"imageManager",new L)}}r.AnnotationEditorUIManager=u}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.StatTimer=r.RenderingCancelledException=r.PixelsPerInch=r.PageViewport=r.PDFDateString=r.DOMStandardFontDataFactory=r.DOMSVGFactory=r.DOMFilterFactory=r.DOMCanvasFactory=r.DOMCMapReaderFactory=void 0,r.deprecated=B,r.getColorValues=st,r.getCurrentTransform=Q,r.getCurrentTransformInverse=et,r.getFilenameFromUrl=n,r.getPdfFilenameFromUrl=y,r.getRGB=z,r.getXfaPageViewport=V,r.isDataScheme=c,r.isPdfFile=f,r.isValidFetchUrl=w,r.loadScript=v,r.noContextMenu=p,r.setLayerDimensions=nt;var o=F(7),m=F(1);const D="http://www.w3.org/2000/svg";class C{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}r.PixelsPerInch=C;class N extends o.BaseFilterFactory{#t;#e;#s;#i;#o;#a;#r;#l;#c;#n;#f=0;constructor({docId:M,ownerDocument:_=globalThis.document}={}){super(),this.#s=M,this.#i=_}get#d(){return this.#t||=new Map}get#u(){if(!this.#e){const M=this.#i.createElement("div"),{style:_}=M;_.visibility="hidden",_.contain="strict",_.width=_.height=0,_.position="absolute",_.top=_.left=0,_.zIndex=-1;const h=this.#i.createElementNS(D,"svg");h.setAttribute("width",0),h.setAttribute("height",0),this.#e=this.#i.createElementNS(D,"defs"),M.append(h),h.append(this.#e),this.#i.body.append(M)}return this.#e}addFilter(M){if(!M)return"none";let _=this.#d.get(M);if(_)return _;let h,d,b,P;if(M.length===1){const a=M[0],g=new Array(256);for(let A=0;A<256;A++)g[A]=a[A]/255;P=h=d=b=g.join(",")}else{const[a,g,A]=M,E=new Array(256),x=new Array(256),O=new Array(256);for(let j=0;j<256;j++)E[j]=a[j]/255,x[j]=g[j]/255,O[j]=A[j]/255;h=E.join(","),d=x.join(","),b=O.join(","),P=`${h}${d}${b}`}if(_=this.#d.get(P),_)return this.#d.set(M,_),_;const k=`g_${this.#s}_transfer_map_${this.#f++}`,R=`url(#${k})`;this.#d.set(M,R),this.#d.set(P,R);const S=this.#_(k);return this.#g(h,d,b,S),R}addHCMFilter(M,_){const h=`${M}-${_}`;if(this.#a===h)return this.#r;if(this.#a=h,this.#r="none",this.#o?.remove(),!M||!_)return this.#r;const d=this.#h(M);M=m.Util.makeHexColor(...d);const b=this.#h(_);if(_=m.Util.makeHexColor(...b),this.#u.style.color="",M==="#000000"&&_==="#ffffff"||M===_)return this.#r;const P=new Array(256);for(let g=0;g<=255;g++){const A=g/255;P[g]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const k=P.join(","),R=`g_${this.#s}_hcm_filter`,S=this.#l=this.#_(R);this.#g(k,k,k,S),this.#p(S);const a=(g,A)=>{const E=d[g]/255,x=b[g]/255,O=new Array(A+1);for(let j=0;j<=A;j++)O[j]=E+j/A*(x-E);return O.join(",")};return this.#g(a(0,5),a(1,5),a(2,5),S),this.#r=`url(#${R})`,this.#r}addHighlightHCMFilter(M,_,h,d){const b=`${M}-${_}-${h}-${d}`;if(this.#c===b)return this.#n;if(this.#c=b,this.#n="none",this.#l?.remove(),!M||!_)return this.#n;const[P,k]=[M,_].map(this.#h.bind(this));let R=Math.round(.2126*P[0]+.7152*P[1]+.0722*P[2]),S=Math.round(.2126*k[0]+.7152*k[1]+.0722*k[2]),[a,g]=[h,d].map(this.#h.bind(this));S<R&&([R,S,a,g]=[S,R,g,a]),this.#u.style.color="";const A=(O,j,X)=>{const it=new Array(256),q=(S-R)/X,Y=O/255,K=(j-O)/(255*X);let $=0;for(let Z=0;Z<=X;Z++){const rt=Math.round(R+Z*q),ot=Y+Z*K;for(let lt=$;lt<=rt;lt++)it[lt]=ot;$=rt+1}for(let Z=$;Z<256;Z++)it[Z]=it[$-1];return it.join(",")},E=`g_${this.#s}_hcm_highlight_filter`,x=this.#l=this.#_(E);return this.#p(x),this.#g(A(a[0],g[0],5),A(a[1],g[1],5),A(a[2],g[2],5),x),this.#n=`url(#${E})`,this.#n}destroy(M=!1){M&&(this.#r||this.#n)||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#f=0)}#p(M){const _=this.#i.createElementNS(D,"feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),M.append(_)}#_(M){const _=this.#i.createElementNS(D,"filter");return _.setAttribute("color-interpolation-filters","sRGB"),_.setAttribute("id",M),this.#u.append(_),_}#m(M,_,h){const d=this.#i.createElementNS(D,_);d.setAttribute("type","discrete"),d.setAttribute("tableValues",h),M.append(d)}#g(M,_,h,d){const b=this.#i.createElementNS(D,"feComponentTransfer");d.append(b),this.#m(b,"feFuncR",M),this.#m(b,"feFuncG",_),this.#m(b,"feFuncB",h)}#h(M){return this.#u.style.color=M,z(getComputedStyle(this.#u).getPropertyValue("color"))}}r.DOMFilterFactory=N;class L extends o.BaseCanvasFactory{constructor({ownerDocument:M=globalThis.document}={}){super(),this._document=M}_createCanvas(M,_){const h=this._document.createElement("canvas");return h.width=M,h.height=_,h}}r.DOMCanvasFactory=L;async function i(J,M=!1){if(w(J,document.baseURI)){const _=await fetch(J);if(!_.ok)throw new Error(_.statusText);return M?new Uint8Array(await _.arrayBuffer()):(0,m.stringToBytes)(await _.text())}return new Promise((_,h)=>{const d=new XMLHttpRequest;d.open("GET",J,!0),M&&(d.responseType="arraybuffer"),d.onreadystatechange=()=>{if(d.readyState===XMLHttpRequest.DONE){if(d.status===200||d.status===0){let b;if(M&&d.response?b=new Uint8Array(d.response):!M&&d.responseText&&(b=(0,m.stringToBytes)(d.responseText)),b){_(b);return}}h(new Error(d.statusText))}},d.send(null)})}class t extends o.BaseCMapReaderFactory{_fetchData(M,_){return i(M,this.isCompressed).then(h=>({cMapData:h,compressionType:_}))}}r.DOMCMapReaderFactory=t;class s extends o.BaseStandardFontDataFactory{_fetchData(M){return i(M,!0)}}r.DOMStandardFontDataFactory=s;class u extends o.BaseSVGFactory{_createSVG(M){return document.createElementNS(D,M)}}r.DOMSVGFactory=u;class l{constructor({viewBox:M,scale:_,rotation:h,offsetX:d=0,offsetY:b=0,dontFlip:P=!1}){this.viewBox=M,this.scale=_,this.rotation=h,this.offsetX=d,this.offsetY=b;const k=(M[2]+M[0])/2,R=(M[3]+M[1])/2;let S,a,g,A;switch(h%=360,h<0&&(h+=360),h){case 180:S=-1,a=0,g=0,A=1;break;case 90:S=0,a=1,g=1,A=0;break;case 270:S=0,a=-1,g=-1,A=0;break;case 0:S=1,a=0,g=0,A=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}P&&(g=-g,A=-A);let E,x,O,j;S===0?(E=Math.abs(R-M[1])*_+d,x=Math.abs(k-M[0])*_+b,O=(M[3]-M[1])*_,j=(M[2]-M[0])*_):(E=Math.abs(k-M[0])*_+d,x=Math.abs(R-M[1])*_+b,O=(M[2]-M[0])*_,j=(M[3]-M[1])*_),this.transform=[S*_,a*_,g*_,A*_,E-S*_*k-g*_*R,x-a*_*k-A*_*R],this.width=O,this.height=j}get rawDims(){const{viewBox:M}=this;return(0,m.shadow)(this,"rawDims",{pageWidth:M[2]-M[0],pageHeight:M[3]-M[1],pageX:M[0],pageY:M[1]})}clone({scale:M=this.scale,rotation:_=this.rotation,offsetX:h=this.offsetX,offsetY:d=this.offsetY,dontFlip:b=!1}={}){return new l({viewBox:this.viewBox.slice(),scale:M,rotation:_,offsetX:h,offsetY:d,dontFlip:b})}convertToViewportPoint(M,_){return m.Util.applyTransform([M,_],this.transform)}convertToViewportRectangle(M){const _=m.Util.applyTransform([M[0],M[1]],this.transform),h=m.Util.applyTransform([M[2],M[3]],this.transform);return[_[0],_[1],h[0],h[1]]}convertToPdfPoint(M,_){return m.Util.applyInverseTransform([M,_],this.transform)}}r.PageViewport=l;class e extends m.BaseException{constructor(M,_=0){super(M,"RenderingCancelledException"),this.extraDelay=_}}r.RenderingCancelledException=e;function c(J){const M=J.length;let _=0;for(;_<M&&J[_].trim()==="";)_++;return J.substring(_,_+5).toLowerCase()==="data:"}function f(J){return typeof J=="string"&&/\.pdf$/i.test(J)}function n(J,M=!1){return M||([J]=J.split(/[#?]/,1)),J.substring(J.lastIndexOf("/")+1)}function y(J,M="document.pdf"){if(typeof J!="string")return M;if(c(J))return(0,m.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),M;const _=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,h=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,d=_.exec(J);let b=h.exec(d[1])||h.exec(d[2])||h.exec(d[3]);if(b&&(b=b[0],b.includes("%")))try{b=h.exec(decodeURIComponent(b))[0]}catch{}return b||M}class T{started=Object.create(null);times=[];time(M){M in this.started&&(0,m.warn)(`Timer is already running for ${M}`),this.started[M]=Date.now()}timeEnd(M){M in this.started||(0,m.warn)(`Timer has not been started for ${M}`),this.times.push({name:M,start:this.started[M],end:Date.now()}),delete this.started[M]}toString(){const M=[];let _=0;for(const{name:h}of this.times)_=Math.max(h.length,_);for(const{name:h,start:d,end:b}of this.times)M.push(`${h.padEnd(_)} ${b-d}ms
`);return M.join("")}}r.StatTimer=T;function w(J,M){try{const{protocol:_}=M?new URL(J,M):new URL(J);return _==="http:"||_==="https:"}catch{return!1}}function p(J){J.preventDefault()}function v(J,M=!1){return new Promise((_,h)=>{const d=document.createElement("script");d.src=J,d.onload=function(b){M&&d.remove(),_(b)},d.onerror=function(){h(new Error(`Cannot load script at: ${d.src}`))},(document.head||document.documentElement).append(d)})}function B(J){console.log("Deprecated API usage: "+J)}let H;class I{static toDateObject(M){if(!M||typeof M!="string")return null;H||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const _=H.exec(M);if(!_)return null;const h=parseInt(_[1],10);let d=parseInt(_[2],10);d=d>=1&&d<=12?d-1:0;let b=parseInt(_[3],10);b=b>=1&&b<=31?b:1;let P=parseInt(_[4],10);P=P>=0&&P<=23?P:0;let k=parseInt(_[5],10);k=k>=0&&k<=59?k:0;let R=parseInt(_[6],10);R=R>=0&&R<=59?R:0;const S=_[7]||"Z";let a=parseInt(_[8],10);a=a>=0&&a<=23?a:0;let g=parseInt(_[9],10)||0;return g=g>=0&&g<=59?g:0,S==="-"?(P+=a,k+=g):S==="+"&&(P-=a,k-=g),new Date(Date.UTC(h,d,b,P,k,R))}}r.PDFDateString=I;function V(J,{scale:M=1,rotation:_=0}){const{width:h,height:d}=J.attributes.style,b=[0,0,parseInt(h),parseInt(d)];return new l({viewBox:b,scale:M,rotation:_})}function z(J){if(J.startsWith("#")){const M=parseInt(J.slice(1),16);return[(M&16711680)>>16,(M&65280)>>8,M&255]}return J.startsWith("rgb(")?J.slice(4,-1).split(",").map(M=>parseInt(M)):J.startsWith("rgba(")?J.slice(5,-1).split(",").map(M=>parseInt(M)).slice(0,3):((0,m.warn)(`Not a valid color format: "${J}"`),[0,0,0])}function st(J){const M=document.createElement("span");M.style.visibility="hidden",document.body.append(M);for(const _ of J.keys()){M.style.color=_;const h=window.getComputedStyle(M).color;J.set(_,z(h))}M.remove()}function Q(J){const{a:M,b:_,c:h,d,e:b,f:P}=J.getTransform();return[M,_,h,d,b,P]}function et(J){const{a:M,b:_,c:h,d,e:b,f:P}=J.getTransform().invertSelf();return[M,_,h,d,b,P]}function nt(J,M,_=!1,h=!0){if(M instanceof l){const{pageWidth:d,pageHeight:b}=M.rawDims,{style:P}=J,k=m.FeatureTest.isCSSRoundSupported,R=`var(--scale-factor) * ${d}px`,S=`var(--scale-factor) * ${b}px`,a=k?`round(${R}, 1px)`:`calc(${R})`,g=k?`round(${S}, 1px)`:`calc(${S})`;!_||M.rotation%180===0?(P.width=a,P.height=g):(P.width=g,P.height=a)}h&&J.setAttribute("data-main-rotation",M.rotation)}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BaseStandardFontDataFactory=r.BaseSVGFactory=r.BaseFilterFactory=r.BaseCanvasFactory=r.BaseCMapReaderFactory=void 0;var o=F(1);class m{constructor(){this.constructor===m&&(0,o.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,s){return"none"}addHighlightHCMFilter(t,s,u,l){return"none"}destroy(t=!1){}}r.BaseFilterFactory=m;class D{constructor(){this.constructor===D&&(0,o.unreachable)("Cannot initialize BaseCanvasFactory.")}create(t,s){if(t<=0||s<=0)throw new Error("Invalid canvas size");const u=this._createCanvas(t,s);return{canvas:u,context:u.getContext("2d")}}reset(t,s,u){if(!t.canvas)throw new Error("Canvas is not specified");if(s<=0||u<=0)throw new Error("Invalid canvas size");t.canvas.width=s,t.canvas.height=u}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,s){(0,o.unreachable)("Abstract method `_createCanvas` called.")}}r.BaseCanvasFactory=D;class C{constructor({baseUrl:t=null,isCompressed:s=!0}){this.constructor===C&&(0,o.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=s}async fetch({name:t}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const s=this.baseUrl+t+(this.isCompressed?".bcmap":""),u=this.isCompressed?o.CMapCompressionType.BINARY:o.CMapCompressionType.NONE;return this._fetchData(s,u).catch(l=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${s}`)})}_fetchData(t,s){(0,o.unreachable)("Abstract method `_fetchData` called.")}}r.BaseCMapReaderFactory=C;class N{constructor({baseUrl:t=null}){this.constructor===N&&(0,o.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const s=`${this.baseUrl}${t}`;return this._fetchData(s).catch(u=>{throw new Error(`Unable to load font data at: ${s}`)})}_fetchData(t){(0,o.unreachable)("Abstract method `_fetchData` called.")}}r.BaseStandardFontDataFactory=N;class L{constructor(){this.constructor===L&&(0,o.unreachable)("Cannot initialize BaseSVGFactory.")}create(t,s,u=!1){if(t<=0||s<=0)throw new Error("Invalid SVG dimensions");const l=this._createSVG("svg:svg");return l.setAttribute("version","1.1"),u||(l.setAttribute("width",`${t}px`),l.setAttribute("height",`${s}px`)),l.setAttribute("preserveAspectRatio","none"),l.setAttribute("viewBox",`0 0 ${t} ${s}`),l}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){(0,o.unreachable)("Abstract method `_createSVG` called.")}}r.BaseSVGFactory=L}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.MurmurHash3_64=void 0;var o=F(1);const m=3285377520,D=4294901760,C=65535;class N{constructor(i){this.h1=i?i&4294967295:m,this.h2=i?i&4294967295:m}update(i){let t,s;if(typeof i=="string"){t=new Uint8Array(i.length*2),s=0;for(let B=0,H=i.length;B<H;B++){const I=i.charCodeAt(B);I<=255?t[s++]=I:(t[s++]=I>>>8,t[s++]=I&255)}}else if((0,o.isArrayBuffer)(i))t=i.slice(),s=t.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const u=s>>2,l=s-u*4,e=new Uint32Array(t.buffer,0,u);let c=0,f=0,n=this.h1,y=this.h2;const T=3432918353,w=461845907,p=T&C,v=w&C;for(let B=0;B<u;B++)B&1?(c=e[B],c=c*T&D|c*p&C,c=c<<15|c>>>17,c=c*w&D|c*v&C,n^=c,n=n<<13|n>>>19,n=n*5+3864292196):(f=e[B],f=f*T&D|f*p&C,f=f<<15|f>>>17,f=f*w&D|f*v&C,y^=f,y=y<<13|y>>>19,y=y*5+3864292196);switch(c=0,l){case 3:c^=t[u*4+2]<<16;case 2:c^=t[u*4+1]<<8;case 1:c^=t[u*4],c=c*T&D|c*p&C,c=c<<15|c>>>17,c=c*w&D|c*v&C,u&1?n^=c:y^=c}this.h1=n,this.h2=y}hexdigest(){let i=this.h1,t=this.h2;return i^=t>>>1,i=i*3981806797&D|i*36045&C,t=t*4283543511&D|((t<<16|i>>>16)*2950163797&D)>>>16,i^=t>>>1,i=i*444984403&D|i*60499&C,t=t*3301882366&D|((t<<16|i>>>16)*3120437893&D)>>>16,i^=t>>>1,(i>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}r.MurmurHash3_64=N}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FontLoader=r.FontFaceObject=void 0;var o=F(1);class m{#t=new Set;constructor({ownerDocument:N=globalThis.document,styleElement:L=null}){this._document=N,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(N){this.nativeFontFaces.add(N),this._document.fonts.add(N)}removeNativeFontFace(N){this.nativeFontFaces.delete(N),this._document.fonts.delete(N)}insertRule(N){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const L=this.styleElement.sheet;L.insertRule(N,L.cssRules.length)}clear(){for(const N of this.nativeFontFaces)this._document.fonts.delete(N);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(N){if(!(!N||this.#t.has(N.loadedName))){if((0,o.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:L,src:i,style:t}=N,s=new FontFace(L,i,t);this.addNativeFontFace(s);try{await s.load(),this.#t.add(L)}catch{(0,o.warn)(`Cannot load system font: ${N.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(s)}return}(0,o.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(N){if(N.attached||N.missingFile&&!N.systemFontInfo)return;if(N.attached=!0,N.systemFontInfo){await this.loadSystemFont(N.systemFontInfo);return}if(this.isFontLoadingAPISupported){const i=N.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(t){throw(0,o.warn)(`Failed to load font '${i.family}': '${t}'.`),N.disableFontFace=!0,t}}return}const L=N.createFontFaceRule();if(L){if(this.insertRule(L),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const t=this._queueLoadingCallback(i);this._prepareFontLoadEvent(N,t)})}}get isFontLoadingAPISupported(){const N=!!this._document?.fonts;return(0,o.shadow)(this,"isFontLoadingAPISupported",N)}get isSyncFontLoadingSupported(){let N=!1;return(o.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(N=!0),(0,o.shadow)(this,"isSyncFontLoadingSupported",N)}_queueLoadingCallback(N){function L(){for((0,o.assert)(!t.done,"completeRequest() cannot be called twice."),t.done=!0;i.length>0&&i[0].done;){const s=i.shift();setTimeout(s.callback,0)}}const{loadingRequests:i}=this,t={done:!1,complete:L,callback:N};return i.push(t),t}get _loadTestFont(){const N=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,o.shadow)(this,"_loadTestFont",N)}_prepareFontLoadEvent(N,L){function i(V,z){return V.charCodeAt(z)<<24|V.charCodeAt(z+1)<<16|V.charCodeAt(z+2)<<8|V.charCodeAt(z+3)&255}function t(V,z,st,Q){const et=V.substring(0,z),nt=V.substring(z+st);return et+Q+nt}let s,u;const l=this._document.createElement("canvas");l.width=1,l.height=1;const e=l.getContext("2d");let c=0;function f(V,z){if(++c>30){(0,o.warn)("Load test font never loaded."),z();return}if(e.font="30px "+V,e.fillText(".",0,20),e.getImageData(0,0,1,1).data[3]>0){z();return}setTimeout(f.bind(null,V,z))}const n=`lt${Date.now()}${this.loadTestFontId++}`;let y=this._loadTestFont;y=t(y,976,n.length,n);const w=16,p=1482184792;let v=i(y,w);for(s=0,u=n.length-3;s<u;s+=4)v=v-p+i(n,s)|0;s<n.length&&(v=v-p+i(n+"XXX",s)|0),y=t(y,w,4,(0,o.string32)(v));const B=`url(data:font/opentype;base64,${btoa(y)});`,H=`@font-face {font-family:"${n}";src:${B}}`;this.insertRule(H);const I=this._document.createElement("div");I.style.visibility="hidden",I.style.width=I.style.height="10px",I.style.position="absolute",I.style.top=I.style.left="0px";for(const V of[N.loadedName,n]){const z=this._document.createElement("span");z.textContent="Hi",z.style.fontFamily=V,I.append(z)}this._document.body.append(I),f(n,()=>{I.remove(),L.complete()})}}r.FontLoader=m;class D{constructor(N,{isEvalSupported:L=!0,disableFontFace:i=!1,ignoreErrors:t=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const u in N)this[u]=N[u];this.isEvalSupported=L!==!1,this.disableFontFace=i===!0,this.ignoreErrors=t===!0,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let N;if(!this.cssFontInfo)N=new FontFace(this.loadedName,this.data,{});else{const L={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(L.style=`oblique ${this.cssFontInfo.italicAngle}deg`),N=new FontFace(this.cssFontInfo.fontFamily,this.data,L)}return this._inspectFont?.(this),N}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const N=(0,o.bytesToString)(this.data),L=`url(data:${this.mimetype};base64,${btoa(N)});`;let i;if(!this.cssFontInfo)i=`@font-face {font-family:"${this.loadedName}";src:${L}}`;else{let t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),i=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${t}src:${L}}`}return this._inspectFont?.(this,L),i}getPathGenerator(N,L){if(this.compiledGlyphs[L]!==void 0)return this.compiledGlyphs[L];let i;try{i=N.get(this.loadedName+"_path_"+L)}catch(t){if(!this.ignoreErrors)throw t;return(0,o.warn)(`getPathGenerator - ignoring character: "${t}".`),this.compiledGlyphs[L]=function(s,u){}}if(this.isEvalSupported&&o.FeatureTest.isEvalSupported){const t=[];for(const s of i){const u=s.args!==void 0?s.args.join(","):"";t.push("c.",s.cmd,"(",u,`);
`)}return this.compiledGlyphs[L]=new Function("c","size",t.join(""))}return this.compiledGlyphs[L]=function(t,s){for(const u of i)u.cmd==="scale"&&(u.args=[s,-s]),t[u.cmd].apply(t,u.args)}}}r.FontFaceObject=D}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NodeStandardFontDataFactory=r.NodeFilterFactory=r.NodeCanvasFactory=r.NodeCMapReaderFactory=void 0;var o=F(7);F(1);const m=function(i){return new Promise((t,s)=>{require$$5.readFile(i,(l,e)=>{if(l||!e){s(new Error(l));return}t(new Uint8Array(e))})})};class D extends o.BaseFilterFactory{}r.NodeFilterFactory=D;class C extends o.BaseCanvasFactory{_createCanvas(t,s){return require$$5.createCanvas(t,s)}}r.NodeCanvasFactory=C;class N extends o.BaseCMapReaderFactory{_fetchData(t,s){return m(t).then(u=>({cMapData:u,compressionType:s}))}}r.NodeCMapReaderFactory=N;class L extends o.BaseStandardFontDataFactory{_fetchData(t){return m(t)}}r.NodeStandardFontDataFactory=L}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CanvasGraphics=void 0;var o=F(1),m=F(6),D=F(12),C=F(13);const N=16,L=100,i=4096,t=15,s=10,u=1e3,l=16;function e(_,h){if(_._removeMirroring)throw new Error("Context is already forwarding operations.");_.__originalSave=_.save,_.__originalRestore=_.restore,_.__originalRotate=_.rotate,_.__originalScale=_.scale,_.__originalTranslate=_.translate,_.__originalTransform=_.transform,_.__originalSetTransform=_.setTransform,_.__originalResetTransform=_.resetTransform,_.__originalClip=_.clip,_.__originalMoveTo=_.moveTo,_.__originalLineTo=_.lineTo,_.__originalBezierCurveTo=_.bezierCurveTo,_.__originalRect=_.rect,_.__originalClosePath=_.closePath,_.__originalBeginPath=_.beginPath,_._removeMirroring=()=>{_.save=_.__originalSave,_.restore=_.__originalRestore,_.rotate=_.__originalRotate,_.scale=_.__originalScale,_.translate=_.__originalTranslate,_.transform=_.__originalTransform,_.setTransform=_.__originalSetTransform,_.resetTransform=_.__originalResetTransform,_.clip=_.__originalClip,_.moveTo=_.__originalMoveTo,_.lineTo=_.__originalLineTo,_.bezierCurveTo=_.__originalBezierCurveTo,_.rect=_.__originalRect,_.closePath=_.__originalClosePath,_.beginPath=_.__originalBeginPath,delete _._removeMirroring},_.save=function(){h.save(),this.__originalSave()},_.restore=function(){h.restore(),this.__originalRestore()},_.translate=function(b,P){h.translate(b,P),this.__originalTranslate(b,P)},_.scale=function(b,P){h.scale(b,P),this.__originalScale(b,P)},_.transform=function(b,P,k,R,S,a){h.transform(b,P,k,R,S,a),this.__originalTransform(b,P,k,R,S,a)},_.setTransform=function(b,P,k,R,S,a){h.setTransform(b,P,k,R,S,a),this.__originalSetTransform(b,P,k,R,S,a)},_.resetTransform=function(){h.resetTransform(),this.__originalResetTransform()},_.rotate=function(b){h.rotate(b),this.__originalRotate(b)},_.clip=function(b){h.clip(b),this.__originalClip(b)},_.moveTo=function(d,b){h.moveTo(d,b),this.__originalMoveTo(d,b)},_.lineTo=function(d,b){h.lineTo(d,b),this.__originalLineTo(d,b)},_.bezierCurveTo=function(d,b,P,k,R,S){h.bezierCurveTo(d,b,P,k,R,S),this.__originalBezierCurveTo(d,b,P,k,R,S)},_.rect=function(d,b,P,k){h.rect(d,b,P,k),this.__originalRect(d,b,P,k)},_.closePath=function(){h.closePath(),this.__originalClosePath()},_.beginPath=function(){h.beginPath(),this.__originalBeginPath()}}class c{constructor(h){this.canvasFactory=h,this.cache=Object.create(null)}getCanvas(h,d,b){let P;return this.cache[h]!==void 0?(P=this.cache[h],this.canvasFactory.reset(P,d,b)):(P=this.canvasFactory.create(d,b),this.cache[h]=P),P}delete(h){delete this.cache[h]}clear(){for(const h in this.cache){const d=this.cache[h];this.canvasFactory.destroy(d),delete this.cache[h]}}}function f(_,h,d,b,P,k,R,S,a,g){const[A,E,x,O,j,X]=(0,m.getCurrentTransform)(_);if(E===0&&x===0){const Y=R*A+j,K=Math.round(Y),$=S*O+X,Z=Math.round($),rt=(R+a)*A+j,ot=Math.abs(Math.round(rt)-K)||1,lt=(S+g)*O+X,ct=Math.abs(Math.round(lt)-Z)||1;return _.setTransform(Math.sign(A),0,0,Math.sign(O),K,Z),_.drawImage(h,d,b,P,k,0,0,ot,ct),_.setTransform(A,E,x,O,j,X),[ot,ct]}if(A===0&&O===0){const Y=S*x+j,K=Math.round(Y),$=R*E+X,Z=Math.round($),rt=(S+g)*x+j,ot=Math.abs(Math.round(rt)-K)||1,lt=(R+a)*E+X,ct=Math.abs(Math.round(lt)-Z)||1;return _.setTransform(0,Math.sign(E),Math.sign(x),0,K,Z),_.drawImage(h,d,b,P,k,0,0,ct,ot),_.setTransform(A,E,x,O,j,X),[ct,ot]}_.drawImage(h,d,b,P,k,R,S,a,g);const it=Math.hypot(A,E),q=Math.hypot(x,O);return[it*a,q*g]}function n(_){const{width:h,height:d}=_;if(h>u||d>u)return null;const b=1e3,P=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),k=h+1;let R=new Uint8Array(k*(d+1)),S,a,g;const A=h+7&-8;let E=new Uint8Array(A*d),x=0;for(const q of _.data){let Y=128;for(;Y>0;)E[x++]=q&Y?0:255,Y>>=1}let O=0;for(x=0,E[x]!==0&&(R[0]=1,++O),a=1;a<h;a++)E[x]!==E[x+1]&&(R[a]=E[x]?2:1,++O),x++;for(E[x]!==0&&(R[a]=2,++O),S=1;S<d;S++){x=S*A,g=S*k,E[x-A]!==E[x]&&(R[g]=E[x]?1:8,++O);let q=(E[x]?4:0)+(E[x-A]?8:0);for(a=1;a<h;a++)q=(q>>2)+(E[x+1]?4:0)+(E[x-A+1]?8:0),P[q]&&(R[g+a]=P[q],++O),x++;if(E[x-A]!==E[x]&&(R[g+a]=E[x]?2:4,++O),O>b)return null}for(x=A*(d-1),g=S*k,E[x]!==0&&(R[g]=8,++O),a=1;a<h;a++)E[x]!==E[x+1]&&(R[g+a]=E[x]?4:8,++O),x++;if(E[x]!==0&&(R[g+a]=4,++O),O>b)return null;const j=new Int32Array([0,k,-1,0,-k,0,0,0,1]),X=new Path2D;for(S=0;O&&S<=d;S++){let q=S*k;const Y=q+h;for(;q<Y&&!R[q];)q++;if(q===Y)continue;X.moveTo(q%k,S);const K=q;let $=R[q];do{const Z=j[$];do q+=Z;while(!R[q]);const rt=R[q];rt!==5&&rt!==10?($=rt,R[q]=0):($=rt&51*$>>4,R[q]&=$>>2|$<<2),X.lineTo(q%k,q/k|0),R[q]||--O}while(K!==q);--S}return E=null,R=null,function(q){q.save(),q.scale(1/h,-1/d),q.translate(0,-d),q.fill(X),q.beginPath(),q.restore()}}class y{constructor(h,d){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=o.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=o.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=o.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,h,d])}clone(){const h=Object.create(this);return h.clipBox=this.clipBox.slice(),h}setCurrentPoint(h,d){this.x=h,this.y=d}updatePathMinMax(h,d,b){[d,b]=o.Util.applyTransform([d,b],h),this.minX=Math.min(this.minX,d),this.minY=Math.min(this.minY,b),this.maxX=Math.max(this.maxX,d),this.maxY=Math.max(this.maxY,b)}updateRectMinMax(h,d){const b=o.Util.applyTransform(d,h),P=o.Util.applyTransform(d.slice(2),h);this.minX=Math.min(this.minX,b[0],P[0]),this.minY=Math.min(this.minY,b[1],P[1]),this.maxX=Math.max(this.maxX,b[0],P[0]),this.maxY=Math.max(this.maxY,b[1],P[1])}updateScalingPathMinMax(h,d){o.Util.scaleMinMax(h,d),this.minX=Math.min(this.minX,d[0]),this.maxX=Math.max(this.maxX,d[1]),this.minY=Math.min(this.minY,d[2]),this.maxY=Math.max(this.maxY,d[3])}updateCurvePathMinMax(h,d,b,P,k,R,S,a,g,A){const E=o.Util.bezierBoundingBox(d,b,P,k,R,S,a,g);if(A){A[0]=Math.min(A[0],E[0],E[2]),A[1]=Math.max(A[1],E[0],E[2]),A[2]=Math.min(A[2],E[1],E[3]),A[3]=Math.max(A[3],E[1],E[3]);return}this.updateRectMinMax(h,E)}getPathBoundingBox(h=D.PathType.FILL,d=null){const b=[this.minX,this.minY,this.maxX,this.maxY];if(h===D.PathType.STROKE){d||(0,o.unreachable)("Stroke bounding box must include transform.");const P=o.Util.singularValueDecompose2dScale(d),k=P[0]*this.lineWidth/2,R=P[1]*this.lineWidth/2;b[0]-=k,b[1]-=R,b[2]+=k,b[3]+=R}return b}updateClipFromPath(){const h=o.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(h||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(h){this.clipBox=h,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(h=D.PathType.FILL,d=null){return o.Util.intersect(this.clipBox,this.getPathBoundingBox(h,d))}}function T(_,h){if(typeof ImageData<"u"&&h instanceof ImageData){_.putImageData(h,0,0);return}const d=h.height,b=h.width,P=d%l,k=(d-P)/l,R=P===0?k:k+1,S=_.createImageData(b,l);let a=0,g;const A=h.data,E=S.data;let x,O,j,X;if(h.kind===o.ImageKind.GRAYSCALE_1BPP){const it=A.byteLength,q=new Uint32Array(E.buffer,0,E.byteLength>>2),Y=q.length,K=b+7>>3,$=4294967295,Z=o.FeatureTest.isLittleEndian?4278190080:255;for(x=0;x<R;x++){for(j=x<k?l:P,g=0,O=0;O<j;O++){const rt=it-a;let ot=0;const lt=rt>K?b:rt*8-7,ct=lt&-8;let ht=0,ut=0;for(;ot<ct;ot+=8)ut=A[a++],q[g++]=ut&128?$:Z,q[g++]=ut&64?$:Z,q[g++]=ut&32?$:Z,q[g++]=ut&16?$:Z,q[g++]=ut&8?$:Z,q[g++]=ut&4?$:Z,q[g++]=ut&2?$:Z,q[g++]=ut&1?$:Z;for(;ot<lt;ot++)ht===0&&(ut=A[a++],ht=128),q[g++]=ut&ht?$:Z,ht>>=1}for(;g<Y;)q[g++]=0;_.putImageData(S,0,x*l)}}else if(h.kind===o.ImageKind.RGBA_32BPP){for(O=0,X=b*l*4,x=0;x<k;x++)E.set(A.subarray(a,a+X)),a+=X,_.putImageData(S,0,O),O+=l;x<R&&(X=b*P*4,E.set(A.subarray(a,a+X)),_.putImageData(S,0,O))}else if(h.kind===o.ImageKind.RGB_24BPP)for(j=l,X=b*j,x=0;x<R;x++){for(x>=k&&(j=P,X=b*j),g=0,O=X;O--;)E[g++]=A[a++],E[g++]=A[a++],E[g++]=A[a++],E[g++]=255;_.putImageData(S,0,x*l)}else throw new Error(`bad image kind: ${h.kind}`)}function w(_,h){if(h.bitmap){_.drawImage(h.bitmap,0,0);return}const d=h.height,b=h.width,P=d%l,k=(d-P)/l,R=P===0?k:k+1,S=_.createImageData(b,l);let a=0;const g=h.data,A=S.data;for(let E=0;E<R;E++){const x=E<k?l:P;({srcPos:a}=(0,C.convertBlackAndWhiteToRGBA)({src:g,srcPos:a,dest:A,width:b,height:x,nonBlackColor:0})),_.putImageData(S,0,E*l)}}function p(_,h){const d=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const b of d)_[b]!==void 0&&(h[b]=_[b]);_.setLineDash!==void 0&&(h.setLineDash(_.getLineDash()),h.lineDashOffset=_.lineDashOffset)}function v(_){if(_.strokeStyle=_.fillStyle="#000000",_.fillRule="nonzero",_.globalAlpha=1,_.lineWidth=1,_.lineCap="butt",_.lineJoin="miter",_.miterLimit=10,_.globalCompositeOperation="source-over",_.font="10px sans-serif",_.setLineDash!==void 0&&(_.setLineDash([]),_.lineDashOffset=0),!o.isNodeJS){const{filter:h}=_;h!=="none"&&h!==""&&(_.filter="none")}}function B(_,h,d,b){const P=_.length;for(let k=3;k<P;k+=4){const R=_[k];if(R===0)_[k-3]=h,_[k-2]=d,_[k-1]=b;else if(R<255){const S=255-R;_[k-3]=_[k-3]*R+h*S>>8,_[k-2]=_[k-2]*R+d*S>>8,_[k-1]=_[k-1]*R+b*S>>8}}}function H(_,h,d){const b=_.length,P=1/255;for(let k=3;k<b;k+=4){const R=d?d[_[k]]:_[k];h[k]=h[k]*R*P|0}}function I(_,h,d){const b=_.length;for(let P=3;P<b;P+=4){const k=_[P-3]*77+_[P-2]*152+_[P-1]*28;h[P]=d?h[P]*d[k>>8]>>8:h[P]*k>>16}}function V(_,h,d,b,P,k,R,S,a,g,A){const E=!!k,x=E?k[0]:0,O=E?k[1]:0,j=E?k[2]:0,X=P==="Luminosity"?I:H,q=Math.min(b,Math.ceil(1048576/d));for(let Y=0;Y<b;Y+=q){const K=Math.min(q,b-Y),$=_.getImageData(S-g,Y+(a-A),d,K),Z=h.getImageData(S,Y+a,d,K);E&&B($.data,x,O,j),X($.data,Z.data,R),h.putImageData(Z,S,Y+a)}}function z(_,h,d,b){const P=b[0],k=b[1],R=b[2]-P,S=b[3]-k;R===0||S===0||(V(h.context,d,R,S,h.subtype,h.backdrop,h.transferMap,P,k,h.offsetX,h.offsetY),_.save(),_.globalAlpha=1,_.globalCompositeOperation="source-over",_.setTransform(1,0,0,1,0,0),_.drawImage(d.canvas,0,0),_.restore())}function st(_,h){const d=o.Util.singularValueDecompose2dScale(_);d[0]=Math.fround(d[0]),d[1]=Math.fround(d[1]);const b=Math.fround((globalThis.devicePixelRatio||1)*m.PixelsPerInch.PDF_TO_CSS_UNITS);return h!==void 0?h:d[0]<=b||d[1]<=b}const Q=["butt","round","square"],et=["miter","round","bevel"],nt={},J={};class M{constructor(h,d,b,P,k,{optionalContentConfig:R,markedContentStack:S=null},a,g){this.ctx=h,this.current=new y(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=d,this.objs=b,this.canvasFactory=P,this.filterFactory=k,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=S||[],this.optionalContentConfig=R,this.cachedCanvases=new c(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=g,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(h,d=null){return typeof h=="string"?h.startsWith("g_")?this.commonObjs.get(h):this.objs.get(h):d}beginDrawing({transform:h,viewport:d,transparency:b=!1,background:P=null}){const k=this.ctx.canvas.width,R=this.ctx.canvas.height,S=this.ctx.fillStyle;if(this.ctx.fillStyle=P||"#ffffff",this.ctx.fillRect(0,0,k,R),this.ctx.fillStyle=S,b){const a=this.cachedCanvases.getCanvas("transparent",k,R);this.compositeCtx=this.ctx,this.transparentCanvas=a.canvas,this.ctx=a.context,this.ctx.save(),this.ctx.transform(...(0,m.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),v(this.ctx),h&&(this.ctx.transform(...h),this.outputScaleX=h[0],this.outputScaleY=h[0]),this.ctx.transform(...d.transform),this.viewportScale=d.scale,this.baseTransform=(0,m.getCurrentTransform)(this.ctx)}executeOperatorList(h,d,b,P){const k=h.argsArray,R=h.fnArray;let S=d||0;const a=k.length;if(a===S)return S;const g=a-S>s&&typeof b=="function",A=g?Date.now()+t:0;let E=0;const x=this.commonObjs,O=this.objs;let j;for(;;){if(P!==void 0&&S===P.nextBreakPoint)return P.breakIt(S,b),S;if(j=R[S],j!==o.OPS.dependency)this[j].apply(this,k[S]);else for(const X of k[S]){const it=X.startsWith("g_")?x:O;if(!it.has(X))return it.get(X,b),S}if(S++,S===a)return S;if(g&&++E>s){if(Date.now()>A)return b(),S;E=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const h of this._cachedBitmapsMap.values()){for(const d of h.values())typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement&&(d.width=d.height=0);h.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const h=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(h!=="none"){const d=this.ctx.filter;this.ctx.filter=h,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=d}}}_scaleImage(h,d){const b=h.width,P=h.height;let k=Math.max(Math.hypot(d[0],d[1]),1),R=Math.max(Math.hypot(d[2],d[3]),1),S=b,a=P,g="prescale1",A,E;for(;k>2&&S>1||R>2&&a>1;){let x=S,O=a;k>2&&S>1&&(x=S>=16384?Math.floor(S/2)-1||1:Math.ceil(S/2),k/=S/x),R>2&&a>1&&(O=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a)/2,R/=a/O),A=this.cachedCanvases.getCanvas(g,x,O),E=A.context,E.clearRect(0,0,x,O),E.drawImage(h,0,0,S,a,0,0,x,O),h=A.canvas,S=x,a=O,g=g==="prescale1"?"prescale2":"prescale1"}return{img:h,paintWidth:S,paintHeight:a}}_createMaskCanvas(h){const d=this.ctx,{width:b,height:P}=h,k=this.current.fillColor,R=this.current.patternFill,S=(0,m.getCurrentTransform)(d);let a,g,A,E;if((h.bitmap||h.data)&&h.count>1){const ot=h.bitmap||h.data.buffer;g=JSON.stringify(R?S:[S.slice(0,4),k]),a=this._cachedBitmapsMap.get(ot),a||(a=new Map,this._cachedBitmapsMap.set(ot,a));const lt=a.get(g);if(lt&&!R){const ct=Math.round(Math.min(S[0],S[2])+S[4]),ht=Math.round(Math.min(S[1],S[3])+S[5]);return{canvas:lt,offsetX:ct,offsetY:ht}}A=lt}A||(E=this.cachedCanvases.getCanvas("maskCanvas",b,P),w(E.context,h));let x=o.Util.transform(S,[1/b,0,0,-1/P,0,0]);x=o.Util.transform(x,[1,0,0,1,0,-P]);const O=o.Util.applyTransform([0,0],x),j=o.Util.applyTransform([b,P],x),X=o.Util.normalizeRect([O[0],O[1],j[0],j[1]]),it=Math.round(X[2]-X[0])||1,q=Math.round(X[3]-X[1])||1,Y=this.cachedCanvases.getCanvas("fillCanvas",it,q),K=Y.context,$=Math.min(O[0],j[0]),Z=Math.min(O[1],j[1]);K.translate(-$,-Z),K.transform(...x),A||(A=this._scaleImage(E.canvas,(0,m.getCurrentTransformInverse)(K)),A=A.img,a&&R&&a.set(g,A)),K.imageSmoothingEnabled=st((0,m.getCurrentTransform)(K),h.interpolate),f(K,A,0,0,A.width,A.height,0,0,b,P),K.globalCompositeOperation="source-in";const rt=o.Util.transform((0,m.getCurrentTransformInverse)(K),[1,0,0,1,-$,-Z]);return K.fillStyle=R?k.getPattern(d,this,rt,D.PathType.FILL):k,K.fillRect(0,0,b,P),a&&!R&&(this.cachedCanvases.delete("fillCanvas"),a.set(g,Y.canvas)),{canvas:Y.canvas,offsetX:Math.round($),offsetY:Math.round(Z)}}setLineWidth(h){h!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=h,this.ctx.lineWidth=h}setLineCap(h){this.ctx.lineCap=Q[h]}setLineJoin(h){this.ctx.lineJoin=et[h]}setMiterLimit(h){this.ctx.miterLimit=h}setDash(h,d){const b=this.ctx;b.setLineDash!==void 0&&(b.setLineDash(h),b.lineDashOffset=d)}setRenderingIntent(h){}setFlatness(h){}setGState(h){for(const[d,b]of h)switch(d){case"LW":this.setLineWidth(b);break;case"LC":this.setLineCap(b);break;case"LJ":this.setLineJoin(b);break;case"ML":this.setMiterLimit(b);break;case"D":this.setDash(b[0],b[1]);break;case"RI":this.setRenderingIntent(b);break;case"FL":this.setFlatness(b);break;case"Font":this.setFont(b[0],b[1]);break;case"CA":this.current.strokeAlpha=b;break;case"ca":this.current.fillAlpha=b,this.ctx.globalAlpha=b;break;case"BM":this.ctx.globalCompositeOperation=b;break;case"SMask":this.current.activeSMask=b?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(b);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const h=this.inSMaskMode;this.current.activeSMask&&!h?this.beginSMaskMode():!this.current.activeSMask&&h&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const h=this.ctx.canvas.width,d=this.ctx.canvas.height,b="smaskGroupAt"+this.groupLevel,P=this.cachedCanvases.getCanvas(b,h,d);this.suspendedCtx=this.ctx,this.ctx=P.context;const k=this.ctx;k.setTransform(...(0,m.getCurrentTransform)(this.suspendedCtx)),p(this.suspendedCtx,k),e(k,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),p(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(h){if(!this.current.activeSMask)return;h?(h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]),h[2]=Math.ceil(h[2]),h[3]=Math.ceil(h[3])):h=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const d=this.current.activeSMask,b=this.suspendedCtx;z(b,d,this.ctx,h),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(p(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const h=this.current;this.stateStack.push(h),this.current=h.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),p(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(h,d,b,P,k,R){this.ctx.transform(h,d,b,P,k,R),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(h,d,b){const P=this.ctx,k=this.current;let R=k.x,S=k.y,a,g;const A=(0,m.getCurrentTransform)(P),E=A[0]===0&&A[3]===0||A[1]===0&&A[2]===0,x=E?b.slice(0):null;for(let O=0,j=0,X=h.length;O<X;O++)switch(h[O]|0){case o.OPS.rectangle:R=d[j++],S=d[j++];const it=d[j++],q=d[j++],Y=R+it,K=S+q;P.moveTo(R,S),it===0||q===0?P.lineTo(Y,K):(P.lineTo(Y,S),P.lineTo(Y,K),P.lineTo(R,K)),E||k.updateRectMinMax(A,[R,S,Y,K]),P.closePath();break;case o.OPS.moveTo:R=d[j++],S=d[j++],P.moveTo(R,S),E||k.updatePathMinMax(A,R,S);break;case o.OPS.lineTo:R=d[j++],S=d[j++],P.lineTo(R,S),E||k.updatePathMinMax(A,R,S);break;case o.OPS.curveTo:a=R,g=S,R=d[j+4],S=d[j+5],P.bezierCurveTo(d[j],d[j+1],d[j+2],d[j+3],R,S),k.updateCurvePathMinMax(A,a,g,d[j],d[j+1],d[j+2],d[j+3],R,S,x),j+=6;break;case o.OPS.curveTo2:a=R,g=S,P.bezierCurveTo(R,S,d[j],d[j+1],d[j+2],d[j+3]),k.updateCurvePathMinMax(A,a,g,R,S,d[j],d[j+1],d[j+2],d[j+3],x),R=d[j+2],S=d[j+3],j+=4;break;case o.OPS.curveTo3:a=R,g=S,R=d[j+2],S=d[j+3],P.bezierCurveTo(d[j],d[j+1],R,S,R,S),k.updateCurvePathMinMax(A,a,g,d[j],d[j+1],R,S,R,S,x),j+=4;break;case o.OPS.closePath:P.closePath();break}E&&k.updateScalingPathMinMax(A,x),k.setCurrentPoint(R,S)}closePath(){this.ctx.closePath()}stroke(h=!0){const d=this.ctx,b=this.current.strokeColor;d.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof b=="object"&&b?.getPattern?(d.save(),d.strokeStyle=b.getPattern(d,this,(0,m.getCurrentTransformInverse)(d),D.PathType.STROKE),this.rescaleAndStroke(!1),d.restore()):this.rescaleAndStroke(!0)),h&&this.consumePath(this.current.getClippedPathBoundingBox()),d.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(h=!0){const d=this.ctx,b=this.current.fillColor,P=this.current.patternFill;let k=!1;P&&(d.save(),d.fillStyle=b.getPattern(d,this,(0,m.getCurrentTransformInverse)(d),D.PathType.FILL),k=!0);const R=this.current.getClippedPathBoundingBox();this.contentVisible&&R!==null&&(this.pendingEOFill?(d.fill("evenodd"),this.pendingEOFill=!1):d.fill()),k&&d.restore(),h&&this.consumePath(R)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=nt}eoClip(){this.pendingClip=J}beginText(){this.current.textMatrix=o.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const h=this.pendingTextPaths,d=this.ctx;if(h===void 0){d.beginPath();return}d.save(),d.beginPath();for(const b of h)d.setTransform(...b.transform),d.translate(b.x,b.y),b.addToPath(d,b.fontSize);d.restore(),d.clip(),d.beginPath(),delete this.pendingTextPaths}setCharSpacing(h){this.current.charSpacing=h}setWordSpacing(h){this.current.wordSpacing=h}setHScale(h){this.current.textHScale=h/100}setLeading(h){this.current.leading=-h}setFont(h,d){const b=this.commonObjs.get(h),P=this.current;if(!b)throw new Error(`Can't find font for ${h}`);if(P.fontMatrix=b.fontMatrix||o.FONT_IDENTITY_MATRIX,(P.fontMatrix[0]===0||P.fontMatrix[3]===0)&&(0,o.warn)("Invalid font matrix for font "+h),d<0?(d=-d,P.fontDirection=-1):P.fontDirection=1,this.current.font=b,this.current.fontSize=d,b.isType3Font)return;const k=b.loadedName||"sans-serif",R=b.systemFontInfo?.css||`"${k}", ${b.fallbackName}`;let S="normal";b.black?S="900":b.bold&&(S="bold");const a=b.italic?"italic":"normal";let g=d;d<N?g=N:d>L&&(g=L),this.current.fontSizeScale=d/g,this.ctx.font=`${a} ${S} ${g}px ${R}`}setTextRenderingMode(h){this.current.textRenderingMode=h}setTextRise(h){this.current.textRise=h}moveText(h,d){this.current.x=this.current.lineX+=h,this.current.y=this.current.lineY+=d}setLeadingMoveText(h,d){this.setLeading(-d),this.moveText(h,d)}setTextMatrix(h,d,b,P,k,R){this.current.textMatrix=[h,d,b,P,k,R],this.current.textMatrixScale=Math.hypot(h,d),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(h,d,b,P){const k=this.ctx,R=this.current,S=R.font,a=R.textRenderingMode,g=R.fontSize/R.fontSizeScale,A=a&o.TextRenderingMode.FILL_STROKE_MASK,E=!!(a&o.TextRenderingMode.ADD_TO_PATH_FLAG),x=R.patternFill&&!S.missingFile;let O;(S.disableFontFace||E||x)&&(O=S.getPathGenerator(this.commonObjs,h)),S.disableFontFace||x?(k.save(),k.translate(d,b),k.beginPath(),O(k,g),P&&k.setTransform(...P),(A===o.TextRenderingMode.FILL||A===o.TextRenderingMode.FILL_STROKE)&&k.fill(),(A===o.TextRenderingMode.STROKE||A===o.TextRenderingMode.FILL_STROKE)&&k.stroke(),k.restore()):((A===o.TextRenderingMode.FILL||A===o.TextRenderingMode.FILL_STROKE)&&k.fillText(h,d,b),(A===o.TextRenderingMode.STROKE||A===o.TextRenderingMode.FILL_STROKE)&&k.strokeText(h,d,b)),E&&(this.pendingTextPaths||=[]).push({transform:(0,m.getCurrentTransform)(k),x:d,y:b,fontSize:g,addToPath:O})}get isFontSubpixelAAEnabled(){const{context:h}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);h.scale(1.5,1),h.fillText("I",0,10);const d=h.getImageData(0,0,10,10).data;let b=!1;for(let P=3;P<d.length;P+=4)if(d[P]>0&&d[P]<255){b=!0;break}return(0,o.shadow)(this,"isFontSubpixelAAEnabled",b)}showText(h){const d=this.current,b=d.font;if(b.isType3Font)return this.showType3Text(h);const P=d.fontSize;if(P===0)return;const k=this.ctx,R=d.fontSizeScale,S=d.charSpacing,a=d.wordSpacing,g=d.fontDirection,A=d.textHScale*g,E=h.length,x=b.vertical,O=x?1:-1,j=b.defaultVMetrics,X=P*d.fontMatrix[0],it=d.textRenderingMode===o.TextRenderingMode.FILL&&!b.disableFontFace&&!d.patternFill;k.save(),k.transform(...d.textMatrix),k.translate(d.x,d.y+d.textRise),g>0?k.scale(A,-1):k.scale(A,1);let q;if(d.patternFill){k.save();const rt=d.fillColor.getPattern(k,this,(0,m.getCurrentTransformInverse)(k),D.PathType.FILL);q=(0,m.getCurrentTransform)(k),k.restore(),k.fillStyle=rt}let Y=d.lineWidth;const K=d.textMatrixScale;if(K===0||Y===0){const rt=d.textRenderingMode&o.TextRenderingMode.FILL_STROKE_MASK;(rt===o.TextRenderingMode.STROKE||rt===o.TextRenderingMode.FILL_STROKE)&&(Y=this.getSinglePixelWidth())}else Y/=K;if(R!==1&&(k.scale(R,R),Y/=R),k.lineWidth=Y,b.isInvalidPDFjsFont){const rt=[];let ot=0;for(const lt of h)rt.push(lt.unicode),ot+=lt.width;k.fillText(rt.join(""),0,0),d.x+=ot*X*A,k.restore(),this.compose();return}let $=0,Z;for(Z=0;Z<E;++Z){const rt=h[Z];if(typeof rt=="number"){$+=O*rt*P/1e3;continue}let ot=!1;const lt=(rt.isSpace?a:0)+S,ct=rt.fontChar,ht=rt.accent;let ut,At,mt=rt.width;if(x){const _t=rt.vmetric||j,vt=-(rt.vmetric?_t[1]:mt*.5)*X,Dt=_t[2]*X;mt=_t?-_t[0]:mt,ut=vt/R,At=($+Dt)/R}else ut=$/R,At=0;if(b.remeasure&&mt>0){const _t=k.measureText(ct).width*1e3/P*R;if(mt<_t&&this.isFontSubpixelAAEnabled){const vt=mt/_t;ot=!0,k.save(),k.scale(vt,1),ut/=vt}else mt!==_t&&(ut+=(mt-_t)/2e3*P/R)}if(this.contentVisible&&(rt.isInFont||b.missingFile)){if(it&&!ht)k.fillText(ct,ut,At);else if(this.paintChar(ct,ut,At,q),ht){const _t=ut+P*ht.offset.x/R,vt=At-P*ht.offset.y/R;this.paintChar(ht.fontChar,_t,vt,q)}}const wt=x?mt*X-lt*g:mt*X+lt*g;$+=wt,ot&&k.restore()}x?d.y-=$:d.x+=$*A,k.restore(),this.compose()}showType3Text(h){const d=this.ctx,b=this.current,P=b.font,k=b.fontSize,R=b.fontDirection,S=P.vertical?1:-1,a=b.charSpacing,g=b.wordSpacing,A=b.textHScale*R,E=b.fontMatrix||o.FONT_IDENTITY_MATRIX,x=h.length,O=b.textRenderingMode===o.TextRenderingMode.INVISIBLE;let j,X,it,q;if(!(O||k===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,d.save(),d.transform(...b.textMatrix),d.translate(b.x,b.y),d.scale(A,R),j=0;j<x;++j){if(X=h[j],typeof X=="number"){q=S*X*k/1e3,this.ctx.translate(q,0),b.x+=q*A;continue}const Y=(X.isSpace?g:0)+a,K=P.charProcOperatorList[X.operatorListId];if(!K){(0,o.warn)(`Type3 character "${X.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=X,this.save(),d.scale(k,k),d.transform(...E),this.executeOperatorList(K),this.restore()),it=o.Util.applyTransform([X.width,0],E)[0]*k+Y,d.translate(it,0),b.x+=it*A}d.restore(),this.processingType3=null}}setCharWidth(h,d){}setCharWidthAndBounds(h,d,b,P,k,R){this.ctx.rect(b,P,k-b,R-P),this.ctx.clip(),this.endPath()}getColorN_Pattern(h){let d;if(h[0]==="TilingPattern"){const b=h[1],P=this.baseTransform||(0,m.getCurrentTransform)(this.ctx),k={createCanvasGraphics:R=>new M(R,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};d=new D.TilingPattern(h,b,this.ctx,k,P)}else d=this._getPattern(h[1],h[2]);return d}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(h,d,b){const P=o.Util.makeHexColor(h,d,b);this.ctx.strokeStyle=P,this.current.strokeColor=P}setFillRGBColor(h,d,b){const P=o.Util.makeHexColor(h,d,b);this.ctx.fillStyle=P,this.current.fillColor=P,this.current.patternFill=!1}_getPattern(h,d=null){let b;return this.cachedPatterns.has(h)?b=this.cachedPatterns.get(h):(b=(0,D.getShadingPattern)(this.getObject(h)),this.cachedPatterns.set(h,b)),d&&(b.matrix=d),b}shadingFill(h){if(!this.contentVisible)return;const d=this.ctx;this.save();const b=this._getPattern(h);d.fillStyle=b.getPattern(d,this,(0,m.getCurrentTransformInverse)(d),D.PathType.SHADING);const P=(0,m.getCurrentTransformInverse)(d);if(P){const{width:k,height:R}=d.canvas,[S,a,g,A]=o.Util.getAxialAlignedBoundingBox([0,0,k,R],P);this.ctx.fillRect(S,a,g-S,A-a)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,o.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,o.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(h,d){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(h)&&h.length===6&&this.transform(...h),this.baseTransform=(0,m.getCurrentTransform)(this.ctx),d)){const b=d[2]-d[0],P=d[3]-d[1];this.ctx.rect(d[0],d[1],b,P),this.current.updateRectMinMax((0,m.getCurrentTransform)(this.ctx),d),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(h){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const d=this.ctx;h.isolated||(0,o.info)("TODO: Support non-isolated groups."),h.knockout&&(0,o.warn)("Knockout groups not supported.");const b=(0,m.getCurrentTransform)(d);if(h.matrix&&d.transform(...h.matrix),!h.bbox)throw new Error("Bounding box is required.");let P=o.Util.getAxialAlignedBoundingBox(h.bbox,(0,m.getCurrentTransform)(d));const k=[0,0,d.canvas.width,d.canvas.height];P=o.Util.intersect(P,k)||[0,0,0,0];const R=Math.floor(P[0]),S=Math.floor(P[1]);let a=Math.max(Math.ceil(P[2])-R,1),g=Math.max(Math.ceil(P[3])-S,1),A=1,E=1;a>i&&(A=a/i,a=i),g>i&&(E=g/i,g=i),this.current.startNewPathAndClipBox([0,0,a,g]);let x="groupAt"+this.groupLevel;h.smask&&(x+="_smask_"+this.smaskCounter++%2);const O=this.cachedCanvases.getCanvas(x,a,g),j=O.context;j.scale(1/A,1/E),j.translate(-R,-S),j.transform(...b),h.smask?this.smaskStack.push({canvas:O.canvas,context:j,offsetX:R,offsetY:S,scaleX:A,scaleY:E,subtype:h.smask.subtype,backdrop:h.smask.backdrop,transferMap:h.smask.transferMap||null,startTransformInverse:null}):(d.setTransform(1,0,0,1,0,0),d.translate(R,S),d.scale(A,E),d.save()),p(d,j),this.ctx=j,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(d),this.groupLevel++}endGroup(h){if(!this.contentVisible)return;this.groupLevel--;const d=this.ctx,b=this.groupStack.pop();if(this.ctx=b,this.ctx.imageSmoothingEnabled=!1,h.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const P=(0,m.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...P);const k=o.Util.getAxialAlignedBoundingBox([0,0,d.canvas.width,d.canvas.height],P);this.ctx.drawImage(d.canvas,0,0),this.ctx.restore(),this.compose(k)}}beginAnnotation(h,d,b,P,k){if(this.#t(),v(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(d)&&d.length===4){const R=d[2]-d[0],S=d[3]-d[1];if(k&&this.annotationCanvasMap){b=b.slice(),b[4]-=d[0],b[5]-=d[1],d=d.slice(),d[0]=d[1]=0,d[2]=R,d[3]=S;const[a,g]=o.Util.singularValueDecompose2dScale((0,m.getCurrentTransform)(this.ctx)),{viewportScale:A}=this,E=Math.ceil(R*this.outputScaleX*A),x=Math.ceil(S*this.outputScaleY*A);this.annotationCanvas=this.canvasFactory.create(E,x);const{canvas:O,context:j}=this.annotationCanvas;this.annotationCanvasMap.set(h,O),this.annotationCanvas.savedCtx=this.ctx,this.ctx=j,this.ctx.save(),this.ctx.setTransform(a,0,0,-g,0,S*g),v(this.ctx)}else v(this.ctx),this.ctx.rect(d[0],d[1],R,S),this.ctx.clip(),this.endPath()}this.current=new y(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...b),this.transform(...P)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(h){if(!this.contentVisible)return;const d=h.count;h=this.getObject(h.data,h),h.count=d;const b=this.ctx,P=this.processingType3;if(P&&(P.compiled===void 0&&(P.compiled=n(h)),P.compiled)){P.compiled(b);return}const k=this._createMaskCanvas(h),R=k.canvas;b.save(),b.setTransform(1,0,0,1,0,0),b.drawImage(R,k.offsetX,k.offsetY),b.restore(),this.compose()}paintImageMaskXObjectRepeat(h,d,b=0,P=0,k,R){if(!this.contentVisible)return;h=this.getObject(h.data,h);const S=this.ctx;S.save();const a=(0,m.getCurrentTransform)(S);S.transform(d,b,P,k,0,0);const g=this._createMaskCanvas(h);S.setTransform(1,0,0,1,g.offsetX-a[4],g.offsetY-a[5]);for(let A=0,E=R.length;A<E;A+=2){const x=o.Util.transform(a,[d,b,P,k,R[A],R[A+1]]),[O,j]=o.Util.applyTransform([0,0],x);S.drawImage(g.canvas,O,j)}S.restore(),this.compose()}paintImageMaskXObjectGroup(h){if(!this.contentVisible)return;const d=this.ctx,b=this.current.fillColor,P=this.current.patternFill;for(const k of h){const{data:R,width:S,height:a,transform:g}=k,A=this.cachedCanvases.getCanvas("maskCanvas",S,a),E=A.context;E.save();const x=this.getObject(R,k);w(E,x),E.globalCompositeOperation="source-in",E.fillStyle=P?b.getPattern(E,this,(0,m.getCurrentTransformInverse)(d),D.PathType.FILL):b,E.fillRect(0,0,S,a),E.restore(),d.save(),d.transform(...g),d.scale(1,-1),f(d,A.canvas,0,0,S,a,0,-1,1,1),d.restore()}this.compose()}paintImageXObject(h){if(!this.contentVisible)return;const d=this.getObject(h);if(!d){(0,o.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(d)}paintImageXObjectRepeat(h,d,b,P){if(!this.contentVisible)return;const k=this.getObject(h);if(!k){(0,o.warn)("Dependent image isn't ready yet");return}const R=k.width,S=k.height,a=[];for(let g=0,A=P.length;g<A;g+=2)a.push({transform:[d,0,0,b,P[g],P[g+1]],x:0,y:0,w:R,h:S});this.paintInlineImageXObjectGroup(k,a)}applyTransferMapsToCanvas(h){return this.current.transferMaps!=="none"&&(h.filter=this.current.transferMaps,h.drawImage(h.canvas,0,0),h.filter="none"),h.canvas}applyTransferMapsToBitmap(h){if(this.current.transferMaps==="none")return h.bitmap;const{bitmap:d,width:b,height:P}=h,k=this.cachedCanvases.getCanvas("inlineImage",b,P),R=k.context;return R.filter=this.current.transferMaps,R.drawImage(d,0,0),R.filter="none",k.canvas}paintInlineImageXObject(h){if(!this.contentVisible)return;const d=h.width,b=h.height,P=this.ctx;if(this.save(),!o.isNodeJS){const{filter:S}=P;S!=="none"&&S!==""&&(P.filter="none")}P.scale(1/d,-1/b);let k;if(h.bitmap)k=this.applyTransferMapsToBitmap(h);else if(typeof HTMLElement=="function"&&h instanceof HTMLElement||!h.data)k=h;else{const a=this.cachedCanvases.getCanvas("inlineImage",d,b).context;T(a,h),k=this.applyTransferMapsToCanvas(a)}const R=this._scaleImage(k,(0,m.getCurrentTransformInverse)(P));P.imageSmoothingEnabled=st((0,m.getCurrentTransform)(P),h.interpolate),f(P,R.img,0,0,R.paintWidth,R.paintHeight,0,-b,d,b),this.compose(),this.restore()}paintInlineImageXObjectGroup(h,d){if(!this.contentVisible)return;const b=this.ctx;let P;if(h.bitmap)P=h.bitmap;else{const k=h.width,R=h.height,a=this.cachedCanvases.getCanvas("inlineImage",k,R).context;T(a,h),P=this.applyTransferMapsToCanvas(a)}for(const k of d)b.save(),b.transform(...k.transform),b.scale(1,-1),f(b,P,k.x,k.y,k.w,k.h,0,-1,1,1),b.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(h){}markPointProps(h,d){}beginMarkedContent(h){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(h,d){h==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(d)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(h){const d=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(h);const b=this.ctx;this.pendingClip&&(d||(this.pendingClip===J?b.clip("evenodd"):b.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),b.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const h=(0,m.getCurrentTransform)(this.ctx);if(h[1]===0&&h[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(h[0]),Math.abs(h[3]));else{const d=Math.abs(h[0]*h[3]-h[2]*h[1]),b=Math.hypot(h[0],h[2]),P=Math.hypot(h[1],h[3]);this._cachedGetSinglePixelWidth=Math.max(b,P)/d}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:h}=this.current,{a:d,b,c:P,d:k}=this.ctx.getTransform();let R,S;if(b===0&&P===0){const a=Math.abs(d),g=Math.abs(k);if(a===g)if(h===0)R=S=1/a;else{const A=a*h;R=S=A<1?1/A:1}else if(h===0)R=1/a,S=1/g;else{const A=a*h,E=g*h;R=A<1?1/A:1,S=E<1?1/E:1}}else{const a=Math.abs(d*k-b*P),g=Math.hypot(d,b),A=Math.hypot(P,k);if(h===0)R=A/a,S=g/a;else{const E=h*a;R=A>E?A/E:1,S=g>E?g/E:1}}this._cachedScaleForStroking[0]=R,this._cachedScaleForStroking[1]=S}return this._cachedScaleForStroking}rescaleAndStroke(h){const{ctx:d}=this,{lineWidth:b}=this.current,[P,k]=this.getScaleForStroking();if(d.lineWidth=b||1,P===1&&k===1){d.stroke();return}const R=d.getLineDash();if(h&&d.save(),d.scale(P,k),R.length>0){const S=Math.max(P,k);d.setLineDash(R.map(a=>a/S)),d.lineDashOffset/=S}d.stroke(),h&&d.restore()}isContentVisible(){for(let h=this.markedContentStack.length-1;h>=0;h--)if(!this.markedContentStack[h].visible)return!1;return!0}}r.CanvasGraphics=M;for(const _ in o.OPS)M.prototype[_]!==void 0&&(M.prototype[o.OPS[_]]=M.prototype[_])}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TilingPattern=r.PathType=void 0,r.getShadingPattern=l;var o=F(1),m=F(6);const D={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};r.PathType=D;function C(f,n){if(!n)return;const y=n[2]-n[0],T=n[3]-n[1],w=new Path2D;w.rect(n[0],n[1],y,T),f.clip(w)}class N{constructor(){this.constructor===N&&(0,o.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,o.unreachable)("Abstract method `getPattern` called.")}}class L extends N{constructor(n){super(),this._type=n[1],this._bbox=n[2],this._colorStops=n[3],this._p0=n[4],this._p1=n[5],this._r0=n[6],this._r1=n[7],this.matrix=null}_createGradient(n){let y;this._type==="axial"?y=n.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(y=n.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const T of this._colorStops)y.addColorStop(T[0],T[1]);return y}getPattern(n,y,T,w){let p;if(w===D.STROKE||w===D.FILL){const v=y.current.getClippedPathBoundingBox(w,(0,m.getCurrentTransform)(n))||[0,0,0,0],B=Math.ceil(v[2]-v[0])||1,H=Math.ceil(v[3]-v[1])||1,I=y.cachedCanvases.getCanvas("pattern",B,H,!0),V=I.context;V.clearRect(0,0,V.canvas.width,V.canvas.height),V.beginPath(),V.rect(0,0,V.canvas.width,V.canvas.height),V.translate(-v[0],-v[1]),T=o.Util.transform(T,[1,0,0,1,v[0],v[1]]),V.transform(...y.baseTransform),this.matrix&&V.transform(...this.matrix),C(V,this._bbox),V.fillStyle=this._createGradient(V),V.fill(),p=n.createPattern(I.canvas,"no-repeat");const z=new DOMMatrix(T);p.setTransform(z)}else C(n,this._bbox),p=this._createGradient(n);return p}}function i(f,n,y,T,w,p,v,B){const H=n.coords,I=n.colors,V=f.data,z=f.width*4;let st;H[y+1]>H[T+1]&&(st=y,y=T,T=st,st=p,p=v,v=st),H[T+1]>H[w+1]&&(st=T,T=w,w=st,st=v,v=B,B=st),H[y+1]>H[T+1]&&(st=y,y=T,T=st,st=p,p=v,v=st);const Q=(H[y]+n.offsetX)*n.scaleX,et=(H[y+1]+n.offsetY)*n.scaleY,nt=(H[T]+n.offsetX)*n.scaleX,J=(H[T+1]+n.offsetY)*n.scaleY,M=(H[w]+n.offsetX)*n.scaleX,_=(H[w+1]+n.offsetY)*n.scaleY;if(et>=_)return;const h=I[p],d=I[p+1],b=I[p+2],P=I[v],k=I[v+1],R=I[v+2],S=I[B],a=I[B+1],g=I[B+2],A=Math.round(et),E=Math.round(_);let x,O,j,X,it,q,Y,K;for(let $=A;$<=E;$++){if($<J){const ct=$<et?0:(et-$)/(et-J);x=Q-(Q-nt)*ct,O=h-(h-P)*ct,j=d-(d-k)*ct,X=b-(b-R)*ct}else{let ct;$>_?ct=1:J===_?ct=0:ct=(J-$)/(J-_),x=nt-(nt-M)*ct,O=P-(P-S)*ct,j=k-(k-a)*ct,X=R-(R-g)*ct}let Z;$<et?Z=0:$>_?Z=1:Z=(et-$)/(et-_),it=Q-(Q-M)*Z,q=h-(h-S)*Z,Y=d-(d-a)*Z,K=b-(b-g)*Z;const rt=Math.round(Math.min(x,it)),ot=Math.round(Math.max(x,it));let lt=z*$+rt*4;for(let ct=rt;ct<=ot;ct++)Z=(x-ct)/(x-it),Z<0?Z=0:Z>1&&(Z=1),V[lt++]=O-(O-q)*Z|0,V[lt++]=j-(j-Y)*Z|0,V[lt++]=X-(X-K)*Z|0,V[lt++]=255}}function t(f,n,y){const T=n.coords,w=n.colors;let p,v;switch(n.type){case"lattice":const B=n.verticesPerRow,H=Math.floor(T.length/B)-1,I=B-1;for(p=0;p<H;p++){let V=p*B;for(let z=0;z<I;z++,V++)i(f,y,T[V],T[V+1],T[V+B],w[V],w[V+1],w[V+B]),i(f,y,T[V+B+1],T[V+1],T[V+B],w[V+B+1],w[V+1],w[V+B])}break;case"triangles":for(p=0,v=T.length;p<v;p+=3)i(f,y,T[p],T[p+1],T[p+2],w[p],w[p+1],w[p+2]);break;default:throw new Error("illegal figure")}}class s extends N{constructor(n){super(),this._coords=n[2],this._colors=n[3],this._figures=n[4],this._bounds=n[5],this._bbox=n[7],this._background=n[8],this.matrix=null}_createMeshCanvas(n,y,T){const B=Math.floor(this._bounds[0]),H=Math.floor(this._bounds[1]),I=Math.ceil(this._bounds[2])-B,V=Math.ceil(this._bounds[3])-H,z=Math.min(Math.ceil(Math.abs(I*n[0]*1.1)),3e3),st=Math.min(Math.ceil(Math.abs(V*n[1]*1.1)),3e3),Q=I/z,et=V/st,nt={coords:this._coords,colors:this._colors,offsetX:-B,offsetY:-H,scaleX:1/Q,scaleY:1/et},J=z+4,M=st+4,_=T.getCanvas("mesh",J,M,!1),h=_.context,d=h.createImageData(z,st);if(y){const P=d.data;for(let k=0,R=P.length;k<R;k+=4)P[k]=y[0],P[k+1]=y[1],P[k+2]=y[2],P[k+3]=255}for(const P of this._figures)t(d,P,nt);return h.putImageData(d,2,2),{canvas:_.canvas,offsetX:B-2*Q,offsetY:H-2*et,scaleX:Q,scaleY:et}}getPattern(n,y,T,w){C(n,this._bbox);let p;if(w===D.SHADING)p=o.Util.singularValueDecompose2dScale((0,m.getCurrentTransform)(n));else if(p=o.Util.singularValueDecompose2dScale(y.baseTransform),this.matrix){const B=o.Util.singularValueDecompose2dScale(this.matrix);p=[p[0]*B[0],p[1]*B[1]]}const v=this._createMeshCanvas(p,w===D.SHADING?null:this._background,y.cachedCanvases);return w!==D.SHADING&&(n.setTransform(...y.baseTransform),this.matrix&&n.transform(...this.matrix)),n.translate(v.offsetX,v.offsetY),n.scale(v.scaleX,v.scaleY),n.createPattern(v.canvas,"no-repeat")}}class u extends N{getPattern(){return"hotpink"}}function l(f){switch(f[0]){case"RadialAxial":return new L(f);case"Mesh":return new s(f);case"Dummy":return new u}throw new Error(`Unknown IR type: ${f[0]}`)}const e={COLORED:1,UNCOLORED:2};class c{static MAX_PATTERN_SIZE=3e3;constructor(n,y,T,w,p){this.operatorList=n[2],this.matrix=n[3]||[1,0,0,1,0,0],this.bbox=n[4],this.xstep=n[5],this.ystep=n[6],this.paintType=n[7],this.tilingType=n[8],this.color=y,this.ctx=T,this.canvasGraphicsFactory=w,this.baseTransform=p}createPatternCanvas(n){const y=this.operatorList,T=this.bbox,w=this.xstep,p=this.ystep,v=this.paintType,B=this.tilingType,H=this.color,I=this.canvasGraphicsFactory;(0,o.info)("TilingType: "+B);const V=T[0],z=T[1],st=T[2],Q=T[3],et=o.Util.singularValueDecompose2dScale(this.matrix),nt=o.Util.singularValueDecompose2dScale(this.baseTransform),J=[et[0]*nt[0],et[1]*nt[1]],M=this.getSizeAndScale(w,this.ctx.canvas.width,J[0]),_=this.getSizeAndScale(p,this.ctx.canvas.height,J[1]),h=n.cachedCanvases.getCanvas("pattern",M.size,_.size,!0),d=h.context,b=I.createCanvasGraphics(d);b.groupLevel=n.groupLevel,this.setFillAndStrokeStyleToContext(b,v,H);let P=V,k=z,R=st,S=Q;return V<0&&(P=0,R+=Math.abs(V)),z<0&&(k=0,S+=Math.abs(z)),d.translate(-(M.scale*P),-(_.scale*k)),b.transform(M.scale,0,0,_.scale,0,0),d.save(),this.clipBbox(b,P,k,R,S),b.baseTransform=(0,m.getCurrentTransform)(b.ctx),b.executeOperatorList(y),b.endDrawing(),{canvas:h.canvas,scaleX:M.scale,scaleY:_.scale,offsetX:P,offsetY:k}}getSizeAndScale(n,y,T){n=Math.abs(n);const w=Math.max(c.MAX_PATTERN_SIZE,y);let p=Math.ceil(n*T);return p>=w?p=w:T=p/n,{scale:T,size:p}}clipBbox(n,y,T,w,p){const v=w-y,B=p-T;n.ctx.rect(y,T,v,B),n.current.updateRectMinMax((0,m.getCurrentTransform)(n.ctx),[y,T,w,p]),n.clip(),n.endPath()}setFillAndStrokeStyleToContext(n,y,T){const w=n.ctx,p=n.current;switch(y){case e.COLORED:const v=this.ctx;w.fillStyle=v.fillStyle,w.strokeStyle=v.strokeStyle,p.fillColor=v.fillStyle,p.strokeColor=v.strokeStyle;break;case e.UNCOLORED:const B=o.Util.makeHexColor(T[0],T[1],T[2]);w.fillStyle=B,w.strokeStyle=B,p.fillColor=B,p.strokeColor=B;break;default:throw new o.FormatError(`Unsupported paint type: ${y}`)}}getPattern(n,y,T,w){let p=T;w!==D.SHADING&&(p=o.Util.transform(p,y.baseTransform),this.matrix&&(p=o.Util.transform(p,this.matrix)));const v=this.createPatternCanvas(y);let B=new DOMMatrix(p);B=B.translate(v.offsetX,v.offsetY),B=B.scale(1/v.scaleX,1/v.scaleY);const H=n.createPattern(v.canvas,"repeat");return H.setTransform(B),H}}r.TilingPattern=c}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.convertBlackAndWhiteToRGBA=D,r.convertToRGBA=m,r.grayToRGBA=N;var o=F(1);function m(L){switch(L.kind){case o.ImageKind.GRAYSCALE_1BPP:return D(L);case o.ImageKind.RGB_24BPP:return C(L)}return null}function D({src:L,srcPos:i=0,dest:t,width:s,height:u,nonBlackColor:l=4294967295,inverseDecode:e=!1}){const c=o.FeatureTest.isLittleEndian?4278190080:255,[f,n]=e?[l,c]:[c,l],y=s>>3,T=s&7,w=L.length;t=new Uint32Array(t.buffer);let p=0;for(let v=0;v<u;v++){for(const H=i+y;i<H;i++){const I=i<w?L[i]:255;t[p++]=I&128?n:f,t[p++]=I&64?n:f,t[p++]=I&32?n:f,t[p++]=I&16?n:f,t[p++]=I&8?n:f,t[p++]=I&4?n:f,t[p++]=I&2?n:f,t[p++]=I&1?n:f}if(T===0)continue;const B=i<w?L[i++]:255;for(let H=0;H<T;H++)t[p++]=B&1<<7-H?n:f}return{srcPos:i,destPos:p}}function C({src:L,srcPos:i=0,dest:t,destPos:s=0,width:u,height:l}){let e=0;const c=L.length>>2,f=new Uint32Array(L.buffer,i,c);if(o.FeatureTest.isLittleEndian){for(;e<c-2;e+=3,s+=4){const n=f[e],y=f[e+1],T=f[e+2];t[s]=n|4278190080,t[s+1]=n>>>24|y<<8|4278190080,t[s+2]=y>>>16|T<<16|4278190080,t[s+3]=T>>>8|4278190080}for(let n=e*4,y=L.length;n<y;n+=3)t[s++]=L[n]|L[n+1]<<8|L[n+2]<<16|4278190080}else{for(;e<c-2;e+=3,s+=4){const n=f[e],y=f[e+1],T=f[e+2];t[s]=n|255,t[s+1]=n<<24|y>>>8|255,t[s+2]=y<<16|T>>>16|255,t[s+3]=T<<8|255}for(let n=e*4,y=L.length;n<y;n+=3)t[s++]=L[n]<<24|L[n+1]<<16|L[n+2]<<8|255}return{srcPos:i,destPos:s}}function N(L,i){if(o.FeatureTest.isLittleEndian)for(let t=0,s=L.length;t<s;t++)i[t]=L[t]*65793|4278190080;else for(let t=0,s=L.length;t<s;t++)i[t]=L[t]*16843008|255}}),((U,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GlobalWorkerOptions=void 0;const F=Object.create(null);r.GlobalWorkerOptions=F,F.workerPort=null,F.workerSrc=""}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.MessageHandler=void 0;var o=F(1);const m={DATA:1,ERROR:2},D={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function C(L){switch(L instanceof Error||typeof L=="object"&&L!==null||(0,o.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),L.name){case"AbortException":return new o.AbortException(L.message);case"MissingPDFException":return new o.MissingPDFException(L.message);case"PasswordException":return new o.PasswordException(L.message,L.code);case"UnexpectedResponseException":return new o.UnexpectedResponseException(L.message,L.status);case"UnknownErrorException":return new o.UnknownErrorException(L.message,L.details);default:return new o.UnknownErrorException(L.message,L.toString())}}class N{constructor(i,t,s){this.sourceName=i,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=u=>{const l=u.data;if(l.targetName!==this.sourceName)return;if(l.stream){this.#e(l);return}if(l.callback){const c=l.callbackId,f=this.callbackCapabilities[c];if(!f)throw new Error(`Cannot resolve callback ${c}`);if(delete this.callbackCapabilities[c],l.callback===m.DATA)f.resolve(l.data);else if(l.callback===m.ERROR)f.reject(C(l.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[l.action];if(!e)throw new Error(`Unknown action from worker: ${l.action}`);if(l.callbackId){const c=this.sourceName,f=l.sourceName;new Promise(function(n){n(e(l.data))}).then(function(n){s.postMessage({sourceName:c,targetName:f,callback:m.DATA,callbackId:l.callbackId,data:n})},function(n){s.postMessage({sourceName:c,targetName:f,callback:m.ERROR,callbackId:l.callbackId,reason:C(n)})});return}if(l.streamId){this.#t(l);return}e(l.data)},s.addEventListener("message",this._onComObjOnMessage)}on(i,t){const s=this.actionHandler;if(s[i])throw new Error(`There is already an actionName called "${i}"`);s[i]=t}send(i,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:i,data:t},s)}sendWithPromise(i,t,s){const u=this.callbackId++,l=new o.PromiseCapability;this.callbackCapabilities[u]=l;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:i,callbackId:u,data:t},s)}catch(e){l.reject(e)}return l.promise}sendWithStream(i,t,s,u){const l=this.streamId++,e=this.sourceName,c=this.targetName,f=this.comObj;return new ReadableStream({start:n=>{const y=new o.PromiseCapability;return this.streamControllers[l]={controller:n,startCall:y,pullCall:null,cancelCall:null,isClosed:!1},f.postMessage({sourceName:e,targetName:c,action:i,streamId:l,data:t,desiredSize:n.desiredSize},u),y.promise},pull:n=>{const y=new o.PromiseCapability;return this.streamControllers[l].pullCall=y,f.postMessage({sourceName:e,targetName:c,stream:D.PULL,streamId:l,desiredSize:n.desiredSize}),y.promise},cancel:n=>{(0,o.assert)(n instanceof Error,"cancel must have a valid reason");const y=new o.PromiseCapability;return this.streamControllers[l].cancelCall=y,this.streamControllers[l].isClosed=!0,f.postMessage({sourceName:e,targetName:c,stream:D.CANCEL,streamId:l,reason:C(n)}),y.promise}},s)}#t(i){const t=i.streamId,s=this.sourceName,u=i.sourceName,l=this.comObj,e=this,c=this.actionHandler[i.action],f={enqueue(n,y=1,T){if(this.isCancelled)return;const w=this.desiredSize;this.desiredSize-=y,w>0&&this.desiredSize<=0&&(this.sinkCapability=new o.PromiseCapability,this.ready=this.sinkCapability.promise),l.postMessage({sourceName:s,targetName:u,stream:D.ENQUEUE,streamId:t,chunk:n},T)},close(){this.isCancelled||(this.isCancelled=!0,l.postMessage({sourceName:s,targetName:u,stream:D.CLOSE,streamId:t}),delete e.streamSinks[t])},error(n){(0,o.assert)(n instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,l.postMessage({sourceName:s,targetName:u,stream:D.ERROR,streamId:t,reason:C(n)}))},sinkCapability:new o.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:i.desiredSize,ready:null};f.sinkCapability.resolve(),f.ready=f.sinkCapability.promise,this.streamSinks[t]=f,new Promise(function(n){n(c(i.data,f))}).then(function(){l.postMessage({sourceName:s,targetName:u,stream:D.START_COMPLETE,streamId:t,success:!0})},function(n){l.postMessage({sourceName:s,targetName:u,stream:D.START_COMPLETE,streamId:t,reason:C(n)})})}#e(i){const t=i.streamId,s=this.sourceName,u=i.sourceName,l=this.comObj,e=this.streamControllers[t],c=this.streamSinks[t];switch(i.stream){case D.START_COMPLETE:i.success?e.startCall.resolve():e.startCall.reject(C(i.reason));break;case D.PULL_COMPLETE:i.success?e.pullCall.resolve():e.pullCall.reject(C(i.reason));break;case D.PULL:if(!c){l.postMessage({sourceName:s,targetName:u,stream:D.PULL_COMPLETE,streamId:t,success:!0});break}c.desiredSize<=0&&i.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=i.desiredSize,new Promise(function(f){f(c.onPull?.())}).then(function(){l.postMessage({sourceName:s,targetName:u,stream:D.PULL_COMPLETE,streamId:t,success:!0})},function(f){l.postMessage({sourceName:s,targetName:u,stream:D.PULL_COMPLETE,streamId:t,reason:C(f)})});break;case D.ENQUEUE:if((0,o.assert)(e,"enqueue should have stream controller"),e.isClosed)break;e.controller.enqueue(i.chunk);break;case D.CLOSE:if((0,o.assert)(e,"close should have stream controller"),e.isClosed)break;e.isClosed=!0,e.controller.close(),this.#s(e,t);break;case D.ERROR:(0,o.assert)(e,"error should have stream controller"),e.controller.error(C(i.reason)),this.#s(e,t);break;case D.CANCEL_COMPLETE:i.success?e.cancelCall.resolve():e.cancelCall.reject(C(i.reason)),this.#s(e,t);break;case D.CANCEL:if(!c)break;new Promise(function(f){f(c.onCancel?.(C(i.reason)))}).then(function(){l.postMessage({sourceName:s,targetName:u,stream:D.CANCEL_COMPLETE,streamId:t,success:!0})},function(f){l.postMessage({sourceName:s,targetName:u,stream:D.CANCEL_COMPLETE,streamId:t,reason:C(f)})}),c.sinkCapability.reject(C(i.reason)),c.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#s(i,t){await Promise.allSettled([i.startCall?.promise,i.pullCall?.promise,i.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}r.MessageHandler=N}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;var o=F(1);class m{#t;#e;constructor({parsedData:C,rawData:N}){this.#t=C,this.#e=N}getRaw(){return this.#e}get(C){return this.#t.get(C)??null}getAll(){return(0,o.objectFromMap)(this.#t)}has(C){return this.#t.has(C)}}r.Metadata=m}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OptionalContentConfig=void 0;var o=F(1),m=F(8);const D=Symbol("INTERNAL");class C{#t=!0;constructor(i,t){this.name=i,this.intent=t}get visible(){return this.#t}_setVisible(i,t){i!==D&&(0,o.unreachable)("Internal method `_setVisible` called."),this.#t=t}}class N{#t=null;#e=new Map;#s=null;#i=null;constructor(i){if(this.name=null,this.creator=null,i!==null){this.name=i.name,this.creator=i.creator,this.#i=i.order;for(const t of i.groups)this.#e.set(t.id,new C(t.name,t.intent));if(i.baseState==="OFF")for(const t of this.#e.values())t._setVisible(D,!1);for(const t of i.on)this.#e.get(t)._setVisible(D,!0);for(const t of i.off)this.#e.get(t)._setVisible(D,!1);this.#s=this.getHash()}}#o(i){const t=i.length;if(t<2)return!0;const s=i[0];for(let u=1;u<t;u++){const l=i[u];let e;if(Array.isArray(l))e=this.#o(l);else if(this.#e.has(l))e=this.#e.get(l).visible;else return(0,o.warn)(`Optional content group not found: ${l}`),!0;switch(s){case"And":if(!e)return!1;break;case"Or":if(e)return!0;break;case"Not":return!e;default:return!0}}return s==="And"}isVisible(i){if(this.#e.size===0)return!0;if(!i)return(0,o.warn)("Optional content group not defined."),!0;if(i.type==="OCG")return this.#e.has(i.id)?this.#e.get(i.id).visible:((0,o.warn)(`Optional content group not found: ${i.id}`),!0);if(i.type==="OCMD"){if(i.expression)return this.#o(i.expression);if(!i.policy||i.policy==="AnyOn"){for(const t of i.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(i.policy==="AllOn"){for(const t of i.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(i.policy==="AnyOff"){for(const t of i.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(i.policy==="AllOff"){for(const t of i.ids){if(!this.#e.has(t))return(0,o.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return(0,o.warn)(`Unknown optional content policy ${i.policy}.`),!0}return(0,o.warn)(`Unknown group type ${i.type}.`),!0}setVisibility(i,t=!0){if(!this.#e.has(i)){(0,o.warn)(`Optional content group not found: ${i}`);return}this.#e.get(i)._setVisible(D,!!t),this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,o.objectFromMap)(this.#e):null}getGroup(i){return this.#e.get(i)||null}getHash(){if(this.#t!==null)return this.#t;const i=new m.MurmurHash3_64;for(const[t,s]of this.#e)i.update(`${t}:${s.visible}`);return this.#t=i.hexdigest()}}r.OptionalContentConfig=N}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFDataTransportStream=void 0;var o=F(1),m=F(6);class D{constructor({length:i,initialData:t,progressiveDone:s=!1,contentDispositionFilename:u=null,disableRange:l=!1,disableStream:e=!1},c){if((0,o.assert)(c,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=s,this._contentDispositionFilename=u,t?.length>0){const f=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(f)}this._pdfDataRangeTransport=c,this._isStreamingSupported=!e,this._isRangeSupported=!l,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((f,n)=>{this._onReceiveData({begin:f,chunk:n})}),this._pdfDataRangeTransport.addProgressListener((f,n)=>{this._onProgress({loaded:f,total:n})}),this._pdfDataRangeTransport.addProgressiveReadListener(f=>{this._onReceiveData({chunk:f})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:i,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(i===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const u=this._rangeReaders.some(function(l){return l._begin!==i?!1:(l._enqueue(s),!0)});(0,o.assert)(u,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(i){i.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:i.loaded}):this._fullRequestReader?.onProgress?.({loaded:i.loaded,total:i.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(i){const t=this._rangeReaders.indexOf(i);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,o.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const i=this._queuedChunks;return this._queuedChunks=null,new C(this,i,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(i,t){if(t<=this._progressiveDataLength)return null;const s=new N(this,i,t);return this._pdfDataRangeTransport.requestDataRange(i,t),this._rangeReaders.push(s),s}cancelAllRequests(i){this._fullRequestReader?.cancel(i);for(const t of this._rangeReaders.slice(0))t.cancel(i);this._pdfDataRangeTransport.abort()}}r.PDFDataTransportStream=D;class C{constructor(i,t,s=!1,u=null){this._stream=i,this._done=s||!1,this._filename=(0,m.isPdfFile)(u)?u:null,this._queuedChunks=t||[],this._loaded=0;for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._requests=[],this._headersReady=Promise.resolve(),i._fullRequestReader=this,this.onProgress=null}_enqueue(i){this._done||(this._requests.length>0?this._requests.shift().resolve({value:i,done:!1}):this._queuedChunks.push(i),this._loaded+=i.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const i=new o.PromiseCapability;return this._requests.push(i),i.promise}cancel(i){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class N{constructor(i,t,s){this._stream=i,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(i){if(!this._done){if(this._requests.length===0)this._queuedChunk=i;else{this._requests.shift().resolve({value:i,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const i=new o.PromiseCapability;return this._requests.push(i),i.promise}cancel(i){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFFetchStream=void 0;var o=F(1),m=F(20);function D(s,u,l){return{method:"GET",headers:s,signal:l.signal,mode:"cors",credentials:u?"include":"same-origin",redirect:"follow"}}function C(s){const u=new Headers;for(const l in s){const e=s[l];e!==void 0&&u.append(l,e)}return u}function N(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:((0,o.warn)(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class L{constructor(u){this.source=u,this.isHttp=/^https?:/i.test(u.url),this.httpHeaders=this.isHttp&&u.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,o.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new i(this),this._fullRequestReader}getRangeReader(u,l){if(l<=this._progressiveDataLength)return null;const e=new t(this,u,l);return this._rangeRequestReaders.push(e),e}cancelAllRequests(u){this._fullRequestReader?.cancel(u);for(const l of this._rangeRequestReaders.slice(0))l.cancel(u)}}r.PDFFetchStream=L;class i{constructor(u){this._stream=u,this._reader=null,this._loaded=0,this._filename=null;const l=u.source;this._withCredentials=l.withCredentials||!1,this._contentLength=l.length,this._headersCapability=new o.PromiseCapability,this._disableRange=l.disableRange||!1,this._rangeChunkSize=l.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!l.disableStream,this._isRangeSupported=!l.disableRange,this._headers=C(this._stream.httpHeaders);const e=l.url;fetch(e,D(this._headers,this._withCredentials,this._abortController)).then(c=>{if(!(0,m.validateResponseStatus)(c.status))throw(0,m.createResponseStatusError)(c.status,e);this._reader=c.body.getReader(),this._headersCapability.resolve();const f=T=>c.headers.get(T),{allowRangeRequests:n,suggestedLength:y}=(0,m.validateRangeRequestCapabilities)({getResponseHeader:f,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n,this._contentLength=y||this._contentLength,this._filename=(0,m.extractFilenameFromHeader)(f),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new o.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:u,done:l}=await this._reader.read();return l?{value:u,done:l}:(this._loaded+=u.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:N(u),done:!1})}cancel(u){this._reader?.cancel(u),this._abortController.abort()}}class t{constructor(u,l,e){this._stream=u,this._reader=null,this._loaded=0;const c=u.source;this._withCredentials=c.withCredentials||!1,this._readCapability=new o.PromiseCapability,this._isStreamingSupported=!c.disableStream,this._abortController=new AbortController,this._headers=C(this._stream.httpHeaders),this._headers.append("Range",`bytes=${l}-${e-1}`);const f=c.url;fetch(f,D(this._headers,this._withCredentials,this._abortController)).then(n=>{if(!(0,m.validateResponseStatus)(n.status))throw(0,m.createResponseStatusError)(n.status,f);this._readCapability.resolve(),this._reader=n.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:u,done:l}=await this._reader.read();return l?{value:u,done:l}:(this._loaded+=u.byteLength,this.onProgress?.({loaded:this._loaded}),{value:N(u),done:!1})}cancel(u){this._reader?.cancel(u),this._abortController.abort()}}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createResponseStatusError=L,r.extractFilenameFromHeader=N,r.validateRangeRequestCapabilities=C,r.validateResponseStatus=i;var o=F(1),m=F(21),D=F(6);function C({getResponseHeader:t,isHttp:s,rangeChunkSize:u,disableRange:l}){const e={allowRangeRequests:!1,suggestedLength:void 0},c=parseInt(t("Content-Length"),10);return!Number.isInteger(c)||(e.suggestedLength=c,c<=2*u)||l||!s||t("Accept-Ranges")!=="bytes"||(t("Content-Encoding")||"identity")!=="identity"||(e.allowRangeRequests=!0),e}function N(t){const s=t("Content-Disposition");if(s){let u=(0,m.getFilenameFromContentDispositionHeader)(s);if(u.includes("%"))try{u=decodeURIComponent(u)}catch{}if((0,D.isPdfFile)(u))return u}return null}function L(t,s){return t===404||t===0&&s.startsWith("file:")?new o.MissingPDFException('Missing PDF "'+s+'".'):new o.UnexpectedResponseException(`Unexpected server response (${t}) while retrieving PDF "${s}".`,t)}function i(t){return t===200||t===206}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getFilenameFromContentDispositionHeader=m;var o=F(1);function m(D){let C=!0,N=L("filename\\*","i").exec(D);if(N){N=N[1];let c=u(N);return c=unescape(c),c=l(c),c=e(c),t(c)}if(N=s(D),N){const c=e(N);return t(c)}if(N=L("filename","i").exec(D),N){N=N[1];let c=u(N);return c=e(c),t(c)}function L(c,f){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function i(c,f){if(c){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const n=new TextDecoder(c,{fatal:!0}),y=(0,o.stringToBytes)(f);f=n.decode(y),C=!1}catch{}}return f}function t(c){return C&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),C&&(c=i("iso-8859-1",c))),c}function s(c){const f=[];let n;const y=L("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(n=y.exec(c))!==null;){let[,w,p,v]=n;if(w=parseInt(w,10),w in f){if(w===0)break;continue}f[w]=[p,v]}const T=[];for(let w=0;w<f.length&&w in f;++w){let[p,v]=f[w];v=u(v),p&&(v=unescape(v),w===0&&(v=l(v))),T.push(v)}return T.join("")}function u(c){if(c.startsWith('"')){const f=c.slice(1).split('\\"');for(let n=0;n<f.length;++n){const y=f[n].indexOf('"');y!==-1&&(f[n]=f[n].slice(0,y),f.length=n+1),f[n]=f[n].replaceAll(/\\(.)/g,"$1")}c=f.join('"')}return c}function l(c){const f=c.indexOf("'");if(f===-1)return c;const n=c.slice(0,f),T=c.slice(f+1).replace(/^[^']*'/,"");return i(n,T)}function e(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,n,y,T){if(y==="q"||y==="Q")return T=T.replaceAll("_"," "),T=T.replaceAll(/=([0-9a-fA-F]{2})/g,function(w,p){return String.fromCharCode(parseInt(p,16))}),i(n,T);try{T=atob(T)}catch{}return i(n,T)})}return""}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNetworkStream=void 0;var o=F(1),m=F(20);const D=200,C=206;function N(u){const l=u.response;return typeof l!="string"?l:(0,o.stringToBytes)(l).buffer}class L{constructor(l,e={}){this.url=l,this.isHttp=/^https?:/i.test(l),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(l,e,c){const f={begin:l,end:e};for(const n in c)f[n]=c[n];return this.request(f)}requestFull(l){return this.request(l)}request(l){const e=new XMLHttpRequest,c=this.currXhrId++,f=this.pendingRequests[c]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const n in this.httpHeaders){const y=this.httpHeaders[n];y!==void 0&&e.setRequestHeader(n,y)}return this.isHttp&&"begin"in l&&"end"in l?(e.setRequestHeader("Range",`bytes=${l.begin}-${l.end-1}`),f.expectedStatus=C):f.expectedStatus=D,e.responseType="arraybuffer",l.onError&&(e.onerror=function(n){l.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,c),e.onprogress=this.onProgress.bind(this,c),f.onHeadersReceived=l.onHeadersReceived,f.onDone=l.onDone,f.onError=l.onError,f.onProgress=l.onProgress,e.send(null),c}onProgress(l,e){const c=this.pendingRequests[l];c&&c.onProgress?.(e)}onStateChange(l,e){const c=this.pendingRequests[l];if(!c)return;const f=c.xhr;if(f.readyState>=2&&c.onHeadersReceived&&(c.onHeadersReceived(),delete c.onHeadersReceived),f.readyState!==4||!(l in this.pendingRequests))return;if(delete this.pendingRequests[l],f.status===0&&this.isHttp){c.onError?.(f.status);return}const n=f.status||D;if(!(n===D&&c.expectedStatus===C)&&n!==c.expectedStatus){c.onError?.(f.status);return}const T=N(f);if(n===C){const w=f.getResponseHeader("Content-Range"),p=/bytes (\d+)-(\d+)\/(\d+)/.exec(w);c.onDone({begin:parseInt(p[1],10),chunk:T})}else T?c.onDone({begin:0,chunk:T}):c.onError?.(f.status)}getRequestXhr(l){return this.pendingRequests[l].xhr}isPendingRequest(l){return l in this.pendingRequests}abortRequest(l){const e=this.pendingRequests[l].xhr;delete this.pendingRequests[l],e.abort()}}class i{constructor(l){this._source=l,this._manager=new L(l.url,{httpHeaders:l.httpHeaders,withCredentials:l.withCredentials}),this._rangeChunkSize=l.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(l){const e=this._rangeRequestReaders.indexOf(l);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return(0,o.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new t(this._manager,this._source),this._fullRequestReader}getRangeReader(l,e){const c=new s(this._manager,l,e);return c.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(c),c}cancelAllRequests(l){this._fullRequestReader?.cancel(l);for(const e of this._rangeRequestReaders.slice(0))e.cancel(l)}}r.PDFNetworkStream=i;class t{constructor(l,e){this._manager=l;const c={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=l.requestFull(c),this._headersReceivedCapability=new o.PromiseCapability,this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const l=this._fullRequestId,e=this._manager.getRequestXhr(l),c=y=>e.getResponseHeader(y),{allowRangeRequests:f,suggestedLength:n}=(0,m.validateRangeRequestCapabilities)({getResponseHeader:c,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});f&&(this._isRangeSupported=!0),this._contentLength=n||this._contentLength,this._filename=(0,m.extractFilenameFromHeader)(c),this._isRangeSupported&&this._manager.abortRequest(l),this._headersReceivedCapability.resolve()}_onDone(l){if(l&&(this._requests.length>0?this._requests.shift().resolve({value:l.chunk,done:!1}):this._cachedChunks.push(l.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(l){this._storedError=(0,m.createResponseStatusError)(l,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(l){this.onProgress?.({loaded:l.loaded,total:l.lengthComputable?l.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const l=new o.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0,this._headersReceivedCapability.reject(l);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class s{constructor(l,e,c){this._manager=l;const f={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=l.url,this._requestId=l.requestRange(e,c,f),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(l){const e=l.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const c of this._requests)c.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(l){this._storedError=(0,m.createResponseStatusError)(l,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(l){this.isStreamingSupported||this.onProgress?.({loaded:l.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const l=new o.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNodeStream=void 0;var o=F(1),m=F(20);const D=/^file:\/\/\/[a-zA-Z]:\//;function C(c){const f=require$$5,n=f.parse(c);return n.protocol==="file:"||n.host?n:/^[a-z]:[/\\]/i.test(c)?f.parse(`file:///${c}`):(n.host||(n.protocol="file:"),n)}class N{constructor(f){this.source=f,this.url=C(f.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,o.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new l(this):new s(this),this._fullRequestReader}getRangeReader(f,n){if(n<=this._progressiveDataLength)return null;const y=this.isFsUrl?new e(this,f,n):new u(this,f,n);return this._rangeRequestReaders.push(y),y}cancelAllRequests(f){this._fullRequestReader?.cancel(f);for(const n of this._rangeRequestReaders.slice(0))n.cancel(f)}}r.PDFNodeStream=N;class L{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null;const n=f.source;this._contentLength=n.length,this._loaded=0,this._filename=null,this._disableRange=n.disableRange||!1,this._rangeChunkSize=n.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!n.disableStream,this._isRangeSupported=!n.disableRange,this._readableStream=null,this._readCapability=new o.PromiseCapability,this._headersCapability=new o.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new o.PromiseCapability,this.read()):(this._loaded+=f.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",n=>{this._error(n)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new o.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class i{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new o.PromiseCapability;const n=f.source;this._isStreamingSupported=!n.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new o.PromiseCapability,this.read()):(this._loaded+=f.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",n=>{this._error(n)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function t(c,f){return{protocol:c.protocol,auth:c.auth,host:c.hostname,port:c.port,path:c.path,method:"GET",headers:f}}class s extends L{constructor(f){super(f);const n=y=>{if(y.statusCode===404){const v=new o.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=v,this._headersCapability.reject(v);return}this._headersCapability.resolve(),this._setReadableStream(y);const T=v=>this._readableStream.headers[v.toLowerCase()],{allowRangeRequests:w,suggestedLength:p}=(0,m.validateRangeRequestCapabilities)({getResponseHeader:T,isHttp:f.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=w,this._contentLength=p||this._contentLength,this._filename=(0,m.extractFilenameFromHeader)(T)};if(this._request=null,this._url.protocol==="http:"){const y=require$$5;this._request=y.request(t(this._url,f.httpHeaders),n)}else{const y=require$$5;this._request=y.request(t(this._url,f.httpHeaders),n)}this._request.on("error",y=>{this._storedError=y,this._headersCapability.reject(y)}),this._request.end()}}class u extends i{constructor(f,n,y){super(f),this._httpHeaders={};for(const w in f.httpHeaders){const p=f.httpHeaders[w];p!==void 0&&(this._httpHeaders[w]=p)}this._httpHeaders.Range=`bytes=${n}-${y-1}`;const T=w=>{if(w.statusCode===404){const p=new o.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=p;return}this._setReadableStream(w)};if(this._request=null,this._url.protocol==="http:"){const w=require$$5;this._request=w.request(t(this._url,this._httpHeaders),T)}else{const w=require$$5;this._request=w.request(t(this._url,this._httpHeaders),T)}this._request.on("error",w=>{this._storedError=w}),this._request.end()}}class l extends L{constructor(f){super(f);let n=decodeURIComponent(this._url.path);D.test(this._url.href)&&(n=n.replace(/^\//,""));const y=require$$5;y.lstat(n,(T,w)=>{if(T){T.code==="ENOENT"&&(T=new o.MissingPDFException(`Missing PDF "${n}".`)),this._storedError=T,this._headersCapability.reject(T);return}this._contentLength=w.size,this._setReadableStream(y.createReadStream(n)),this._headersCapability.resolve()})}}class e extends i{constructor(f,n,y){super(f);let T=decodeURIComponent(this._url.path);D.test(this._url.href)&&(T=T.replace(/^\//,""));const w=require$$5;this._setReadableStream(w.createReadStream(T,{start:n,end:y-1}))}}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SVGGraphics=void 0;var o=F(6),m=F(1);const D={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},C="http://www.w3.org/XML/1998/namespace",N="http://www.w3.org/1999/xlink",L=["butt","round","square"],i=["miter","round","bevel"],t=function(w,p="",v=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!v)return URL.createObjectURL(new Blob([w],{type:p}));const B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let H=`data:${p};base64,`;for(let I=0,V=w.length;I<V;I+=3){const z=w[I]&255,st=w[I+1]&255,Q=w[I+2]&255,et=z>>2,nt=(z&3)<<4|st>>4,J=I+1<V?(st&15)<<2|Q>>6:64,M=I+2<V?Q&63:64;H+=B[et]+B[nt]+B[J]+B[M]}return H},s=(function(){const w=new Uint8Array([137,80,78,71,13,10,26,10]),p=12,v=new Int32Array(256);for(let Q=0;Q<256;Q++){let et=Q;for(let nt=0;nt<8;nt++)et=et&1?3988292384^et>>1&2147483647:et>>1&2147483647;v[Q]=et}function B(Q,et,nt){let J=-1;for(let M=et;M<nt;M++){const _=(J^Q[M])&255,h=v[_];J=J>>>8^h}return J^-1}function H(Q,et,nt,J){let M=J;const _=et.length;nt[M]=_>>24&255,nt[M+1]=_>>16&255,nt[M+2]=_>>8&255,nt[M+3]=_&255,M+=4,nt[M]=Q.charCodeAt(0)&255,nt[M+1]=Q.charCodeAt(1)&255,nt[M+2]=Q.charCodeAt(2)&255,nt[M+3]=Q.charCodeAt(3)&255,M+=4,nt.set(et,M),M+=et.length;const h=B(nt,J+4,M);nt[M]=h>>24&255,nt[M+1]=h>>16&255,nt[M+2]=h>>8&255,nt[M+3]=h&255}function I(Q,et,nt){let J=1,M=0;for(let _=et;_<nt;++_)J=(J+(Q[_]&255))%65521,M=(M+J)%65521;return M<<16|J}function V(Q){if(!m.isNodeJS)return z(Q);try{const et=parseInt(process.versions.node)>=8?Q:Buffer.from(Q),nt=require$$5.deflateSync(et,{level:9});return nt instanceof Uint8Array?nt:new Uint8Array(nt)}catch(et){(0,m.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+et)}return z(Q)}function z(Q){let et=Q.length;const nt=65535,J=Math.ceil(et/nt),M=new Uint8Array(2+et+J*5+4);let _=0;M[_++]=120,M[_++]=156;let h=0;for(;et>nt;)M[_++]=0,M[_++]=255,M[_++]=255,M[_++]=0,M[_++]=0,M.set(Q.subarray(h,h+nt),_),_+=nt,h+=nt,et-=nt;M[_++]=1,M[_++]=et&255,M[_++]=et>>8&255,M[_++]=~et&65535&255,M[_++]=(~et&65535)>>8&255,M.set(Q.subarray(h),_),_+=Q.length-h;const d=I(Q,0,Q.length);return M[_++]=d>>24&255,M[_++]=d>>16&255,M[_++]=d>>8&255,M[_++]=d&255,M}function st(Q,et,nt,J){const M=Q.width,_=Q.height;let h,d,b;const P=Q.data;switch(et){case m.ImageKind.GRAYSCALE_1BPP:d=0,h=1,b=M+7>>3;break;case m.ImageKind.RGB_24BPP:d=2,h=8,b=M*3;break;case m.ImageKind.RGBA_32BPP:d=6,h=8,b=M*4;break;default:throw new Error("invalid format")}const k=new Uint8Array((1+b)*_);let R=0,S=0;for(let O=0;O<_;++O)k[R++]=0,k.set(P.subarray(S,S+b),R),S+=b,R+=b;if(et===m.ImageKind.GRAYSCALE_1BPP&&J){R=0;for(let O=0;O<_;O++){R++;for(let j=0;j<b;j++)k[R++]^=255}}const a=new Uint8Array([M>>24&255,M>>16&255,M>>8&255,M&255,_>>24&255,_>>16&255,_>>8&255,_&255,h,d,0,0,0]),g=V(k),A=w.length+p*3+a.length+g.length,E=new Uint8Array(A);let x=0;return E.set(w,x),x+=w.length,H("IHDR",a,E,x),x+=p+a.length,H("IDATA",g,E,x),x+=p+g.length,H("IEND",new Uint8Array(0),E,x),t(E,"image/png",nt)}return function(et,nt,J){const M=et.kind===void 0?m.ImageKind.GRAYSCALE_1BPP:et.kind;return st(et,M,nt,J)}})();class u{constructor(){this.fontSizeScale=1,this.fontWeight=D.fontWeight,this.fontSize=0,this.textMatrix=m.IDENTITY_MATRIX,this.fontMatrix=m.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=m.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=D.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(p,v){this.x=p,this.y=v}}function l(w){let p=[];const v=[];for(const B of w){if(B.fn==="save"){p.push({fnId:92,fn:"group",items:[]}),v.push(p),p=p.at(-1).items;continue}B.fn==="restore"?p=v.pop():p.push(B)}return p}function e(w){if(Number.isInteger(w))return w.toString();const p=w.toFixed(10);let v=p.length-1;if(p[v]!=="0")return p;do v--;while(p[v]==="0");return p.substring(0,p[v]==="."?v:v+1)}function c(w){if(w[4]===0&&w[5]===0){if(w[1]===0&&w[2]===0)return w[0]===1&&w[3]===1?"":`scale(${e(w[0])} ${e(w[3])})`;if(w[0]===w[3]&&w[1]===-w[2]){const p=Math.acos(w[0])*180/Math.PI;return`rotate(${e(p)})`}}else if(w[0]===1&&w[1]===0&&w[2]===0&&w[3]===1)return`translate(${e(w[4])} ${e(w[5])})`;return`matrix(${e(w[0])} ${e(w[1])} ${e(w[2])} ${e(w[3])} ${e(w[4])} ${e(w[5])})`}let f=0,n=0,y=0;class T{constructor(p,v,B=!1){(0,o.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new o.DOMSVGFactory,this.current=new u,this.transformMatrix=m.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=p,this.objs=v,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!B,this._operatorIdMapping=[];for(const H in m.OPS)this._operatorIdMapping[m.OPS[H]]=H}getObject(p,v=null){return typeof p=="string"?p.startsWith("g_")?this.commonObjs.get(p):this.objs.get(p):v}save(){this.transformStack.push(this.transformMatrix);const p=this.current;this.extraStack.push(p),this.current=p.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(p){this.save(),this.executeOpTree(p),this.restore()}loadDependencies(p){const v=p.fnArray,B=p.argsArray;for(let H=0,I=v.length;H<I;H++)if(v[H]===m.OPS.dependency)for(const V of B[H]){const z=V.startsWith("g_")?this.commonObjs:this.objs,st=new Promise(Q=>{z.get(V,Q)});this.current.dependencies.push(st)}return Promise.all(this.current.dependencies)}transform(p,v,B,H,I,V){const z=[p,v,B,H,I,V];this.transformMatrix=m.Util.transform(this.transformMatrix,z),this.tgrp=null}getSVG(p,v){this.viewport=v;const B=this._initialize(v);return this.loadDependencies(p).then(()=>(this.transformMatrix=m.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(p)),B))}convertOpList(p){const v=this._operatorIdMapping,B=p.argsArray,H=p.fnArray,I=[];for(let V=0,z=H.length;V<z;V++){const st=H[V];I.push({fnId:st,fn:v[st],args:B[V]})}return l(I)}executeOpTree(p){for(const v of p){const B=v.fn,H=v.fnId,I=v.args;switch(H|0){case m.OPS.beginText:this.beginText();break;case m.OPS.dependency:break;case m.OPS.setLeading:this.setLeading(I);break;case m.OPS.setLeadingMoveText:this.setLeadingMoveText(I[0],I[1]);break;case m.OPS.setFont:this.setFont(I);break;case m.OPS.showText:this.showText(I[0]);break;case m.OPS.showSpacedText:this.showText(I[0]);break;case m.OPS.endText:this.endText();break;case m.OPS.moveText:this.moveText(I[0],I[1]);break;case m.OPS.setCharSpacing:this.setCharSpacing(I[0]);break;case m.OPS.setWordSpacing:this.setWordSpacing(I[0]);break;case m.OPS.setHScale:this.setHScale(I[0]);break;case m.OPS.setTextMatrix:this.setTextMatrix(I[0],I[1],I[2],I[3],I[4],I[5]);break;case m.OPS.setTextRise:this.setTextRise(I[0]);break;case m.OPS.setTextRenderingMode:this.setTextRenderingMode(I[0]);break;case m.OPS.setLineWidth:this.setLineWidth(I[0]);break;case m.OPS.setLineJoin:this.setLineJoin(I[0]);break;case m.OPS.setLineCap:this.setLineCap(I[0]);break;case m.OPS.setMiterLimit:this.setMiterLimit(I[0]);break;case m.OPS.setFillRGBColor:this.setFillRGBColor(I[0],I[1],I[2]);break;case m.OPS.setStrokeRGBColor:this.setStrokeRGBColor(I[0],I[1],I[2]);break;case m.OPS.setStrokeColorN:this.setStrokeColorN(I);break;case m.OPS.setFillColorN:this.setFillColorN(I);break;case m.OPS.shadingFill:this.shadingFill(I[0]);break;case m.OPS.setDash:this.setDash(I[0],I[1]);break;case m.OPS.setRenderingIntent:this.setRenderingIntent(I[0]);break;case m.OPS.setFlatness:this.setFlatness(I[0]);break;case m.OPS.setGState:this.setGState(I[0]);break;case m.OPS.fill:this.fill();break;case m.OPS.eoFill:this.eoFill();break;case m.OPS.stroke:this.stroke();break;case m.OPS.fillStroke:this.fillStroke();break;case m.OPS.eoFillStroke:this.eoFillStroke();break;case m.OPS.clip:this.clip("nonzero");break;case m.OPS.eoClip:this.clip("evenodd");break;case m.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case m.OPS.paintImageXObject:this.paintImageXObject(I[0]);break;case m.OPS.paintInlineImageXObject:this.paintInlineImageXObject(I[0]);break;case m.OPS.paintImageMaskXObject:this.paintImageMaskXObject(I[0]);break;case m.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(I[0],I[1]);break;case m.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case m.OPS.closePath:this.closePath();break;case m.OPS.closeStroke:this.closeStroke();break;case m.OPS.closeFillStroke:this.closeFillStroke();break;case m.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case m.OPS.nextLine:this.nextLine();break;case m.OPS.transform:this.transform(I[0],I[1],I[2],I[3],I[4],I[5]);break;case m.OPS.constructPath:this.constructPath(I[0],I[1]);break;case m.OPS.endPath:this.endPath();break;case 92:this.group(v.items);break;default:(0,m.warn)(`Unimplemented operator ${B}`);break}}}setWordSpacing(p){this.current.wordSpacing=p}setCharSpacing(p){this.current.charSpacing=p}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(p,v,B,H,I,V){const z=this.current;z.textMatrix=z.lineMatrix=[p,v,B,H,I,V],z.textMatrixScale=Math.hypot(p,v),z.x=z.lineX=0,z.y=z.lineY=0,z.xcoords=[],z.ycoords=[],z.tspan=this.svgFactory.createElement("svg:tspan"),z.tspan.setAttributeNS(null,"font-family",z.fontFamily),z.tspan.setAttributeNS(null,"font-size",`${e(z.fontSize)}px`),z.tspan.setAttributeNS(null,"y",e(-z.y)),z.txtElement=this.svgFactory.createElement("svg:text"),z.txtElement.append(z.tspan)}beginText(){const p=this.current;p.x=p.lineX=0,p.y=p.lineY=0,p.textMatrix=m.IDENTITY_MATRIX,p.lineMatrix=m.IDENTITY_MATRIX,p.textMatrixScale=1,p.tspan=this.svgFactory.createElement("svg:tspan"),p.txtElement=this.svgFactory.createElement("svg:text"),p.txtgrp=this.svgFactory.createElement("svg:g"),p.xcoords=[],p.ycoords=[]}moveText(p,v){const B=this.current;B.x=B.lineX+=p,B.y=B.lineY+=v,B.xcoords=[],B.ycoords=[],B.tspan=this.svgFactory.createElement("svg:tspan"),B.tspan.setAttributeNS(null,"font-family",B.fontFamily),B.tspan.setAttributeNS(null,"font-size",`${e(B.fontSize)}px`),B.tspan.setAttributeNS(null,"y",e(-B.y))}showText(p){const v=this.current,B=v.font,H=v.fontSize;if(H===0)return;const I=v.fontSizeScale,V=v.charSpacing,z=v.wordSpacing,st=v.fontDirection,Q=v.textHScale*st,et=B.vertical,nt=et?1:-1,J=B.defaultVMetrics,M=H*v.fontMatrix[0];let _=0;for(const b of p){if(b===null){_+=st*z;continue}else if(typeof b=="number"){_+=nt*b*H/1e3;continue}const P=(b.isSpace?z:0)+V,k=b.fontChar;let R,S,a=b.width;if(et){let A;const E=b.vmetric||J;A=b.vmetric?E[1]:a*.5,A=-A*M;const x=E[2]*M;a=E?-E[0]:a,R=A/I,S=(_+x)/I}else R=_/I,S=0;(b.isInFont||B.missingFile)&&(v.xcoords.push(v.x+R),et&&v.ycoords.push(-v.y+S),v.tspan.textContent+=k);const g=et?a*M-P*st:a*M+P*st;_+=g}v.tspan.setAttributeNS(null,"x",v.xcoords.map(e).join(" ")),et?v.tspan.setAttributeNS(null,"y",v.ycoords.map(e).join(" ")):v.tspan.setAttributeNS(null,"y",e(-v.y)),et?v.y-=_:v.x+=_*Q,v.tspan.setAttributeNS(null,"font-family",v.fontFamily),v.tspan.setAttributeNS(null,"font-size",`${e(v.fontSize)}px`),v.fontStyle!==D.fontStyle&&v.tspan.setAttributeNS(null,"font-style",v.fontStyle),v.fontWeight!==D.fontWeight&&v.tspan.setAttributeNS(null,"font-weight",v.fontWeight);const h=v.textRenderingMode&m.TextRenderingMode.FILL_STROKE_MASK;if(h===m.TextRenderingMode.FILL||h===m.TextRenderingMode.FILL_STROKE?(v.fillColor!==D.fillColor&&v.tspan.setAttributeNS(null,"fill",v.fillColor),v.fillAlpha<1&&v.tspan.setAttributeNS(null,"fill-opacity",v.fillAlpha)):v.textRenderingMode===m.TextRenderingMode.ADD_TO_PATH?v.tspan.setAttributeNS(null,"fill","transparent"):v.tspan.setAttributeNS(null,"fill","none"),h===m.TextRenderingMode.STROKE||h===m.TextRenderingMode.FILL_STROKE){const b=1/(v.textMatrixScale||1);this._setStrokeAttributes(v.tspan,b)}let d=v.textMatrix;v.textRise!==0&&(d=d.slice(),d[5]+=v.textRise),v.txtElement.setAttributeNS(null,"transform",`${c(d)} scale(${e(Q)}, -1)`),v.txtElement.setAttributeNS(C,"xml:space","preserve"),v.txtElement.append(v.tspan),v.txtgrp.append(v.txtElement),this._ensureTransformGroup().append(v.txtElement)}setLeadingMoveText(p,v){this.setLeading(-v),this.moveText(p,v)}addFontStyle(p){if(!p.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const v=t(p.data,p.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${p.loadedName}"; src: url(${v}); }
`}setFont(p){const v=this.current,B=this.commonObjs.get(p[0]);let H=p[1];v.font=B,this.embedFonts&&!B.missingFile&&!this.embeddedFonts[B.loadedName]&&(this.addFontStyle(B),this.embeddedFonts[B.loadedName]=B),v.fontMatrix=B.fontMatrix||m.FONT_IDENTITY_MATRIX;let I="normal";B.black?I="900":B.bold&&(I="bold");const V=B.italic?"italic":"normal";H<0?(H=-H,v.fontDirection=-1):v.fontDirection=1,v.fontSize=H,v.fontFamily=B.loadedName,v.fontWeight=I,v.fontStyle=V,v.tspan=this.svgFactory.createElement("svg:tspan"),v.tspan.setAttributeNS(null,"y",e(-v.y)),v.xcoords=[],v.ycoords=[]}endText(){const p=this.current;p.textRenderingMode&m.TextRenderingMode.ADD_TO_PATH_FLAG&&p.txtElement?.hasChildNodes()&&(p.element=p.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(p){p>0&&(this.current.lineWidth=p)}setLineCap(p){this.current.lineCap=L[p]}setLineJoin(p){this.current.lineJoin=i[p]}setMiterLimit(p){this.current.miterLimit=p}setStrokeAlpha(p){this.current.strokeAlpha=p}setStrokeRGBColor(p,v,B){this.current.strokeColor=m.Util.makeHexColor(p,v,B)}setFillAlpha(p){this.current.fillAlpha=p}setFillRGBColor(p,v,B){this.current.fillColor=m.Util.makeHexColor(p,v,B),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(p){this.current.strokeColor=this._makeColorN_Pattern(p)}setFillColorN(p){this.current.fillColor=this._makeColorN_Pattern(p)}shadingFill(p){const{width:v,height:B}=this.viewport,H=m.Util.inverseTransform(this.transformMatrix),[I,V,z,st]=m.Util.getAxialAlignedBoundingBox([0,0,v,B],H),Q=this.svgFactory.createElement("svg:rect");Q.setAttributeNS(null,"x",I),Q.setAttributeNS(null,"y",V),Q.setAttributeNS(null,"width",z-I),Q.setAttributeNS(null,"height",st-V),Q.setAttributeNS(null,"fill",this._makeShadingPattern(p)),this.current.fillAlpha<1&&Q.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Q)}_makeColorN_Pattern(p){return p[0]==="TilingPattern"?this._makeTilingPattern(p):this._makeShadingPattern(p)}_makeTilingPattern(p){const v=p[1],B=p[2],H=p[3]||m.IDENTITY_MATRIX,[I,V,z,st]=p[4],Q=p[5],et=p[6],nt=p[7],J=`shading${y++}`,[M,_,h,d]=m.Util.normalizeRect([...m.Util.applyTransform([I,V],H),...m.Util.applyTransform([z,st],H)]),[b,P]=m.Util.singularValueDecompose2dScale(H),k=Q*b,R=et*P,S=this.svgFactory.createElement("svg:pattern");S.setAttributeNS(null,"id",J),S.setAttributeNS(null,"patternUnits","userSpaceOnUse"),S.setAttributeNS(null,"width",k),S.setAttributeNS(null,"height",R),S.setAttributeNS(null,"x",`${M}`),S.setAttributeNS(null,"y",`${_}`);const a=this.svg,g=this.transformMatrix,A=this.current.fillColor,E=this.current.strokeColor,x=this.svgFactory.create(h-M,d-_);if(this.svg=x,this.transformMatrix=H,nt===2){const O=m.Util.makeHexColor(...v);this.current.fillColor=O,this.current.strokeColor=O}return this.executeOpTree(this.convertOpList(B)),this.svg=a,this.transformMatrix=g,this.current.fillColor=A,this.current.strokeColor=E,S.append(x.childNodes[0]),this.defs.append(S),`url(#${J})`}_makeShadingPattern(p){switch(typeof p=="string"&&(p=this.objs.get(p)),p[0]){case"RadialAxial":const v=`shading${y++}`,B=p[3];let H;switch(p[1]){case"axial":const I=p[4],V=p[5];H=this.svgFactory.createElement("svg:linearGradient"),H.setAttributeNS(null,"id",v),H.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),H.setAttributeNS(null,"x1",I[0]),H.setAttributeNS(null,"y1",I[1]),H.setAttributeNS(null,"x2",V[0]),H.setAttributeNS(null,"y2",V[1]);break;case"radial":const z=p[4],st=p[5],Q=p[6],et=p[7];H=this.svgFactory.createElement("svg:radialGradient"),H.setAttributeNS(null,"id",v),H.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),H.setAttributeNS(null,"cx",st[0]),H.setAttributeNS(null,"cy",st[1]),H.setAttributeNS(null,"r",et),H.setAttributeNS(null,"fx",z[0]),H.setAttributeNS(null,"fy",z[1]),H.setAttributeNS(null,"fr",Q);break;default:throw new Error(`Unknown RadialAxial type: ${p[1]}`)}for(const I of B){const V=this.svgFactory.createElement("svg:stop");V.setAttributeNS(null,"offset",I[0]),V.setAttributeNS(null,"stop-color",I[1]),H.append(V)}return this.defs.append(H),`url(#${v})`;case"Mesh":return(0,m.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${p[0]}`)}}setDash(p,v){this.current.dashArray=p,this.current.dashPhase=v}constructPath(p,v){const B=this.current;let H=B.x,I=B.y,V=[],z=0;for(const st of p)switch(st|0){case m.OPS.rectangle:H=v[z++],I=v[z++];const Q=v[z++],et=v[z++],nt=H+Q,J=I+et;V.push("M",e(H),e(I),"L",e(nt),e(I),"L",e(nt),e(J),"L",e(H),e(J),"Z");break;case m.OPS.moveTo:H=v[z++],I=v[z++],V.push("M",e(H),e(I));break;case m.OPS.lineTo:H=v[z++],I=v[z++],V.push("L",e(H),e(I));break;case m.OPS.curveTo:H=v[z+4],I=v[z+5],V.push("C",e(v[z]),e(v[z+1]),e(v[z+2]),e(v[z+3]),e(H),e(I)),z+=6;break;case m.OPS.curveTo2:V.push("C",e(H),e(I),e(v[z]),e(v[z+1]),e(v[z+2]),e(v[z+3])),H=v[z+2],I=v[z+3],z+=4;break;case m.OPS.curveTo3:H=v[z+2],I=v[z+3],V.push("C",e(v[z]),e(v[z+1]),e(H),e(I),e(H),e(I)),z+=4;break;case m.OPS.closePath:V.push("Z");break}V=V.join(" "),B.path&&p.length>0&&p[0]!==m.OPS.rectangle&&p[0]!==m.OPS.moveTo?V=B.path.getAttributeNS(null,"d")+V:(B.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(B.path)),B.path.setAttributeNS(null,"d",V),B.path.setAttributeNS(null,"fill","none"),B.element=B.path,B.setCurrentPoint(H,I)}endPath(){const p=this.current;if(p.path=null,!this.pendingClip)return;if(!p.element){this.pendingClip=null;return}const v=`clippath${f++}`,B=this.svgFactory.createElement("svg:clipPath");B.setAttributeNS(null,"id",v),B.setAttributeNS(null,"transform",c(this.transformMatrix));const H=p.element.cloneNode(!0);if(this.pendingClip==="evenodd"?H.setAttributeNS(null,"clip-rule","evenodd"):H.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,B.append(H),this.defs.append(B),p.activeClipUrl){p.clipGroup=null;for(const I of this.extraStack)I.clipGroup=null;B.setAttributeNS(null,"clip-path",p.activeClipUrl)}p.activeClipUrl=`url(#${v})`,this.tgrp=null}clip(p){this.pendingClip=p}closePath(){const p=this.current;if(p.path){const v=`${p.path.getAttributeNS(null,"d")}Z`;p.path.setAttributeNS(null,"d",v)}}setLeading(p){this.current.leading=-p}setTextRise(p){this.current.textRise=p}setTextRenderingMode(p){this.current.textRenderingMode=p}setHScale(p){this.current.textHScale=p/100}setRenderingIntent(p){}setFlatness(p){}setGState(p){for(const[v,B]of p)switch(v){case"LW":this.setLineWidth(B);break;case"LC":this.setLineCap(B);break;case"LJ":this.setLineJoin(B);break;case"ML":this.setMiterLimit(B);break;case"D":this.setDash(B[0],B[1]);break;case"RI":this.setRenderingIntent(B);break;case"FL":this.setFlatness(B);break;case"Font":this.setFont(B);break;case"CA":this.setStrokeAlpha(B);break;case"ca":this.setFillAlpha(B);break;default:(0,m.warn)(`Unimplemented graphic state operator ${v}`);break}}fill(){const p=this.current;p.element&&(p.element.setAttributeNS(null,"fill",p.fillColor),p.element.setAttributeNS(null,"fill-opacity",p.fillAlpha),this.endPath())}stroke(){const p=this.current;p.element&&(this._setStrokeAttributes(p.element),p.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(p,v=1){const B=this.current;let H=B.dashArray;v!==1&&H.length>0&&(H=H.map(function(I){return v*I})),p.setAttributeNS(null,"stroke",B.strokeColor),p.setAttributeNS(null,"stroke-opacity",B.strokeAlpha),p.setAttributeNS(null,"stroke-miterlimit",e(B.miterLimit)),p.setAttributeNS(null,"stroke-linecap",B.lineCap),p.setAttributeNS(null,"stroke-linejoin",B.lineJoin),p.setAttributeNS(null,"stroke-width",e(v*B.lineWidth)+"px"),p.setAttributeNS(null,"stroke-dasharray",H.map(e).join(" ")),p.setAttributeNS(null,"stroke-dashoffset",e(v*B.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x","0"),p.setAttributeNS(null,"y","0"),p.setAttributeNS(null,"width","1px"),p.setAttributeNS(null,"height","1px"),p.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(p)}paintImageXObject(p){const v=this.getObject(p);if(!v){(0,m.warn)(`Dependent image with object ID ${p} is not ready yet`);return}this.paintInlineImageXObject(v)}paintInlineImageXObject(p,v){const B=p.width,H=p.height,I=s(p,this.forceDataSchema,!!v),V=this.svgFactory.createElement("svg:rect");V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y","0"),V.setAttributeNS(null,"width",e(B)),V.setAttributeNS(null,"height",e(H)),this.current.element=V,this.clip("nonzero");const z=this.svgFactory.createElement("svg:image");z.setAttributeNS(N,"xlink:href",I),z.setAttributeNS(null,"x","0"),z.setAttributeNS(null,"y",e(-H)),z.setAttributeNS(null,"width",e(B)+"px"),z.setAttributeNS(null,"height",e(H)+"px"),z.setAttributeNS(null,"transform",`scale(${e(1/B)} ${e(-1/H)})`),v?v.append(z):this._ensureTransformGroup().append(z)}paintImageMaskXObject(p){const v=this.getObject(p.data,p);if(v.bitmap){(0,m.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const B=this.current,H=v.width,I=v.height,V=B.fillColor;B.maskId=`mask${n++}`;const z=this.svgFactory.createElement("svg:mask");z.setAttributeNS(null,"id",B.maskId);const st=this.svgFactory.createElement("svg:rect");st.setAttributeNS(null,"x","0"),st.setAttributeNS(null,"y","0"),st.setAttributeNS(null,"width",e(H)),st.setAttributeNS(null,"height",e(I)),st.setAttributeNS(null,"fill",V),st.setAttributeNS(null,"mask",`url(#${B.maskId})`),this.defs.append(z),this._ensureTransformGroup().append(st),this.paintInlineImageXObject(v,z)}paintFormXObjectBegin(p,v){if(Array.isArray(p)&&p.length===6&&this.transform(p[0],p[1],p[2],p[3],p[4],p[5]),v){const B=v[2]-v[0],H=v[3]-v[1],I=this.svgFactory.createElement("svg:rect");I.setAttributeNS(null,"x",v[0]),I.setAttributeNS(null,"y",v[1]),I.setAttributeNS(null,"width",e(B)),I.setAttributeNS(null,"height",e(H)),this.current.element=I,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(p){const v=this.svgFactory.create(p.width,p.height),B=this.svgFactory.createElement("svg:defs");v.append(B),this.defs=B;const H=this.svgFactory.createElement("svg:g");return H.setAttributeNS(null,"transform",c(p.transform)),v.append(H),this.svg=H,v}_ensureClipGroup(){if(!this.current.clipGroup){const p=this.svgFactory.createElement("svg:g");p.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(p),this.current.clipGroup=p}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",c(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}r.SVGGraphics=T}),((U,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaText=void 0;class F{static textContent(m){const D=[],C={items:D,styles:Object.create(null)};function N(L){if(!L)return;let i=null;const t=L.name;if(t==="#text")i=L.value;else if(F.shouldBuildText(t))L?.attributes?.textContent?i=L.attributes.textContent:L.value&&(i=L.value);else return;if(i!==null&&D.push({str:i}),!!L.children)for(const s of L.children)N(s)}return N(m),C}static shouldBuildText(m){return!(m==="textarea"||m==="input"||m==="option"||m==="select")}}r.XfaText=F}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TextLayerRenderTask=void 0,r.renderTextLayer=c,r.updateTextLayer=f;var o=F(1),m=F(6);const D=1e5,C=30,N=.8,L=new Map;function i(n,y){let T;if(y&&o.FeatureTest.isOffscreenCanvasSupported)T=new OffscreenCanvas(n,n).getContext("2d",{alpha:!1});else{const w=document.createElement("canvas");w.width=w.height=n,T=w.getContext("2d",{alpha:!1})}return T}function t(n,y){const T=L.get(n);if(T)return T;const w=i(C,y);w.font=`${C}px ${n}`;const p=w.measureText("");let v=p.fontBoundingBoxAscent,B=Math.abs(p.fontBoundingBoxDescent);if(v){const I=v/(v+B);return L.set(n,I),w.canvas.width=w.canvas.height=0,I}w.strokeStyle="red",w.clearRect(0,0,C,C),w.strokeText("g",0,0);let H=w.getImageData(0,0,C,C).data;B=0;for(let I=H.length-1-3;I>=0;I-=4)if(H[I]>0){B=Math.ceil(I/4/C);break}w.clearRect(0,0,C,C),w.strokeText("A",0,C),H=w.getImageData(0,0,C,C).data,v=0;for(let I=0,V=H.length;I<V;I+=4)if(H[I]>0){v=C-Math.floor(I/4/C);break}if(w.canvas.width=w.canvas.height=0,v){const I=v/(v+B);return L.set(n,I),I}return L.set(n,N),N}function s(n,y,T){const w=document.createElement("span"),p={angle:0,canvasWidth:0,hasText:y.str!=="",hasEOL:y.hasEOL,fontSize:0};n._textDivs.push(w);const v=o.Util.transform(n._transform,y.transform);let B=Math.atan2(v[1],v[0]);const H=T[y.fontName];H.vertical&&(B+=Math.PI/2);const I=Math.hypot(v[2],v[3]),V=I*t(H.fontFamily,n._isOffscreenCanvasSupported);let z,st;B===0?(z=v[4],st=v[5]-V):(z=v[4]+V*Math.sin(B),st=v[5]-V*Math.cos(B));const Q="calc(var(--scale-factor)*",et=w.style;n._container===n._rootContainer?(et.left=`${(100*z/n._pageWidth).toFixed(2)}%`,et.top=`${(100*st/n._pageHeight).toFixed(2)}%`):(et.left=`${Q}${z.toFixed(2)}px)`,et.top=`${Q}${st.toFixed(2)}px)`),et.fontSize=`${Q}${I.toFixed(2)}px)`,et.fontFamily=H.fontFamily,p.fontSize=I,w.setAttribute("role","presentation"),w.textContent=y.str,w.dir=y.dir,n._fontInspectorEnabled&&(w.dataset.fontName=y.fontName),B!==0&&(p.angle=B*(180/Math.PI));let nt=!1;if(y.str.length>1)nt=!0;else if(y.str!==" "&&y.transform[0]!==y.transform[3]){const J=Math.abs(y.transform[0]),M=Math.abs(y.transform[3]);J!==M&&Math.max(J,M)/Math.min(J,M)>1.5&&(nt=!0)}nt&&(p.canvasWidth=H.vertical?y.height:y.width),n._textDivProperties.set(w,p),n._isReadableStream&&n._layoutText(w)}function u(n){const{div:y,scale:T,properties:w,ctx:p,prevFontSize:v,prevFontFamily:B}=n,{style:H}=y;let I="";if(w.canvasWidth!==0&&w.hasText){const{fontFamily:V}=H,{canvasWidth:z,fontSize:st}=w;(v!==st||B!==V)&&(p.font=`${st*T}px ${V}`,n.prevFontSize=st,n.prevFontFamily=V);const{width:Q}=p.measureText(y.textContent);Q>0&&(I=`scaleX(${z*T/Q})`)}w.angle!==0&&(I=`rotate(${w.angle}deg) ${I}`),I.length>0&&(H.transform=I)}function l(n){if(n._canceled)return;const y=n._textDivs,T=n._capability;if(y.length>D){T.resolve();return}if(!n._isReadableStream)for(const p of y)n._layoutText(p);T.resolve()}class e{constructor({textContentSource:y,container:T,viewport:w,textDivs:p,textDivProperties:v,textContentItemsStr:B,isOffscreenCanvasSupported:H}){this._textContentSource=y,this._isReadableStream=y instanceof ReadableStream,this._container=this._rootContainer=T,this._textDivs=p||[],this._textContentItemsStr=B||[],this._isOffscreenCanvasSupported=H,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=v||new WeakMap,this._canceled=!1,this._capability=new o.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:w.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:i(0,H)};const{pageWidth:I,pageHeight:V,pageX:z,pageY:st}=w.rawDims;this._transform=[1,0,0,-1,-z,st+V],this._pageWidth=I,this._pageHeight=V,(0,m.setLayerDimensions)(T,w),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new o.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new o.AbortException("TextLayer task cancelled."))}_processItems(y,T){for(const w of y){if(w.str===void 0){if(w.type==="beginMarkedContentProps"||w.type==="beginMarkedContent"){const p=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),w.id!==null&&this._container.setAttribute("id",`${w.id}`),p.append(this._container)}else w.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(w.str),s(this,w,T)}}_layoutText(y){const T=this._layoutTextParams.properties=this._textDivProperties.get(y);if(this._layoutTextParams.div=y,u(this._layoutTextParams),T.hasText&&this._container.append(y),T.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),this._container.append(w)}}_render(){const y=new o.PromiseCapability;let T=Object.create(null);if(this._isReadableStream){const w=()=>{this._reader.read().then(({value:p,done:v})=>{if(v){y.resolve();return}Object.assign(T,p.styles),this._processItems(p.items,T),w()},y.reject)};this._reader=this._textContentSource.getReader(),w()}else if(this._textContentSource){const{items:w,styles:p}=this._textContentSource;this._processItems(w,p),y.resolve()}else throw new Error('No "textContentSource" parameter specified.');y.promise.then(()=>{T=null,l(this)},this._capability.reject)}}r.TextLayerRenderTask=e;function c(n){!n.textContentSource&&(n.textContent||n.textContentStream)&&((0,m.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),n.textContentSource=n.textContent||n.textContentStream);const{container:y,viewport:T}=n,w=getComputedStyle(y),p=w.getPropertyValue("visibility"),v=parseFloat(w.getPropertyValue("--scale-factor"));p==="visible"&&(!v||Math.abs(v-T.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const B=new e(n);return B._render(),B}function f({container:n,viewport:y,textDivs:T,textDivProperties:w,isOffscreenCanvasSupported:p,mustRotate:v=!0,mustRescale:B=!0}){if(v&&(0,m.setLayerDimensions)(n,{rotation:y.rotation}),B){const H=i(0,p),V={prevFontSize:null,prevFontFamily:null,div:null,scale:y.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:H};for(const z of T)V.properties=w.get(z),V.div=z,u(V)}}}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditorLayer=void 0;var o=F(1),m=F(4),D=F(28),C=F(33),N=F(6),L=F(34);class i{#t;#e=!1;#s=null;#i=this.pointerup.bind(this);#o=this.pointerdown.bind(this);#a=new Map;#r=!1;#l=!1;#c=!1;#n;static _initialized=!1;constructor({uiManager:s,pageIndex:u,div:l,accessibilityManager:e,annotationLayer:c,viewport:f,l10n:n}){const y=[D.FreeTextEditor,C.InkEditor,L.StampEditor];if(!i._initialized){i._initialized=!0;for(const T of y)T.initialize(n)}s.registerEditorTypes(y),this.#n=s,this.pageIndex=u,this.div=l,this.#t=e,this.#s=c,this.viewport=f,this.#n.addLayer(this)}get isEmpty(){return this.#a.size===0}updateToolbar(s){this.#n.updateToolbar(s)}updateMode(s=this.#n.getMode()){this.#p(),s===o.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),s!==o.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",s===o.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",s===o.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",s===o.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(s){if(!s&&this.#n.getMode()!==o.AnnotationEditorType.INK)return;if(!s){for(const l of this.#a.values())if(l.isEmpty()){l.setInBackground();return}}this.#d({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(s){this.#n.setEditingState(s)}addCommands(s){this.#n.addCommands(s)}enable(){this.div.style.pointerEvents="auto";const s=new Set;for(const l of this.#a.values())l.enableEditing(),l.annotationElementId&&s.add(l.annotationElementId);if(!this.#s)return;const u=this.#s.getEditableAnnotations();for(const l of u){if(l.hide(),this.#n.isDeletedAnnotationElement(l.data.id)||s.has(l.data.id))continue;const e=this.deserialize(l);e&&(this.addOrRebuild(e),e.enableEditing())}}disable(){this.#c=!0,this.div.style.pointerEvents="none";const s=new Set;for(const u of this.#a.values()){if(u.disableEditing(),!u.annotationElementId||u.serialize()!==null){s.add(u.annotationElementId);continue}this.getEditableAnnotation(u.annotationElementId)?.show(),u.remove()}if(this.#s){const u=this.#s.getEditableAnnotations();for(const l of u){const{id:e}=l.data;s.has(e)||this.#n.isDeletedAnnotationElement(e)||l.show()}}this.#p(),this.isEmpty&&(this.div.hidden=!0),this.#c=!1}getEditableAnnotation(s){return this.#s?.getEditableAnnotation(s)||null}setActiveEditor(s){this.#n.getActive()!==s&&this.#n.setActiveEditor(s)}enableClick(){this.div.addEventListener("pointerdown",this.#o),this.div.addEventListener("pointerup",this.#i)}disableClick(){this.div.removeEventListener("pointerdown",this.#o),this.div.removeEventListener("pointerup",this.#i)}attach(s){this.#a.set(s.id,s);const{annotationElementId:u}=s;u&&this.#n.isDeletedAnnotationElement(u)&&this.#n.removeDeletedAnnotationElement(s)}detach(s){this.#a.delete(s.id),this.#t?.removePointerInTextLayer(s.contentDiv),!this.#c&&s.annotationElementId&&this.#n.addDeletedAnnotationElement(s)}remove(s){this.detach(s),this.#n.removeEditor(s),s.div.contains(document.activeElement)&&setTimeout(()=>{this.#n.focusMainContainer()},0),s.div.remove(),s.isAttachedToDOM=!1,this.#l||this.addInkEditorIfNeeded(!1)}changeParent(s){s.parent!==this&&(s.annotationElementId&&(this.#n.addDeletedAnnotationElement(s.annotationElementId),m.AnnotationEditor.deleteAnnotationElement(s),s.annotationElementId=null),this.attach(s),s.parent?.detach(s),s.setParent(this),s.div&&s.isAttachedToDOM&&(s.div.remove(),this.div.append(s.div)))}add(s){if(this.changeParent(s),this.#n.addEditor(s),this.attach(s),!s.isAttachedToDOM){const u=s.render();this.div.append(u),s.isAttachedToDOM=!0}s.fixAndSetPosition(),s.onceAdded(),this.#n.addToAnnotationStorage(s)}moveEditorInDOM(s){if(!s.isAttachedToDOM)return;const{activeElement:u}=document;s.div.contains(u)&&(s._focusEventsAllowed=!1,setTimeout(()=>{s.div.contains(document.activeElement)?s._focusEventsAllowed=!0:(s.div.addEventListener("focusin",()=>{s._focusEventsAllowed=!0},{once:!0}),u.focus())},0)),s._structTreeParentId=this.#t?.moveElementInDOM(this.div,s.div,s.contentDiv,!0)}addOrRebuild(s){s.needsToBeRebuilt()?s.rebuild():this.add(s)}addUndoableEditor(s){const u=()=>s._uiManager.rebuild(s),l=()=>{s.remove()};this.addCommands({cmd:u,undo:l,mustExec:!1})}getNextId(){return this.#n.getId()}#f(s){switch(this.#n.getMode()){case o.AnnotationEditorType.FREETEXT:return new D.FreeTextEditor(s);case o.AnnotationEditorType.INK:return new C.InkEditor(s);case o.AnnotationEditorType.STAMP:return new L.StampEditor(s)}return null}pasteEditor(s,u){this.#n.updateToolbar(s),this.#n.updateMode(s);const{offsetX:l,offsetY:e}=this.#u(),c=this.getNextId(),f=this.#f({parent:this,id:c,x:l,y:e,uiManager:this.#n,isCentered:!0,...u});f&&this.add(f)}deserialize(s){switch(s.annotationType??s.annotationEditorType){case o.AnnotationEditorType.FREETEXT:return D.FreeTextEditor.deserialize(s,this,this.#n);case o.AnnotationEditorType.INK:return C.InkEditor.deserialize(s,this,this.#n);case o.AnnotationEditorType.STAMP:return L.StampEditor.deserialize(s,this,this.#n)}return null}#d(s,u){const l=this.getNextId(),e=this.#f({parent:this,id:l,x:s.offsetX,y:s.offsetY,uiManager:this.#n,isCentered:u});return e&&this.add(e),e}#u(){const{x:s,y:u,width:l,height:e}=this.div.getBoundingClientRect(),c=Math.max(0,s),f=Math.max(0,u),n=Math.min(window.innerWidth,s+l),y=Math.min(window.innerHeight,u+e),T=(c+n)/2-s,w=(f+y)/2-u,[p,v]=this.viewport.rotation%180===0?[T,w]:[w,T];return{offsetX:p,offsetY:v}}addNewEditor(){this.#d(this.#u(),!0)}setSelected(s){this.#n.setSelected(s)}toggleSelected(s){this.#n.toggleSelected(s)}isSelected(s){return this.#n.isSelected(s)}unselect(s){this.#n.unselect(s)}pointerup(s){const{isMac:u}=o.FeatureTest.platform;if(!(s.button!==0||s.ctrlKey&&u)&&s.target===this.div&&this.#r){if(this.#r=!1,!this.#e){this.#e=!0;return}if(this.#n.getMode()===o.AnnotationEditorType.STAMP){this.#n.unselectAll();return}this.#d(s,!1)}}pointerdown(s){if(this.#r){this.#r=!1;return}const{isMac:u}=o.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&u||s.target!==this.div)return;this.#r=!0;const l=this.#n.getActive();this.#e=!l||l.isEmpty()}findNewParent(s,u,l){const e=this.#n.findParent(u,l);return e===null||e===this?!1:(e.changeParent(s),!0)}destroy(){this.#n.getActive()?.parent===this&&(this.#n.commitOrRemove(),this.#n.setActiveEditor(null));for(const s of this.#a.values())this.#t?.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,this.#a.clear(),this.#n.removeLayer(this)}#p(){this.#l=!0;for(const s of this.#a.values())s.isEmpty()&&s.remove();this.#l=!1}render({viewport:s}){this.viewport=s,(0,N.setLayerDimensions)(this.div,s);for(const u of this.#n.getEditors(this.pageIndex))this.add(u);this.updateMode()}update({viewport:s}){this.#n.commitOrRemove(),this.viewport=s,(0,N.setLayerDimensions)(this.div,{rotation:s.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:s,pageHeight:u}=this.viewport.rawDims;return[s,u]}}r.AnnotationEditorLayer=i}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.FreeTextEditor=void 0;var o=F(1),m=F(5),D=F(4),C=F(29);class N extends D.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#s=this.editorDivInput.bind(this);#i=this.editorDivKeydown.bind(this);#o;#a="";#r=`${this.id}-editor`;#l;#c=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const i=N.prototype,t=l=>l.isEmpty(),s=m.AnnotationEditorUIManager.TRANSLATE_SMALL,u=m.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,o.shadow)(this,"_keyboardManager",new m.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],i.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],i.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],i._translateEmpty,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],i._translateEmpty,{args:[-u,0],checker:t}],[["ArrowRight","mac+ArrowRight"],i._translateEmpty,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],i._translateEmpty,{args:[u,0],checker:t}],[["ArrowUp","mac+ArrowUp"],i._translateEmpty,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],i._translateEmpty,{args:[0,-u],checker:t}],[["ArrowDown","mac+ArrowDown"],i._translateEmpty,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],i._translateEmpty,{args:[0,u],checker:t}]]))}static _type="freetext";constructor(i){super({...i,name:"freeTextEditor"}),this.#o=i.color||N._defaultColor||D.AnnotationEditor._defaultLineColor,this.#l=i.fontSize||N._defaultFontSize}static initialize(i){D.AnnotationEditor.initialize(i,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(i,t){switch(i){case o.AnnotationEditorParamsType.FREETEXT_SIZE:N._defaultFontSize=t;break;case o.AnnotationEditorParamsType.FREETEXT_COLOR:N._defaultColor=t;break}}updateParams(i,t){switch(i){case o.AnnotationEditorParamsType.FREETEXT_SIZE:this.#n(t);break;case o.AnnotationEditorParamsType.FREETEXT_COLOR:this.#f(t);break}}static get defaultPropertiesToUpdate(){return[[o.AnnotationEditorParamsType.FREETEXT_SIZE,N._defaultFontSize],[o.AnnotationEditorParamsType.FREETEXT_COLOR,N._defaultColor||D.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[o.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[o.AnnotationEditorParamsType.FREETEXT_COLOR,this.#o]]}#n(i){const t=u=>{this.editorDiv.style.fontSize=`calc(${u}px * var(--scale-factor))`,this.translate(0,-(u-this.#l)*this.parentScale),this.#l=u,this.#u()},s=this.#l;this.addCommands({cmd:()=>{t(i)},undo:()=>{t(s)},mustExec:!0,type:o.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#f(i){const t=this.#o;this.addCommands({cmd:()=>{this.#o=this.editorDiv.style.color=i},undo:()=>{this.#o=this.editorDiv.style.color=t},mustExec:!0,type:o.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(i,t){this._uiManager.translateSelectedEditors(i,t,!0)}getInitialTranslation(){const i=this.parentScale;return[-N._internalPadding*i,-(N._internalPadding+this.#l)*i]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(o.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#i),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#s))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#r),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#i),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#s),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(i){this._focusEventsAllowed&&(super.focusin(i),i.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#m();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}#d(){const i=this.editorDiv.getElementsByTagName("div");if(i.length===0)return this.editorDiv.innerText;const t=[];for(const s of i)t.push(s.innerText.replace(/\r\n?|\n/,""));return t.join(`
`)}#u(){const[i,t]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:u,div:l}=this,e=l.style.display;l.style.display="hidden",u.div.append(this.div),s=l.getBoundingClientRect(),l.remove(),l.style.display=e}this.rotation%180===this.parentRotation%180?(this.width=s.width/i,this.height=s.height/t):(this.width=s.height/i,this.height=s.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const i=this.#a,t=this.#a=this.#d().trimEnd();if(i===t)return;const s=u=>{if(this.#a=u,!u){this.remove();return}this.#p(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{s(t)},undo:()=>{s(i)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(i){this.enterInEditMode()}keydown(i){i.target===this.div&&i.key==="Enter"&&(this.enterInEditMode(),i.preventDefault())}editorDivKeydown(i){N._keyboardManager.exec(this,i)}editorDivFocus(i){this.isEditing=!0}editorDivBlur(i){this.isEditing=!1}editorDivInput(i){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let i,t;this.width&&(i=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#r),this.enableEditing(),D.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(u=>this.editorDiv?.setAttribute("aria-label",u)),D.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(u=>this.editorDiv?.setAttribute("default-content",u)),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#l}px * var(--scale-factor))`,s.color=this.#o,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,m.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[u,l]=this.parentDimensions;if(this.annotationElementId){const{position:e}=this.#c;let[c,f]=this.getInitialTranslation();[c,f]=this.pageTranslationToScreen(c,f);const[n,y]=this.pageDimensions,[T,w]=this.pageTranslation;let p,v;switch(this.rotation){case 0:p=i+(e[0]-T)/n,v=t+this.height-(e[1]-w)/y;break;case 90:p=i+(e[0]-T)/n,v=t-(e[1]-w)/y,[c,f]=[f,-c];break;case 180:p=i-this.width+(e[0]-T)/n,v=t-(e[1]-w)/y,[c,f]=[-c,-f];break;case 270:p=i+(e[0]-T-this.height*y)/n,v=t+(e[1]-w-this.width*n)/y,[c,f]=[-f,c];break}this.setAt(p*u,v*l,c,f)}else this.setAt(i*u,t*l,this.width*u,this.height*l);this.#p(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#p(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const i of this.#a.split(`
`)){const t=document.createElement("div");t.append(i?document.createTextNode(i):document.createElement("br")),this.editorDiv.append(t)}}get contentDiv(){return this.editorDiv}static deserialize(i,t,s){let u=null;if(i instanceof C.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:e,fontColor:c},rect:f,rotation:n,id:y},textContent:T,textPosition:w,parent:{page:{pageNumber:p}}}=i;if(!T||T.length===0)return null;u=i={annotationType:o.AnnotationEditorType.FREETEXT,color:Array.from(c),fontSize:e,value:T.join(`
`),position:w,pageIndex:p-1,rect:f,rotation:n,id:y,deleted:!1}}const l=super.deserialize(i,t,s);return l.#l=i.fontSize,l.#o=o.Util.makeHexColor(...i.color),l.#a=i.value,l.annotationElementId=i.id||null,l.#c=u,l}serialize(i=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const t=N._internalPadding*this.parentScale,s=this.getRect(t,t),u=D.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#o),l={annotationType:o.AnnotationEditorType.FREETEXT,color:u,fontSize:this.#l,value:this.#a,pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return i?l:this.annotationElementId&&!this.#_(l)?null:(l.id=this.annotationElementId,l)}#_(i){const{value:t,fontSize:s,color:u,rect:l,pageIndex:e}=this.#c;return i.value!==t||i.fontSize!==s||i.rect.some((c,f)=>Math.abs(c-l[f])>=1)||i.color.some((c,f)=>c!==u[f])||i.pageIndex!==e}#m(i=!1){if(!this.annotationElementId)return;if(this.#u(),!i&&(this.width===0||this.height===0)){setTimeout(()=>this.#m(!0),0);return}const t=N._internalPadding*this.parentScale;this.#c.rect=this.getRect(t,t)}}r.FreeTextEditor=N}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.StampAnnotationElement=r.InkAnnotationElement=r.FreeTextAnnotationElement=r.AnnotationLayer=void 0;var o=F(1),m=F(6),D=F(3),C=F(30),N=F(31),L=F(32);const i=1e3,t=9,s=new WeakSet;function u(S){return{width:S[2]-S[0],height:S[3]-S[1]}}class l{static create(a){switch(a.data.annotationType){case o.AnnotationType.LINK:return new c(a);case o.AnnotationType.TEXT:return new f(a);case o.AnnotationType.WIDGET:switch(a.data.fieldType){case"Tx":return new y(a);case"Btn":return a.data.radioButton?new p(a):a.data.checkBox?new w(a):new v(a);case"Ch":return new B(a);case"Sig":return new T(a)}return new n(a);case o.AnnotationType.POPUP:return new H(a);case o.AnnotationType.FREETEXT:return new V(a);case o.AnnotationType.LINE:return new z(a);case o.AnnotationType.SQUARE:return new st(a);case o.AnnotationType.CIRCLE:return new Q(a);case o.AnnotationType.POLYLINE:return new et(a);case o.AnnotationType.CARET:return new J(a);case o.AnnotationType.INK:return new M(a);case o.AnnotationType.POLYGON:return new nt(a);case o.AnnotationType.HIGHLIGHT:return new _(a);case o.AnnotationType.UNDERLINE:return new h(a);case o.AnnotationType.SQUIGGLY:return new d(a);case o.AnnotationType.STRIKEOUT:return new b(a);case o.AnnotationType.STAMP:return new P(a);case o.AnnotationType.FILEATTACHMENT:return new k(a);default:return new e(a)}}}class e{#t=!1;constructor(a,{isRenderable:g=!1,ignoreBorder:A=!1,createQuadrilaterals:E=!1}={}){this.isRenderable=g,this.data=a.data,this.layer=a.layer,this.linkService=a.linkService,this.downloadManager=a.downloadManager,this.imageResourcesPath=a.imageResourcesPath,this.renderForms=a.renderForms,this.svgFactory=a.svgFactory,this.annotationStorage=a.annotationStorage,this.enableScripting=a.enableScripting,this.hasJSActions=a.hasJSActions,this._fieldObjects=a.fieldObjects,this.parent=a.parent,g&&(this.container=this._createContainer(A)),E&&this._createQuadrilaterals()}static _hasPopupData({titleObj:a,contentsObj:g,richText:A}){return!!(a?.str||g?.str||A?.str)}get hasPopupData(){return e._hasPopupData(this.data)}_createContainer(a){const{data:g,parent:{page:A,viewport:E}}=this,x=document.createElement("section");x.setAttribute("data-annotation-id",g.id),this instanceof n||(x.tabIndex=i),x.style.zIndex=this.parent.zIndex++,this.data.popupRef&&x.setAttribute("aria-haspopup","dialog"),g.noRotate&&x.classList.add("norotate");const{pageWidth:O,pageHeight:j,pageX:X,pageY:it}=E.rawDims;if(!g.rect||this instanceof H){const{rotation:Z}=g;return!g.hasOwnCanvas&&Z!==0&&this.setRotation(Z,x),x}const{width:q,height:Y}=u(g.rect),K=o.Util.normalizeRect([g.rect[0],A.view[3]-g.rect[1]+A.view[1],g.rect[2],A.view[3]-g.rect[3]+A.view[1]]);if(!a&&g.borderStyle.width>0){x.style.borderWidth=`${g.borderStyle.width}px`;const Z=g.borderStyle.horizontalCornerRadius,rt=g.borderStyle.verticalCornerRadius;if(Z>0||rt>0){const lt=`calc(${Z}px * var(--scale-factor)) / calc(${rt}px * var(--scale-factor))`;x.style.borderRadius=lt}else if(this instanceof p){const lt=`calc(${q}px * var(--scale-factor)) / calc(${Y}px * var(--scale-factor))`;x.style.borderRadius=lt}switch(g.borderStyle.style){case o.AnnotationBorderStyleType.SOLID:x.style.borderStyle="solid";break;case o.AnnotationBorderStyleType.DASHED:x.style.borderStyle="dashed";break;case o.AnnotationBorderStyleType.BEVELED:(0,o.warn)("Unimplemented border style: beveled");break;case o.AnnotationBorderStyleType.INSET:(0,o.warn)("Unimplemented border style: inset");break;case o.AnnotationBorderStyleType.UNDERLINE:x.style.borderBottomStyle="solid";break}const ot=g.borderColor||null;ot?(this.#t=!0,x.style.borderColor=o.Util.makeHexColor(ot[0]|0,ot[1]|0,ot[2]|0)):x.style.borderWidth=0}x.style.left=`${100*(K[0]-X)/O}%`,x.style.top=`${100*(K[1]-it)/j}%`;const{rotation:$}=g;return g.hasOwnCanvas||$===0?(x.style.width=`${100*q/O}%`,x.style.height=`${100*Y/j}%`):this.setRotation($,x),x}setRotation(a,g=this.container){if(!this.data.rect)return;const{pageWidth:A,pageHeight:E}=this.parent.viewport.rawDims,{width:x,height:O}=u(this.data.rect);let j,X;a%180===0?(j=100*x/A,X=100*O/E):(j=100*O/A,X=100*x/E),g.style.width=`${j}%`,g.style.height=`${X}%`,g.setAttribute("data-main-rotation",(360-a)%360)}get _commonActions(){const a=(g,A,E)=>{const x=E.detail[g],O=x[0],j=x.slice(1);E.target.style[A]=C.ColorConverters[`${O}_HTML`](j),this.annotationStorage.setValue(this.data.id,{[A]:C.ColorConverters[`${O}_rgb`](j)})};return(0,o.shadow)(this,"_commonActions",{display:g=>{const{display:A}=g.detail,E=A%2===1;this.container.style.visibility=E?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:E,noPrint:A===1||A===2})},print:g=>{this.annotationStorage.setValue(this.data.id,{noPrint:!g.detail.print})},hidden:g=>{const{hidden:A}=g.detail;this.container.style.visibility=A?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:A,noView:A})},focus:g=>{setTimeout(()=>g.target.focus({preventScroll:!1}),0)},userName:g=>{g.target.title=g.detail.userName},readonly:g=>{g.target.disabled=g.detail.readonly},required:g=>{this._setRequired(g.target,g.detail.required)},bgColor:g=>{a("bgColor","backgroundColor",g)},fillColor:g=>{a("fillColor","backgroundColor",g)},fgColor:g=>{a("fgColor","color",g)},textColor:g=>{a("textColor","color",g)},borderColor:g=>{a("borderColor","borderColor",g)},strokeColor:g=>{a("strokeColor","borderColor",g)},rotation:g=>{const A=g.detail.rotation;this.setRotation(A),this.annotationStorage.setValue(this.data.id,{rotation:A})}})}_dispatchEventFromSandbox(a,g){const A=this._commonActions;for(const E of Object.keys(g.detail))(a[E]||A[E])?.(g)}_setDefaultPropertiesFromJS(a){if(!this.enableScripting)return;const g=this.annotationStorage.getRawValue(this.data.id);if(!g)return;const A=this._commonActions;for(const[E,x]of Object.entries(g)){const O=A[E];if(O){const j={detail:{[E]:x},target:a};O(j),delete g[E]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:a}=this.data;if(!a)return;const[g,A,E,x]=this.data.rect;if(a.length===1){const[,{x:rt,y:ot},{x:lt,y:ct}]=a[0];if(E===rt&&x===ot&&g===lt&&A===ct)return}const{style:O}=this.container;let j;if(this.#t){const{borderColor:rt,borderWidth:ot}=O;O.borderWidth=0,j=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${rt}" stroke-width="${ot}">`],this.container.classList.add("hasBorder")}const X=E-g,it=x-A,{svgFactory:q}=this,Y=q.createElement("svg");Y.classList.add("quadrilateralsContainer"),Y.setAttribute("width",0),Y.setAttribute("height",0);const K=q.createElement("defs");Y.append(K);const $=q.createElement("clipPath"),Z=`clippath_${this.data.id}`;$.setAttribute("id",Z),$.setAttribute("clipPathUnits","objectBoundingBox"),K.append($);for(const[,{x:rt,y:ot},{x:lt,y:ct}]of a){const ht=q.createElement("rect"),ut=(lt-g)/X,At=(x-ot)/it,mt=(rt-lt)/X,wt=(ot-ct)/it;ht.setAttribute("x",ut),ht.setAttribute("y",At),ht.setAttribute("width",mt),ht.setAttribute("height",wt),$.append(ht),j?.push(`<rect vector-effect="non-scaling-stroke" x="${ut}" y="${At}" width="${mt}" height="${wt}"/>`)}this.#t&&(j.push("</g></svg>')"),O.backgroundImage=j.join("")),this.container.append(Y),this.container.style.clipPath=`url(#${Z})`}_createPopup(){const{container:a,data:g}=this;a.setAttribute("aria-haspopup","dialog");const A=new H({data:{color:g.color,titleObj:g.titleObj,modificationDate:g.modificationDate,contentsObj:g.contentsObj,richText:g.richText,parentRect:g.rect,borderStyle:0,id:`popup_${g.id}`,rotation:g.rotation},parent:this.parent,elements:[this]});this.parent.div.append(A.render())}render(){(0,o.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(a,g=null){const A=[];if(this._fieldObjects){const E=this._fieldObjects[a];if(E)for(const{page:x,id:O,exportValues:j}of E){if(x===-1||O===g)continue;const X=typeof j=="string"?j:null,it=document.querySelector(`[data-element-id="${O}"]`);if(it&&!s.has(it)){(0,o.warn)(`_getElementsByName - element not allowed: ${O}`);continue}A.push({id:O,exportValue:X,domElement:it})}return A}for(const E of document.getElementsByName(a)){const{exportValue:x}=E,O=E.getAttribute("data-element-id");O!==g&&s.has(E)&&A.push({id:O,exportValue:x,domElement:E})}return A}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const a=this.getElementsToTriggerPopup();if(Array.isArray(a))for(const g of a)g.classList.add("highlightArea");else a.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:a,data:{id:g}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:a,editId:g})})}}class c extends e{constructor(a,g=null){super(a,{isRenderable:!0,ignoreBorder:!!g?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=a.data.isTooltipOnly}render(){const{data:a,linkService:g}=this,A=document.createElement("a");A.setAttribute("data-element-id",a.id);let E=!1;return a.url?(g.addLinkAttributes(A,a.url,a.newWindow),E=!0):a.action?(this._bindNamedAction(A,a.action),E=!0):a.attachment?(this._bindAttachment(A,a.attachment),E=!0):a.setOCGState?(this.#e(A,a.setOCGState),E=!0):a.dest?(this._bindLink(A,a.dest),E=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(A,a),E=!0),a.resetForm?(this._bindResetFormAction(A,a.resetForm),E=!0):this.isTooltipOnly&&!E&&(this._bindLink(A,""),E=!0)),this.container.classList.add("linkAnnotation"),E&&this.container.append(A),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(a,g){a.href=this.linkService.getDestinationHash(g),a.onclick=()=>(g&&this.linkService.goToDestination(g),!1),(g||g==="")&&this.#t()}_bindNamedAction(a,g){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(g),!1),this.#t()}_bindAttachment(a,g){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,g.content,g.filename),!1),this.#t()}#e(a,g){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeSetOCGState(g),!1),this.#t()}_bindJSAction(a,g){a.href=this.linkService.getAnchorUrl("");const A=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const E of Object.keys(g.actions)){const x=A.get(E);x&&(a[x]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g.id,name:E}}),!1))}a.onclick||(a.onclick=()=>!1),this.#t()}_bindResetFormAction(a,g){const A=a.onclick;if(A||(a.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,o.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),A||(a.onclick=()=>!1);return}a.onclick=()=>{A?.();const{fields:E,refs:x,include:O}=g,j=[];if(E.length!==0||x.length!==0){const q=new Set(x);for(const Y of E){const K=this._fieldObjects[Y]||[];for(const{id:$}of K)q.add($)}for(const Y of Object.values(this._fieldObjects))for(const K of Y)q.has(K.id)===O&&j.push(K)}else for(const q of Object.values(this._fieldObjects))j.push(...q);const X=this.annotationStorage,it=[];for(const q of j){const{id:Y}=q;switch(it.push(Y),q.type){case"text":{const $=q.defaultValue||"";X.setValue(Y,{value:$});break}case"checkbox":case"radiobutton":{const $=q.defaultValue===q.exportValues;X.setValue(Y,{value:$});break}case"combobox":case"listbox":{const $=q.defaultValue||"";X.setValue(Y,{value:$});break}default:continue}const K=document.querySelector(`[data-element-id="${Y}"]`);if(K){if(!s.has(K)){(0,o.warn)(`_bindResetFormAction - element not allowed: ${Y}`);continue}}else continue;K.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:it,name:"ResetForm"}}),!1}}}class f extends e{constructor(a){super(a,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const a=document.createElement("img");return a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",a.alt="[{{type}} Annotation]",a.dataset.l10nId="text_annotation_type",a.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(a),this.container}}class n extends e{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(a){this.data.hasOwnCanvas&&(a.previousSibling?.nodeName==="CANVAS"&&(a.previousSibling.hidden=!0),a.hidden=!1)}_getKeyModifier(a){const{isWin:g,isMac:A}=o.FeatureTest.platform;return g&&a.ctrlKey||A&&a.metaKey}_setEventListener(a,g,A,E,x){A.includes("mouse")?a.addEventListener(A,O=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:E,value:x(O),shift:O.shiftKey,modifier:this._getKeyModifier(O)}})}):a.addEventListener(A,O=>{if(A==="blur"){if(!g.focused||!O.relatedTarget)return;g.focused=!1}else if(A==="focus"){if(g.focused)return;g.focused=!0}x&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:E,value:x(O)}})})}_setEventListeners(a,g,A,E){for(const[x,O]of A)(O==="Action"||this.data.actions?.[O])&&((O==="Focus"||O==="Blur")&&(g||={focused:!1}),this._setEventListener(a,g,x,O,E),O==="Focus"&&!this.data.actions?.Blur?this._setEventListener(a,g,"blur","Blur",null):O==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(a,g,"focus","Focus",null))}_setBackgroundColor(a){const g=this.data.backgroundColor||null;a.style.backgroundColor=g===null?"transparent":o.Util.makeHexColor(g[0],g[1],g[2])}_setTextStyle(a){const g=["left","center","right"],{fontColor:A}=this.data.defaultAppearanceData,E=this.data.defaultAppearanceData.fontSize||t,x=a.style;let O;const j=2,X=it=>Math.round(10*it)/10;if(this.data.multiLine){const it=Math.abs(this.data.rect[3]-this.data.rect[1]-j),q=Math.round(it/(o.LINE_FACTOR*E))||1,Y=it/q;O=Math.min(E,X(Y/o.LINE_FACTOR))}else{const it=Math.abs(this.data.rect[3]-this.data.rect[1]-j);O=Math.min(E,X(it/o.LINE_FACTOR))}x.fontSize=`calc(${O}px * var(--scale-factor))`,x.color=o.Util.makeHexColor(A[0],A[1],A[2]),this.data.textAlignment!==null&&(x.textAlign=g[this.data.textAlignment])}_setRequired(a,g){g?a.setAttribute("required",!0):a.removeAttribute("required"),a.setAttribute("aria-required",g)}}class y extends n{constructor(a){const g=a.renderForms||!a.data.hasAppearance&&!!a.data.fieldValue;super(a,{isRenderable:g})}setPropertyOnSiblings(a,g,A,E){const x=this.annotationStorage;for(const O of this._getElementsByName(a.name,a.id))O.domElement&&(O.domElement[g]=A),x.setValue(O.id,{[E]:A})}render(){const a=this.annotationStorage,g=this.data.id;this.container.classList.add("textWidgetAnnotation");let A=null;if(this.renderForms){const E=a.getValue(g,{value:this.data.fieldValue});let x=E.value||"";const O=a.getValue(g,{charLimit:this.data.maxLen}).charLimit;O&&x.length>O&&(x=x.slice(0,O));let j=E.formattedValue||this.data.textContent?.join(`
`)||null;j&&this.data.comb&&(j=j.replaceAll(/\s+/g,""));const X={userValue:x,formattedValue:j,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(A=document.createElement("textarea"),A.textContent=j??x,this.data.doNotScroll&&(A.style.overflowY="hidden")):(A=document.createElement("input"),A.type="text",A.setAttribute("value",j??x),this.data.doNotScroll&&(A.style.overflowX="hidden")),this.data.hasOwnCanvas&&(A.hidden=!0),s.add(A),A.setAttribute("data-element-id",g),A.disabled=this.data.readOnly,A.name=this.data.fieldName,A.tabIndex=i,this._setRequired(A,this.data.required),O&&(A.maxLength=O),A.addEventListener("input",q=>{a.setValue(g,{value:q.target.value}),this.setPropertyOnSiblings(A,"value",q.target.value,"value"),X.formattedValue=null}),A.addEventListener("resetform",q=>{const Y=this.data.defaultFieldValue??"";A.value=X.userValue=Y,X.formattedValue=null});let it=q=>{const{formattedValue:Y}=X;Y!=null&&(q.target.value=Y),q.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){A.addEventListener("focus",Y=>{if(X.focused)return;const{target:K}=Y;X.userValue&&(K.value=X.userValue),X.lastCommittedValue=K.value,X.commitKey=1,X.focused=!0}),A.addEventListener("updatefromsandbox",Y=>{this.showElementAndHideCanvas(Y.target);const K={value($){X.userValue=$.detail.value??"",a.setValue(g,{value:X.userValue.toString()}),$.target.value=X.userValue},formattedValue($){const{formattedValue:Z}=$.detail;X.formattedValue=Z,Z!=null&&$.target!==document.activeElement&&($.target.value=Z),a.setValue(g,{formattedValue:Z})},selRange($){$.target.setSelectionRange(...$.detail.selRange)},charLimit:$=>{const{charLimit:Z}=$.detail,{target:rt}=$;if(Z===0){rt.removeAttribute("maxLength");return}rt.setAttribute("maxLength",Z);let ot=X.userValue;!ot||ot.length<=Z||(ot=ot.slice(0,Z),rt.value=X.userValue=ot,a.setValue(g,{value:ot}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:ot,willCommit:!0,commitKey:1,selStart:rt.selectionStart,selEnd:rt.selectionEnd}}))}};this._dispatchEventFromSandbox(K,Y)}),A.addEventListener("keydown",Y=>{X.commitKey=1;let K=-1;if(Y.key==="Escape"?K=0:Y.key==="Enter"&&!this.data.multiLine?K=2:Y.key==="Tab"&&(X.commitKey=3),K===-1)return;const{value:$}=Y.target;X.lastCommittedValue!==$&&(X.lastCommittedValue=$,X.userValue=$,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:$,willCommit:!0,commitKey:K,selStart:Y.target.selectionStart,selEnd:Y.target.selectionEnd}}))});const q=it;it=null,A.addEventListener("blur",Y=>{if(!X.focused||!Y.relatedTarget)return;X.focused=!1;const{value:K}=Y.target;X.userValue=K,X.lastCommittedValue!==K&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:K,willCommit:!0,commitKey:X.commitKey,selStart:Y.target.selectionStart,selEnd:Y.target.selectionEnd}}),q(Y)}),this.data.actions?.Keystroke&&A.addEventListener("beforeinput",Y=>{X.lastCommittedValue=null;const{data:K,target:$}=Y,{value:Z,selectionStart:rt,selectionEnd:ot}=$;let lt=rt,ct=ot;switch(Y.inputType){case"deleteWordBackward":{const ht=Z.substring(0,rt).match(/\w*[^\w]*$/);ht&&(lt-=ht[0].length);break}case"deleteWordForward":{const ht=Z.substring(rt).match(/^[^\w]*\w*/);ht&&(ct+=ht[0].length);break}case"deleteContentBackward":rt===ot&&(lt-=1);break;case"deleteContentForward":rt===ot&&(ct+=1);break}Y.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:Z,change:K||"",willCommit:!1,selStart:lt,selEnd:ct}})}),this._setEventListeners(A,X,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Y=>Y.target.value)}if(it&&A.addEventListener("blur",it),this.data.comb){const Y=(this.data.rect[2]-this.data.rect[0])/O;A.classList.add("comb"),A.style.letterSpacing=`calc(${Y}px * var(--scale-factor) - 1ch)`}}else A=document.createElement("div"),A.textContent=this.data.fieldValue,A.style.verticalAlign="middle",A.style.display="table-cell";return this._setTextStyle(A),this._setBackgroundColor(A),this._setDefaultPropertiesFromJS(A),this.container.append(A),this.container}}class T extends n{constructor(a){super(a,{isRenderable:!!a.data.hasOwnCanvas})}}class w extends n{constructor(a){super(a,{isRenderable:a.renderForms})}render(){const a=this.annotationStorage,g=this.data,A=g.id;let E=a.getValue(A,{value:g.exportValue===g.fieldValue}).value;typeof E=="string"&&(E=E!=="Off",a.setValue(A,{value:E})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const x=document.createElement("input");return s.add(x),x.setAttribute("data-element-id",A),x.disabled=g.readOnly,this._setRequired(x,this.data.required),x.type="checkbox",x.name=g.fieldName,E&&x.setAttribute("checked",!0),x.setAttribute("exportValue",g.exportValue),x.tabIndex=i,x.addEventListener("change",O=>{const{name:j,checked:X}=O.target;for(const it of this._getElementsByName(j,A)){const q=X&&it.exportValue===g.exportValue;it.domElement&&(it.domElement.checked=q),a.setValue(it.id,{value:q})}a.setValue(A,{value:X})}),x.addEventListener("resetform",O=>{const j=g.defaultFieldValue||"Off";O.target.checked=j===g.exportValue}),this.enableScripting&&this.hasJSActions&&(x.addEventListener("updatefromsandbox",O=>{const j={value(X){X.target.checked=X.detail.value!=="Off",a.setValue(A,{value:X.target.checked})}};this._dispatchEventFromSandbox(j,O)}),this._setEventListeners(x,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],O=>O.target.checked)),this._setBackgroundColor(x),this._setDefaultPropertiesFromJS(x),this.container.append(x),this.container}}class p extends n{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const a=this.annotationStorage,g=this.data,A=g.id;let E=a.getValue(A,{value:g.fieldValue===g.buttonValue}).value;typeof E=="string"&&(E=E!==g.buttonValue,a.setValue(A,{value:E}));const x=document.createElement("input");if(s.add(x),x.setAttribute("data-element-id",A),x.disabled=g.readOnly,this._setRequired(x,this.data.required),x.type="radio",x.name=g.fieldName,E&&x.setAttribute("checked",!0),x.tabIndex=i,x.addEventListener("change",O=>{const{name:j,checked:X}=O.target;for(const it of this._getElementsByName(j,A))a.setValue(it.id,{value:!1});a.setValue(A,{value:X})}),x.addEventListener("resetform",O=>{const j=g.defaultFieldValue;O.target.checked=j!=null&&j===g.buttonValue}),this.enableScripting&&this.hasJSActions){const O=g.buttonValue;x.addEventListener("updatefromsandbox",j=>{const X={value:it=>{const q=O===it.detail.value;for(const Y of this._getElementsByName(it.target.name)){const K=q&&Y.id===A;Y.domElement&&(Y.domElement.checked=K),a.setValue(Y.id,{value:K})}}};this._dispatchEventFromSandbox(X,j)}),this._setEventListeners(x,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],j=>j.target.checked)}return this._setBackgroundColor(x),this._setDefaultPropertiesFromJS(x),this.container.append(x),this.container}}class v extends c{constructor(a){super(a,{ignoreBorder:a.data.hasAppearance})}render(){const a=super.render();a.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(a.title=this.data.alternativeText);const g=a.lastChild;return this.enableScripting&&this.hasJSActions&&g&&(this._setDefaultPropertiesFromJS(g),g.addEventListener("updatefromsandbox",A=>{this._dispatchEventFromSandbox({},A)})),a}}class B extends n{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const a=this.annotationStorage,g=this.data.id,A=a.getValue(g,{value:this.data.fieldValue}),E=document.createElement("select");s.add(E),E.setAttribute("data-element-id",g),E.disabled=this.data.readOnly,this._setRequired(E,this.data.required),E.name=this.data.fieldName,E.tabIndex=i;let x=this.data.combo&&this.data.options.length>0;this.data.combo||(E.size=this.data.options.length,this.data.multiSelect&&(E.multiple=!0)),E.addEventListener("resetform",q=>{const Y=this.data.defaultFieldValue;for(const K of E.options)K.selected=K.value===Y});for(const q of this.data.options){const Y=document.createElement("option");Y.textContent=q.displayValue,Y.value=q.exportValue,A.value.includes(q.exportValue)&&(Y.setAttribute("selected",!0),x=!1),E.append(Y)}let O=null;if(x){const q=document.createElement("option");q.value=" ",q.setAttribute("hidden",!0),q.setAttribute("selected",!0),E.prepend(q),O=()=>{q.remove(),E.removeEventListener("input",O),O=null},E.addEventListener("input",O)}const j=q=>{const Y=q?"value":"textContent",{options:K,multiple:$}=E;return $?Array.prototype.filter.call(K,Z=>Z.selected).map(Z=>Z[Y]):K.selectedIndex===-1?null:K[K.selectedIndex][Y]};let X=j(!1);const it=q=>{const Y=q.target.options;return Array.prototype.map.call(Y,K=>({displayValue:K.textContent,exportValue:K.value}))};return this.enableScripting&&this.hasJSActions?(E.addEventListener("updatefromsandbox",q=>{const Y={value(K){O?.();const $=K.detail.value,Z=new Set(Array.isArray($)?$:[$]);for(const rt of E.options)rt.selected=Z.has(rt.value);a.setValue(g,{value:j(!0)}),X=j(!1)},multipleSelection(K){E.multiple=!0},remove(K){const $=E.options,Z=K.detail.remove;$[Z].selected=!1,E.remove(Z),$.length>0&&Array.prototype.findIndex.call($,ot=>ot.selected)===-1&&($[0].selected=!0),a.setValue(g,{value:j(!0),items:it(K)}),X=j(!1)},clear(K){for(;E.length!==0;)E.remove(0);a.setValue(g,{value:null,items:[]}),X=j(!1)},insert(K){const{index:$,displayValue:Z,exportValue:rt}=K.detail.insert,ot=E.children[$],lt=document.createElement("option");lt.textContent=Z,lt.value=rt,ot?ot.before(lt):E.append(lt),a.setValue(g,{value:j(!0),items:it(K)}),X=j(!1)},items(K){const{items:$}=K.detail;for(;E.length!==0;)E.remove(0);for(const Z of $){const{displayValue:rt,exportValue:ot}=Z,lt=document.createElement("option");lt.textContent=rt,lt.value=ot,E.append(lt)}E.options.length>0&&(E.options[0].selected=!0),a.setValue(g,{value:j(!0),items:it(K)}),X=j(!1)},indices(K){const $=new Set(K.detail.indices);for(const Z of K.target.options)Z.selected=$.has(Z.index);a.setValue(g,{value:j(!0)}),X=j(!1)},editable(K){K.target.disabled=!K.detail.editable}};this._dispatchEventFromSandbox(Y,q)}),E.addEventListener("input",q=>{const Y=j(!0);a.setValue(g,{value:Y}),q.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:X,changeEx:Y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(E,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],q=>q.target.value)):E.addEventListener("input",function(q){a.setValue(g,{value:j(!0)})}),this.data.combo&&this._setTextStyle(E),this._setBackgroundColor(E),this._setDefaultPropertiesFromJS(E),this.container.append(E),this.container}}class H extends e{constructor(a){const{data:g,elements:A}=a;super(a,{isRenderable:e._hasPopupData(g)}),this.elements=A}render(){this.container.classList.add("popupAnnotation");const a=new I({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),g=[];for(const A of this.elements)A.popup=a,g.push(A.data.id),A.addHighlightArea();return this.container.setAttribute("aria-controls",g.map(A=>`${o.AnnotationPrefix}${A}`).join(",")),this.container}}class I{#t=null;#e=this.#h.bind(this);#s=this.#S.bind(this);#i=this.#E.bind(this);#o=this.#b.bind(this);#a=null;#r=null;#l=null;#c=null;#n=null;#f=null;#d=!1;#u=null;#p=null;#_=null;#m=null;#g=!1;constructor({container:a,color:g,elements:A,titleObj:E,modificationDate:x,contentsObj:O,richText:j,parent:X,rect:it,parentRect:q,open:Y}){this.#r=a,this.#m=E,this.#l=O,this.#_=j,this.#n=X,this.#a=g,this.#p=it,this.#f=q,this.#c=A;const K=m.PDFDateString.toDateObject(x);K&&(this.#t=X.l10n.get("annotation_date_string",{date:K.toLocaleDateString(),time:K.toLocaleTimeString()})),this.trigger=A.flatMap($=>$.getElementsToTriggerPopup());for(const $ of this.trigger)$.addEventListener("click",this.#o),$.addEventListener("mouseenter",this.#i),$.addEventListener("mouseleave",this.#s),$.classList.add("popupTriggerArea");for(const $ of A)$.container?.addEventListener("keydown",this.#e);this.#r.hidden=!0,Y&&this.#b()}render(){if(this.#u)return;const{page:{view:a},viewport:{rawDims:{pageWidth:g,pageHeight:A,pageX:E,pageY:x}}}=this.#n,O=this.#u=document.createElement("div");if(O.className="popup",this.#a){const ht=O.style.outlineColor=o.Util.makeHexColor(...this.#a);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?O.style.backgroundColor=`color-mix(in srgb, ${ht} 30%, white)`:O.style.backgroundColor=o.Util.makeHexColor(...this.#a.map(At=>Math.floor(.7*(255-At)+At)))}const j=document.createElement("span");j.className="header";const X=document.createElement("h1");if(j.append(X),{dir:X.dir,str:X.textContent}=this.#m,O.append(j),this.#t){const ht=document.createElement("span");ht.classList.add("popupDate"),this.#t.then(ut=>{ht.textContent=ut}),j.append(ht)}const it=this.#l,q=this.#_;if(q?.str&&(!it?.str||it.str===q.str))L.XfaLayer.render({xfaHtml:q.html,intent:"richText",div:O}),O.lastChild.classList.add("richText","popupContent");else{const ht=this._formatContents(it);O.append(ht)}let Y=!!this.#f,K=Y?this.#f:this.#p;for(const ht of this.#c)if(!K||o.Util.intersect(ht.data.rect,K)!==null){K=ht.data.rect,Y=!0;break}const $=o.Util.normalizeRect([K[0],a[3]-K[1]+a[1],K[2],a[3]-K[3]+a[1]]),rt=Y?K[2]-K[0]+5:0,ot=$[0]+rt,lt=$[1],{style:ct}=this.#r;ct.left=`${100*(ot-E)/g}%`,ct.top=`${100*(lt-x)/A}%`,this.#r.append(O)}_formatContents({str:a,dir:g}){const A=document.createElement("p");A.classList.add("popupContent"),A.dir=g;const E=a.split(/(?:\r\n?|\n)/);for(let x=0,O=E.length;x<O;++x){const j=E[x];A.append(document.createTextNode(j)),x<O-1&&A.append(document.createElement("br"))}return A}#h(a){a.altKey||a.shiftKey||a.ctrlKey||a.metaKey||(a.key==="Enter"||a.key==="Escape"&&this.#d)&&this.#b()}#b(){this.#d=!this.#d,this.#d?(this.#E(),this.#r.addEventListener("click",this.#o),this.#r.addEventListener("keydown",this.#e)):(this.#S(),this.#r.removeEventListener("click",this.#o),this.#r.removeEventListener("keydown",this.#e))}#E(){this.#u||this.render(),this.isVisible?this.#d&&this.#r.classList.add("focused"):(this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#S(){this.#r.classList.remove("focused"),!(this.#d||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#g=this.isVisible,this.#g&&(this.#r.hidden=!0)}maybeShow(){this.#g&&(this.#g=!1,this.#r.hidden=!1)}get isVisible(){return this.#r.hidden===!1}}class V extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.textContent=a.data.textContent,this.textPosition=a.data.textPosition,this.annotationEditorType=o.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const a=document.createElement("div");a.classList.add("annotationTextContent"),a.setAttribute("role","comment");for(const g of this.textContent){const A=document.createElement("span");A.textContent=g,a.append(A)}this.container.append(a)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}r.FreeTextAnnotationElement=V;class z extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const a=this.data,{width:g,height:A}=u(a.rect),E=this.svgFactory.create(g,A,!0),x=this.#t=this.svgFactory.createElement("svg:line");return x.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),x.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),x.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),x.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),x.setAttribute("stroke-width",a.borderStyle.width||1),x.setAttribute("stroke","transparent"),x.setAttribute("fill","transparent"),E.append(x),this.container.append(E),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class st extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const a=this.data,{width:g,height:A}=u(a.rect),E=this.svgFactory.create(g,A,!0),x=a.borderStyle.width,O=this.#t=this.svgFactory.createElement("svg:rect");return O.setAttribute("x",x/2),O.setAttribute("y",x/2),O.setAttribute("width",g-x),O.setAttribute("height",A-x),O.setAttribute("stroke-width",x||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),E.append(O),this.container.append(E),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Q extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const a=this.data,{width:g,height:A}=u(a.rect),E=this.svgFactory.create(g,A,!0),x=a.borderStyle.width,O=this.#t=this.svgFactory.createElement("svg:ellipse");return O.setAttribute("cx",g/2),O.setAttribute("cy",A/2),O.setAttribute("rx",g/2-x/2),O.setAttribute("ry",A/2-x/2),O.setAttribute("stroke-width",x||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),E.append(O),this.container.append(E),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class et extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:g,height:A}=u(a.rect),E=this.svgFactory.create(g,A,!0);let x=[];for(const j of a.vertices){const X=j.x-a.rect[0],it=a.rect[3]-j.y;x.push(X+","+it)}x=x.join(" ");const O=this.#t=this.svgFactory.createElement(this.svgElementName);return O.setAttribute("points",x),O.setAttribute("stroke-width",a.borderStyle.width||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),E.append(O),this.container.append(E),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class nt extends et{constructor(a){super(a),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class J extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class M extends e{#t=[];constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=o.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:g,height:A}=u(a.rect),E=this.svgFactory.create(g,A,!0);for(const x of a.inkLists){let O=[];for(const X of x){const it=X.x-a.rect[0],q=a.rect[3]-X.y;O.push(`${it},${q}`)}O=O.join(" ");const j=this.svgFactory.createElement(this.svgElementName);this.#t.push(j),j.setAttribute("points",O),j.setAttribute("stroke-width",a.borderStyle.width||1),j.setAttribute("stroke","transparent"),j.setAttribute("fill","transparent"),!a.popupRef&&this.hasPopupData&&this._createPopup(),E.append(j)}return this.container.append(E),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}r.InkAnnotationElement=M;class _ extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class h extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class d extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class b extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class P extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}r.StampAnnotationElement=P;class k extends e{#t=null;constructor(a){super(a,{isRenderable:!0});const{filename:g,content:A}=this.data.file;this.filename=(0,m.getFilenameFromUrl)(g,!0),this.content=A,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:g,content:A})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:a,data:g}=this;let A;g.hasAppearance||g.fillAlpha===0?A=document.createElement("div"):(A=document.createElement("img"),A.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(g.name)?"paperclip":"pushpin"}.svg`,g.fillAlpha&&g.fillAlpha<1&&(A.style=`filter: opacity(${Math.round(g.fillAlpha*100)}%);`)),A.addEventListener("dblclick",this.#e.bind(this)),this.#t=A;const{isMac:E}=o.FeatureTest.platform;return a.addEventListener("keydown",x=>{x.key==="Enter"&&(E?x.metaKey:x.ctrlKey)&&this.#e()}),!g.popupRef&&this.hasPopupData?this._createPopup():A.classList.add("popupTriggerArea"),a.append(A),a}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class R{#t=null;#e=null;#s=new Map;constructor({div:a,accessibilityManager:g,annotationCanvasMap:A,l10n:E,page:x,viewport:O}){this.div=a,this.#t=g,this.#e=A,this.l10n=E,this.page=x,this.viewport=O,this.zIndex=0,this.l10n||=N.NullL10n}#i(a,g){const A=a.firstChild||a;A.id=`${o.AnnotationPrefix}${g}`,this.div.append(a),this.#t?.moveElementInDOM(this.div,a,A,!1)}async render(a){const{annotations:g}=a,A=this.div;(0,m.setLayerDimensions)(A,this.viewport);const E=new Map,x={data:null,layer:A,linkService:a.linkService,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||"",renderForms:a.renderForms!==!1,svgFactory:new m.DOMSVGFactory,annotationStorage:a.annotationStorage||new D.AnnotationStorage,enableScripting:a.enableScripting===!0,hasJSActions:a.hasJSActions,fieldObjects:a.fieldObjects,parent:this,elements:null};for(const O of g){if(O.noHTML)continue;const j=O.annotationType===o.AnnotationType.POPUP;if(j){const q=E.get(O.id);if(!q)continue;x.elements=q}else{const{width:q,height:Y}=u(O.rect);if(q<=0||Y<=0)continue}x.data=O;const X=l.create(x);if(!X.isRenderable)continue;if(!j&&O.popupRef){const q=E.get(O.popupRef);q?q.push(X):E.set(O.popupRef,[X])}X.annotationEditorType>0&&this.#s.set(X.data.id,X);const it=X.render();O.hidden&&(it.style.visibility="hidden"),this.#i(it,O.id)}this.#o(),await this.l10n.translate(A)}update({viewport:a}){const g=this.div;this.viewport=a,(0,m.setLayerDimensions)(g,{rotation:a.rotation}),this.#o(),g.hidden=!1}#o(){if(!this.#e)return;const a=this.div;for(const[g,A]of this.#e){const E=a.querySelector(`[data-annotation-id="${g}"]`);if(!E)continue;const{firstChild:x}=E;x?x.nodeName==="CANVAS"?x.replaceWith(A):x.before(A):E.append(A)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(a){return this.#s.get(a)}}r.AnnotationLayer=R}),((U,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorConverters=void 0;function F(D){return Math.floor(Math.max(0,Math.min(1,D))*255).toString(16).padStart(2,"0")}function o(D){return Math.max(0,Math.min(255,255*D))}class m{static CMYK_G([C,N,L,i]){return["G",1-Math.min(1,.3*C+.59*L+.11*N+i)]}static G_CMYK([C]){return["CMYK",0,0,0,1-C]}static G_RGB([C]){return["RGB",C,C,C]}static G_rgb([C]){return C=o(C),[C,C,C]}static G_HTML([C]){const N=F(C);return`#${N}${N}${N}`}static RGB_G([C,N,L]){return["G",.3*C+.59*N+.11*L]}static RGB_rgb(C){return C.map(o)}static RGB_HTML(C){return`#${C.map(F).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([C,N,L,i]){return["RGB",1-Math.min(1,C+i),1-Math.min(1,L+i),1-Math.min(1,N+i)]}static CMYK_rgb([C,N,L,i]){return[o(1-Math.min(1,C+i)),o(1-Math.min(1,L+i)),o(1-Math.min(1,N+i))]}static CMYK_HTML(C){const N=this.CMYK_RGB(C).slice(1);return this.RGB_HTML(N)}static RGB_CMYK([C,N,L]){const i=1-C,t=1-N,s=1-L,u=Math.min(i,t,s);return["CMYK",i,t,s,u]}}r.ColorConverters=m}),((U,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NullL10n=void 0,r.getL10nFallback=o;const F={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};F.print_progress_percent="{{progress}}%";function o(C,N){switch(C){case"find_match_count":C=`find_match_count[${N.total===1?"one":"other"}]`;break;case"find_match_count_limit":C=`find_match_count_limit[${N.limit===1?"one":"other"}]`;break}return F[C]||""}function m(C,N){return N?C.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(L,i)=>i in N?N[i]:"{{"+i+"}}"):C}const D={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(C,N=null,L=o(C,N)){return m(L,N)},async translate(C){}};r.NullL10n=D}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaLayer=void 0;var o=F(25);class m{static setupStorage(C,N,L,i,t){const s=i.getValue(N,{value:null});switch(L.name){case"textarea":if(s.value!==null&&(C.textContent=s.value),t==="print")break;C.addEventListener("input",u=>{i.setValue(N,{value:u.target.value})});break;case"input":if(L.attributes.type==="radio"||L.attributes.type==="checkbox"){if(s.value===L.attributes.xfaOn?C.setAttribute("checked",!0):s.value===L.attributes.xfaOff&&C.removeAttribute("checked"),t==="print")break;C.addEventListener("change",u=>{i.setValue(N,{value:u.target.checked?u.target.getAttribute("xfaOn"):u.target.getAttribute("xfaOff")})})}else{if(s.value!==null&&C.setAttribute("value",s.value),t==="print")break;C.addEventListener("input",u=>{i.setValue(N,{value:u.target.value})})}break;case"select":if(s.value!==null){C.setAttribute("value",s.value);for(const u of L.children)u.attributes.value===s.value?u.attributes.selected=!0:u.attributes.hasOwnProperty("selected")&&delete u.attributes.selected}C.addEventListener("input",u=>{const l=u.target.options,e=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(N,{value:e})});break}}static setAttributes({html:C,element:N,storage:L=null,intent:i,linkService:t}){const{attributes:s}=N,u=C instanceof HTMLAnchorElement;s.type==="radio"&&(s.name=`${s.name}-${i}`);for(const[l,e]of Object.entries(s))if(e!=null)switch(l){case"class":e.length&&C.setAttribute(l,e.join(" "));break;case"dataId":break;case"id":C.setAttribute("data-element-id",e);break;case"style":Object.assign(C.style,e);break;case"textContent":C.textContent=e;break;default:(!u||l!=="href"&&l!=="newWindow")&&C.setAttribute(l,e)}u&&t.addLinkAttributes(C,s.href,s.newWindow),L&&s.dataId&&this.setupStorage(C,s.dataId,N,L)}static render(C){const N=C.annotationStorage,L=C.linkService,i=C.xfaHtml,t=C.intent||"display",s=document.createElement(i.name);i.attributes&&this.setAttributes({html:s,element:i,intent:t,linkService:L});const u=[[i,-1,s]],l=C.div;if(l.append(s),C.viewport){const c=`matrix(${C.viewport.transform.join(",")})`;l.style.transform=c}t!=="richText"&&l.setAttribute("class","xfaLayer xfaFont");const e=[];for(;u.length>0;){const[c,f,n]=u.at(-1);if(f+1===c.children.length){u.pop();continue}const y=c.children[++u.at(-1)[1]];if(y===null)continue;const{name:T}=y;if(T==="#text"){const p=document.createTextNode(y.value);e.push(p),n.append(p);continue}const w=y?.attributes?.xmlns?document.createElementNS(y.attributes.xmlns,T):document.createElement(T);if(n.append(w),y.attributes&&this.setAttributes({html:w,element:y,storage:N,intent:t,linkService:L}),y.children&&y.children.length>0)u.push([y,-1,w]);else if(y.value){const p=document.createTextNode(y.value);o.XfaText.shouldBuildText(T)&&e.push(p),w.append(p)}}for(const c of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))c.setAttribute("readOnly",!0);return{textDivs:e}}static update(C){const N=`matrix(${C.viewport.transform.join(",")})`;C.div.style.transform=N,C.div.hidden=!1}}r.XfaLayer=m}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.InkEditor=void 0;var o=F(1),m=F(4),D=F(29),C=F(6),N=F(5);class L extends m.AnnotationEditor{#t=0;#e=0;#s=this.canvasPointermove.bind(this);#i=this.canvasPointerleave.bind(this);#o=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#r=new Path2D;#l=!1;#c=!1;#n=!1;#f=null;#d=0;#u=0;#p=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t){m.AnnotationEditor.initialize(t,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(t,s){switch(t){case o.AnnotationEditorParamsType.INK_THICKNESS:L._defaultThickness=s;break;case o.AnnotationEditorParamsType.INK_COLOR:L._defaultColor=s;break;case o.AnnotationEditorParamsType.INK_OPACITY:L._defaultOpacity=s/100;break}}updateParams(t,s){switch(t){case o.AnnotationEditorParamsType.INK_THICKNESS:this.#_(s);break;case o.AnnotationEditorParamsType.INK_COLOR:this.#m(s);break;case o.AnnotationEditorParamsType.INK_OPACITY:this.#g(s);break}}static get defaultPropertiesToUpdate(){return[[o.AnnotationEditorParamsType.INK_THICKNESS,L._defaultThickness],[o.AnnotationEditorParamsType.INK_COLOR,L._defaultColor||m.AnnotationEditor._defaultLineColor],[o.AnnotationEditorParamsType.INK_OPACITY,Math.round(L._defaultOpacity*100)]]}get propertiesToUpdate(){return[[o.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||L._defaultThickness],[o.AnnotationEditorParamsType.INK_COLOR,this.color||L._defaultColor||m.AnnotationEditor._defaultLineColor],[o.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??L._defaultOpacity))]]}#_(t){const s=this.thickness;this.addCommands({cmd:()=>{this.thickness=t,this.#C()},undo:()=>{this.thickness=s,this.#C()},mustExec:!0,type:o.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#m(t){const s=this.color;this.addCommands({cmd:()=>{this.color=t,this.#A()},undo:()=>{this.color=s,this.#A()},mustExec:!0,type:o.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#g(t){t/=100;const s=this.opacity;this.addCommands({cmd:()=>{this.opacity=t,this.#A()},undo:()=>{this.opacity=s,this.#A()},mustExec:!0,type:o.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#k(),this.#F()),this.isAttachedToDOM||(this.parent.add(this),this.#y()),this.#C()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#f.disconnect(),this.#f=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,s]=this.parentDimensions,u=this.width*t,l=this.height*s;this.setDimensions(u,l)}enableEditMode(){this.#l||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#a))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#h(){const{parentRotation:t,parentDimensions:[s,u]}=this;switch(t){case 90:return[0,u,u,s];case 180:return[s,u,s,u];case 270:return[s,0,u,s];default:return[0,0,s,u]}}#b(){const{ctx:t,color:s,opacity:u,thickness:l,parentScale:e,scaleFactor:c}=this;t.lineWidth=l*e/c,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${s}${(0,N.opacityToHex)(u)}`}#E(t,s){this.canvas.addEventListener("contextmenu",C.noContextMenu),this.canvas.addEventListener("pointerleave",this.#i),this.canvas.addEventListener("pointermove",this.#s),this.canvas.addEventListener("pointerup",this.#o),this.canvas.removeEventListener("pointerdown",this.#a),this.isEditing=!0,this.#n||(this.#n=!0,this.#y(),this.thickness||=L._defaultThickness,this.color||=L._defaultColor||m.AnnotationEditor._defaultLineColor,this.opacity??=L._defaultOpacity),this.currentPath.push([t,s]),this.#c=!1,this.#b(),this.#p=()=>{this.#I(),this.#p&&window.requestAnimationFrame(this.#p)},window.requestAnimationFrame(this.#p)}#S(t,s){const[u,l]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===u&&s===l)return;const e=this.currentPath;let c=this.#r;if(e.push([t,s]),this.#c=!0,e.length<=2){c.moveTo(...e[0]),c.lineTo(t,s);return}e.length===3&&(this.#r=c=new Path2D,c.moveTo(...e[0])),this.#L(c,...e.at(-3),...e.at(-2),t,s)}#x(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#r.lineTo(...t)}#P(t,s){this.#p=null,t=Math.min(Math.max(t,0),this.canvas.width),s=Math.min(Math.max(s,0),this.canvas.height),this.#S(t,s),this.#x();let u;if(this.currentPath.length!==1)u=this.#O();else{const n=[t,s];u=[[n,n.slice(),n.slice(),n]]}const l=this.#r,e=this.currentPath;this.currentPath=[],this.#r=new Path2D;const c=()=>{this.allRawPaths.push(e),this.paths.push(u),this.bezierPath2D.push(l),this.rebuild()},f=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#k(),this.#F()),this.#C())};this.addCommands({cmd:c,undo:f,mustExec:!0})}#I(){if(!this.#c)return;this.#c=!1;const t=Math.ceil(this.thickness*this.parentScale),s=this.currentPath.slice(-3),u=s.map(c=>c[0]),l=s.map(c=>c[1]);Math.min(...u)-t,Math.max(...u)+t,Math.min(...l)-t,Math.max(...l)+t;const{ctx:e}=this;e.save(),e.clearRect(0,0,this.canvas.width,this.canvas.height);for(const c of this.bezierPath2D)e.stroke(c);e.stroke(this.#r),e.restore()}#L(t,s,u,l,e,c,f){const n=(s+l)/2,y=(u+e)/2,T=(l+c)/2,w=(e+f)/2;t.bezierCurveTo(n+2*(l-n)/3,y+2*(e-y)/3,T+2*(l-T)/3,w+2*(e-w)/3,T,w)}#O(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const s=[];let u,[l,e]=t[0];for(u=1;u<t.length-2;u++){const[p,v]=t[u],[B,H]=t[u+1],I=(p+B)/2,V=(v+H)/2,z=[l+2*(p-l)/3,e+2*(v-e)/3],st=[I+2*(p-I)/3,V+2*(v-V)/3];s.push([[l,e],z,st,[I,V]]),[l,e]=[I,V]}const[c,f]=t[u],[n,y]=t[u+1],T=[l+2*(c-l)/3,e+2*(f-e)/3],w=[n+2*(c-n)/3,y+2*(f-y)/3];return s.push([[l,e],T,w,[n,y]]),s}#A(){if(this.isEmpty()){this.#w();return}this.#b();const{canvas:t,ctx:s}=this;s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),this.#w();for(const u of this.bezierPath2D)s.stroke(u)}commit(){this.#l||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#l=!0,this.div.classList.add("disabled"),this.#C(!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#l||(this.setInForeground(),t.preventDefault(),t.type!=="mouse"&&this.div.focus(),this.#E(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#S(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#D(t)}canvasPointerleave(t){this.#D(t)}#D(t){this.canvas.removeEventListener("pointerleave",this.#i),this.canvas.removeEventListener("pointermove",this.#s),this.canvas.removeEventListener("pointerup",this.#o),this.canvas.addEventListener("pointerdown",this.#a),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",C.noContextMenu)},10),this.#P(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#k(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",m.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(t=>this.canvas?.setAttribute("aria-label",t)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#F(){this.#f=new ResizeObserver(t=>{const s=t[0].contentRect;s.width&&s.height&&this.setDimensions(s.width,s.height)}),this.#f.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#l}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),m.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(f=>this.div?.setAttribute("aria-label",f));const[u,l,e,c]=this.#h();if(this.setAt(u,l,0,0),this.setDims(e,c),this.#k(),this.width){const[f,n]=this.parentDimensions;this.setAspectRatio(this.width*f,this.height*n),this.setAt(t*f,s*n,this.width*f,this.height*n),this.#n=!0,this.#y(),this.setDims(this.width*f,this.height*n),this.#A(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#F(),this.div}#y(){if(!this.#n)return;const[t,s]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*s),this.#w()}setDimensions(t,s){const u=Math.round(t),l=Math.round(s);if(this.#d===u&&this.#u===l)return;this.#d=u,this.#u=l,this.canvas.style.visibility="hidden";const[e,c]=this.parentDimensions;this.width=t/e,this.height=s/c,this.fixAndSetPosition(),this.#l&&this.#T(t,s),this.#y(),this.#A(),this.canvas.style.visibility="visible",this.fixDims()}#T(t,s){const u=this.#R(),l=(t-u)/this.#e,e=(s-u)/this.#t;this.scaleFactor=Math.min(l,e)}#w(){const t=this.#R()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#N(t){const s=new Path2D;for(let u=0,l=t.length;u<l;u++){const[e,c,f,n]=t[u];u===0&&s.moveTo(...e),s.bezierCurveTo(c[0],c[1],f[0],f[1],n[0],n[1])}return s}static#B(t,s,u){const[l,e,c,f]=s;switch(u){case 0:for(let n=0,y=t.length;n<y;n+=2)t[n]+=l,t[n+1]=f-t[n+1];break;case 90:for(let n=0,y=t.length;n<y;n+=2){const T=t[n];t[n]=t[n+1]+l,t[n+1]=T+e}break;case 180:for(let n=0,y=t.length;n<y;n+=2)t[n]=c-t[n],t[n+1]+=e;break;case 270:for(let n=0,y=t.length;n<y;n+=2){const T=t[n];t[n]=c-t[n+1],t[n+1]=f-T}break;default:throw new Error("Invalid rotation")}return t}static#U(t,s,u){const[l,e,c,f]=s;switch(u){case 0:for(let n=0,y=t.length;n<y;n+=2)t[n]-=l,t[n+1]=f-t[n+1];break;case 90:for(let n=0,y=t.length;n<y;n+=2){const T=t[n];t[n]=t[n+1]-e,t[n+1]=T-l}break;case 180:for(let n=0,y=t.length;n<y;n+=2)t[n]=c-t[n],t[n+1]-=e;break;case 270:for(let n=0,y=t.length;n<y;n+=2){const T=t[n];t[n]=f-t[n+1],t[n+1]=c-T}break;default:throw new Error("Invalid rotation")}return t}#j(t,s,u,l){const e=[],c=this.thickness/2,f=t*s+c,n=t*u+c;for(const y of this.paths){const T=[],w=[];for(let p=0,v=y.length;p<v;p++){const[B,H,I,V]=y[p],z=t*B[0]+f,st=t*B[1]+n,Q=t*H[0]+f,et=t*H[1]+n,nt=t*I[0]+f,J=t*I[1]+n,M=t*V[0]+f,_=t*V[1]+n;p===0&&(T.push(z,st),w.push(z,st)),T.push(Q,et,nt,J,M,_),w.push(Q,et),p===v-1&&w.push(M,_)}e.push({bezier:L.#B(T,l,this.rotation),points:L.#B(w,l,this.rotation)})}return e}#M(){let t=1/0,s=-1/0,u=1/0,l=-1/0;for(const e of this.paths)for(const[c,f,n,y]of e){const T=o.Util.bezierBoundingBox(...c,...f,...n,...y);t=Math.min(t,T[0]),u=Math.min(u,T[1]),s=Math.max(s,T[2]),l=Math.max(l,T[3])}return[t,u,s,l]}#R(){return this.#l?Math.ceil(this.thickness*this.parentScale):0}#C(t=!1){if(this.isEmpty())return;if(!this.#l){this.#A();return}const s=this.#M(),u=this.#R();this.#e=Math.max(m.AnnotationEditor.MIN_SIZE,s[2]-s[0]),this.#t=Math.max(m.AnnotationEditor.MIN_SIZE,s[3]-s[1]);const l=Math.ceil(u+this.#e*this.scaleFactor),e=Math.ceil(u+this.#t*this.scaleFactor),[c,f]=this.parentDimensions;this.width=l/c,this.height=e/f,this.setAspectRatio(l,e);const n=this.translationX,y=this.translationY;this.translationX=-s[0],this.translationY=-s[1],this.#y(),this.#A(),this.#d=l,this.#u=e,this.setDims(l,e);const T=t?u/this.scaleFactor/2:0;this.translate(n-this.translationX-T,y-this.translationY-T)}static deserialize(t,s,u){if(t instanceof D.InkAnnotationElement)return null;const l=super.deserialize(t,s,u);l.thickness=t.thickness,l.color=o.Util.makeHexColor(...t.color),l.opacity=t.opacity;const[e,c]=l.pageDimensions,f=l.width*e,n=l.height*c,y=l.parentScale,T=t.thickness/2;l.#l=!0,l.#d=Math.round(f),l.#u=Math.round(n);const{paths:w,rect:p,rotation:v}=t;for(let{bezier:H}of w){H=L.#U(H,p,v);const I=[];l.paths.push(I);let V=y*(H[0]-T),z=y*(H[1]-T);for(let Q=2,et=H.length;Q<et;Q+=6){const nt=y*(H[Q]-T),J=y*(H[Q+1]-T),M=y*(H[Q+2]-T),_=y*(H[Q+3]-T),h=y*(H[Q+4]-T),d=y*(H[Q+5]-T);I.push([[V,z],[nt,J],[M,_],[h,d]]),V=h,z=d}const st=this.#N(I);l.bezierPath2D.push(st)}const B=l.#M();return l.#e=Math.max(m.AnnotationEditor.MIN_SIZE,B[2]-B[0]),l.#t=Math.max(m.AnnotationEditor.MIN_SIZE,B[3]-B[1]),l.#T(f,n),l}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),s=m.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:o.AnnotationEditorType.INK,color:s,thickness:this.thickness,opacity:this.opacity,paths:this.#j(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}r.InkEditor=L}),((U,r,F)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.StampEditor=void 0;var o=F(1),m=F(4),D=F(6),C=F(29);class N extends m.AnnotationEditor{#t=null;#e=null;#s=null;#i=null;#o=null;#a=null;#r=null;#l=null;#c=!1;#n=!1;static _type="stamp";constructor(i){super({...i,name:"stampEditor"}),this.#i=i.bitmapUrl,this.#o=i.bitmapFile}static initialize(i){m.AnnotationEditor.initialize(i)}static get supportedTypes(){const i=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,o.shadow)(this,"supportedTypes",i.map(t=>`image/${t}`))}static get supportedTypesStr(){return(0,o.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(i){return this.supportedTypes.includes(i)}static paste(i,t){t.pasteEditor(o.AnnotationEditorType.STAMP,{bitmapFile:i.getAsFile()})}#f(i,t=!1){if(!i){this.remove();return}this.#t=i.bitmap,t||(this.#e=i.id,this.#c=i.isSvg),this.#p()}#d(){this.#s=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#u(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(t=>this.#f(t,!0)).finally(()=>this.#d());return}if(this.#i){const t=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(t).then(s=>this.#f(s)).finally(()=>this.#d());return}if(this.#o){const t=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(t).then(s=>this.#f(s)).finally(()=>this.#d());return}const i=document.createElement("input");i.type="file",i.accept=N.supportedTypesStr,this.#s=new Promise(t=>{i.addEventListener("change",async()=>{if(!i.files||i.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(i.files[0]);this.#f(s)}t()}),i.addEventListener("cancel",()=>{this.remove(),t()})}).finally(()=>this.#d()),i.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#r?.disconnect(),this.#r=null),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#u();return}super.rebuild(),this.div!==null&&(this.#e&&this.#u(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#i||this.#o)}get isResizable(){return!0}render(){if(this.div)return this.div;let i,t;if(this.width&&(i=this.x,t=this.y),super.render(),this.div.hidden=!0,this.#t?this.#p():this.#u(),this.width){const[s,u]=this.parentDimensions;this.setAt(i*s,t*u,this.width*s,this.height*u)}return this.div}#p(){const{div:i}=this;let{width:t,height:s}=this.#t;const[u,l]=this.pageDimensions,e=.75;if(this.width)t=this.width*u,s=this.height*l;else if(t>e*u||s>e*l){const y=Math.min(e*u/t,e*l/s);t*=y,s*=y}const[c,f]=this.parentDimensions;this.setDims(t*c/u,s*f/l),this._uiManager.enableWaiting(!1);const n=this.#a=document.createElement("canvas");i.append(n),i.hidden=!1,this.#g(t,s),this.#b(),this.#n||(this.parent.addUndoableEditor(this),this.#n=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()}#_(i,t){const[s,u]=this.parentDimensions;this.width=i/s,this.height=t/u,this.setDims(i,t),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#l!==null&&clearTimeout(this.#l);const l=200;this.#l=setTimeout(()=>{this.#l=null,this.#g(i,t)},l)}#m(i,t){const{width:s,height:u}=this.#t;let l=s,e=u,c=this.#t;for(;l>2*i||e>2*t;){const f=l,n=e;l>2*i&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2)),e>2*t&&(e=e>=16384?Math.floor(e/2)-1:Math.ceil(e/2));const y=new OffscreenCanvas(l,e);y.getContext("2d").drawImage(c,0,0,f,n,0,0,l,e),c=y.transferToImageBitmap()}return c}#g(i,t){i=Math.ceil(i),t=Math.ceil(t);const s=this.#a;if(!s||s.width===i&&s.height===t)return;s.width=i,s.height=t;const u=this.#c?this.#t:this.#m(i,t),l=s.getContext("2d");l.filter=this._uiManager.hcmFilter,l.drawImage(u,0,0,u.width,u.height,0,0,i,t)}#h(i){if(i){if(this.#c){const u=this._uiManager.imageManager.getSvgUrl(this.#e);if(u)return u}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#c){const[t,s]=this.pageDimensions,u=Math.round(this.width*t*D.PixelsPerInch.PDF_TO_CSS_UNITS),l=Math.round(this.height*s*D.PixelsPerInch.PDF_TO_CSS_UNITS),e=new OffscreenCanvas(u,l);return e.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,u,l),e.transferToImageBitmap()}return structuredClone(this.#t)}#b(){this.#r=new ResizeObserver(i=>{const t=i[0].contentRect;t.width&&t.height&&this.#_(t.width,t.height)}),this.#r.observe(this.div)}static deserialize(i,t,s){if(i instanceof C.StampAnnotationElement)return null;const u=super.deserialize(i,t,s),{rect:l,bitmapUrl:e,bitmapId:c,isSvg:f,accessibilityData:n}=i;c&&s.imageManager.isValidId(c)?u.#e=c:u.#i=e,u.#c=f;const[y,T]=u.pageDimensions;return u.width=(l[2]-l[0])/y,u.height=(l[3]-l[1])/T,n&&(u.altTextData=n),u}serialize(i=!1,t=null){if(this.isEmpty())return null;const s={annotationType:o.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(i)return s.bitmapUrl=this.#h(!0),s.accessibilityData=this.altTextData,s;const{decorative:u,altText:l}=this.altTextData;if(!u&&l&&(s.accessibilityData={type:"Figure",alt:l}),t===null)return s;t.stamps||=new Map;const e=this.#c?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:e,serialized:s}),s.bitmap=this.#h(!1);else if(this.#c){const c=t.stamps.get(this.#e);e>c.area&&(c.area=e,c.serialized.bitmap.close(),c.serialized.bitmap=this.#h(!1))}return s}}r.StampEditor=N})],__webpack_module_cache__={};function __w_pdfjs_require__(U){var r=__webpack_module_cache__[U];if(r!==void 0)return r.exports;var F=__webpack_module_cache__[U]={exports:{}};return __webpack_modules__[U](F,F.exports,__w_pdfjs_require__),F.exports}var __webpack_exports__={};return(()=>{var U=__webpack_exports__;Object.defineProperty(U,"__esModule",{value:!0}),Object.defineProperty(U,"AbortException",{enumerable:!0,get:function(){return r.AbortException}}),Object.defineProperty(U,"AnnotationEditorLayer",{enumerable:!0,get:function(){return D.AnnotationEditorLayer}}),Object.defineProperty(U,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return r.AnnotationEditorParamsType}}),Object.defineProperty(U,"AnnotationEditorType",{enumerable:!0,get:function(){return r.AnnotationEditorType}}),Object.defineProperty(U,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return C.AnnotationEditorUIManager}}),Object.defineProperty(U,"AnnotationLayer",{enumerable:!0,get:function(){return N.AnnotationLayer}}),Object.defineProperty(U,"AnnotationMode",{enumerable:!0,get:function(){return r.AnnotationMode}}),Object.defineProperty(U,"CMapCompressionType",{enumerable:!0,get:function(){return r.CMapCompressionType}}),Object.defineProperty(U,"DOMSVGFactory",{enumerable:!0,get:function(){return o.DOMSVGFactory}}),Object.defineProperty(U,"FeatureTest",{enumerable:!0,get:function(){return r.FeatureTest}}),Object.defineProperty(U,"GlobalWorkerOptions",{enumerable:!0,get:function(){return L.GlobalWorkerOptions}}),Object.defineProperty(U,"ImageKind",{enumerable:!0,get:function(){return r.ImageKind}}),Object.defineProperty(U,"InvalidPDFException",{enumerable:!0,get:function(){return r.InvalidPDFException}}),Object.defineProperty(U,"MissingPDFException",{enumerable:!0,get:function(){return r.MissingPDFException}}),Object.defineProperty(U,"OPS",{enumerable:!0,get:function(){return r.OPS}}),Object.defineProperty(U,"PDFDataRangeTransport",{enumerable:!0,get:function(){return F.PDFDataRangeTransport}}),Object.defineProperty(U,"PDFDateString",{enumerable:!0,get:function(){return o.PDFDateString}}),Object.defineProperty(U,"PDFWorker",{enumerable:!0,get:function(){return F.PDFWorker}}),Object.defineProperty(U,"PasswordResponses",{enumerable:!0,get:function(){return r.PasswordResponses}}),Object.defineProperty(U,"PermissionFlag",{enumerable:!0,get:function(){return r.PermissionFlag}}),Object.defineProperty(U,"PixelsPerInch",{enumerable:!0,get:function(){return o.PixelsPerInch}}),Object.defineProperty(U,"PromiseCapability",{enumerable:!0,get:function(){return r.PromiseCapability}}),Object.defineProperty(U,"RenderingCancelledException",{enumerable:!0,get:function(){return o.RenderingCancelledException}}),Object.defineProperty(U,"SVGGraphics",{enumerable:!0,get:function(){return F.SVGGraphics}}),Object.defineProperty(U,"UnexpectedResponseException",{enumerable:!0,get:function(){return r.UnexpectedResponseException}}),Object.defineProperty(U,"Util",{enumerable:!0,get:function(){return r.Util}}),Object.defineProperty(U,"VerbosityLevel",{enumerable:!0,get:function(){return r.VerbosityLevel}}),Object.defineProperty(U,"XfaLayer",{enumerable:!0,get:function(){return i.XfaLayer}}),Object.defineProperty(U,"build",{enumerable:!0,get:function(){return F.build}}),Object.defineProperty(U,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return r.createValidAbsoluteUrl}}),Object.defineProperty(U,"getDocument",{enumerable:!0,get:function(){return F.getDocument}}),Object.defineProperty(U,"getFilenameFromUrl",{enumerable:!0,get:function(){return o.getFilenameFromUrl}}),Object.defineProperty(U,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return o.getPdfFilenameFromUrl}}),Object.defineProperty(U,"getXfaPageViewport",{enumerable:!0,get:function(){return o.getXfaPageViewport}}),Object.defineProperty(U,"isDataScheme",{enumerable:!0,get:function(){return o.isDataScheme}}),Object.defineProperty(U,"isPdfFile",{enumerable:!0,get:function(){return o.isPdfFile}}),Object.defineProperty(U,"loadScript",{enumerable:!0,get:function(){return o.loadScript}}),Object.defineProperty(U,"noContextMenu",{enumerable:!0,get:function(){return o.noContextMenu}}),Object.defineProperty(U,"normalizeUnicode",{enumerable:!0,get:function(){return r.normalizeUnicode}}),Object.defineProperty(U,"renderTextLayer",{enumerable:!0,get:function(){return m.renderTextLayer}}),Object.defineProperty(U,"setLayerDimensions",{enumerable:!0,get:function(){return o.setLayerDimensions}}),Object.defineProperty(U,"shadow",{enumerable:!0,get:function(){return r.shadow}}),Object.defineProperty(U,"updateTextLayer",{enumerable:!0,get:function(){return m.updateTextLayer}}),Object.defineProperty(U,"version",{enumerable:!0,get:function(){return F.version}});var r=__w_pdfjs_require__(1),F=__w_pdfjs_require__(2),o=__w_pdfjs_require__(6),m=__w_pdfjs_require__(26),D=__w_pdfjs_require__(27),C=__w_pdfjs_require__(5),N=__w_pdfjs_require__(29),L=__w_pdfjs_require__(14),i=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf)),pdf.exports}var pdfExports=requirePdf();const pdfjsWorker="/build/assets/pdf.worker-BgPpApnW.js",_hoisted_1$1={key:0,class:"rounded-md border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"},_hoisted_2$1={key:1,class:"flex items-center justify-center rounded-md border border-gray-200 bg-white px-4 py-12 text-sm text-gray-600"},_sfc_main$1={__name:"PdfViewer",props:{src:{type:String,required:!0},allowTextSelection:{type:Boolean,default:!1},scale:{type:Number,default:1}},setup(U){pdfExports.GlobalWorkerOptions.workerSrc=pdfjsWorker;const r=U,F=ref(null),o=ref(null),m=ref(!0),D=ref(null);let C=null,N=[],L=null;const i=()=>{N.forEach(l=>{try{l?.cancel()}catch{}}),N=[],C&&(C.cleanup(),C.destroy(),C=null),o.value&&(o.value.innerHTML=""),L&&(L.abort(),L=null)},t=async(l,e)=>{const c=l.getViewport({scale:e}),f=document.createElement("div");f.className="pdf-page relative mx-auto",f.style.width=`${c.width}px`;const n=document.createElement("canvas");n.height=c.height,n.width=c.width,n.className="block max-w-full";const y=n.getContext("2d",{alpha:!1}),T=l.render({canvasContext:y,viewport:c});if(N.push(T),f.appendChild(n),o.value.appendChild(f),await T.promise,r.allowTextSelection){const w=document.createElement("div");w.className="textLayer",w.style.width=`${c.width}px`,w.style.height=`${c.height}px`,f.appendChild(w);const p=await l.getTextContent({normalizeWhitespace:!0});pdfExports.renderTextLayer({textContent:p,container:w,viewport:c,textDivs:[],enhanceTextSelection:!0})}},s=async()=>{if(!C||!F.value||!o.value)return;const l=F.value.clientWidth||800,c=(await C.getPage(1)).getViewport({scale:r.scale}),f=l/c.width*r.scale;o.value.innerHTML="";for(let n=1;n<=C.numPages;n+=1){const y=await C.getPage(n);await t(y,f)}},u=async()=>{if(i(),m.value=!0,D.value=null,!r.src){m.value=!1,D.value="Missing PDF source.";return}L=new AbortController;try{const l=await fetch(r.src,{credentials:"include",signal:L.signal});if(!l.ok)throw new Error("Failed to load PDF.");const e=await l.arrayBuffer();C=await pdfExports.getDocument({data:e}).promise,await s()}catch(l){if(l.name==="AbortError")return;console.error("PDF Viewer error:",l),D.value=l?.message??"Unable to load PDF."}finally{m.value=!1}};return onMounted(()=>{u()}),watch(()=>[r.src,r.allowTextSelection,r.scale],async()=>{await u()}),onBeforeUnmount(()=>{i()}),(l,e)=>(openBlock(),createElementBlock("div",{class:"pdf-viewer",ref_key:"containerRef",ref:F},[D.value?(openBlock(),createElementBlock("div",_hoisted_1$1,toDisplayString(D.value),1)):m.value?(openBlock(),createElementBlock("div",_hoisted_2$1," Loading PDF… ")):(openBlock(),createElementBlock("div",{key:2,ref_key:"pagesRef",ref:o,class:"space-y-8"},null,512))],512))}},PdfViewer=_export_sfc(_sfc_main$1,[["__scopeId","data-v-aa58a66b"]]),_hoisted_1={class:"flex items-center justify-between"},_hoisted_2={class:"flex items-center gap-4"},_hoisted_3={class:"text-xl font-semibold leading-tight text-gray-800"},_hoisted_4={key:0,class:"flex items-center gap-3"},_hoisted_5=["href"],_hoisted_6={class:"py-10"},_hoisted_7={class:"mx-auto max-w-7xl space-y-6 px-4 sm:px-6 lg:px-8"},_hoisted_8={key:0,class:"text-center py-12"},_hoisted_9={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},_hoisted_10={class:"px-6 py-4"},_hoisted_11={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3"},_hoisted_12={class:"mt-1 text-sm text-gray-900"},_hoisted_13={class:"mt-1 text-sm text-gray-900"},_hoisted_14={class:"mt-1 text-sm text-gray-900"},_hoisted_15={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},_hoisted_16={class:"border-b border-gray-200 px-6 py-4"},_hoisted_17={class:"text-lg font-semibold text-gray-900 flex items-center gap-2"},_hoisted_18={key:0,class:"ml-auto text-xs font-normal text-gray-500"},_hoisted_19={class:"px-6 py-4"},_hoisted_20={key:1,class:"text-center py-12 text-gray-500"},_hoisted_21={key:0,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},_hoisted_22={class:"border-b border-gray-200 px-6 py-4"},_hoisted_23={class:"text-lg font-semibold text-gray-900"},_hoisted_24={class:"px-6 py-4"},_hoisted_25={class:"overflow-x-auto"},_hoisted_26={class:"min-w-full divide-y divide-gray-200"},_hoisted_27={class:"divide-y divide-gray-200 bg-white"},_hoisted_28=["onClick"],_hoisted_29={class:"px-4 py-3 text-sm text-gray-900"},_hoisted_30={class:"px-4 py-3 text-sm text-gray-900"},_hoisted_31={class:"px-4 py-3 text-sm text-gray-900"},_sfc_main={__name:"Show",props:{bookId:{type:[String,Number],required:!0}},setup(U){const r=U,F=usePage(),o=computed(()=>F.props.auth?.user?.role??"teacher"),m=computed(()=>o.value==="super-admin"),D=computed(()=>["admin","super-admin"].includes(o.value)),C=computed(()=>m.value),N=computed(()=>m.value),L=ref(!1),i=ref(null),t=ref(!1),s=computed(()=>i.value?`/api/v1/books/${i.value.id}/stream`:null),u=computed(()=>i.value?i.value.path?`/storage/${i.value.path}`:s.value:null),l=async()=>{L.value=!0;try{const{data:f}=await api.get(`/books/${r.bookId}`);i.value=f}catch(f){console.error("Error fetching book:",f)}finally{L.value=!1}},e=async()=>{try{L.value=!0,await api.delete(`/books/${r.bookId}`),router.visit(route("books.index"))}catch(f){console.error("Error deleting book:",f),t.value=!1}finally{L.value=!1}},c=f=>f?new Date(f).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"—";return onMounted(()=>{l()}),(f,n)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(unref(head_default),{title:i.value?`${i.value.title} - Book Details`:"Book Details"},null,8,["title"]),createVNode(_sfc_main$8,null,{header:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("button",{onClick:n[0]||(n[0]=y=>unref(router).visit(f.route("books.index"))),class:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600"},[createVNode(unref(render$1),{class:"h-5 w-5"})]),createBaseVNode("div",null,[createBaseVNode("h2",_hoisted_3,toDisplayString(i.value?.title??"Loading..."),1),n[4]||(n[4]=createBaseVNode("p",{class:"text-sm text-gray-500"}," Book Viewer ",-1))])]),C.value||D.value?(openBlock(),createElementBlock("div",_hoisted_4,[C.value&&u.value?(openBlock(),createElementBlock("a",{key:0,href:u.value,target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 rounded-md border border-gray-300 px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"}," Download ",8,_hoisted_5)):createCommentVNode("",!0),D.value?(openBlock(),createBlock(_sfc_main$7,{key:1,onClick:n[1]||(n[1]=y=>t.value=!0),variant:"destructive",disabled:L.value},{default:withCtx(()=>[createVNode(unref(render$2),{class:"h-4 w-4 mr-2"}),n[5]||(n[5]=createTextVNode(" Delete ",-1))]),_:1},8,["disabled"])):createCommentVNode("",!0)])):createCommentVNode("",!0)])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[L.value&&!i.value?(openBlock(),createElementBlock("div",_hoisted_8,[...n[6]||(n[6]=[createBaseVNode("div",{class:"text-gray-500"},"Loading book information...",-1)])])):i.value?(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",_hoisted_9,[n[10]||(n[10]=createBaseVNode("div",{class:"border-b border-gray-200 px-6 py-4"},[createBaseVNode("h3",{class:"text-lg font-semibold text-gray-900"},"Book Information")],-1)),createBaseVNode("div",_hoisted_10,[createBaseVNode("dl",_hoisted_11,[createBaseVNode("div",null,[n[7]||(n[7]=createBaseVNode("dt",{class:"text-sm font-medium text-gray-500"},"Title",-1)),createBaseVNode("dd",_hoisted_12,toDisplayString(i.value.title??"—"),1)]),createBaseVNode("div",null,[n[8]||(n[8]=createBaseVNode("dt",{class:"text-sm font-medium text-gray-500"},"Original Filename",-1)),createBaseVNode("dd",_hoisted_13,toDisplayString(i.value.original_filename??"—"),1)]),createBaseVNode("div",null,[n[9]||(n[9]=createBaseVNode("dt",{class:"text-sm font-medium text-gray-500"},"Uploaded",-1)),createBaseVNode("dd",_hoisted_14,toDisplayString(c(i.value.created_at)),1)])])])]),createBaseVNode("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,[createBaseVNode("h3",_hoisted_17,[createVNode(unref(render),{class:"h-5 w-5"}),n[11]||(n[11]=createTextVNode(" Book Content ",-1)),N.value?createCommentVNode("",!0):(openBlock(),createElementBlock("span",_hoisted_18," (Copy, highlight, and download are restricted) "))])]),createBaseVNode("div",_hoisted_19,[s.value?(openBlock(),createBlock(PdfViewer,{key:0,src:s.value,"allow-text-selection":N.value},null,8,["src","allow-text-selection"])):(openBlock(),createElementBlock("div",_hoisted_20," PDF not available "))])]),i.value.book_assignments&&i.value.book_assignments.length>0?(openBlock(),createElementBlock("div",_hoisted_21,[createBaseVNode("div",_hoisted_22,[createBaseVNode("h3",_hoisted_23," Assignments ("+toDisplayString(i.value.book_assignments.length)+") ",1)]),createBaseVNode("div",_hoisted_24,[createBaseVNode("div",_hoisted_25,[createBaseVNode("table",_hoisted_26,[n[12]||(n[12]=createBaseVNode("thead",{class:"bg-gray-50"},[createBaseVNode("tr",null,[createBaseVNode("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Student "),createBaseVNode("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Teacher "),createBaseVNode("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"}," Assigned Date ")])],-1)),createBaseVNode("tbody",_hoisted_27,[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.value.book_assignments,y=>(openBlock(),createElementBlock("tr",{key:y.id,class:"hover:bg-gray-50 cursor-pointer",onClick:T=>unref(router).visit(f.route("assignments.show",y.id))},[createBaseVNode("td",_hoisted_29,toDisplayString(y.student?.name??"—"),1),createBaseVNode("td",_hoisted_30,toDisplayString(y.teacher?.name??"—"),1),createBaseVNode("td",_hoisted_31,toDisplayString(c(y.created_at)),1)],8,_hoisted_28))),128))])])])])])):createCommentVNode("",!0)],64)):createCommentVNode("",!0)])]),createVNode(_sfc_main$2,{open:t.value,"onUpdate:open":n[3]||(n[3]=y=>t.value=y)},{default:withCtx(()=>[createBaseVNode("div",null,[createVNode(_sfc_main$3,null,{default:withCtx(()=>[createVNode(_sfc_main$4,null,{default:withCtx(()=>[...n[13]||(n[13]=[createTextVNode("Delete Book",-1)])]),_:1}),createVNode(_sfc_main$5,null,{default:withCtx(()=>[n[14]||(n[14]=createTextVNode(" Are you sure you want to delete ",-1)),createBaseVNode("strong",null,toDisplayString(i.value?.title),1),n[15]||(n[15]=createTextVNode("? This action cannot be undone. ",-1))]),_:1})]),_:1}),createVNode(_sfc_main$6,null,{default:withCtx(()=>[createVNode(_sfc_main$7,{variant:"outline",onClick:n[2]||(n[2]=y=>t.value=!1)},{default:withCtx(()=>[...n[16]||(n[16]=[createTextVNode("Cancel",-1)])]),_:1}),createVNode(_sfc_main$7,{variant:"destructive",onClick:e,disabled:L.value},{default:withCtx(()=>[...n[17]||(n[17]=[createTextVNode(" Delete ",-1)])]),_:1},8,["disabled"])]),_:1})])]),_:1},8,["open"])]),_:1})],64))}};export{_sfc_main as default};
