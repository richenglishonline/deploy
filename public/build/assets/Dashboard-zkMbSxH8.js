import{c as o,b as t,e as l,m as M,p as v,r as _,o as B,t as n,d as m,a as y,u as k,F as p,j as C,n as N,k as P,h as T,w as j,q as D,J as F}from"./app-Ct4hsfzr.js";import{d as H,e as V,f as z,b as L,g as U,_ as E}from"./AuthenticatedLayout-D745UfWq.js";import{a as A}from"./api-g2UYsWvT.js";function I($,g){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}const W={class:"flex items-center justify-between p-4 bg-white shadow-md rounded-lg w-full mb-3"},q={class:"flex items-center gap-4"},J=["title"],R={class:"text-xl font-semibold text-gray-900 truncate"},G={class:"relative"},K={key:0,class:"absolute -top-1 -right-1 rounded-full bg-red-500 text-white w-5 h-5 text-xs flex items-center justify-center"},O={key:0,class:"absolute right-0 mt-2 w-80 max-h-96 overflow-y-auto bg-white rounded-lg shadow-lg border border-gray-200 z-50"},Q={class:"p-2"},X=["onClick"],Y={class:"flex justify-between items-center"},Z={class:"text-sm font-medium text-gray-900"},ee=["onClick"],te={key:0,class:"text-xs text-gray-600 truncate"},se={key:1,class:"text-xs text-gray-700"},ae={key:2,class:"text-[10px] text-gray-400"},le={__name:"DashboardHeader",setup($){const g=M(),i=v(()=>g.props.auth?.user?.name??"User"),u=v(()=>g.props.auth?.user?.id),d=_([]),c=_(!1),b=v(()=>d.value.filter(e=>!e.is_read).length),f=async()=>{if(u.value){c.value=!0;try{const{data:e}=await A.get("/notification");d.value=Array.isArray(e)?e:[]}catch(e){console.error("Failed to load notifications:",e)}finally{c.value=!1}}},x=async e=>{try{await A.patch(`/notification/${e}`,{is_read:!0});const a=d.value.findIndex(r=>r.id===e);a!==-1&&(d.value[a].is_read=!0)}catch(a){console.error("Failed to mark notification as read:",a)}},s=v(()=>i.value.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase());return B(()=>{f()}),(e,a)=>(l(),o("div",W,[t("div",q,[t("div",{class:"flex items-center justify-center w-12 h-12 rounded-full bg-indigo-600 text-white font-semibold text-lg",title:i.value},n(s.value),9,J),t("h1",R,n(i.value),1)]),t("div",G,[t("button",{class:"relative p-2 rounded-full hover:bg-gray-100 transition-colors",onClick:f},[y(k(I),{class:"w-6 h-6 text-gray-700"}),b.value>0?(l(),o("span",K,n(b.value),1)):m("",!0)]),d.value.length>0?(l(),o("div",O,[t("div",Q,[a[0]||(a[0]=t("div",{class:"font-semibold px-2 py-1 border-b border-gray-200 mb-2"}," Notifications ",-1)),(l(!0),o(p,null,C(d.value,r=>(l(),o("div",{key:r.id,class:N([{"bg-gray-50":!r.is_read,"bg-white":r.is_read},"flex flex-col gap-1 p-2 rounded-md hover:bg-gray-100 cursor-pointer mb-1"]),onClick:w=>x(r.id)},[t("div",Y,[t("span",Z,n(r.type),1),t("button",{onClick:P(w=>x(r.id),["stop"]),class:"p-1 hover:bg-gray-200 rounded"},[y(k(H),{class:"w-4 h-4 text-gray-400 hover:text-gray-600"})],8,ee)]),r.label?(l(),o("span",te,n(r.label),1)):m("",!0),r.message?(l(),o("span",se,n(r.message),1)):m("",!0),r.created_at?(l(),o("span",ae,n(new Date(r.created_at).toLocaleString()),1)):m("",!0)],10,X))),128))])])):m("",!0)])]))}},oe={class:"space-y-6"},re={key:0,class:"space-y-6"},ne={class:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"},de={class:"p-5"},ie={class:"flex items-center"},ue={class:"flex-shrink-0"},ce={class:"ml-5 w-0 flex-1"},ve={class:"text-sm font-medium text-gray-500 truncate"},ge={class:"text-lg font-medium text-gray-900"},he={key:2,class:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3"},me={class:"text-sm font-medium text-gray-500"},pe={class:"mt-2 text-3xl font-semibold text-gray-900"},fe={__name:"Dashboard",setup($){const g=M(),i=_(!1),u=_(null),d=_(!1),c=v(()=>g.props.auth?.user?.role??"teacher"),b=v(()=>{if(!u.value||c.value!=="teacher")return[];const e=(u.value.stats??{}).dashboard??{},a=e.students??0,r=Array.isArray(e.activeClass)?e.activeClass.filter(h=>h!==null).length:e.activeClass&&e.activeClass!==null?1:0,w=Array.isArray(e.todayAttendance)?e.todayAttendance.filter(h=>h!==null).length:e.todayAttendance&&e.todayAttendance!==null?1:0,S=Array.isArray(e.pendingMakeups)?e.pendingMakeups.filter(h=>h!==null).length:e.pendingMakeups&&e.pendingMakeups!==null?1:0;return[{name:"Total Students",value:a,icon:V,color:"bg-blue-500"},{name:"Active Classes",value:r,icon:z,color:"bg-green-500"},{name:"Today's Attendance",value:w,icon:L,color:"bg-yellow-500"},{name:"Pending Makeups",value:S,icon:U,color:"bg-red-500"}]}),f=v(()=>{if(!u.value||c.value==="teacher")return[];const s=u.value.stats??{};return{"super-admin":[{label:"Admins",value:s.totalAdmins},{label:"Teachers",value:s.totalTeachers},{label:"Students",value:s.totalStudents},{label:"Books",value:s.totalBooks},{label:"Classes",value:s.totalClasses},{label:"Payouts",value:s.totalPayouts},{label:"Notifications",value:s.totalNotifications},{label:"Book Assignments",value:s.totalBookAssignments}],admin:[{label:"Assigned Teachers",value:s.assignedTeachers},{label:"Students",value:s.totalStudents},{label:"Books",value:s.totalBooks},{label:"Classes Created",value:s.totalClasses},{label:"Notifications",value:s.totalNotifications},{label:"Payouts",value:s.totalPayouts},{label:"Hours This Month",value:s.totalHoursMonth},{label:"Hours This Week",value:s.totalHoursWeek},{label:"Estimated Month Payout",value:`â‚±${Number(s.totalPaymentMonth??0).toFixed(2)}`}]}[c.value]??[]}),x=async()=>{if(!(i.value||d.value)){i.value=!0;try{const{data:s}=await A.get("/dashboard/stats");u.value=s,d.value=!0}catch(s){console.error("Dashboard stats error:",s),s.response?.status===401&&console.warn("Unauthorized - user may need to re-login")}finally{i.value=!1}}};return B(()=>{!d.value&&!i.value&&x()}),(s,e)=>(l(),o(p,null,[y(k(T),{title:"Dashboard"}),y(E,null,{default:j(()=>[t("div",oe,[y(le),i.value?(l(),o("div",re,[...e[0]||(e[0]=[t("div",{class:"w-full h-96 mb-12 mt-5 bg-gray-200 animate-pulse rounded"},null,-1),t("div",{class:"w-full h-96 bg-gray-200 animate-pulse rounded"},null,-1)])])):c.value==="teacher"?(l(),o(p,{key:1},[t("div",ne,[(l(!0),o(p,null,C(b.value,a=>(l(),o("div",{key:a.name,class:"bg-white overflow-hidden shadow rounded-lg"},[t("div",de,[t("div",ie,[t("div",ue,[t("div",{class:N([a.color,"p-3 rounded-md"])},[(l(),D(F(a.icon),{class:"h-6 w-6 text-white"}))],2)]),t("div",ce,[t("dl",null,[t("dt",ve,n(a.name),1),t("dd",ge,n(a.value),1)])])])])]))),128))]),e[1]||(e[1]=t("div",{class:"flex flex-col-reverse lg:flex-row gap-6"},[t("div",{class:"w-full lg:w-2/3"},[t("div",{class:"bg-white rounded-lg shadow-lg p-4 max-h-[70vh] overflow-auto"})]),t("div",{class:"w-full lg:w-1/3"},[t("div",{class:"bg-white rounded-lg shadow-lg p-4 max-h-[70vh] overflow-visible"},[t("div",{class:"text-center text-gray-500 py-8"}," Calendar will be displayed here ")])])],-1))],64)):(l(),o("div",he,[(l(!0),o(p,null,C(f.value,a=>(l(),o("div",{key:a.label,class:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm"},[t("dt",me,n(a.label),1),t("dd",pe,n(a.value??0),1)]))),128))]))])]),_:1})],64))}};export{fe as default};
