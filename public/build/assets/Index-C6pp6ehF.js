import{l as z,m as S,r as g,a as P,o as L,c as n,b as l,u as x,h as G,w as i,d as e,k as R,f as r,F as y,g as C,t as d,v as A,e as U,i as W,n as p}from"./app-0fzbWLMr.js";import{_ as H}from"./AuthenticatedLayout-7O23QDDk.js";import{a as $}from"./api-CjtnGutK.js";import{_ as b}from"./Button-lzdat9VZ.js";import{_ as J,a as K,b as Q,c as X}from"./DialogFooter-qDcU_0lk.js";import{_ as Y}from"./DialogDescription-BQFp_t3y.js";import{_ as V,a as Z}from"./Label-DdYipys5.js";import{r as I}from"./VideoCameraIcon-CkrVJPAm.js";import{r as ee}from"./PlusIcon-CKW4_cgH.js";const te={class:"flex items-center justify-between"},se={class:"flex items-center gap-3"},ae=["disabled"],le={class:"py-10"},oe={class:"mx-auto max-w-7xl space-y-6 px-4 sm:px-6 lg:px-8"},ie={class:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm"},de={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},ne=["value"],re={class:"flex items-end gap-3 sm:col-span-2 lg:col-span-3"},ue=["disabled"],ce=["disabled"],pe={class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm"},fe={class:"overflow-x-auto"},ge={class:"min-w-full divide-y divide-gray-200"},me={class:"divide-y divide-gray-200 bg-white"},ve={key:0},_e={class:"px-6 py-4"},xe={class:"flex items-center gap-2"},ye={class:"font-medium text-gray-900"},be={key:0,class:"text-xs text-gray-500"},he={class:"px-6 py-4"},we={key:0},ke={class:"font-medium text-gray-900"},Ce={class:"text-xs text-gray-500"},Ue={key:1,class:"text-gray-400"},$e={class:"px-6 py-4"},Ve={class:"px-6 py-4"},Fe={class:"px-6 py-4"},De={class:"flex items-center gap-2"},Se={key:0,class:"flex flex-col items-center justify-between gap-4 border-t border-gray-100 px-6 py-4 text-sm text-gray-600 sm:flex-row"},Pe={class:"flex items-center gap-2"},Re=["disabled"],Ae=["disabled"],Me={class:"max-w-md"},Be={class:"grid gap-4 py-4"},Ee=["value"],Ke={__name:"Index",setup(Ne){const F=z(),M=S(()=>F.props.auth?.user?.role??"teacher"),B=S(()=>F.props.auth?.user?.id),c=g(!1),h=g([]),u=g(null),w=g([]),v=g(!1),_=g(!1),k=g(null),o=P({class_id:"",attendance_id:"",file:null}),f=P({class_id:"",attendance_id:"",page:1,limit:20}),E=async()=>{try{const{data:a}=await $.get("/class",{params:{teacher_id:M.value==="teacher"?B.value:void 0,limit:100}});w.value=a.classes||[]}catch(a){console.error("Error loading filters:",a)}},m=async()=>{c.value=!0;try{const{data:a}=await $.get("/recording",{params:f});h.value=a.recordings,u.value=a.pagination}catch(a){console.error("Error fetching recordings:",a)}finally{c.value=!1}},D=a=>{u.value&&(a<1||a>u.value.totalPages||(f.page=a,m()))},N=()=>{f.class_id="",f.attendance_id="",f.page=1,m()},O=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—",T=a=>{const[t]=a.target.files??[];o.file=t??null},j=()=>{o.class_id="",o.attendance_id="",o.file=null,k.value&&(k.value.value="")},q=async()=>{if(!o.class_id||!o.file){alert("Please select a class and file");return}_.value=!0;try{const a=new FormData;a.append("class_id",o.class_id),o.attendance_id&&a.append("attendance_id",o.attendance_id),a.append("file",o.file),await $.post("/recording",a,{headers:{"Content-Type":"multipart/form-data"}}),v.value=!1,j(),await m()}catch(a){console.error("Error uploading recording:",a),alert(a.response?.data?.message||"Failed to upload recording")}finally{_.value=!1}};return L(async()=>{await E(),await m()}),(a,t)=>(r(),n(y,null,[l(x(G),{title:"Recordings"}),l(H,null,{header:i(()=>[e("div",te,[t[9]||(t[9]=e("div",null,[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Recordings "),e("p",{class:"text-sm text-gray-500"}," View and manage class recordings. ")],-1)),e("div",se,[l(b,{onClick:t[0]||(t[0]=s=>v.value=!0),disabled:c.value},{default:i(()=>[l(x(ee),{class:"h-4 w-4 mr-2"}),t[8]||(t[8]=p(" Upload Recording ",-1))]),_:1},8,["disabled"]),e("button",{onClick:m,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:c.value}," Refresh ",8,ae)])])]),default:i(()=>[e("div",le,[e("div",oe,[e("div",ie,[e("form",de,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700"}," Class ",-1)),R(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>f.class_id=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t[10]||(t[10]=e("option",{value:""},"All Classes",-1)),(r(!0),n(y,null,C(w.value,s=>(r(),n("option",{key:s.id,value:s.id},d(s.student?.name??"Unknown")+" - "+d(s.start_date),9,ne))),128))],512),[[A,f.class_id]])]),e("div",re,[e("button",{type:"button",onClick:m,class:"flex-1 rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",disabled:c.value}," Apply Filters ",8,ue),e("button",{type:"button",onClick:N,class:"flex-1 rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50",disabled:c.value}," Reset ",8,ce)])])]),e("div",pe,[e("div",fe,[e("table",ge,[t[14]||(t[14]=e("thead",{class:"bg-gray-50"},[e("tr",{class:"text-left text-xs font-semibold uppercase tracking-wider text-gray-500"},[e("th",{scope:"col",class:"px-6 py-3"}," Recording "),e("th",{scope:"col",class:"px-6 py-3"}," Class "),e("th",{scope:"col",class:"px-6 py-3"}," Uploaded By "),e("th",{scope:"col",class:"px-6 py-3"}," Uploaded At "),e("th",{scope:"col",class:"px-6 py-3"}," Actions ")])],-1)),e("tbody",me,[!c.value&&h.value.length===0?(r(),n("tr",ve,[...t[12]||(t[12]=[e("td",{colspan:"5",class:"px-6 py-4 text-center text-sm text-gray-500"}," No recordings found. ",-1)])])):U("",!0),(r(!0),n(y,null,C(h.value,s=>(r(),n("tr",{key:s.id,class:"text-sm text-gray-700 hover:bg-gray-50"},[e("td",_e,[e("div",xe,[l(x(I),{class:"h-5 w-5 text-gray-400"}),e("div",null,[e("div",ye,d(s.filename??"Untitled Recording"),1),s.drive?.link?(r(),n("div",be," Google Drive ")):U("",!0)])])]),e("td",he,[s.classSchedule?(r(),n("div",we,[e("div",ke,d(s.classSchedule.student?.name??"Unknown Student"),1),e("div",Ce,d(s.classSchedule.start_date)+" "+d(s.classSchedule.start_time),1)])):(r(),n("span",Ue,"—"))]),e("td",$e,d(s.uploader?.name??"Unknown"),1),e("td",Ve,d(O(s.created_at)),1),e("td",Fe,[e("div",De,[l(b,{onClick:Oe=>x(W).visit(a.route("recordings.show",s.id)),variant:"outline",size:"sm"},{default:i(()=>[...t[13]||(t[13]=[p(" View ",-1)])]),_:1},8,["onClick"])])])]))),128))])])]),u.value?(r(),n("div",Se,[e("div",null," Page "+d(u.value.page)+" of "+d(u.value.totalPages??1),1),e("div",Pe,[e("button",{onClick:t[2]||(t[2]=s=>D(u.value.page-1)),class:"rounded-md border border-gray-300 px-3 py-1 hover:bg-gray-50",disabled:c.value||u.value.page===1}," Previous ",8,Re),e("button",{onClick:t[3]||(t[3]=s=>D(u.value.page+1)),class:"rounded-md border border-gray-300 px-3 py-1 hover:bg-gray-50",disabled:c.value||u.value.page===u.value.totalPages}," Next ",8,Ae)])])):U("",!0)])])]),l(J,{open:v.value,"onUpdate:open":t[7]||(t[7]=s=>v.value=s)},{default:i(()=>[e("div",Me,[l(K,null,{default:i(()=>[l(Q,null,{default:i(()=>[...t[15]||(t[15]=[p("Upload Recording",-1)])]),_:1}),l(Y,null,{default:i(()=>[...t[16]||(t[16]=[p(" Upload a class recording video file. ",-1)])]),_:1})]),_:1}),e("div",Be,[e("div",null,[l(V,{for:"upload-class"},{default:i(()=>[...t[17]||(t[17]=[p("Class *",-1)])]),_:1}),R(e("select",{id:"upload-class","onUpdate:modelValue":t[4]||(t[4]=s=>o.class_id=s),class:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",required:""},[t[18]||(t[18]=e("option",{value:""},"Select a class",-1)),(r(!0),n(y,null,C(w.value,s=>(r(),n("option",{key:s.id,value:s.id},d(s.student?.name??"Unknown")+" - "+d(s.start_date)+" "+d(s.start_time),9,Ee))),128))],512),[[A,o.class_id]])]),e("div",null,[l(V,{for:"upload-attendance"},{default:i(()=>[...t[19]||(t[19]=[p("Attendance (Optional)",-1)])]),_:1}),l(Z,{id:"upload-attendance",modelValue:o.attendance_id,"onUpdate:modelValue":t[5]||(t[5]=s=>o.attendance_id=s),type:"text",placeholder:"Attendance ID"},null,8,["modelValue"])]),e("div",null,[l(V,{for:"upload-file"},{default:i(()=>[...t[20]||(t[20]=[p("Video File *",-1)])]),_:1}),e("input",{ref_key:"fileInput",ref:k,id:"upload-file",type:"file",accept:"video/*",onChange:T,class:"mt-1 block w-full text-sm text-gray-700",required:""},null,544),t[21]||(t[21]=e("p",{class:"mt-1 text-xs text-gray-500"}," Maximum size 100MB. Supported formats: MP4, MOV, WEBM, AVI. ",-1))])]),l(X,null,{default:i(()=>[l(b,{variant:"outline",onClick:t[6]||(t[6]=s=>v.value=!1),disabled:_.value},{default:i(()=>[...t[22]||(t[22]=[p(" Cancel ",-1)])]),_:1},8,["disabled"]),l(b,{onClick:q,disabled:_.value||!o.class_id||!o.file},{default:i(()=>[p(d(_.value?"Uploading...":"Upload"),1)]),_:1},8,["disabled"])]),_:1})])]),_:1},8,["open"])]),_:1})],64))}};export{Ke as default};
