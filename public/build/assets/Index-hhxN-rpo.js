import{u as L,r as g,o as j,c as m,a as l,b as i,h as C,w as o,d as e,e as V,t as r,g as c,f as _,k as D,F as N,i as S}from"./app-CGuEmW06.js";import{r as p,h as E,a as b,_ as U}from"./AuthenticatedLayout-CJGuDV3D.js";import{_ as I}from"./AdvancedTable-C74tgwHJ.js";import{_ as v}from"./Card-O4ACqxyG.js";import{_ as x}from"./Badge-xK72gQ5Q.js";import{a as f}from"./api-B9gIEsIZ.js";import{r as R}from"./ArrowDownTrayIcon-CC8afiRz.js";import{r as T}from"./EyeIcon-BaQtjq6r.js";import"./ArrowUpIcon-DLRLa_dE.js";import"./TrashIcon-7rQaTgdF.js";const F={class:"space-y-6 pb-8"},M={class:"grid grid-cols-1 gap-6 sm:grid-cols-3"},O={class:"flex items-center justify-between"},P={class:"mt-2 text-3xl font-semibold text-gray-900"},q={class:"rounded-lg bg-blue-50 p-3"},z={class:"flex items-center justify-between"},G={class:"mt-2 text-3xl font-semibold text-gray-900"},H={class:"rounded-lg bg-green-50 p-3"},J={class:"flex items-center justify-between"},K={class:"mt-2 text-3xl font-semibold text-gray-900"},Q={class:"rounded-lg bg-purple-50 p-3"},W={class:"flex items-center gap-3"},X={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-orange-500 to-red-600"},Y={class:"font-medium text-gray-900"},Z={key:0,class:"text-xs text-gray-500"},ee={class:"text-gray-900"},te={class:"flex items-center gap-2 text-gray-900"},se={class:"flex items-center justify-end gap-2"},ae=["onClick"],le=["onClick"],oe={key:1,class:"space-y-4"},pe={__name:"Index",setup(ne){L();const u=g(!1),d=g([]),y=g(null),h=[{key:"title",label:"Book",sortable:!0},{key:"author",label:"Author",sortable:!0},{key:"level",label:"Level",sortable:!0,align:"center"},{key:"assigned_date",label:"Assigned",sortable:!0,format:"date"},{key:"students_count",label:"Students",sortable:!0,align:"center"}],k=[{key:"level",label:"Level",type:"select",options:[{value:"",label:"All Levels"},{value:"beginner",label:"Beginner"},{value:"intermediate",label:"Intermediate"},{value:"advanced",label:"Advanced"}]}],w=async()=>{u.value=!0;try{const{data:a}=await f.get("/teacher/books");d.value=Array.isArray(a.books||a)?(a.books||a).map(s=>({...s,assigned_date:s.assigned_date||s.created_at,students_count:s.students?.length||0})):[]}catch(a){console.error("Error fetching books:",a),d.value=[]}finally{u.value=!1}},B=async()=>{try{const{data:a}=await f.get("/dashboard/stats");y.value=a?.dashboard||{}}catch(a){console.error("Error fetching stats:",a)}},$=a=>{S.visit(`/teacher/books/${a.id}`)},A=async a=>{try{const s=await f.get(`/books/${a.id}/download`,{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=t,n.setAttribute("download",a.file_name||`${a.title}.pdf`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(t)}catch(s){console.error("Error downloading book:",s),alert("Failed to download book")}};return j(()=>{w(),B()}),(a,s)=>(c(),m(N,null,[l(i(C),{title:"My Books"}),l(U,null,{default:o(()=>[e("div",F,[s[6]||(s[6]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"My Books"),e("p",{class:"mt-1 text-sm text-gray-500"}," View assigned books and materials ")],-1)),e("div",M,[l(v,{class:"p-6"},{default:o(()=>[e("div",O,[e("div",null,[s[0]||(s[0]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Books",-1)),e("p",P,r(d.value.length),1)]),e("div",q,[l(i(p),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),l(v,{class:"p-6"},{default:o(()=>[e("div",z,[e("div",null,[s[1]||(s[1]=e("p",{class:"text-sm font-medium text-gray-600"},"Active Assignments",-1)),e("p",G,r(d.value.filter(t=>t.students_count>0).length),1),s[2]||(s[2]=e("p",{class:"mt-1 text-xs text-gray-500"},"In use",-1))]),e("div",H,[l(i(E),{class:"h-8 w-8 text-green-600"})])])]),_:1}),l(v,{class:"p-6"},{default:o(()=>[e("div",J,[e("div",null,[s[3]||(s[3]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Students",-1)),e("p",K,r(d.value.reduce((t,n)=>t+(n.students_count||0),0)),1),s[4]||(s[4]=e("p",{class:"mt-1 text-xs text-gray-500"},"Assigned",-1))]),e("div",Q,[l(i(b),{class:"h-8 w-8 text-purple-600"})])])]),_:1})]),u.value?(c(),m("div",oe,[...s[5]||(s[5]=[e("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(c(),V(I,{key:0,title:"Assigned Books",columns:h,data:d.value,searchable:!0,paginated:!0,filters:k,"items-per-page":25,"row-key":"id"},{"cell-title":o(({row:t})=>[e("div",W,[e("div",X,[l(i(p),{class:"h-5 w-5 text-white"})]),e("div",null,[e("div",Y,r(t.title||"Untitled"),1),t.isbn?(c(),m("div",Z,"ISBN: "+r(t.isbn),1)):D("",!0)])])]),"cell-author":o(({row:t})=>[e("div",ee,r(t.author||"—"),1)]),"cell-level":o(({row:t})=>[l(x,{variant:t.level==="beginner"?"primary":t.level==="intermediate"?"warning":"success"},{default:o(()=>[_(r(t.level||"N/A"),1)]),_:2},1032,["variant"])]),"cell-assigned_date":o(({row:t})=>[e("div",te,[l(i(b),{class:"h-4 w-4 text-gray-400"}),_(" "+r(t.assigned_date?new Date(t.assigned_date).toLocaleDateString():"—"),1)])]),"cell-students_count":o(({row:t})=>[l(x,{variant:"secondary"},{default:o(()=>[_(r(t.students_count||0)+" students ",1)]),_:2},1024)]),"row-actions":o(({row:t})=>[e("div",se,[e("button",{onClick:n=>A(t),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-green-600 transition-colors",title:"Download"},[l(i(R),{class:"h-5 w-5"})],8,ae),e("button",{onClick:n=>$(t),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[l(i(T),{class:"h-5 w-5"})],8,le)])]),_:1},8,["data"]))])]),_:1})],64))}};export{pe as default};
