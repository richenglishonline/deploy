import{u as V,r as y,o as I,c as x,a as l,b as n,h as M,w as r,d as e,e as O,f as h,t as i,g as u,k as G,F as P,i as k}from"./app-BiSPCPuo.js";import{r as B,h as W,e as A,_ as q}from"./AuthenticatedLayout-57Q77M7z.js";import{_ as H}from"./AdvancedTable-5fi55ECo.js";import{_ as J}from"./Button-cwC7HEN4.js";import{_ as C}from"./Badge-DAiRCop6.js";import{_ as g}from"./Card-B0sMFwFC.js";import{a as c}from"./api-BtR7IrG5.js";import{r as K}from"./PlusIcon-BOqTvPvA.js";import{r as j}from"./ArrowDownTrayIcon-DICVMDSG.js";import{r as Q}from"./EyeIcon-BomQU5Ge.js";import{r as X}from"./PencilIcon-B9iUmX0Q.js";import{r as Y}from"./TrashIcon-DlbRnS0G.js";import"./ArrowUpIcon-IEJdmouC.js";const Z={class:"space-y-6 pb-8"},ee={class:"flex items-center justify-between"},te={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},se={class:"flex items-center justify-between"},ae={class:"mt-2 text-3xl font-semibold text-gray-900"},le={class:"rounded-lg bg-blue-50 p-3"},oe={class:"flex items-center justify-between"},re={class:"mt-2 text-3xl font-semibold text-gray-900"},ne={class:"rounded-lg bg-green-50 p-3"},ie={class:"flex items-center justify-between"},de={class:"mt-2 text-3xl font-semibold text-gray-900"},ce={class:"rounded-lg bg-purple-50 p-3"},ue={class:"flex items-center justify-between"},ge={class:"mt-2 text-3xl font-semibold text-gray-900"},me={class:"rounded-lg bg-orange-50 p-3"},be={class:"flex items-center gap-3"},ve={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-orange-500 to-red-600"},pe={class:"font-medium text-gray-900"},_e={key:0,class:"text-xs text-gray-500"},fe={class:"text-gray-900"},ye={class:"text-gray-900"},xe={class:"text-right text-gray-900"},he={class:"flex items-center justify-end gap-2"},ke=["onClick"],we=["onClick"],$e=["onClick"],Be=["onClick"],Ae={key:1,class:"space-y-4"},Me={__name:"Index",setup(Ce){V();const m=y(!1),d=y([]),w=y(null),b=[{key:"title",label:"Title",sortable:!0},{key:"author",label:"Author",sortable:!0},{key:"level",label:"Level",sortable:!0,align:"center"},{key:"category",label:"Category",sortable:!0},{key:"assigned_count",label:"Assigned",sortable:!0,align:"center"},{key:"file_size",label:"File Size",sortable:!0,align:"right"},{key:"created_at",label:"Uploaded",sortable:!0,format:"date"}],E=[{key:"level",label:"Level",type:"select",options:[{value:"",label:"All Levels"},{value:"beginner",label:"Beginner"},{value:"intermediate",label:"Intermediate"},{value:"advanced",label:"Advanced"}]},{key:"category",label:"Category",type:"select",options:[{value:"",label:"All Categories"},{value:"grammar",label:"Grammar"},{value:"vocabulary",label:"Vocabulary"},{value:"reading",label:"Reading"},{value:"writing",label:"Writing"}]}],v=async()=>{m.value=!0;try{const{data:a}=await c.get("/books");d.value=Array.isArray(a.books||a)?(a.books||a).map(t=>({...t,assigned_count:t.assignments?.length||0,file_size:t.file_size?`${(t.file_size/1024/1024).toFixed(2)} MB`:"N/A"})):[]}catch(a){console.error("Error fetching books:",a),d.value=[]}finally{m.value=!1}},p=async()=>{try{const{data:a}=await c.get("/dashboard/stats");w.value=a?.stats||{}}catch(a){console.error("Error fetching stats:",a)}},R=()=>{k.visit("/super-admin/books/create")},U=a=>{k.visit(`/super-admin/books/${a.id}`)},L=a=>{k.visit(`/super-admin/books/${a.id}?edit=true`)},z=async a=>{if(confirm(`Are you sure you want to delete "${a.title}"?`))try{await c.delete(`/books/${a.id}`),await v(),await p()}catch(t){console.error("Error deleting book:",t),alert("Failed to delete book")}},D=async a=>{try{const t=await c.get(`/books/${a.id}/download`,{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),o=document.createElement("a");o.href=s,o.setAttribute("download",a.file_name||`${a.title}.pdf`),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(s)}catch(t){console.error("Error downloading book:",t),alert("Failed to download book")}},F=async()=>{if(confirm(`Are you sure you want to delete ${selectedRows.value.length} book(s)?`))try{await Promise.all(selectedRows.value.map(a=>c.delete(`/books/${a.id}`))),selectedRows.value=[],await v(),await p()}catch(a){console.error("Error bulk deleting books:",a),alert("Failed to delete some books")}},N=a=>{const t=b.map(f=>f.label).join(","),s=a.map(f=>b.map(T=>`"${f[T.key]||""}"`).join(",")).join(`
`),o=`${t}
${s}`,S=new Blob([o],{type:"text/csv"}),$=window.URL.createObjectURL(S),_=document.createElement("a");_.href=$,_.download=`books-${new Date().toISOString().split("T")[0]}.csv`,_.click(),window.URL.revokeObjectURL($)};return I(()=>{v(),p()}),(a,t)=>(u(),x(P,null,[l(n(M),{title:"Books Management"}),l(q,null,{default:r(()=>[e("div",Z,[e("div",ee,[t[1]||(t[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Books Management"),e("p",{class:"mt-1 text-sm text-gray-500"}," Manage curriculum books and materials ")],-1)),l(J,{onClick:R,variant:"primary"},{default:r(()=>[l(n(K),{class:"h-5 w-5 mr-2"}),t[0]||(t[0]=h(" Upload Book ",-1))]),_:1})]),e("div",te,[l(g,{class:"p-6"},{default:r(()=>[e("div",se,[e("div",null,[t[2]||(t[2]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Books",-1)),e("p",ae,i(w.value?.totalBooks||d.value.length),1)]),e("div",le,[l(n(B),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),l(g,{class:"p-6"},{default:r(()=>[e("div",oe,[e("div",null,[t[3]||(t[3]=e("p",{class:"text-sm font-medium text-gray-600"},"Assigned Books",-1)),e("p",re,i(d.value.filter(s=>s.assigned_count>0).length),1),t[4]||(t[4]=e("p",{class:"mt-1 text-xs text-gray-500"},"In use",-1))]),e("div",ne,[l(n(W),{class:"h-8 w-8 text-green-600"})])])]),_:1}),l(g,{class:"p-6"},{default:r(()=>[e("div",ie,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Assignments",-1)),e("p",de,i(d.value.reduce((s,o)=>s+(o.assigned_count||0),0)),1),t[6]||(t[6]=e("p",{class:"mt-1 text-xs text-gray-500"},"Active",-1))]),e("div",ce,[l(n(A),{class:"h-8 w-8 text-purple-600"})])])]),_:1}),l(g,{class:"p-6"},{default:r(()=>[e("div",ue,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Storage Used",-1)),e("p",ge,i((d.value.reduce((s,o)=>s+(o.file_size?parseFloat(o.file_size):0),0)/1024).toFixed(2))+" GB ",1),t[8]||(t[8]=e("p",{class:"mt-1 text-xs text-gray-500"},"Total size",-1))]),e("div",me,[l(n(j),{class:"h-8 w-8 text-orange-600"})])])]),_:1})]),m.value?(u(),x("div",Ae,[...t[9]||(t[9]=[e("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(u(),O(H,{key:0,title:"All Books",columns:b,data:d.value,searchable:!0,paginated:!0,selectable:!0,exportable:!0,filters:E,"items-per-page":25,"row-key":"id",onExport:N,onBulkDelete:F},{"cell-title":r(({row:s})=>[e("div",be,[e("div",ve,[l(n(B),{class:"h-5 w-5 text-white"})]),e("div",null,[e("div",pe,i(s.title||"Untitled"),1),s.isbn?(u(),x("div",_e,"ISBN: "+i(s.isbn),1)):G("",!0)])])]),"cell-author":r(({row:s})=>[e("div",fe,i(s.author||"—"),1)]),"cell-level":r(({row:s})=>[l(C,{variant:s.level==="beginner"?"primary":s.level==="intermediate"?"warning":"success"},{default:r(()=>[h(i(s.level||"N/A"),1)]),_:2},1032,["variant"])]),"cell-category":r(({row:s})=>[e("div",ye,i(s.category||"—"),1)]),"cell-assigned_count":r(({row:s})=>[l(C,{variant:"secondary"},{default:r(()=>[l(n(A),{class:"h-3 w-3 mr-1 inline"}),h(" "+i(s.assigned_count||0),1)]),_:2},1024)]),"cell-file_size":r(({row:s})=>[e("div",xe,i(s.file_size||"—"),1)]),"row-actions":r(({row:s})=>[e("div",he,[e("button",{onClick:o=>D(s),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"Download"},[l(n(j),{class:"h-5 w-5"})],8,ke),e("button",{onClick:o=>U(s),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[l(n(Q),{class:"h-5 w-5"})],8,we),e("button",{onClick:o=>L(s),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"Edit"},[l(n(X),{class:"h-5 w-5"})],8,$e),e("button",{onClick:o=>z(s),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-red-600 transition-colors",title:"Delete"},[l(n(Y),{class:"h-5 w-5"})],8,Be)])]),_:1},8,["data"]))])]),_:1})],64))}};export{Me as default};
