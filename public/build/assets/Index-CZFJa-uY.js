import{u as N,r as h,j as S,o as M,c as w,a as o,b as n,h as O,w as r,d as t,e as I,i as j,f as u,t as l,g as m,k as q,F as z}from"./app-Cmmq__Tw.js";import{k as H,d as G,j as J,_ as K}from"./AuthenticatedLayout-B2GbnFPi.js";import{_ as Q}from"./AdvancedTable-CIaIA73U.js";import{_ as F}from"./Button-D72KtQR-.js";import{_ as k}from"./Badge-BZFBi4LI.js";import{_ as p}from"./Card-CcoMGp7w.js";import{a as g}from"./api-BS-ONIJM.js";import{r as W}from"./PlusIcon-3lCZdoOe.js";import{r as D}from"./CheckCircleIcon-Cn5KpQJI.js";import{r as X}from"./EyeIcon-DroDtrWB.js";import"./ArrowDownTrayIcon-CzbVfJHZ.js";import"./ArrowUpIcon-DRFX-h9Y.js";import"./TrashIcon-DD0p8Ace.js";const Y={class:"space-y-6 pb-8"},Z={class:"flex items-center justify-between"},ee={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},te={class:"flex items-center justify-between"},se={class:"mt-2 text-3xl font-semibold text-gray-900"},ae={class:"rounded-lg bg-blue-50 p-3"},oe={class:"flex items-center justify-between"},re={class:"mt-2 text-3xl font-semibold text-gray-900"},le={class:"rounded-lg bg-yellow-50 p-3"},ne={class:"flex items-center justify-between"},ie={class:"mt-2 text-3xl font-semibold text-gray-900"},ce={class:"rounded-lg bg-orange-50 p-3"},de={class:"flex items-center justify-between"},ue={class:"mt-2 text-3xl font-semibold text-gray-900"},me={class:"rounded-lg bg-green-50 p-3"},pe={class:"flex items-center gap-3"},ge={class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-500 to-pink-600"},fe={class:"text-sm font-semibold text-white"},ye={class:"font-medium text-gray-900"},xe={class:"text-right font-semibold text-gray-900"},_e={class:"text-gray-900"},be={class:"flex items-center justify-end gap-2"},ve=["onClick"],he=["onClick"],we={key:1,class:"space-y-4"},Te={__name:"Index",setup(ke){N();const f=h(!1),i=h([]),C=h(null),y=[{key:"teacher",label:"Teacher",sortable:!0},{key:"amount",label:"Amount",sortable:!0,format:"currency",align:"right"},{key:"period",label:"Period",sortable:!0},{key:"hours",label:"Hours",sortable:!0,align:"center"},{key:"classes",label:"Classes",sortable:!0,align:"center"},{key:"status",label:"Status",sortable:!0,align:"center"},{key:"processed_at",label:"Processed",sortable:!0,format:"date"}],A=[{key:"status",label:"Status",type:"select",options:[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"processed",label:"Processed"},{value:"failed",label:"Failed"}]}],x=async()=>{f.value=!0;try{const{data:s}=await g.get("/payouts");i.value=Array.isArray(s.payouts||s)?(s.payouts||s).map(e=>({...e,teacher:e.teacher?`${e.teacher.first_name||""} ${e.teacher.last_name||""}`.trim()||e.teacher.email:"N/A",period:e.period||`${new Date(e.start_date).toLocaleDateString()} - ${new Date(e.end_date).toLocaleDateString()}`,hours:e.total_hours||0,classes:e.classes_count||0,status:e.status||"pending"})):[]}catch(s){console.error("Error fetching payouts:",s),i.value=[]}finally{f.value=!1}},_=async()=>{try{const{data:s}=await g.get("/dashboard/stats");C.value=s?.stats||{}}catch(s){console.error("Error fetching stats:",s)}},L=s=>{j.visit(`/super-admin/payouts/${s.id}`)},E=async s=>{if(confirm(`Process payout of $${s.amount} to ${s.teacher}?`))try{await g.post(`/payouts/${s.id}/process`),await x(),await _()}catch(e){console.error("Error processing payout:",e),alert("Failed to process payout")}},R=async()=>{if(confirm(`Process ${selectedRows.value.length} payout(s)?`))try{await Promise.all(selectedRows.value.map(s=>g.post(`/payouts/${s.id}/process`))),selectedRows.value=[],await x(),await _()}catch(s){console.error("Error bulk processing payouts:",s),alert("Failed to process some payouts")}},U=s=>{const e=y.map(v=>v.label).join(","),a=s.map(v=>y.map(P=>{let d=v[P.key]||"";return P.format==="currency"&&(d=typeof d=="number"?d:parseFloat(d)||0),`"${String(d).replace(/"/g,'""')}"`}).join(",")).join(`
`),c=`${e}
${a}`,V=new Blob([c],{type:"text/csv"}),$=window.URL.createObjectURL(V),b=document.createElement("a");b.href=$,b.download=`payouts-${new Date().toISOString().split("T")[0]}.csv`,b.click(),window.URL.revokeObjectURL($)},B=S(()=>i.value.filter(s=>s.status==="pending").reduce((s,e)=>s+(parseFloat(e.amount)||0),0)),T=S(()=>i.value.filter(s=>s.status==="processed").reduce((s,e)=>s+(parseFloat(e.amount)||0),0));return M(()=>{x(),_()}),(s,e)=>(m(),w(z,null,[o(n(O),{title:"Payouts Management"}),o(K,null,{default:r(()=>[t("div",Y,[t("div",Z,[e[2]||(e[2]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Payouts Management"),t("p",{class:"mt-1 text-sm text-gray-500"}," Manage teacher payouts and salary payments ")],-1)),o(F,{onClick:e[0]||(e[0]=()=>n(j).visit("/super-admin/payouts/process")),variant:"primary"},{default:r(()=>[o(n(W),{class:"h-5 w-5 mr-2"}),e[1]||(e[1]=u(" Process Payouts ",-1))]),_:1})]),t("div",ee,[o(p,{class:"p-6"},{default:r(()=>[t("div",te,[t("div",null,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Payouts",-1)),t("p",se,l(i.value.length),1),e[4]||(e[4]=t("p",{class:"mt-1 text-xs text-gray-500"},"All time",-1))]),t("div",ae,[o(n(H),{class:"h-8 w-8 text-blue-600"})])])]),_:1}),o(p,{class:"p-6"},{default:r(()=>[t("div",oe,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600"},"Pending",-1)),t("p",re,l(i.value.filter(a=>a.status==="pending").length),1),e[6]||(e[6]=t("p",{class:"mt-1 text-xs text-yellow-600"},"Requires processing",-1))]),t("div",le,[o(n(G),{class:"h-8 w-8 text-yellow-600"})])])]),_:1}),o(p,{class:"p-6"},{default:r(()=>[t("div",ne,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-600"},"Pending Amount",-1)),t("p",ie," $"+l(B.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),e[8]||(e[8]=t("p",{class:"mt-1 text-xs text-gray-500"},"To be processed",-1))]),t("div",ce,[o(n(J),{class:"h-8 w-8 text-orange-600"})])])]),_:1}),o(p,{class:"p-6"},{default:r(()=>[t("div",de,[t("div",null,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Processed",-1)),t("p",ue," $"+l(T.value.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1),e[10]||(e[10]=t("p",{class:"mt-1 text-xs text-green-600"},"All time",-1))]),t("div",me,[o(n(D),{class:"h-8 w-8 text-green-600"})])])]),_:1})]),f.value?(m(),w("div",we,[...e[11]||(e[11]=[t("div",{class:"h-64 rounded-xl bg-gray-200 animate-pulse"},null,-1)])])):(m(),I(Q,{key:0,title:"All Payouts",columns:y,data:i.value,searchable:!0,paginated:!0,selectable:!0,exportable:!0,filters:A,"items-per-page":25,"row-key":"id",onExport:U},{"cell-teacher":r(({row:a})=>[t("div",pe,[t("div",ge,[t("span",fe,l(a.teacher.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2)),1)]),t("span",ye,l(a.teacher),1)])]),"cell-amount":r(({row:a})=>[t("div",xe," $"+l(parseFloat(a.amount||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),1)]),"cell-period":r(({row:a})=>[t("div",_e,l(a.period||"â€”"),1)]),"cell-hours":r(({row:a})=>[o(k,{variant:"secondary"},{default:r(()=>[u(l(a.hours||0)+"h",1)]),_:2},1024)]),"cell-classes":r(({row:a})=>[o(k,{variant:"secondary"},{default:r(()=>[u(l(a.classes||0),1)]),_:2},1024)]),"cell-status":r(({row:a})=>[o(k,{variant:a.status==="processed"?"success":a.status==="pending"?"warning":"danger"},{default:r(()=>[u(l(a.status||"pending"),1)]),_:2},1032,["variant"])]),"row-actions":r(({row:a})=>[t("div",be,[t("button",{onClick:c=>L(a),class:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors",title:"View Details"},[o(n(X),{class:"h-5 w-5"})],8,ve),a.status==="pending"?(m(),w("button",{key:0,onClick:c=>E(a),class:"rounded-lg px-3 py-1.5 text-xs font-medium text-white bg-green-600 hover:bg-green-700 transition-colors",title:"Process Payout"}," Process ",8,he)):q("",!0)])]),"bulk-actions":r(({selectedRows:a})=>[o(F,{onClick:R,variant:"primary",size:"sm"},{default:r(()=>[o(n(D),{class:"h-4 w-4 mr-2"}),u(" Process Selected ("+l(a.length)+") ",1)]),_:2},1024)]),_:1},8,["data"]))])]),_:1})],64))}};export{Te as default};
