# RichEnglish Laravel Application - Complete Installation Guide

This guide provides step-by-step instructions to install, configure, and run the RichEnglish Laravel application from scratch.

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [System Requirements](#system-requirements)
3. [Installation Steps](#installation-steps)
4. [Configuration](#configuration)
5. [Database Setup](#database-setup)
6. [Running the Application](#running-the-application)
7. [Production Deployment](#production-deployment)
8. [Troubleshooting](#troubleshooting)
9. [Additional Resources](#additional-resources)

---

## Prerequisites

Before starting, ensure you have the following installed on your system:

### Required Software

- **PHP 8.2 or higher** with extensions:
  - BCMath
  - Ctype
  - cURL
  - DOM
  - Fileinfo
  - JSON
  - Mbstring
  - OpenSSL
  - PCRE
  - PDO
  - Tokenizer
  - XML
- **Composer** (PHP dependency manager) - [Download](https://getcomposer.org/download/)
- **Node.js 18.x or higher** and **npm** - [Download](https://nodejs.org/)
- **MySQL 8.0 or higher** (or MariaDB 10.3+)
- **Git** - [Download](https://git-scm.com/downloads)

### Optional but Recommended

- **Redis** (for caching and sessions)
- **Mail server** (SMTP) or service (Mailgun, SendGrid, etc.) for email functionality

---

## System Requirements

### Minimum Requirements

- **OS**: Windows 10+, macOS 10.15+, or Linux (Ubuntu 20.04+)
- **RAM**: 2GB minimum (4GB recommended)
- **Disk Space**: 500MB for application + database
- **PHP Memory Limit**: 256MB minimum (512MB recommended)

### Recommended for Development

- **RAM**: 8GB+
- **PHP Memory Limit**: 512MB+
- **CPU**: Multi-core processor

---

## Installation Steps

### Step 1: Clone the Repository

```bash
git clone https://github.com/LYLENGQT/richenglish.git
cd richenglish/laravelserver
```

Or if you already have the repository:

```bash
cd laravelserver
git checkout laravel
git pull origin laravel
```

### Step 2: Install PHP Dependencies

```bash
composer install
```

This will install all Laravel framework dependencies and packages.

**Note**: If you encounter memory issues, use:
```bash
php -d memory_limit=512M composer install
```

### Step 3: Install Node.js Dependencies

```bash
npm install
```

Or if you encounter peer dependency issues:

```bash
npm install --legacy-peer-deps
```

### Step 4: Configure Environment

Copy the example environment file:

```bash
cp .env.example .env
```

Or on Windows PowerShell:
```powershell
Copy-Item .env.example .env
```

### Step 5: Generate Application Key

```bash
php artisan key:generate
```

This generates a unique encryption key for your application.

---

## Configuration

### Environment Variables

Edit the `.env` file with your configuration:

#### Database Configuration

```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=richenglish
DB_USERNAME=your_mysql_username
DB_PASSWORD=your_mysql_password
```

#### Application Configuration

```env
APP_NAME="RichEnglish"
APP_ENV=local
APP_KEY=base64:... (generated by key:generate)
APP_DEBUG=true
APP_URL=http://localhost:8000
APP_TIMEZONE=Asia/Manila
```

#### Mail Configuration (for email notifications)

**Using SMTP:**
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=your_username
MAIL_PASSWORD=your_password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@richenglish.com
MAIL_FROM_NAME="${APP_NAME}"
```

**Using Mailgun:**
```env
MAIL_MAILER=mailgun
MAILGUN_DOMAIN=your-domain.mailgun.org
MAILGUN_SECRET=your-mailgun-secret
MAILGUN_ENDPOINT=api.mailgun.net
```

**Using SendGrid:**
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.sendgrid.net
MAIL_PORT=587
MAIL_USERNAME=apikey
MAIL_PASSWORD=your-sendgrid-api-key
MAIL_ENCRYPTION=tls
```

#### Session & Cache Configuration

```env
SESSION_DRIVER=file
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
```

**For better performance (if Redis is installed):**
```env
SESSION_DRIVER=redis
CACHE_DRIVER=redis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379
```

#### File Storage

```env
FILESYSTEM_DISK=local
# For production, use 's3' and configure AWS credentials
```

---

## Database Setup

### Step 1: Create Database

Log into MySQL:

```bash
mysql -u root -p
```

Create the database:

```sql
CREATE DATABASE richenglish CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

Or using MySQL command line:

```bash
mysql -u root -p -e "CREATE DATABASE richenglish CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

### Step 2: Run Migrations

Create all database tables:

```bash
php artisan migrate
```

### Step 3: Seed Database (Optional but Recommended)

Populate the database with sample data including:
- Super admin user
- Admin users
- Teacher users
- Students
- Classes
- Books
- Sample records

```bash
php artisan db:seed --class=RichEnglishSeeder
```

**Default Login Credentials** (after seeding):
- **Email**: `richenglish@admin.com`
- **Password**: `password` (check seeder file for exact password)

### Step 4: Link Storage

Create symbolic link for public file access:

```bash
php artisan storage:link
```

This allows uploaded files (books, resumes, videos, screenshots) to be accessible via the web.

---

## Running the Application

### Development Mode

This application uses **Inertia.js + Vue.js**, which requires **TWO servers** to run simultaneously:

#### Option A: Run Servers Separately (Recommended for Development)

**Terminal 1 - Laravel Server:**
```bash
php artisan serve
```
Server runs at: `http://localhost:8000`

**Terminal 2 - Vite Dev Server:**
```bash
npm run dev
```
Vite runs at: `http://localhost:5173` (for hot-reload)

**Access the application at:** `http://localhost:8000`

#### Option B: Use Composer Script (Runs Both Together)

```bash
composer run dev
```

This starts both servers concurrently. Press `Ctrl+C` to stop all services.

### Production Mode

Build assets first, then run only Laravel:

```bash
# Build production assets
npm run build

# Run Laravel server
php artisan serve
```

Or use a production web server (Apache/Nginx) pointing to the `public/` directory.

---

## Production Deployment

### Step 1: Optimize Application

```bash
# Cache configuration
php artisan config:cache

# Cache routes
php artisan route:cache

# Cache views
php artisan view:cache

# Optimize autoloader
composer install --optimize-autoloader --no-dev
```

### Step 2: Build Frontend Assets

```bash
npm run build
```

### Step 3: Set Production Environment

Update `.env`:
```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com
```

### Step 4: Web Server Configuration

#### Apache (.htaccess already included)

Ensure `mod_rewrite` is enabled and point DocumentRoot to `public/` directory.

#### Nginx Configuration

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/laravelserver/public;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    index index.php;

    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

### Step 5: Set Permissions

```bash
# Set ownership (adjust user/group as needed)
sudo chown -R www-data:www-data /path/to/laravelserver

# Set directory permissions
sudo find /path/to/laravelserver -type d -exec chmod 755 {} \;

# Set file permissions
sudo find /path/to/laravelserver -type f -exec chmod 644 {} \;

# Make storage and cache writable
sudo chmod -R 775 /path/to/laravelserver/storage
sudo chmod -R 775 /path/to/laravelserver/bootstrap/cache
```

### Step 6: Queue Workers (if using queues)

For background job processing:

```bash
php artisan queue:work --daemon
```

Or use a process manager like Supervisor:

```ini
[program:richenglish-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/laravelserver/artisan queue:work --sleep=3 --tries=3
autostart=true
autorestart=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/path/to/laravelserver/storage/logs/worker.log
```

---

## Troubleshooting

### Common Issues and Solutions

#### 1. Port Already in Use

**Error**: `Address already in use`

**Solution**:
```bash
# Use a different port
php artisan serve --port=8001
```

Or find and kill the process:
```bash
# Linux/Mac
lsof -ti:8000 | xargs kill -9

# Windows
netstat -ano | findstr :8000
taskkill /PID <PID> /F
```

#### 2. Database Connection Error

**Error**: `SQLSTATE[HY000] [2002] Connection refused`

**Solutions**:
- Verify MySQL is running: `sudo systemctl status mysql` (Linux) or check Services (Windows)
- Check `.env` database credentials
- Ensure database exists: `mysql -u root -p -e "SHOW DATABASES;"`
- Check MySQL user permissions

#### 3. Vite Assets Not Loading

**Error**: `Failed to load module` or blank page

**Solutions**:
- Ensure `npm run dev` is running
- Check browser console for errors
- Verify `APP_URL` in `.env` matches your server URL
- Clear browser cache
- Rebuild assets: `npm run build`

#### 4. Permission Denied Errors

**Error**: `Permission denied` when writing to storage

**Solutions**:
```bash
# Linux/Mac
sudo chmod -R 775 storage bootstrap/cache
sudo chown -R www-data:www-data storage bootstrap/cache

# Windows - Run as Administrator or adjust folder permissions
```

#### 5. Composer Memory Limit

**Error**: `Fatal error: Allowed memory size exhausted`

**Solution**:
```bash
php -d memory_limit=512M composer install
```

Or permanently increase in `php.ini`:
```ini
memory_limit = 512M
```

#### 6. Missing PHP Extensions

**Error**: `Class 'PDO' not found` or similar

**Solution**:
Install missing PHP extensions:

**Ubuntu/Debian:**
```bash
sudo apt-get install php8.2-mysql php8.2-xml php8.2-mbstring php8.2-curl
```

**Windows (XAMPP):**
Edit `php.ini` and uncomment required extensions:
```ini
extension=pdo_mysql
extension=mbstring
extension=curl
extension=xml
```

**macOS (Homebrew):**
```bash
brew install php@8.2
```

#### 7. Clear All Caches

If experiencing unexpected behavior:

```bash
php artisan config:clear
php artisan cache:clear
php artisan view:clear
php artisan route:clear
php artisan optimize:clear
```

#### 8. Migration Errors

**Error**: `SQLSTATE[42S01]: Base table or view already exists`

**Solution**:
```bash
# Rollback and re-run
php artisan migrate:rollback
php artisan migrate

# Or fresh migration (WARNING: deletes all data)
php artisan migrate:fresh
php artisan db:seed --class=RichEnglishSeeder
```

#### 9. Ziggy Route Errors

**Error**: `Ziggy error: route 'xxx' is not in the route list`

**Solution**:
```bash
php artisan ziggy:generate
```

#### 10. Email Not Sending

**Solutions**:
- Verify mail configuration in `.env`
- Test with Mailtrap (development)
- Check mail logs: `storage/logs/laravel.log`
- Ensure mail server is accessible
- For production, use a service like Mailgun or SendGrid

---

## Additional Resources

### Documentation

- [Laravel Documentation](https://laravel.com/docs)
- [Inertia.js Documentation](https://inertiajs.com/)
- [Vue.js Documentation](https://vuejs.org/)
- [Vite Documentation](https://vitejs.dev/)

### Project-Specific Files

- `QUICK_START.md` - Quick reference for running the app
- `FEATURE_MIGRATION.md` - Feature migration documentation
- `COMPLETE_FEATURE_INVENTORY.md` - Complete feature list
- `SYSTEM_STRUCTURE.md` - System architecture overview

### Support

For issues or questions:
1. Check the troubleshooting section above
2. Review Laravel logs: `storage/logs/laravel.log`
3. Check browser console for frontend errors
4. Verify all prerequisites are installed correctly

### Development Tools

**Useful Artisan Commands:**
```bash
# Database
php artisan migrate              # Run migrations
php artisan migrate:rollback     # Rollback last migration
php artisan db:seed             # Seed database
php artisan tinker              # Interactive shell

# Cache
php artisan cache:clear         # Clear cache
php artisan config:clear        # Clear config cache
php artisan route:clear         # Clear route cache

# Optimization
php artisan optimize            # Cache config, routes, views
php artisan optimize:clear     # Clear all caches

# Other
php artisan route:list          # List all routes
php artisan make:controller     # Create controller
php artisan make:model          # Create model
php artisan make:migration       # Create migration
```

---

## Quick Reference Checklist

Use this checklist for a fresh installation:

- [ ] Install PHP 8.2+ with required extensions
- [ ] Install Composer
- [ ] Install Node.js 18+ and npm
- [ ] Install MySQL 8.0+
- [ ] Clone repository and navigate to `laravelserver`
- [ ] Run `composer install`
- [ ] Run `npm install`
- [ ] Copy `.env.example` to `.env`
- [ ] Run `php artisan key:generate`
- [ ] Configure `.env` with database credentials
- [ ] Create MySQL database
- [ ] Run `php artisan migrate`
- [ ] Run `php artisan db:seed --class=RichEnglishSeeder`
- [ ] Run `php artisan storage:link`
- [ ] Start Laravel server: `php artisan serve`
- [ ] Start Vite dev server: `npm run dev`
- [ ] Access application at `http://localhost:8000`
- [ ] Login with seeded credentials

---

## Notes

- **Development**: Both servers (Laravel + Vite) must run simultaneously
- **Production**: Build assets once with `npm run build`, then only Laravel server needed
- **Security**: Never commit `.env` file to version control
- **Backups**: Regularly backup your database, especially before migrations
- **Updates**: Keep dependencies updated: `composer update` and `npm update`

---

**Last Updated**: 2025-01-12
**Version**: 1.0.0

